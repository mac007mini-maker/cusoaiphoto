{"file_contents":{"replit.md":{"content":"# Viso AI - Photo Avatar Headshot\n\n## Overview\nViso AI is a Flutter-based application designed for creating studio-grade AI headshots and avatars. It offers advanced photo enhancement, face swapping, and various AI-driven transformations to produce high-quality, stylized digital images. The project addresses the growing market demand for personalized digital content and AI-powered image manipulation.\n\n## Recent Changes\n- **2025-10-16**: âœ… **Railway Production Deployed!**: Backend live at `web-production-a7698.up.railway.app` with 300s timeout. Flutter app updated to use Railway domain. Simplified config (removed nixpacks.toml, auto-detection works perfectly).\n- **2025-10-16**: ðŸš‚ **Railway Deployment Ready**: Created Railway config files (Procfile, railway.toml, railway_app.py) and complete setup guide (RAILWAY_SETUP.md). Railway Hobby ($5/mo) provides 300s timeout - perfect for face swap (30-120s).\n- **2025-10-16**: Added gunicorn to requirements.txt for production WSGI server\n- **2025-10-16**: Fixed null handling in faceSwap API response to prevent type errors\n- **2025-10-16**: Attempted Vercel deployment but discovered serverless timeout limitations (10s free tier, insufficient for face swap)\n- **2025-10-16**: Fixed replicate package version to 1.0.7 in requirements.txt\n- **2025-10-16**: Prepared Vercel deployment files for stable production backend (api/index.py, vercel.json, requirements.txt)\n- **2025-10-16**: Created comprehensive deployment guides (VERCEL_SETUP_GUIDE.md, APK_SIZE_OPTIMIZATION.md)\n- **2025-10-16**: Implemented configurable API domain for mobile builds using `--dart-define=API_DOMAIN` to prevent hardcoded URL issues when Replit domain changes\n- **2025-10-16**: Fixed critical validation bug - was reading partial data (1000 bytes) causing corrupt images; now reads full response and validates image signatures (JPEG/PNG/GIF/WEBP/BMP magic bytes)\n- **2025-10-15**: Added comprehensive debug logging and output type handling for Replicate models (list/FileOutput/string)\n- **2025-10-15**: Enhanced download validation - accept CDN octet-stream responses and detect HTML error pages\n- **2025-10-15**: Switched provider priority - Replicate PRIMARY (budget-friendly) â†’ PiAPI FALLBACK (99.9% SLA) to save credits\n- **2025-10-15**: Fixed face swap response format mismatch - server now downloads images and converts to base64 for Flutter compatibility\n\n## User Preferences\nNone documented yet.\n\n## System Architecture\n\n### UI/UX Decisions\nThe application leverages FlutterFlow-generated components to ensure a consistent, responsive design with support for both light and dark themes. It incorporates modern UI elements such as carousels with PageView sliders, smooth transitions, and dot indicators. Ad banners are strategically placed above navigation bars to comply with Google Ads policies. A feedback system allows users to submit feature requests via an integrated dialog.\n\n### Technical Implementations\nBuilt with Flutter 3.32.0 (Dart 3.8.0), Viso AI integrates with a Python Flask backend. This backend functions as a proxy, handling text and image generation, and managing complex image processing tasks with an asynchronous architecture.\n\n### Feature Specifications\n- **AI Headshot & Avatar Generation**: Studio-grade AI headshots and stylized avatars.\n- **Photo Enhancement**: Includes HD Image Enhancement with a 3-tier fallback system (Huggingface Inference API, Replicate Real-ESRGAN, Huggingface Space), and Old Photo Restoration using GFPGAN via Replicate.\n- **Face Swapping**: AI-powered face replacement with multi-provider fallback strategy (PiAPI primary with 99.9% SLA, Replicate fallback), gallery permission handling, and rewarded ad integration. Supports both image and video face swap.\n- **AI Style Templates**: Provides diverse templates for aesthetic transformations, such as cartoonification and various avatar styles.\n- **Monetization**:\n    - **Advertising**: Supports Google Mobile Ads (AdMob) for web, and a dual-network system (AdMob primary, AppLovin MAX fallback) for mobile banner, app open, and rewarded ads. Firebase Remote Config enables dynamic ad control and A/B testing.\n    - **In-App Purchases**: Utilizes RevenueCat SDK for managing premium subscriptions (Lifetime, Yearly, Weekly tiers) with test mode support. Premium features include ad bypass, unlimited creations, and priority processing.\n- **Internationalization**: Supports 20 languages with interactive selection and persistence.\n- **Mobile Download**: Images are saved directly to the device's Gallery/Photos app using the `gal` package, creating a \"VisoAI\" album and ensuring immediate visibility via MediaScanner integration.\n- **Settings**: Includes features for sharing, feedback (email integration), \"About\" section, User Agreement, Privacy Policy, and Community Guidelines.\n\n### System Design Choices\nSupabase is used for backend services, covering authentication, database management, and storage. AI functionalities are primarily powered by Huggingface Spaces and Replicate APIs, accessed via a Python Flask proxy server. Face swap templates are dynamically loaded from Supabase Storage, facilitating automated discovery and management.\n\n**Production Deployment Strategy:**\n- **Backend**: âœ… **Railway Hobby ($5/mo)** - LIVE at `web-production-a7698.up.railway.app` with 300s timeout, perfect for AI operations. Container 24/7, no cold start, stable domain.\n- **Database/Auth/Storage**: Supabase (as current)\n- **Mobile**: Flutter APK with `--split-per-abi` optimization (reduces from 200MB to 40-60MB per APK)\n- **Web**: Flutter web served from Replit (development) or static hosting (production)\n\n**Why Railway over Vercel:**\n- Railway: 300s timeout, container 24/7, $5/mo - âœ… **DEPLOYED & WORKING**\n- Vercel Free: 10s timeout (insufficient for face swap 30-120s)\n- Vercel Pro Max: 300s timeout, $40/mo (8x more expensive than Railway)\n\n## External Dependencies\n\n- **Supabase**: Backend services (authentication, database, storage), including dynamic loading of face swap templates.\n- **Google Mobile Ads (AdMob)**: Advertising for web and primary ad network for mobile.\n- **AppLovin MAX**: Secondary ad network for mobile (iOS/Android) for rewarded, interstitial, and banner ads.\n- **RevenueCat**: In-app purchase management for premium subscriptions.\n- **Huggingface API**: AI models for text/image generation, image enhancement, photo restoration, and style transfer.\n- **PiAPI**: Primary face swap provider with 99.9% uptime SLA for enterprise-grade image and video face swapping.\n- **Replicate API**: Fallback AI services for photo restoration and face-swapping.\n- **Flutter Core Dependencies**: `supabase_flutter`, `cached_network_image`, `go_router`, `google_fonts`, `flutter_animate`, `http`, `permission_handler`, `path_provider`, `applovin_max`, `share_plus`, `url_launcher`, `firebase_core`, `firebase_remote_config`, `purchases_flutter`, `gal`.","size_bytes":6923},"ios/Runner/AppDelegate.swift":{"content":"import UIKit\nimport Flutter\n\n@main\n@objc class AppDelegate: FlutterAppDelegate {\n  override func application(\n    _ application: UIApplication,\n    didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?\n  ) -> Bool {\n    GeneratedPluginRegistrant.register(with: self)\n    return super.application(application, didFinishLaunchingWithOptions: launchOptions)\n  }\n}\n","size_bytes":391},"ios/Runner/GeneratedPluginRegistrant.m":{"content":"//\n//  Generated file. Do not edit.\n//\n\n// clang-format off\n\n#import \"GeneratedPluginRegistrant.h\"\n\n#if __has_include(<app_links/AppLinksPlugin.h>)\n#import <app_links/AppLinksPlugin.h>\n#else\n@import app_links;\n#endif\n\n#if __has_include(<google_mobile_ads/FLTGoogleMobileAdsPlugin.h>)\n#import <google_mobile_ads/FLTGoogleMobileAdsPlugin.h>\n#else\n@import google_mobile_ads;\n#endif\n\n#if __has_include(<image_picker_ios/FLTImagePickerPlugin.h>)\n#import <image_picker_ios/FLTImagePickerPlugin.h>\n#else\n@import image_picker_ios;\n#endif\n\n#if __has_include(<path_provider_foundation/PathProviderPlugin.h>)\n#import <path_provider_foundation/PathProviderPlugin.h>\n#else\n@import path_provider_foundation;\n#endif\n\n#if __has_include(<shared_preferences_foundation/SharedPreferencesPlugin.h>)\n#import <shared_preferences_foundation/SharedPreferencesPlugin.h>\n#else\n@import shared_preferences_foundation;\n#endif\n\n#if __has_include(<sign_in_with_apple/SignInWithApplePlugin.h>)\n#import <sign_in_with_apple/SignInWithApplePlugin.h>\n#else\n@import sign_in_with_apple;\n#endif\n\n#if __has_include(<sqflite/SqflitePlugin.h>)\n#import <sqflite/SqflitePlugin.h>\n#else\n@import sqflite;\n#endif\n\n#if __has_include(<url_launcher_ios/URLLauncherPlugin.h>)\n#import <url_launcher_ios/URLLauncherPlugin.h>\n#else\n@import url_launcher_ios;\n#endif\n\n#if __has_include(<webview_flutter_wkwebview/WebViewFlutterPlugin.h>)\n#import <webview_flutter_wkwebview/WebViewFlutterPlugin.h>\n#else\n@import webview_flutter_wkwebview;\n#endif\n\n@implementation GeneratedPluginRegistrant\n\n+ (void)registerWithRegistry:(NSObject<FlutterPluginRegistry>*)registry {\n  [AppLinksPlugin registerWithRegistrar:[registry registrarForPlugin:@\"AppLinksPlugin\"]];\n  [FLTGoogleMobileAdsPlugin registerWithRegistrar:[registry registrarForPlugin:@\"FLTGoogleMobileAdsPlugin\"]];\n  [FLTImagePickerPlugin registerWithRegistrar:[registry registrarForPlugin:@\"FLTImagePickerPlugin\"]];\n  [PathProviderPlugin registerWithRegistrar:[registry registrarForPlugin:@\"PathProviderPlugin\"]];\n  [SharedPreferencesPlugin registerWithRegistrar:[registry registrarForPlugin:@\"SharedPreferencesPlugin\"]];\n  [SignInWithApplePlugin registerWithRegistrar:[registry registrarForPlugin:@\"SignInWithApplePlugin\"]];\n  [SqflitePlugin registerWithRegistrar:[registry registrarForPlugin:@\"SqflitePlugin\"]];\n  [URLLauncherPlugin registerWithRegistrar:[registry registrarForPlugin:@\"URLLauncherPlugin\"]];\n  [WebViewFlutterPlugin registerWithRegistrar:[registry registrarForPlugin:@\"WebViewFlutterPlugin\"]];\n}\n\n@end\n","size_bytes":2513},"ios/Flutter/flutter_export_environment.sh":{"content":"#!/bin/sh\n# This is a generated file; do not edit or check into version control.\nexport \"FLUTTER_ROOT=/nix/store/i07crp4mg1rimd97s1byrq4gasg7dsk5-flutter-wrapped-3.32.0-sdk-links\"\nexport \"FLUTTER_APPLICATION_PATH=/home/runner/workspace\"\nexport \"COCOAPODS_PARALLEL_CODE_SIGN=true\"\nexport \"FLUTTER_TARGET=lib/main.dart\"\nexport \"FLUTTER_BUILD_DIR=build\"\nexport \"FLUTTER_BUILD_NAME=1.0.0\"\nexport \"FLUTTER_BUILD_NUMBER=1\"\nexport \"DART_OBFUSCATION=false\"\nexport \"TRACK_WIDGET_CREATION=true\"\nexport \"TREE_SHAKE_ICONS=false\"\nexport \"PACKAGE_CONFIG=.dart_tool/package_config.json\"\n","size_bytes":572},"pubspec.yaml":{"content":"name: viso_a_i_photo_avatar_headshot\ndescription: Create studio-grade AI headshots & avatars in minutes. 60+ styles\nversion: 1.0.0+1\n\nenvironment:\n  sdk: '>=3.8.0 <4.0.0'\n\ndependencies:\n  app_links: 6.3.2\n  app_links_platform_interface: 2.0.2\n  auto_size_text: 3.0.0\n  cached_network_image: 3.4.1\n  cached_network_image_platform_interface: 4.1.1\n  cached_network_image_web: 1.3.1\n  collection: 1.19.1\n  cupertino_icons: ^1.0.0\n  flutter:\n    sdk: flutter\n  firebase_core: ^3.8.1\n  firebase_remote_config: ^5.1.7\n  flutter_animate: 4.5.0\n  flutter_cache_manager: 3.4.1\n  flutter_localizations:\n    sdk: flutter\n  flutter_web_plugins:\n    sdk: flutter\n  font_awesome_flutter: 10.7.0\n  from_css_color: 2.0.0\n  functions_client: 2.4.2\n  go_router: 12.1.3\n  google_fonts: 6.1.0\n  google_mobile_ads: 6.0.0\n  applovin_max: ^3.11.1\n  gotrue: 2.12.0\n  hive: 2.2.3\n  image_picker: ^1.0.4\n  gal: ^2.3.0\n  permission_handler: ^11.3.1\n  intl: 0.20.2\n  json_path: 0.7.2\n  page_transition: 2.1.0\n  path_provider: 2.1.4\n  path_provider_android: 2.2.10\n  path_provider_foundation: 2.4.0\n  path_provider_linux: 2.2.1\n  path_provider_platform_interface: 2.1.2\n  path_provider_windows: 2.3.0\n  postgrest: 2.4.2\n  provider: 6.1.5\n  realtime_client: 2.5.0\n  shared_preferences: 2.5.3\n  shared_preferences_android: 2.4.10\n  shared_preferences_foundation: 2.5.4\n  shared_preferences_linux: 2.4.1\n  shared_preferences_platform_interface: 2.4.1\n  shared_preferences_web: 2.4.3\n  shared_preferences_windows: 2.4.1\n  sign_in_with_apple: 7.0.1\n  sign_in_with_apple_platform_interface: 2.0.0\n  sign_in_with_apple_web: 3.0.0\n  sqflite: 2.3.3+1\n  sqflite_common: 2.5.4+3\n  storage_client: 2.4.0\n  supabase: 2.7.0\n  supabase_flutter: 2.9.0\n  timeago: 3.7.1\n  url_launcher: ^6.3.2\n  url_launcher_android: 6.3.16\n  url_launcher_ios: 6.3.3\n  url_launcher_linux: 3.2.1\n  url_launcher_macos: 3.2.2\n  url_launcher_platform_interface: 2.3.2\n  url_launcher_web: 2.4.1\n  url_launcher_windows: 3.1.4\n  webview_flutter: 4.13.0\n  webview_flutter_android: 4.7.0\n  webview_flutter_platform_interface: 2.13.1\n  webview_flutter_wkwebview: 3.22.0\n  share_plus: ^12.0.0\n  purchases_flutter: ^9.8.0\ndev_dependencies:\n  flutter_launcher_icons: 0.13.1\n  flutter_lints: 4.0.0\n  flutter_test:\n    sdk: flutter\n  image: 4.2.0\n  lints: 4.0.0\n\nflutter:\n  uses-material-design: true\n  \n  assets:\n    - assets/images/\n","size_bytes":2357},"android/app/src/main/kotlin/com/example/my_project/MainActivity.kt":{"content":"package com.visoai.photoheadshot\n\nimport io.flutter.embedding.android.FlutterActivity\n\nclass MainActivity: FlutterActivity() {\n}\n","size_bytes":129},"build_web.sh":{"content":"#!/bin/bash\n\n# Build script for Flutter web app in Replit environment\n# This script builds the app and patches it to use HTML renderer instead of CanvasKit\n# because Replit's preview environment doesn't support WebGL/GPU acceleration\n\necho \"Building Flutter web app...\"\nflutter build web --release\n\nif [ $? -eq 0 ]; then\n    echo \"Build successful. Patching for HTML renderer...\"\n    \n    # Change renderer from canvaskit to html in the build config\n    sed -i 's/\"renderer\":\"canvaskit\"/\"renderer\":\"html\"/g' build/web/index.html\n    \n    echo \"Patching complete. The app is ready to serve on port 5000.\"\n    echo \"Run: python3 -m http.server 5000 --directory build/web --bind 0.0.0.0\"\nelse\n    echo \"Build failed!\"\n    exit 1\nfi\n","size_bytes":729},"README.md":{"content":"# Viso AI - Photo Avatar Headshot\n\nA new Flutter project.\n\n## Getting Started\n\nFlutterFlow projects are built to run on the Flutter _stable_ release.\n","size_bytes":150},"services/image_ai_service.py":{"content":"\"\"\"\nAI Image Processing Service with Intelligent Fallback Strategy\n\nHD Image Enhancement Strategy:\n1. PRIMARY: Huggingface Inference API (Pro) - 10s timeout\n   - 4x scale: Stable Diffusion x4 Upscaler (best quality)\n   - 2x scale: Real-ESRGAN Inference API\n2. FALLBACK: Replicate Real-ESRGAN (fast, reliable, $0.0019/run)\n3. LAST RESORT: Huggingface Space (free backup)\n\nOther features use: Replicate (Primary) â†’ Huggingface Spaces (Backup)\nAll blocking I/O runs on loop's default executor (shared, no blocking shutdown)\n\"\"\"\n\nimport os\nimport base64\nimport io\nimport tempfile\nimport re\nimport asyncio\nfrom gradio_client import Client\nfrom PIL import Image\nimport replicate\nimport requests\n\nclass ImageAIService:\n    def __init__(self):\n        # Initialize Gradio clients for Huggingface Spaces (backup)\n        self.real_esrgan_client = None\n        self.vtoonify_client = None\n        self.face_swap_client = None\n        \n        # Replicate API token\n        self.replicate_token = os.environ.get('REPLICATE_API_TOKEN')\n    \n    def _init_real_esrgan_backup(self):\n        \"\"\"Initialize Real-ESRGAN Huggingface Space (backup)\"\"\"\n        if not self.real_esrgan_client:\n            try:\n                self.real_esrgan_client = Client(\"akhaliq/Real-ESRGAN\")\n            except Exception as e:\n                print(f\"Failed to init Real-ESRGAN backup: {e}\")\n        return self.real_esrgan_client\n    \n    def _init_vtoonify_backup(self):\n        \"\"\"Initialize VToonify Huggingface Space (backup)\"\"\"\n        if not self.vtoonify_client:\n            try:\n                self.vtoonify_client = Client(\"PKUWilliamYang/VToonify\")\n            except Exception as e:\n                print(f\"Failed to init VToonify backup: {e}\")\n        return self.vtoonify_client\n    \n    def _init_face_swap_backup(self):\n        \"\"\"Initialize Face Swap Huggingface Space (backup)\"\"\"\n        if not self.face_swap_client:\n            try:\n                # Using popular Roop-based Face Swap Space\n                self.face_swap_client = Client(\"prithivMLmods/Face-Swap-Roop\")\n            except Exception as e:\n                print(f\"Failed to init Face Swap backup: {e}\")\n        return self.face_swap_client\n    \n    def _init_face_swap_backup2(self):\n        \"\"\"Initialize Face Swap Huggingface Space backup 2\"\"\"\n        try:\n            return Client(\"BLACKHOOL/Roop-face-swap\")\n        except Exception as e:\n            print(f\"Failed to init Face Swap backup 2: {e}\")\n            return None\n    \n    def _decode_base64_image(self, base64_str):\n        \"\"\"\n        Decode base64 string (with or without data URI prefix) to bytes\n        Returns: (image_bytes, format_extension)\n        \"\"\"\n        # Strip data URI prefix if present\n        data_uri_pattern = r'^data:image/(jpeg|jpg|png|gif|webp|bmp);base64,'\n        match = re.match(data_uri_pattern, base64_str, re.IGNORECASE)\n        \n        if match:\n            format_ext = match.group(1).lower()\n            if format_ext == 'jpg':\n                format_ext = 'jpeg'\n            base64_str = re.sub(data_uri_pattern, '', base64_str, flags=re.IGNORECASE)\n        else:\n            format_ext = 'png'  # Default format\n        \n        # Clean base64 string: remove whitespace, newlines\n        base64_str = base64_str.strip().replace('\\n', '').replace('\\r', '').replace(' ', '')\n        \n        # Add padding if needed (base64 strings must be multiple of 4)\n        padding_needed = len(base64_str) % 4\n        if padding_needed:\n            base64_str += '=' * (4 - padding_needed)\n        \n        try:\n            image_bytes = base64.b64decode(base64_str)\n            return image_bytes, format_ext\n        except Exception as e:\n            raise ValueError(f\"Invalid base64 string (len={len(base64_str)}): {e}\")\n    \n    def _save_temp_image(self, base64_str):\n        \"\"\"\n        Save base64 image to temporary file, preserving format\n        Returns: temp file path (caller must clean up)\n        \"\"\"\n        image_bytes, format_ext = self._decode_base64_image(base64_str)\n        \n        # Create temp file with proper extension\n        suffix = f'.{format_ext}'\n        temp_file = tempfile.NamedTemporaryFile(delete=False, suffix=suffix)\n        \n        try:\n            # Load image and convert if needed\n            image = Image.open(io.BytesIO(image_bytes))\n            \n            # Convert RGBA to RGB for JPEG format\n            if format_ext == 'jpeg' and image.mode in ('RGBA', 'LA', 'P'):\n                # Create white background\n                rgb_image = Image.new('RGB', image.size, (255, 255, 255))\n                if image.mode == 'P':\n                    image = image.convert('RGBA')\n                rgb_image.paste(image, mask=image.split()[-1] if image.mode in ('RGBA', 'LA') else None)\n                image = rgb_image\n            \n            # Save to temp file\n            image.save(temp_file.name, format=format_ext.upper())\n            return temp_file.name\n            \n        except Exception as e:\n            # Cleanup on error\n            if os.path.exists(temp_file.name):\n                os.remove(temp_file.name)\n            raise ValueError(f\"Failed to save image: {e}\")\n    \n    async def hd_image(self, image_base64, scale=4):\n        \"\"\"\n        HD Image Enhancement with Intelligent Fallback\n        Strategy:\n        1. PRIMARY: Huggingface Inference API (Pro) - 10s timeout\n        2. FALLBACK: Replicate Real-ESRGAN (fast, reliable)\n        3. LAST RESORT: Huggingface Space (free backup)\n        \"\"\"\n        temp_input = None\n        result_path = None\n        \n        # Try Huggingface Inference API first (PRIMARY) with 10s timeout\n        huggingface_token = os.environ.get('HUGGINGFACE_TOKEN')\n        if huggingface_token:\n            try:\n                print(f\"ðŸš€ [PRIMARY] Trying Huggingface Inference API (timeout=10s, scale={scale})...\")\n                \n                image_bytes, format_ext = self._decode_base64_image(image_base64)\n                \n                # Choose best model based on scale\n                if scale == 4:\n                    api_url = \"https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-x4-upscaler\"\n                    print(f\"   Using Stable Diffusion x4 Upscaler\")\n                else:\n                    api_url = \"https://api-inference.huggingface.co/models/nightmareai/real-esrgan\"\n                    print(f\"   Using Real-ESRGAN Inference API\")\n                \n                headers = {\n                    \"Authorization\": f\"Bearer {huggingface_token}\",\n                }\n                \n                def _call_hf_api():\n                    # Huggingface Inference API expects raw binary image bytes\n                    response = requests.post(\n                        api_url,\n                        headers=headers,\n                        data=image_bytes,\n                        timeout=10\n                    )\n                    response.raise_for_status()\n                    return response.content\n                \n                loop = asyncio.get_event_loop()\n                \n                try:\n                    # Try with 10s timeout\n                    content = await asyncio.wait_for(\n                        loop.run_in_executor(None, _call_hf_api),\n                        timeout=10.0\n                    )\n                    \n                    result_base64 = base64.b64encode(content).decode()\n                    print(f\"âœ… HD Image success via Huggingface Pro (scale={scale}x)\")\n                    \n                    return {\n                        \"success\": True,\n                        \"image\": f\"data:image/png;base64,{result_base64}\",\n                        \"message\": f\"Image upscaled {scale}x via Huggingface Pro\",\n                        \"source\": \"huggingface_pro\"\n                    }\n                \n                except asyncio.TimeoutError:\n                    print(f\"â±ï¸ Huggingface Pro timeout (>10s)\")\n                    print(f\"ðŸ”„ Falling back to Replicate...\")\n                except Exception as e:\n                    print(f\"âš ï¸ Huggingface Pro failed: {e}\")\n                    print(f\"ðŸ”„ Falling back to Replicate...\")\n            \n            except Exception as e:\n                print(f\"âš ï¸ Huggingface Pro error: {e}\")\n                print(f\"ðŸ”„ Falling back to Replicate...\")\n        else:\n            print(f\"âš ï¸ HUGGINGFACE_TOKEN not configured, trying Replicate...\")\n        \n        # Fallback: Replicate Real-ESRGAN (FALLBACK)\n        if self.replicate_token:\n            try:\n                print(f\"ðŸ”„ [FALLBACK] Trying Replicate Real-ESRGAN (scale={scale})...\")\n                \n                image_bytes, format_ext = self._decode_base64_image(image_base64)\n                data_uri = f\"data:image/{format_ext};base64,{base64.b64encode(image_bytes).decode()}\"\n                \n                def _run_replicate():\n                    return replicate.run(\n                        \"nightmareai/real-esrgan:42fed1c4974146d4d2414e2be2c5277c7fcf05fcc3a73abf41610695738c1d7b\",\n                        input={\n                            \"image\": data_uri,\n                            \"scale\": scale,\n                            \"face_enhance\": False\n                        }\n                    )\n                \n                loop = asyncio.get_event_loop()\n                output = await loop.run_in_executor(None, _run_replicate)\n                \n                if output:\n                    print(f\"ðŸ“¥ Downloading result from Replicate...\")\n                    \n                    def _download():\n                        response = requests.get(str(output), timeout=30)\n                        response.raise_for_status()\n                        return response.content\n                    \n                    content = await loop.run_in_executor(None, _download)\n                    \n                    result_base64 = base64.b64encode(content).decode()\n                    print(f\"âœ… Real-ESRGAN success via Replicate (scale={scale}x)\")\n                    \n                    return {\n                        \"success\": True,\n                        \"image\": f\"data:image/png;base64,{result_base64}\",\n                        \"message\": f\"Image upscaled {scale}x via Replicate (fallback)\",\n                        \"source\": \"replicate\"\n                    }\n            \n            except Exception as e:\n                print(f\"âš ï¸ Replicate Real-ESRGAN failed: {e}\")\n                print(f\"ðŸ”„ Falling back to Huggingface Space (last resort)...\")\n        else:\n            print(f\"âš ï¸ REPLICATE_API_TOKEN not configured, trying Huggingface Space...\")\n        \n        # Last resort: Huggingface Space (LAST RESORT BACKUP)\n        try:\n            client = self._init_real_esrgan_backup()\n            if not client:\n                return {\"success\": False, \"error\": \"All HD image services unavailable (Huggingface Pro, Replicate, Huggingface Space)\"}\n            \n            temp_input = self._save_temp_image(image_base64)\n            \n            print(f\"ðŸ”„ [LAST RESORT] Using Huggingface Space Real-ESRGAN...\")\n            \n            def _predict():\n                return client.predict(temp_input, api_name=\"/predict\")\n            \n            loop = asyncio.get_event_loop()\n            result_path = await loop.run_in_executor(None, _predict)\n            \n            with open(result_path, 'rb') as f:\n                result_base64 = base64.b64encode(f.read()).decode()\n            \n            print(f\"âœ… Real-ESRGAN success via Huggingface Space (last resort)\")\n            \n            return {\n                \"success\": True,\n                \"image\": f\"data:image/png;base64,{result_base64}\",\n                \"message\": f\"Image upscaled {scale}x via Huggingface Space (backup)\",\n                \"source\": \"huggingface_space\"\n            }\n        \n        except Exception as e:\n            return {\"success\": False, \"error\": f\"All HD image services failed: {str(e)}\"}\n        \n        finally:\n            # Cleanup temp files\n            if temp_input and os.path.exists(temp_input):\n                try:\n                    os.remove(temp_input)\n                except:\n                    pass\n            if result_path and os.path.exists(result_path):\n                try:\n                    os.remove(result_path)\n                except:\n                    pass\n    \n    async def fix_old_photo(self, image_base64, version='v1.3'):\n        \"\"\"\n        Fix Old Photo using GFPGAN (Replicate only - production ready)\n        \"\"\"\n        try:\n            # Get Replicate API token\n            if not self.replicate_token:\n                print(\"âŒ REPLICATE_API_TOKEN not configured\")\n                return {\"success\": False, \"error\": \"REPLICATE_API_TOKEN not configured\"}\n            \n            # Decode base64 image\n            image_bytes, format_ext = self._decode_base64_image(image_base64)\n            data_uri = f\"data:image/{format_ext};base64,{base64.b64encode(image_bytes).decode()}\"\n            \n            print(f\"ðŸ”„ Calling Replicate GFPGAN API with version={version}...\")\n            \n            def _run_replicate():\n                return replicate.run(\n                    \"tencentarc/gfpgan:0fbacf7afc6c144e5be9767cff80f25aff23e52b0708f17e20f9879b2f21516c\",\n                    input={\n                        \"img\": data_uri,\n                        \"version\": version,\n                        \"scale\": 2\n                    }\n                )\n            \n            loop = asyncio.get_event_loop()\n            # Use default executor (no blocking shutdown)\n            output = await loop.run_in_executor(None, _run_replicate)\n            \n            if output:\n                print(f\"ðŸ“¥ Downloading result from Replicate...\")\n                \n                def _download():\n                    response = requests.get(str(output), timeout=30)\n                    response.raise_for_status()\n                    return response.content\n                \n                # Use default executor\n                content = await loop.run_in_executor(None, _download)\n                \n                result_base64 = base64.b64encode(content).decode()\n                print(f\"âœ… GFPGAN restoration successful via Replicate\")\n                \n                return {\n                    \"success\": True,\n                    \"image\": f\"data:image/png;base64,{result_base64}\",\n                    \"message\": \"Old photo restored successfully\",\n                    \"source\": \"replicate\"\n                }\n            else:\n                return {\"success\": False, \"error\": \"No output from Replicate API\"}\n        \n        except Exception as e:\n            print(f\"âŒ Replicate GFPGAN error: {type(e).__name__}: {e}\")\n            return {\"success\": False, \"error\": f\"Photo restoration failed: {str(e)}\"}\n    \n    async def cartoonify(self, image_base64, style='cartoon', style_degree=0.5):\n        \"\"\"\n        Cartoonify image\n        Primary: Replicate VToonify\n        Fallback: Huggingface Space\n        \"\"\"\n        temp_input = None\n        result_path = None\n        \n        # Try Replicate VToonify first (PRIMARY)\n        if self.replicate_token:\n            try:\n                print(f\"ðŸš€ [PRIMARY] Trying Replicate VToonify (style={style}, degree={style_degree})...\")\n                \n                image_bytes, format_ext = self._decode_base64_image(image_base64)\n                data_uri = f\"data:image/{format_ext};base64,{base64.b64encode(image_bytes).decode()}\"\n                \n                def _run_replicate():\n                    return replicate.run(\n                        \"412392713/vtoonify:54daf6387dc7c4d41ed5238e28e06277a6ee9027af5cd16486b7e0c261ba2522\",\n                        input={\n                            \"image\": data_uri,\n                            \"style\": style,\n                            \"style_degree\": float(style_degree),\n                            \"padding\": 200\n                        }\n                    )\n                \n                loop = asyncio.get_event_loop()\n                # Use default executor (no blocking shutdown)\n                output = await loop.run_in_executor(None, _run_replicate)\n                \n                if output:\n                    print(f\"ðŸ“¥ Downloading result from Replicate...\")\n                    \n                    def _download():\n                        response = requests.get(str(output), timeout=30)\n                        response.raise_for_status()\n                        return response.content\n                    \n                    # Use default executor\n                    content = await loop.run_in_executor(None, _download)\n                    \n                    result_base64 = base64.b64encode(content).decode()\n                    print(f\"âœ… VToonify success via Replicate (style={style})\")\n                    \n                    return {\n                        \"success\": True,\n                        \"image\": f\"data:image/png;base64,{result_base64}\",\n                        \"message\": f\"Image cartoonified with {style} style via Replicate\",\n                        \"source\": \"replicate\"\n                    }\n            \n            except Exception as e:\n                print(f\"âš ï¸ Replicate VToonify failed: {e}\")\n                print(f\"ðŸ”„ Falling back to Huggingface Space...\")\n        else:\n            print(f\"âš ï¸ REPLICATE_API_TOKEN not configured, using Huggingface backup...\")\n        \n        # Fallback to Huggingface Space (BACKUP)\n        try:\n            client = self._init_vtoonify_backup()\n            if not client:\n                return {\"success\": False, \"error\": \"Both Replicate and Huggingface VToonify unavailable\"}\n            \n            temp_input = self._save_temp_image(image_base64)\n            \n            print(f\"ðŸ”„ [BACKUP] Using Huggingface VToonify...\")\n            \n            def _predict():\n                return client.predict(\n                    temp_input,\n                    style,\n                    style_degree,\n                    0,\n                    api_name=\"/predict\"\n                )\n            \n            loop = asyncio.get_event_loop()\n            # Use default executor\n            result_path = await loop.run_in_executor(None, _predict)\n            \n            with open(result_path, 'rb') as f:\n                result_base64 = base64.b64encode(f.read()).decode()\n            \n            print(f\"âœ… VToonify success via Huggingface (backup)\")\n            \n            return {\n                \"success\": True,\n                \"image\": f\"data:image/png;base64,{result_base64}\",\n                \"message\": f\"Image cartoonified with {style} style via Huggingface (backup)\",\n                \"source\": \"huggingface\"\n            }\n        \n        except Exception as e:\n            return {\"success\": False, \"error\": f\"All services failed: {str(e)}\"}\n        \n        finally:\n            # Cleanup temp files\n            if temp_input and os.path.exists(temp_input):\n                try:\n                    os.remove(temp_input)\n                except:\n                    pass\n            if result_path and os.path.exists(result_path):\n                try:\n                    os.remove(result_path)\n                except:\n                    pass\n\n    async def face_swap(self, target_image_base64, source_face_base64):\n        \"\"\"\n        Face Swap: Swap face from source onto target image\n        CASCADING FALLBACK STRATEGY:\n        1. Replicate Models (with timeout):\n           - easel/advanced-face-swap (best quality, stable)\n           - cdingram/face-swap (backup 1, 1.1M+ runs)\n           - omniedgeio/face-swap (backup 2)\n        2. Huggingface Spaces (free fallback):\n           - prithivMLmods/Face-Swap-Roop (most popular)\n           - BLACKHOOL/Roop-face-swap (backup)\n        \n        Args:\n            target_image_base64: Template/background image (base64)\n            source_face_base64: User's face image to swap in (base64)\n        \"\"\"\n        temp_target = None\n        temp_source = None\n        result_path = None\n        \n        # Replicate Models (try in order with timeout)\n        # Only using verified working models as of Oct 2025\n        replicate_models = [\n            {\n                \"name\": \"easel/advanced-face-swap\",\n                \"params\": {\"target_image\": None, \"swap_image\": None, \"hair_source\": \"target\"},\n                \"timeout\": 90\n            }\n        ]\n        \n        # Prepare data URIs once\n        target_bytes, target_ext = self._decode_base64_image(target_image_base64)\n        source_bytes, source_ext = self._decode_base64_image(source_face_base64)\n        target_uri = f\"data:image/{target_ext};base64,{base64.b64encode(target_bytes).decode()}\"\n        source_uri = f\"data:image/{source_ext};base64,{base64.b64encode(source_bytes).decode()}\"\n        \n        # Try Replicate Models (PRIMARY - CASCADE THROUGH MODELS)\n        if self.replicate_token:\n            for i, model_config in enumerate(replicate_models, 1):\n                try:\n                    model_name = model_config[\"name\"]\n                    timeout = model_config[\"timeout\"]\n                    print(f\"ðŸš€ [REPLICATE {i}/{len(replicate_models)}] Trying {model_name} (timeout={timeout}s)...\")\n                    \n                    # Map params for each model (different models use different param names)\n                    params = model_config[\"params\"].copy()\n                    if \"target_image\" in params:\n                        params[\"target_image\"] = target_uri\n                    if \"input_image\" in params:\n                        params[\"input_image\"] = target_uri\n                    if \"swap_image\" in params:\n                        params[\"swap_image\"] = source_uri\n                    if \"source_image\" in params:\n                        params[\"source_image\"] = source_uri\n                    \n                    def _run_replicate():\n                        return replicate.run(model_name, input=params)\n                    \n                    loop = asyncio.get_event_loop()\n                    \n                    # Try with timeout\n                    try:\n                        output = await asyncio.wait_for(\n                            loop.run_in_executor(None, _run_replicate),\n                            timeout=timeout\n                        )\n                        \n                        if output:\n                            print(f\"ðŸ“¥ Downloading result from {model_name}...\")\n                            \n                            def _download():\n                                response = requests.get(str(output), timeout=30)\n                                response.raise_for_status()\n                                return response.content\n                            \n                            content = await loop.run_in_executor(None, _download)\n                            result_base64 = base64.b64encode(content).decode()\n                            \n                            print(f\"âœ… Face Swap SUCCESS via {model_name}\")\n                            return {\n                                \"success\": True,\n                                \"image\": f\"data:image/png;base64,{result_base64}\",\n                                \"message\": f\"Face swapped successfully via {model_name}\",\n                                \"source\": f\"replicate:{model_name}\"\n                            }\n                        else:\n                            print(f\"âš ï¸ {model_name} returned no output, trying next model...\")\n                            continue\n                    \n                    except asyncio.TimeoutError:\n                        print(f\"â±ï¸ {model_name} timeout ({timeout}s), trying next model...\")\n                        continue\n                \n                except Exception as e:\n                    print(f\"âš ï¸ {model_config['name']} failed: {type(e).__name__}: {e}\")\n                    print(f\"ðŸ”„ Trying next model...\")\n                    continue\n            \n            print(f\"âš ï¸ All Replicate models failed or timed out, falling back to Huggingface...\")\n        else:\n            print(f\"âš ï¸ REPLICATE_API_TOKEN not configured, trying Huggingface backup...\")\n        \n        # Fallback to Huggingface Spaces (BACKUP - CASCADE THROUGH SPACES)\n        huggingface_spaces = [\n            (\"prithivMLmods/Face-Swap-Roop\", self._init_face_swap_backup),\n            (\"BLACKHOOL/Roop-face-swap\", self._init_face_swap_backup2)\n        ]\n        \n        for i, (space_name, init_func) in enumerate(huggingface_spaces, 1):\n            temp_target_hf = None\n            temp_source_hf = None\n            executor_future = None\n            \n            try:\n                print(f\"ðŸ”„ [HUGGINGFACE {i}/2] Trying {space_name}...\")\n                \n                client = init_func()\n                if not client:\n                    print(f\"âš ï¸ Failed to init {space_name}, trying next...\")\n                    continue\n                \n                temp_target_hf = self._save_temp_image(target_image_base64)\n                temp_source_hf = self._save_temp_image(source_face_base64)\n                \n                def _predict():\n                    # Roop spaces: source_image (face), target_image (destination)\n                    return client.predict(\n                        temp_source_hf,  # Source face\n                        temp_target_hf,  # Target image\n                        api_name=\"/predict\"\n                    )\n                \n                loop = asyncio.get_event_loop()\n                \n                # Submit to executor and track future\n                executor_future = loop.run_in_executor(None, _predict)\n                \n                # Try with 60s timeout\n                try:\n                    result_path_hf = await asyncio.wait_for(executor_future, timeout=60.0)\n                    \n                    with open(result_path_hf, 'rb') as f:\n                        result_base64 = base64.b64encode(f.read()).decode()\n                    \n                    print(f\"âœ… Face Swap SUCCESS via {space_name}\")\n                    \n                    # Cleanup before returning\n                    if temp_target_hf and os.path.exists(temp_target_hf):\n                        os.remove(temp_target_hf)\n                    if temp_source_hf and os.path.exists(temp_source_hf):\n                        os.remove(temp_source_hf)\n                    if result_path_hf and os.path.exists(result_path_hf):\n                        os.remove(result_path_hf)\n                    \n                    return {\n                        \"success\": True,\n                        \"image\": f\"data:image/png;base64,{result_base64}\",\n                        \"message\": f\"Face swapped successfully via {space_name}\",\n                        \"source\": f\"huggingface:{space_name}\"\n                    }\n                \n                except asyncio.TimeoutError:\n                    print(f\"â±ï¸ {space_name} timeout (60s), trying next...\")\n                    # Cleanup input temps immediately\n                    if temp_target_hf and os.path.exists(temp_target_hf):\n                        os.remove(temp_target_hf)\n                    if temp_source_hf and os.path.exists(temp_source_hf):\n                        os.remove(temp_source_hf)\n                    \n                    # Schedule cleanup of result file when executor finishes\n                    async def _cleanup_result(future):\n                        try:\n                            result_path = await future\n                            if result_path and isinstance(result_path, str) and os.path.exists(result_path):\n                                os.remove(result_path)\n                        except Exception:\n                            pass\n                    \n                    # Fire and forget cleanup task\n                    asyncio.create_task(_cleanup_result(executor_future))\n                    continue\n            \n            except Exception as e:\n                print(f\"âš ï¸ {space_name} failed: {type(e).__name__}: {e}\")\n                print(f\"ðŸ”„ Trying next space...\")\n                # Cleanup before continue\n                if temp_target_hf and os.path.exists(temp_target_hf):\n                    try:\n                        os.remove(temp_target_hf)\n                    except:\n                        pass\n                if temp_source_hf and os.path.exists(temp_source_hf):\n                    try:\n                        os.remove(temp_source_hf)\n                    except:\n                        pass\n                continue\n        \n        # All services failed - cleanup and return error\n        if temp_target and os.path.exists(temp_target):\n            try:\n                os.remove(temp_target)\n            except:\n                pass\n        if temp_source and os.path.exists(temp_source):\n            try:\n                os.remove(temp_source)\n            except:\n                pass\n        \n        return {\n            \"success\": False,\n            \"error\": \"All face swap services (Replicate + Huggingface) failed or timed out. Please try again later.\",\n            \"error_code\": \"ALL_SERVICES_FAILED\"\n        }\n\n# Global service instance\nimage_ai_service = ImageAIService()\n","size_bytes":29415},"analysis_options.yaml":{"content":"\n\n\nanalyzer:\n  exclude:\n    - lib/custom_code/**\n    - lib/flutter_flow/custom_functions.dart\n","size_bytes":94},"android/app/src/main/java/io/flutter/plugins/GeneratedPluginRegistrant.java":{"content":"package io.flutter.plugins;\n\nimport androidx.annotation.Keep;\nimport androidx.annotation.NonNull;\nimport io.flutter.Log;\n\nimport io.flutter.embedding.engine.FlutterEngine;\n\n/**\n * Generated file. Do not edit.\n * This file is generated by the Flutter tool based on the\n * plugins that support the Android platform.\n */\n@Keep\npublic final class GeneratedPluginRegistrant {\n  private static final String TAG = \"GeneratedPluginRegistrant\";\n  public static void registerWith(@NonNull FlutterEngine flutterEngine) {\n    try {\n      flutterEngine.getPlugins().add(new com.llfbandit.app_links.AppLinksPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin app_links, com.llfbandit.app_links.AppLinksPlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.flutter_plugin_android_lifecycle.FlutterAndroidLifecyclePlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin flutter_plugin_android_lifecycle, io.flutter.plugins.flutter_plugin_android_lifecycle.FlutterAndroidLifecyclePlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.googlemobileads.GoogleMobileAdsPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin google_mobile_ads, io.flutter.plugins.googlemobileads.GoogleMobileAdsPlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.imagepicker.ImagePickerPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin image_picker_android, io.flutter.plugins.imagepicker.ImagePickerPlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.pathprovider.PathProviderPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin path_provider_android, io.flutter.plugins.pathprovider.PathProviderPlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.sharedpreferences.SharedPreferencesPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin shared_preferences_android, io.flutter.plugins.sharedpreferences.SharedPreferencesPlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new com.aboutyou.dart_packages.sign_in_with_apple.SignInWithApplePlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin sign_in_with_apple, com.aboutyou.dart_packages.sign_in_with_apple.SignInWithApplePlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new com.tekartik.sqflite.SqflitePlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin sqflite, com.tekartik.sqflite.SqflitePlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.urllauncher.UrlLauncherPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin url_launcher_android, io.flutter.plugins.urllauncher.UrlLauncherPlugin\", e);\n    }\n    try {\n      flutterEngine.getPlugins().add(new io.flutter.plugins.webviewflutter.WebViewFlutterPlugin());\n    } catch (Exception e) {\n      Log.e(TAG, \"Error registering plugin webview_flutter_android, io.flutter.plugins.webviewflutter.WebViewFlutterPlugin\", e);\n    }\n  }\n}\n","size_bytes":3201},"ios/ImageNotification/NotificationService.swift":{"content":"import FirebaseMessaging\nimport UserNotifications\n\nclass NotificationService: UNNotificationServiceExtension {\n\n    var contentHandler: ((UNNotificationContent) -> Void)?\n    var bestAttemptContent: UNMutableNotificationContent?\n\n    override func didReceive(_ request: UNNotificationRequest, withContentHandler contentHandler: @escaping (UNNotificationContent) -> Void) {\n        self.contentHandler = contentHandler\n        bestAttemptContent = request.content\n          .mutableCopy() as? UNMutableNotificationContent\n        guard let bestAttemptContent = bestAttemptContent else { return }\n        FIRMessagingExtensionHelper().populateNotificationContent(\n          bestAttemptContent,\n          withContentHandler: contentHandler)\n    }\n    \n    override func serviceExtensionTimeWillExpire() {\n        // Called just before the extension will be terminated by the system.\n        // Use this as an opportunity to deliver your \"best attempt\" at modified content, otherwise the original push payload will be used.\n        if let contentHandler = contentHandler, let bestAttemptContent =  bestAttemptContent {\n            contentHandler(bestAttemptContent)\n        }\n    }\n\n}\n","size_bytes":1181},"backup_to_github.sh":{"content":"#!/bin/bash\n\necho \"ðŸ”„ Starting GitHub backup process...\"\n\n# Add new remote if not exists\nif git remote | grep -q \"backup\"; then\n    echo \"âœ… Backup remote already exists\"\nelse\n    echo \"âž• Adding backup remote...\"\n    git remote add backup https://github.com/jokerlin135/visoaiflow-backup.git\nfi\n\n# Commit current changes\necho \"ðŸ“ Committing current changes...\"\ngit add .\ngit commit -m \"Backup: Clean UI with gradient Pro page and fixed navigation\" || echo \"No changes to commit\"\n\n# Push to backup repo\necho \"â¬†ï¸  Pushing to backup repo...\"\ngit push backup main\n\necho \"âœ… Backup completed successfully!\"\necho \"ðŸ“¦ Code backed up to: https://github.com/jokerlin135/visoaiflow-backup\"\n","size_bytes":694},"pyproject.toml":{"content":"[project]\nname = \"repl-nix-workspace\"\nversion = \"0.1.0\"\ndescription = \"Add your description here\"\nrequires-python = \">=3.11\"\ndependencies = [\n    \"gradio-client>=1.13.3\",\n    \"pillow>=11.3.0\",\n    \"replicate>=1.0.7\",\n    \"requests>=2.32.5\",\n]\n","size_bytes":243},"ios/Runner/Assets.xcassets/LaunchImage.imageset/README.md":{"content":"# Launch Screen Assets\n\nYou can customize the launch screen with your own desired assets by replacing the image files in this directory.\n\nYou can also do it by opening your Flutter project's Xcode project with `open ios/Runner.xcworkspace`, selecting `Runner/Assets.xcassets` in the Project Navigator and dropping in the desired images.","size_bytes":336},"api_server.py":{"content":"#!/usr/bin/env python3\nimport os\nimport sys\nimport json\nimport asyncio\nfrom http.server import HTTPServer, BaseHTTPRequestHandler, SimpleHTTPRequestHandler\nfrom urllib.request import Request, urlopen\nfrom urllib.error import HTTPError\nfrom pathlib import Path\n\n# Add services to path\nsys.path.insert(0, os.path.dirname(__file__))\n\nfrom services.image_ai_service import image_ai_service\nfrom services.face_swap_gateway import face_swap_gateway, FaceSwapMediaType\n\nHUGGINGFACE_TOKEN = os.getenv('HUGGINGFACE_TOKEN')\nPORT = 5000\nWEB_DIR = 'build/web'\n\nclass HuggingfaceProxyHandler(SimpleHTTPRequestHandler):\n    def __init__(self, *args, **kwargs):\n        super().__init__(*args, directory=WEB_DIR, **kwargs)\n    \n    def _set_headers(self, status_code=200, content_type='application/json'):\n        self.send_response(status_code)\n        self.send_header('Content-Type', content_type)\n        self.send_header('Access-Control-Allow-Origin', '*')\n        self.send_header('Access-Control-Allow-Methods', 'POST, GET, OPTIONS')\n        self.send_header('Access-Control-Allow-Headers', 'Content-Type')\n        self.end_headers()\n\n    def do_GET(self):\n        if self.path.startswith('/api/'):\n            self._set_headers(404)\n            self.wfile.write(json.dumps({'error': 'Use POST for API endpoints'}).encode())\n        else:\n            # SPA fallback: check if file exists, otherwise serve index.html for Flutter routing\n            requested_path = self.path.split('?')[0]  # Remove query params\n            full_path = Path(WEB_DIR) / requested_path.lstrip('/')\n            \n            # If file doesn't exist and it's not a static asset, serve index.html\n            if not full_path.exists() and not full_path.is_file():\n                if not any(requested_path.startswith(prefix) for prefix in ['/assets/', '/canvaskit/', '/flutter', '/favicon']):\n                    self.path = '/index.html'\n            \n            super().do_GET()\n\n    def do_OPTIONS(self):\n        self._set_headers()\n\n    def do_POST(self):\n        try:\n            if self.path == '/api/huggingface/text-generation':\n                self.handle_text_generation()\n            elif self.path == '/api/huggingface/text-to-image':\n                self.handle_text_to_image()\n            elif self.path == '/api/ai/hd-image':\n                self.handle_hd_image()\n            elif self.path == '/api/ai/fix-old-photo':\n                self.handle_fix_old_photo()\n            elif self.path == '/api/ai/cartoonify':\n                self.handle_cartoonify()\n            elif self.path == '/api/ai/face-swap':\n                self.handle_face_swap()\n            elif self.path == '/api/ai/face-swap-v2':\n                self.handle_face_swap_v2()\n            elif self.path == '/api/ai/video-face-swap':\n                self.handle_video_face_swap()\n            else:\n                self._set_headers(404)\n                self.wfile.write(json.dumps({'error': 'Endpoint not found'}).encode())\n        except Exception as e:\n            # Global error handler - always return JSON\n            print(f\"âŒ GLOBAL ERROR in do_POST: {type(e).__name__}: {e}\")\n            import traceback\n            traceback.print_exc()\n            try:\n                self._set_headers(500)\n                self.wfile.write(json.dumps({'error': f'Server error: {str(e)}'}).encode())\n            except:\n                pass  # If we can't even send error response, give up gracefully\n\n    def handle_text_generation(self):\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            prompt = data.get('prompt', '')\n            model = data.get('model', 'mistralai/Mistral-7B-Instruct-v0.2')\n            \n            if not HUGGINGFACE_TOKEN:\n                self._set_headers(500)\n                self.wfile.write(json.dumps({'error': 'HUGGINGFACE_TOKEN not configured'}).encode())\n                return\n            \n            hf_url = f'https://api-inference.huggingface.co/models/{model}'\n            payload = json.dumps({\n                'inputs': prompt,\n                'parameters': {\n                    'max_new_tokens': data.get('max_tokens', 250),\n                    'temperature': data.get('temperature', 0.7),\n                    'top_p': data.get('top_p', 0.9),\n                }\n            }).encode('utf-8')\n            \n            req = Request(hf_url, data=payload, headers={\n                'Authorization': f'Bearer {HUGGINGFACE_TOKEN}',\n                'Content-Type': 'application/json',\n            })\n            \n            with urlopen(req, timeout=30) as response:\n                result = json.loads(response.read().decode('utf-8'))\n                self._set_headers(200)\n                self.wfile.write(json.dumps({\n                    'success': True,\n                    'result': result\n                }).encode())\n                \n        except HTTPError as e:\n            error_msg = e.read().decode('utf-8')\n            self._set_headers(e.code)\n            self.wfile.write(json.dumps({\n                'error': f'Huggingface API error: {error_msg}'\n            }).encode())\n        except Exception as e:\n            self._set_headers(500)\n            self.wfile.write(json.dumps({\n                'error': str(e)\n            }).encode())\n\n    def handle_text_to_image(self):\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            prompt = data.get('prompt', '')\n            model = data.get('model', 'stabilityai/stable-diffusion-2')\n            \n            if not HUGGINGFACE_TOKEN:\n                self._set_headers(500)\n                self.wfile.write(json.dumps({'error': 'HUGGINGFACE_TOKEN not configured'}).encode())\n                return\n            \n            hf_url = f'https://api-inference.huggingface.co/models/{model}'\n            payload = json.dumps({'inputs': prompt}).encode('utf-8')\n            \n            req = Request(hf_url, data=payload, headers={\n                'Authorization': f'Bearer {HUGGINGFACE_TOKEN}',\n                'Content-Type': 'application/json',\n            })\n            \n            with urlopen(req, timeout=60) as response:\n                import base64\n                image_data = base64.b64encode(response.read()).decode('utf-8')\n                self._set_headers(200)\n                self.wfile.write(json.dumps({\n                    'success': True,\n                    'image': f'data:image/png;base64,{image_data}'\n                }).encode())\n                \n        except HTTPError as e:\n            error_msg = e.read().decode('utf-8')\n            self._set_headers(e.code)\n            self.wfile.write(json.dumps({\n                'error': f'Huggingface API error: {error_msg}'\n            }).encode())\n        except Exception as e:\n            self._set_headers(500)\n            self.wfile.write(json.dumps({\n                'error': str(e)\n            }).encode())\n\n    def handle_hd_image(self):\n        \"\"\"HD Image Enhancement using Real-ESRGAN\"\"\"\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            # Strip common data URI prefixes, service will handle the rest\n            image_base64 = data.get('image', '')\n            scale = data.get('scale', 4)\n            \n            if not image_base64:\n                self._set_headers(400)\n                self.wfile.write(json.dumps({'error': 'No image provided'}).encode())\n                return\n            \n            # Run async function in sync context\n            result = asyncio.run(image_ai_service.hd_image(image_base64, scale))\n            \n            if result['success']:\n                self._set_headers(200)\n                self.wfile.write(json.dumps(result).encode())\n            else:\n                self._set_headers(500)\n                self.wfile.write(json.dumps(result).encode())\n                \n        except Exception as e:\n            self._set_headers(500)\n            self.wfile.write(json.dumps({'error': str(e)}).encode())\n    \n    def handle_fix_old_photo(self):\n        \"\"\"Fix Old Photo using GFPGAN\"\"\"\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            # Strip common data URI prefixes, service will handle the rest\n            image_base64 = data.get('image', '')\n            version = data.get('version', 'v1.3')\n            \n            if not image_base64:\n                self._set_headers(400)\n                self.wfile.write(json.dumps({'error': 'No image provided'}).encode())\n                return\n            \n            # Run async function in sync context\n            result = asyncio.run(image_ai_service.fix_old_photo(image_base64, version))\n            \n            if result['success']:\n                self._set_headers(200)\n                self.wfile.write(json.dumps(result).encode())\n            else:\n                self._set_headers(500)\n                self.wfile.write(json.dumps(result).encode())\n                \n        except Exception as e:\n            self._set_headers(500)\n            self.wfile.write(json.dumps({'error': str(e)}).encode())\n    \n    def handle_cartoonify(self):\n        \"\"\"Cartoonify image using VToonify\"\"\"\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            # Strip common data URI prefixes, service will handle the rest\n            image_base64 = data.get('image', '')\n            style = data.get('style', 'cartoon')\n            style_degree = data.get('style_degree', 0.5)\n            \n            if not image_base64:\n                self._set_headers(400)\n                self.wfile.write(json.dumps({'error': 'No image provided'}).encode())\n                return\n            \n            # Run async function in sync context\n            result = asyncio.run(image_ai_service.cartoonify(image_base64, style, style_degree))\n            \n            if result['success']:\n                self._set_headers(200)\n                self.wfile.write(json.dumps(result).encode())\n            else:\n                self._set_headers(500)\n                self.wfile.write(json.dumps(result).encode())\n                \n        except Exception as e:\n            self._set_headers(500)\n            self.wfile.write(json.dumps({'error': str(e)}).encode())\n    \n    def handle_face_swap(self):\n        \"\"\"Face Swap using Multi-Provider Gateway (PiAPI â†’ Replicate)\"\"\"\n        try:\n            print(\"ðŸ“¥ [FACE_SWAP] Received request\")\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            target_image = data.get('target_image', '')  # Template image\n            source_face = data.get('source_face', '')    # User's face\n            \n            print(f\"ðŸ–¼ï¸  [FACE_SWAP] Target: {target_image[:50]}...\")\n            print(f\"ðŸ‘¤ [FACE_SWAP] Source: {source_face[:50]}...\")\n            \n            if not target_image or not source_face:\n                self._set_headers(400)\n                self.wfile.write(json.dumps({'error': 'Both target_image and source_face required'}).encode())\n                return\n            \n            # Use new multi-provider gateway (PiAPI primary, Replicate fallback)\n            print(\"ðŸš€ [FACE_SWAP] Calling gateway...\")\n            result = asyncio.run(face_swap_gateway.swap_face(\n                target=target_image,\n                source=source_face,\n                media_type=FaceSwapMediaType.IMAGE\n            ))\n            \n            print(f\"ðŸ“¤ [FACE_SWAP] Result: success={result.get('success')}\")\n            \n            if result.get('success'):\n                # Download image from result_url and convert to base64 for Flutter\n                result_url = result.get('result_url')\n                if result_url:\n                    try:\n                        print(f\"â¬‡ï¸  [FACE_SWAP] Downloading result from: {result_url[:80]}...\")\n                        import base64\n                        from urllib.request import urlopen, Request\n                        \n                        # Use Request to get response info\n                        req = Request(result_url)\n                        with urlopen(req, timeout=30) as img_response:\n                            # Check HTTP status\n                            status_code = img_response.getcode()\n                            content_type = img_response.headers.get('Content-Type', '').lower()\n                            content_length = img_response.headers.get('Content-Length', 'unknown')\n                            \n                            print(f\"ðŸ“Š [FACE_SWAP] HTTP {status_code}, Type: {content_type}, Size: {content_length}\")\n                            \n                            # Validate response is actually an image\n                            if status_code != 200:\n                                raise Exception(f\"HTTP {status_code} from result URL\")\n                            \n                            # Read response data first\n                            image_data = img_response.read()\n                            print(f\"ðŸ“¦ [FACE_SWAP] Downloaded {len(image_data)} bytes, Content-Type: {content_type}\")\n                            \n                            # Detect HTML error pages by checking first bytes\n                            if image_data.startswith(b'<!DOCTYPE') or image_data.startswith(b'<html') or image_data.startswith(b'<HTML'):\n                                raise Exception(f\"Response is HTML page, not image! Content-Type: {content_type}\")\n                            \n                            # Additional check: valid image file signatures\n                            valid_signatures = [\n                                b'\\xff\\xd8\\xff',  # JPEG\n                                b'\\x89PNG',        # PNG\n                                b'GIF8',           # GIF\n                                b'RIFF',           # WEBP (starts with RIFF)\n                                b'BM',             # BMP\n                            ]\n                            \n                            has_valid_signature = any(image_data.startswith(sig) for sig in valid_signatures)\n                            \n                            # Check content type (accept common CDN types)\n                            valid_content_types = ['image/', 'application/octet-stream', 'binary/octet-stream']\n                            has_valid_content_type = any(content_type.startswith(t) for t in valid_content_types) or not content_type\n                            \n                            if not has_valid_signature:\n                                # Show first 100 bytes for debugging\n                                preview = image_data[:100]\n                                raise Exception(f\"Invalid image format! First bytes: {preview[:50]}, Content-Type: {content_type}\")\n                                \n                            base64_image = base64.b64encode(image_data).decode('utf-8')\n                            print(f\"âœ… [FACE_SWAP] Valid image encoded ({len(image_data)} bytes)\")\n                            \n                        # Return format Flutter expects\n                        flutter_response = {\n                            'success': True,\n                            'image': f'data:image/jpeg;base64,{base64_image}'\n                        }\n                        \n                        self._set_headers(200)\n                        self.wfile.write(json.dumps(flutter_response).encode())\n                        print(\"âœ… [FACE_SWAP] Response sent successfully (base64)\")\n                    except Exception as download_error:\n                        print(f\"âŒ [FACE_SWAP] Failed to download result: {download_error}\")\n                        self._set_headers(500)\n                        self.wfile.write(json.dumps({\n                            'success': False,\n                            'error': f'Failed to download result: {str(download_error)}'\n                        }).encode())\n                else:\n                    # No result_url, return error\n                    self._set_headers(500)\n                    self.wfile.write(json.dumps({\n                        'success': False,\n                        'error': 'No result_url in response'\n                    }).encode())\n            else:\n                self._set_headers(500)\n                self.wfile.write(json.dumps(result).encode())\n                print(f\"âš ï¸  [FACE_SWAP] Error response sent: {result.get('error', 'Unknown')[:100]}\")\n                \n        except json.JSONDecodeError as e:\n            print(f\"âŒ JSON decode error in face_swap: {e}\")\n            self._set_headers(400)\n            self.wfile.write(json.dumps({'error': f'Invalid JSON: {str(e)}'}).encode())\n        except Exception as e:\n            print(f\"âŒ Unexpected error in face_swap handler: {type(e).__name__}: {e}\")\n            import traceback\n            traceback.print_exc()\n            self._set_headers(500)\n            self.wfile.write(json.dumps({'error': f'Server error: {str(e)}'}).encode())\n\n    def handle_face_swap_v2(self):\n        \"\"\"Face Swap V2 using Multi-Provider Gateway\"\"\"\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            target_image = data.get('target_image', '')\n            source_face = data.get('source_face', '')\n            \n            if not target_image or not source_face:\n                self._set_headers(400)\n                self.wfile.write(json.dumps({'error': 'Both target_image and source_face required'}).encode())\n                return\n            \n            # Run async function in sync context\n            result = asyncio.run(face_swap_gateway.swap_face(\n                target=target_image,\n                source=source_face,\n                media_type=FaceSwapMediaType.IMAGE\n            ))\n            \n            if result.get('success'):\n                self._set_headers(200)\n                self.wfile.write(json.dumps(result).encode())\n            else:\n                self._set_headers(500)\n                self.wfile.write(json.dumps(result).encode())\n                \n        except json.JSONDecodeError as e:\n            print(f\"âŒ JSON decode error in face_swap_v2: {e}\")\n            self._set_headers(400)\n            self.wfile.write(json.dumps({'error': f'Invalid JSON: {str(e)}'}).encode())\n        except Exception as e:\n            print(f\"âŒ Unexpected error in face_swap_v2 handler: {type(e).__name__}: {e}\")\n            import traceback\n            traceback.print_exc()\n            self._set_headers(500)\n            self.wfile.write(json.dumps({'error': f'Server error: {str(e)}'}).encode())\n\n    def handle_video_face_swap(self):\n        \"\"\"Video Face Swap using PiAPI\"\"\"\n        try:\n            content_length = int(self.headers['Content-Length'])\n            post_data = self.rfile.read(content_length)\n            data = json.loads(post_data.decode('utf-8'))\n            \n            target_video = data.get('target_video', '')\n            source_face = data.get('source_face', '')\n            webhook_url = data.get('webhook_url')\n            \n            if not target_video or not source_face:\n                self._set_headers(400)\n                self.wfile.write(json.dumps({'error': 'Both target_video and source_face required'}).encode())\n                return\n            \n            # Run async function in sync context\n            result = asyncio.run(face_swap_gateway.swap_face(\n                target=target_video,\n                source=source_face,\n                media_type=FaceSwapMediaType.VIDEO,\n                webhook_url=webhook_url\n            ))\n            \n            if result.get('success'):\n                self._set_headers(200)\n                self.wfile.write(json.dumps(result).encode())\n            else:\n                self._set_headers(500)\n                self.wfile.write(json.dumps(result).encode())\n                \n        except json.JSONDecodeError as e:\n            print(f\"âŒ JSON decode error in video_face_swap: {e}\")\n            self._set_headers(400)\n            self.wfile.write(json.dumps({'error': f'Invalid JSON: {str(e)}'}).encode())\n        except Exception as e:\n            print(f\"âŒ Unexpected error in video_face_swap handler: {type(e).__name__}: {e}\")\n            import traceback\n            traceback.print_exc()\n            self._set_headers(500)\n            self.wfile.write(json.dumps({'error': f'Server error: {str(e)}'}).encode())\n\n    def log_message(self, format, *args):\n        print(f\"[API] {format % args}\")\n\ndef run_server():\n    server_address = ('0.0.0.0', PORT)\n    httpd = HTTPServer(server_address, HuggingfaceProxyHandler)\n    print(f'ðŸš€ Flutter Web + AI Image Processing Server running on http://0.0.0.0:{PORT}')\n    print(f'ðŸ“¡ API Endpoints:')\n    print(f'   - POST /api/huggingface/text-generation')\n    print(f'   - POST /api/huggingface/text-to-image')\n    print(f'   - POST /api/ai/hd-image (Real-ESRGAN)')\n    print(f'   - POST /api/ai/fix-old-photo (GFPGAN)')\n    print(f'   - POST /api/ai/cartoonify (VToonify)')\n    print(f'   - POST /api/ai/face-swap (Face Swap - Legacy)')\n    print(f'   - POST /api/ai/face-swap-v2 (Face Swap - Multi-Provider Gateway)')\n    print(f'   - POST /api/ai/video-face-swap (Video Face Swap - PiAPI)')\n    print(f'ðŸŒ Serving Flutter web from: {WEB_DIR}')\n    httpd.serve_forever()\n\nif __name__ == '__main__':\n    run_server()\n","size_bytes":22280},"SUPABASE_STORAGE_GUIDE.md":{"content":"# ðŸ“¸ Supabase Storage Setup - Face Swap Templates\n\n## BÆ°á»›c 1: Táº¡o Storage Bucket trong Supabase\n\n1. Truy cáº­p **Supabase Dashboard**: https://supabase.com/dashboard\n2. Chá»n project **lfeyveflpbkrzsoscjcv** (URL cá»§a báº¡n)\n3. VÃ o **Storage** (menu bÃªn trÃ¡i)\n4. Click **New Bucket**\n   - **Name**: `face-swap-templates`\n   - **Public**: âœ… Check (Ä‘á»ƒ Flutter app cÃ³ thá»ƒ download)\n   - Click **Create bucket**\n\n## BÆ°á»›c 2: Upload Template Images\n\n### Cáº¥u trÃºc thÆ° má»¥c:\n```\nface-swap-templates/\nâ”œâ”€â”€ female/\nâ”‚   â”œâ”€â”€ bedroom_aesthetic.jpg\nâ”‚   â”œâ”€â”€ pink_vintage.jpg\nâ”‚   â”œâ”€â”€ modern_outdoor.jpg\nâ”‚   â”œâ”€â”€ street_fashion.jpg\nâ”‚   â”œâ”€â”€ elegant_portrait.jpg\nâ”‚   â””â”€â”€ ngoctrinh_outfit.jpg\nâ”œâ”€â”€ male/\nâ”‚   â”œâ”€â”€ elegant_portrait.jpg\nâ”‚   â”œâ”€â”€ business_suit.jpg\nâ”‚   â”œâ”€â”€ casual_outdoor.jpg\nâ”‚   â”œâ”€â”€ sport_style.jpg\nâ”‚   â””â”€â”€ vintage_classic.jpg\nâ””â”€â”€ mixed/\n    â”œâ”€â”€ couple_romantic.jpg\n    â”œâ”€â”€ friend_group.jpg\n    â””â”€â”€ family_portrait.jpg\n```\n\n### Upload steps:\n1. Trong bucket `face-swap-templates`\n2. Táº¡o folders: `female`, `male`, `mixed`\n3. Upload cÃ¡c hÃ¬nh template vÃ o tá»«ng folder\n4. **LÆ°u Ã½**: Äáº·t tÃªn file chÃ­nh xÃ¡c theo danh sÃ¡ch trÃªn\n\n## BÆ°á»›c 3: Get Public URLs\n\nSau khi upload, má»—i template sáº½ cÃ³ public URL:\n```\nhttps://lfeyveflpbkrzsoscjcv.supabase.co/storage/v1/object/public/face-swap-templates/female/bedroom_aesthetic.jpg\n```\n\n**Pattern**: \n```\n{SUPABASE_URL}/storage/v1/object/public/{bucket}/{folder}/{filename}\n```\n\n## BÆ°á»›c 4: Configure trong Flutter\n\n### A. Táº¡o Template Model\n\nTáº¡o file `lib/models/face_swap_template.dart`:\n\n```dart\nclass FaceSwapTemplate {\n  final String id;\n  final String name;\n  final String category; // 'female', 'male', 'mixed'\n  final String imageUrl;\n  final String fileName;\n\n  FaceSwapTemplate({\n    required this.id,\n    required this.name,\n    required this.category,\n    required this.imageUrl,\n    required this.fileName,\n  });\n\n  // Supabase URL helper\n  static String getSupabaseUrl(String fileName, String category) {\n    const supabaseUrl = 'https://lfeyveflpbkrzsoscjcv.supabase.co';\n    return '$supabaseUrl/storage/v1/object/public/face-swap-templates/$category/$fileName';\n  }\n}\n```\n\n### B. Define Templates List\n\nTáº¡o file `lib/config/face_swap_templates.dart`:\n\n```dart\nimport '../models/face_swap_template.dart';\n\nclass FaceSwapTemplates {\n  static List<FaceSwapTemplate> femaleTemplates = [\n    FaceSwapTemplate(\n      id: 'bedroom_aesthetic',\n      name: 'Bedroom Aesthetic',\n      category: 'female',\n      fileName: 'bedroom_aesthetic.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('bedroom_aesthetic.jpg', 'female'),\n    ),\n    FaceSwapTemplate(\n      id: 'pink_vintage',\n      name: 'Pink Vintage',\n      category: 'female',\n      fileName: 'pink_vintage.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('pink_vintage.jpg', 'female'),\n    ),\n    FaceSwapTemplate(\n      id: 'elegant_portrait',\n      name: 'Elegant Portrait',\n      category: 'female',\n      fileName: 'elegant_portrait.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('elegant_portrait.jpg', 'female'),\n    ),\n    FaceSwapTemplate(\n      id: 'street_fashion',\n      name: 'Street Fashion',\n      category: 'female',\n      fileName: 'street_fashion.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('street_fashion.jpg', 'female'),\n    ),\n    FaceSwapTemplate(\n      id: 'modern_outdoor',\n      name: 'Modern Outdoor',\n      category: 'female',\n      fileName: 'modern_outdoor.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('modern_outdoor.jpg', 'female'),\n    ),\n    FaceSwapTemplate(\n      id: 'ngoctrinh_outfit',\n      name: 'Ngoctrinh Outfit',\n      category: 'female',\n      fileName: 'ngoctrinh_outfit.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('ngoctrinh_outfit.jpg', 'female'),\n    ),\n  ];\n\n  static List<FaceSwapTemplate> maleTemplates = [\n    FaceSwapTemplate(\n      id: 'elegant_portrait_male',\n      name: 'Elegant Portrait',\n      category: 'male',\n      fileName: 'elegant_portrait.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('elegant_portrait.jpg', 'male'),\n    ),\n    FaceSwapTemplate(\n      id: 'business_suit',\n      name: 'Business Suit',\n      category: 'male',\n      fileName: 'business_suit.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('business_suit.jpg', 'male'),\n    ),\n    FaceSwapTemplate(\n      id: 'casual_outdoor',\n      name: 'Casual Outdoor',\n      category: 'male',\n      fileName: 'casual_outdoor.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('casual_outdoor.jpg', 'male'),\n    ),\n    FaceSwapTemplate(\n      id: 'sport_style',\n      name: 'Sport Style',\n      category: 'male',\n      fileName: 'sport_style.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('sport_style.jpg', 'male'),\n    ),\n    FaceSwapTemplate(\n      id: 'vintage_classic',\n      name: 'Vintage Classic',\n      category: 'male',\n      fileName: 'vintage_classic.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('vintage_classic.jpg', 'male'),\n    ),\n  ];\n\n  static List<FaceSwapTemplate> mixedTemplates = [\n    FaceSwapTemplate(\n      id: 'couple_romantic',\n      name: 'Couple Romantic',\n      category: 'mixed',\n      fileName: 'couple_romantic.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('couple_romantic.jpg', 'mixed'),\n    ),\n    FaceSwapTemplate(\n      id: 'friend_group',\n      name: 'Friend Group',\n      category: 'mixed',\n      fileName: 'friend_group.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('friend_group.jpg', 'mixed'),\n    ),\n    FaceSwapTemplate(\n      id: 'family_portrait',\n      name: 'Family Portrait',\n      category: 'mixed',\n      fileName: 'family_portrait.jpg',\n      imageUrl: FaceSwapTemplate.getSupabaseUrl('family_portrait.jpg', 'mixed'),\n    ),\n  ];\n\n  static List<FaceSwapTemplate> getAllTemplates() {\n    return [...femaleTemplates, ...maleTemplates, ...mixedTemplates];\n  }\n}\n```\n\n## BÆ°á»›c 5: Test Template URLs\n\nSau khi upload, test URL trong browser:\n```\nhttps://lfeyveflpbkrzsoscjcv.supabase.co/storage/v1/object/public/face-swap-templates/female/bedroom_aesthetic.jpg\n```\n\nNáº¿u hiá»ƒn thá»‹ hÃ¬nh â†’ Success! âœ…\n\n## Alternative: Hardcoded Assets (Náº¿u khÃ´ng dÃ¹ng Supabase)\n\nNáº¿u muá»‘n lÆ°u local trong Flutter app:\n\n1. Copy template images vÃ o `assets/images/face_swap_templates/`\n2. Update `pubspec.yaml`:\n```yaml\nflutter:\n  assets:\n    - assets/images/face_swap_templates/female/\n    - assets/images/face_swap_templates/male/\n    - assets/images/face_swap_templates/mixed/\n```\n\n3. Update template URLs:\n```dart\nimageUrl: 'assets/images/face_swap_templates/female/bedroom_aesthetic.jpg'\n```\n\n## ðŸ”¥ Recommended: DÃ¹ng Supabase Storage\n\n**Æ¯u Ä‘iá»ƒm**:\n- âœ… KhÃ´ng lÃ m tÄƒng kÃ­ch thÆ°á»›c APK\n- âœ… Dá»… update templates má»›i (khÃ´ng cáº§n rebuild app)\n- âœ… Public CDN (load nhanh)\n- âœ… CÃ³ thá»ƒ thÃªm templates Ä‘á»™ng\n\n**NhÆ°á»£c Ä‘iá»ƒm**:\n- âš ï¸ Cáº§n internet Ä‘á»ƒ load láº§n Ä‘áº§u\n- âš ï¸ DÃ¹ng bandwidth Supabase (nhÆ°ng free tier Ä‘á»§)\n\n---\n\n## Next Steps\n\nSau khi setup xong Supabase Storage:\n1. âœ… Upload all template images\n2. âœ… Test public URLs\n3. âž¡ï¸ Update Flutter UI (Task 4)\n4. âž¡ï¸ Implement Face Swap logic (Task 4)\n5. âž¡ï¸ Add Download functionality (Task 5)\n","size_bytes":7341},"BACKEND_STATUS.md":{"content":"# Backend API Status Report\n\n## ðŸŽ¯ Architecture: Replicate Pro (Primary) â†’ Huggingface (Backup)\n\nBackend Ä‘Æ°á»£c thiáº¿t káº¿ vá»›i **fallback logic tá»± Ä‘á»™ng**:\n1. **PRIMARY**: Replicate API (production-ready, reliable, fast)\n2. **BACKUP**: Huggingface Spaces (free tier, may timeout)\n\n---\n\n## âœ… Production-Ready APIs\n\n### 1. **Fix Old Photo (GFPGAN)** â­â­â­â­â­\n- **Status:** âœ… WORKING (Replicate only)\n- **Service:** Replicate API\n- **Model:** `tencentarc/gfpgan`\n- **Reliability:** 99.9% uptime\n- **Speed:** 3-5 seconds\n- **Cost:** $0.002/image\n- **Endpoint:** `POST /api/ai/fix-old-photo`\n- **Flutter Service:** `HuggingfaceService.fixOldPhoto()`\n\n**Architecture:** Replicate only (no fallback needed - highly reliable)\n\n```dart\n// Usage in Flutter\nfinal result = await HuggingfaceService.fixOldPhoto(\n  imageBytes: imageBytes,\n  version: 'v1.3', // v1.2, v1.3, v1.4\n);\n```\n\n---\n\n### 2. **HD Image Enhancement (Real-ESRGAN)** â­â­â­â­\n- **Status:** âœ… WORKING (with fallback)\n- **Primary:** Replicate API (`nightmareai/real-esrgan`)\n- **Backup:** Huggingface Space (`akhaliq/Real-ESRGAN`)\n- **Speed:** ~9 seconds (Replicate), variable (Huggingface)\n- **Cost:** $0.0019/run (Replicate), Free (Huggingface)\n- **Endpoint:** `POST /api/ai/hd-image`\n\n**Architecture:** Try Replicate â†’ Fallback to Huggingface if failed\n\n**Tested:** âœ… Replicate working, fallback logic verified\n\n---\n\n### 3. **Cartoonify (VToonify)** âš ï¸\n- **Status:** âš ï¸ BOTH SERVICES UNSTABLE\n- **Primary:** Replicate API (`412392713/vtoonify`) - May timeout\n- **Backup:** Huggingface Space (`PKUWilliamYang/VToonify`) - RUNTIME_ERROR\n- **Endpoint:** `POST /api/ai/cartoonify`\n\n**Architecture:** Try Replicate â†’ Fallback to Huggingface (both may fail)\n\n**Note:** VToonify cÃ³ váº¥n Ä‘á» trÃªn cáº£ 2 platforms. Cáº§n tÃ¬m alternative model hoáº·c self-host.\n\n---\n\n## âš ï¸ Limited/Backup APIs\n\n### 4. **Text Generation (Mistral-7B)**\n- **Status:** âš ï¸ LIMITED\n- **Service:** Huggingface Inference API\n- **Issue:** Free tier rate limits, model loading\n- **Endpoint:** `POST /api/huggingface/text-generation`\n\n### 5. **Image Generation (Stable Diffusion)**\n- **Status:** âš ï¸ LIMITED\n- **Service:** Huggingface Inference API\n- **Issue:** Free tier rate limits, model loading\n- **Endpoint:** `POST /api/huggingface/text-to-image`\n\n---\n\n## ðŸ—ï¸ Fallback Logic Implementation\n\n### How It Works\n\n```python\nasync def hd_image(self, image_base64, scale=4):\n    # Try Replicate first (PRIMARY)\n    if self.replicate_token:\n        try:\n            print(\"ðŸš€ [PRIMARY] Trying Replicate Real-ESRGAN...\")\n            output = replicate.run(\"nightmareai/real-esrgan\", input={...})\n            return {\"success\": True, \"source\": \"replicate\"}\n        except Exception as e:\n            print(f\"âš ï¸ Replicate failed: {e}\")\n            print(\"ðŸ”„ Falling back to Huggingface...\")\n    \n    # Fallback to Huggingface (BACKUP)\n    try:\n        client = self._init_real_esrgan_backup()\n        result = client.predict(...)\n        return {\"success\": True, \"source\": \"huggingface\"}\n    except Exception as e:\n        return {\"success\": False, \"error\": f\"All services failed: {e}\"}\n```\n\n**Benefits:**\n- **Automatic failover** náº¿u Replicate down\n- **Transparent** cho user - API response giá»‘ng nhau\n- **Source tracking** - response chá»©a `\"source\": \"replicate\"` hoáº·c `\"huggingface\"`\n\n---\n\n## ðŸ”§ Flutter Service Integration\n\n### Platform-Aware API URLs\n\n```dart\n// Web: Automatic domain detection\nstatic String get baseUrl {\n  if (kIsWeb) {\n    return '${Uri.base.origin}/api/huggingface';\n  } else {\n    // Mobile: Hardcoded Replit domain (CHANGE TO YOUR DOMAIN)\n    return 'https://YOUR_PRODUCTION_DOMAIN/api/huggingface';\n  }\n}\n```\n\n**âš ï¸ IMPORTANT:** Update production domain trong `lib/services/huggingface_service.dart` lines 13, 23 trÆ°á»›c khi build APK!\n\n---\n\n## ðŸ›¡ï¸ Error Handling\n\n### Backend Error Handling\n```python\n# All APIs cÃ³ proper error handling vá»›i fallback\ntry:\n    # Try Replicate PRIMARY\n    output = await replicate.run(...)\n    return {\"success\": True, \"source\": \"replicate\"}\nexcept:\n    # Fallback to Huggingface BACKUP\n    try:\n        result = huggingface_client.predict(...)\n        return {\"success\": True, \"source\": \"huggingface\"}\n    except:\n        return {\"success\": False, \"error\": \"All services failed\"}\n```\n\n### Flutter Error Handling\n```dart\ntry {\n  final response = await http.post(...).timeout(Duration(seconds: 120));\n  if (response.statusCode == 200) {\n    final data = jsonDecode(response.body);\n    if (data['success'] == true) {\n      return data['image'];\n    }\n    throw Exception(data['error'] ?? 'Failed');\n  }\n} catch (e) {\n  throw Exception('Failed: $e');\n}\n```\n\n**âœ… Äáº§y Ä‘á»§:** Timeout, try-catch, fallback logic, error messages\n\n---\n\n## ðŸ“Š Code Quality Status\n\n| Component | Status | Notes |\n|-----------|--------|-------|\n| **Python Backend** | âœ… Production-Ready | Clean code, fallback logic |\n| **Replicate Integration** | âœ… Excellent | Async-safe, thread pool, 2/3 models working |\n| **Huggingface Fallback** | âœ… Implemented | Automatic failover |\n| **Flutter Service** | âœ… Production-Ready | Platform-aware, proper typing |\n| **API Error Handling** | âœ… Complete | Timeouts, exceptions, fallback |\n| **MIME Detection** | âœ… Implemented | PNG/JPEG/GIF/WebP support |\n| **Deployment Config** | âœ… Ready | Autoscale configured |\n\n---\n\n## ðŸš€ Deployment Recommendations\n\n### For APK/Mobile Production:\n\n1. **Update API domain** trong `lib/services/huggingface_service.dart`:\n   ```dart\n   // Line 13, 23: Replace Replit domain with your production domain\n   return 'https://YOUR_DOMAIN/api/huggingface';\n   ```\n\n2. **Rebuild APK** Ä‘á»ƒ include code má»›i:\n   ```bash\n   flutter build apk --release\n   ```\n\n3. **Test trÃªn thiáº¿t bá»‹ tháº­t** Ä‘á»ƒ verify API connections\n\n### For Backend Hosting:\n\n#### Option 1: Replit Production (Autoscale) âœ…\n- Config Ä‘Ã£ sáºµn trong `deploy_config_tool`\n- Click \"Deploy\" button in Replit\n- Auto-scale khi cÃ³ traffic\n\n#### Option 2: Vercel (Recommended for Replicate) â­\n- Better performance cho Replicate API\n- Serverless functions cho Python backend\n- Free SSL, CDN\n\n#### Option 3: Railway/Render\n- Full stack hosting\n- PostgreSQL database support\n- Easy deploy from Git\n\n---\n\n## ðŸ§ª Testing\n\n### Automated Test Suite:\n```bash\npython3 test_api.py\n```\n\n### Manual Testing:\n```bash\n# Fix Old Photo (Replicate - Working)\ncurl -X POST http://localhost:5000/api/ai/fix-old-photo \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"image\":\"BASE64_IMAGE\",\"version\":\"v1.3\"}'\n\n# HD Image (Replicate â†’ Huggingface fallback)\ncurl -X POST http://localhost:5000/api/ai/hd-image \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"image\":\"BASE64_IMAGE\",\"scale\":2}'\n```\n\n### Response Format:\n```json\n{\n  \"success\": true,\n  \"image\": \"data:image/png;base64,...\",\n  \"message\": \"Image processed successfully\",\n  \"source\": \"replicate\"  // or \"huggingface\"\n}\n```\n\n---\n\n## ðŸ“ Environment Variables Required\n\n```bash\n# Required for Replicate (Primary)\nREPLICATE_API_TOKEN=r8_your_token_here\n\n# Optional for Huggingface (Backup)\nHUGGINGFACE_TOKEN=hf_your_token_here\n\n# Database (if using Supabase)\nSUPABASE_URL=your_url_here\nSUPABASE_ANON_KEY=your_key_here\n```\n\n**âœ… ÄÃ£ config** trong Replit Secrets\n\n---\n\n## ðŸ“ˆ API Performance Comparison\n\n| Feature | Replicate (Primary) | Huggingface (Backup) |\n|---------|---------------------|----------------------|\n| **Fix Old Photo** | âœ… 3-5s, $0.002 | âŒ Not available |\n| **HD Image** | âœ… ~9s, $0.0019 | âš ï¸ Variable, Free |\n| **Cartoonify** | âš ï¸ May timeout | âš ï¸ RUNTIME_ERROR |\n| **Reliability** | 99.9% uptime | Variable (free tier) |\n| **Speed** | Fast & consistent | Slow & variable |\n| **Cost** | ~$0.002/image | Free (rate limited) |\n\n**Recommendation:** Replicate cho production, Huggingface lÃ m backup emergency\n\n---\n\n## ðŸŽ¯ Next Steps for Production\n\n### Immediate (Ready Now):\n1. âœ… **Fix Old Photo** - Production ready vá»›i Replicate\n2. âœ… **HD Image** - Production ready vá»›i fallback logic\n3. âš ï¸ **Cartoonify** - Cáº§n tÃ¬m alternative model\n\n### Short-term:\n1. TÃ¬m stable VToonify alternative trÃªn Replicate hoáº·c self-host\n2. Deploy backend lÃªn production hosting (Vercel/Railway)\n3. Update mobile app vá»›i production API domain\n\n### Long-term:\n1. Self-host models Ä‘á»ƒ 100% control\n2. Implement caching layer cho processed images\n3. Add rate limiting vÃ  user quota management\n\n---\n\n## âœ¨ Káº¿t Luáº­n\n\n**Backend architecture hoÃ n chá»‰nh vá»›i fallback logic!** \n\n### âœ… Hoáº¡t Ä‘á»™ng tá»‘t:\n- **Fix Old Photo** - Replicate (production-ready)\n- **HD Image** - Replicate with Huggingface fallback (tested & working)\n- **Fallback logic** - Tá»± Ä‘á»™ng switch khi primary service fail\n\n### âš ï¸ Cáº§n cáº£i thiá»‡n:\n- **Cartoonify** - Cáº£ 2 services unstable, cáº§n alternative\n\n### ðŸš€ Production Ready:\n**2/3 image processing features production-ready!**\n\n1. Build APK tá»« code hiá»‡n táº¡i â†’ 2/3 features hoáº¡t Ä‘á»™ng\n2. Update production API domain\n3. Deploy backend lÃªn hosting\n\n**Code Ä‘Ã£ sáºµn sÃ ng cho production! ðŸŽ‰**\n","size_bytes":9150},"test_api.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nBackend API Test Suite\nTests fallback architecture: Replicate (Primary) â†’ Huggingface (Backup)\n\"\"\"\n\nimport requests\nimport json\nimport sys\n\nBASE_URL = \"http://localhost:5000\"\n\ndef test_fix_old_photo():\n    \"\"\"Test GFPGAN API via Replicate (Primary only)\"\"\"\n    try:\n        test_image = \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==\"\n        \n        response = requests.post(\n            f\"{BASE_URL}/api/ai/fix-old-photo\",\n            json={\"image\": test_image, \"version\": \"v1.3\"},\n            timeout=60\n        )\n        \n        data = response.json()\n        if data.get('success'):\n            source = data.get('source', 'unknown')\n            return \"âœ… WORKING\", f\"Replicate API (source: {source})\"\n        else:\n            return \"âŒ FAILED\", data.get('error', 'Unknown error')\n    except Exception as e:\n        return \"âŒ ERROR\", str(e)\n\ndef test_hd_image():\n    \"\"\"Test Real-ESRGAN with fallback: Replicate â†’ Huggingface\"\"\"\n    try:\n        test_image = \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==\"\n        \n        response = requests.post(\n            f\"{BASE_URL}/api/ai/hd-image\",\n            json={\"image\": test_image, \"scale\": 2},\n            timeout=60\n        )\n        \n        data = response.json()\n        if data.get('success'):\n            source = data.get('source', 'unknown')\n            if source == 'replicate':\n                return \"âœ… WORKING\", f\"Replicate API (primary)\"\n            elif source == 'huggingface':\n                return \"âœ… WORKING\", f\"Huggingface Spaces (fallback)\"\n            else:\n                return \"âœ… WORKING\", f\"Source: {source}\"\n        else:\n            return \"âŒ FAILED\", data.get('error', 'Unknown error')\n    except Exception as e:\n        return \"âŒ ERROR\", str(e)\n\ndef test_cartoonify():\n    \"\"\"Test VToonify with fallback: Replicate â†’ Huggingface\"\"\"\n    try:\n        test_image = \"iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==\"\n        \n        response = requests.post(\n            f\"{BASE_URL}/api/ai/cartoonify\",\n            json={\"image\": test_image, \"style\": \"cartoon\", \"style_degree\": 0.5},\n            timeout=90\n        )\n        \n        data = response.json()\n        if data.get('success'):\n            source = data.get('source', 'unknown')\n            if source == 'replicate':\n                return \"âœ… WORKING\", f\"Replicate API (primary)\"\n            elif source == 'huggingface':\n                return \"âœ… WORKING\", f\"Huggingface Spaces (fallback)\"\n            else:\n                return \"âœ… WORKING\", f\"Source: {source}\"\n        else:\n            return \"âš ï¸  BOTH FAILED\", data.get('error', 'Both Replicate and Huggingface unavailable')\n    except Exception as e:\n        return \"âš ï¸  TIMEOUT\", f\"Request timeout or error: {str(e)}\"\n\ndef test_text_generation():\n    \"\"\"Test Mistral-7B text generation (Huggingface only)\"\"\"\n    try:\n        response = requests.post(\n            f\"{BASE_URL}/api/huggingface/text-generation\",\n            json={\"prompt\": \"Hello\", \"max_tokens\": 10},\n            timeout=30\n        )\n        \n        data = response.json()\n        if data.get('success'):\n            return \"âœ… WORKING\", \"Huggingface Inference API\"\n        else:\n            return \"âš ï¸  LIMITED\", data.get('error', 'Model may be loading or rate limited')\n    except Exception as e:\n        return \"âš ï¸  LIMITED\", str(e)\n\ndef test_image_generation():\n    \"\"\"Test Stable Diffusion image generation (Huggingface only)\"\"\"\n    try:\n        response = requests.post(\n            f\"{BASE_URL}/api/huggingface/text-to-image\",\n            json={\"prompt\": \"A beautiful landscape\"},\n            timeout=60\n        )\n        \n        data = response.json()\n        if data.get('success'):\n            return \"âœ… WORKING\", \"Huggingface Inference API\"\n        else:\n            return \"âš ï¸  LIMITED\", data.get('error', 'Model may be loading or rate limited')\n    except Exception as e:\n        return \"âš ï¸  LIMITED\", str(e)\n\ndef main():\n    print(\"=\" * 80)\n    print(\"ðŸ”¬ BACKEND API TEST SUITE - FALLBACK ARCHITECTURE\")\n    print(\"=\" * 80)\n    print(\"ðŸ“‹ Architecture: Replicate (Primary) â†’ Huggingface (Backup)\")\n    print()\n    \n    tests = [\n        (\"Fix Old Photo (GFPGAN)\", test_fix_old_photo),\n        (\"HD Image (Real-ESRGAN)\", test_hd_image),\n        (\"Cartoonify (VToonify)\", test_cartoonify),\n        (\"Text Generation (Mistral-7B)\", test_text_generation),\n        (\"Image Generation (Stable Diffusion)\", test_image_generation),\n    ]\n    \n    results = []\n    \n    for name, test_func in tests:\n        print(f\"Testing: {name}...\", end=\" \", flush=True)\n        status, details = test_func()\n        results.append((name, status, details))\n        print(f\"{status}\")\n    \n    print()\n    print(\"=\" * 80)\n    print(\"ðŸ“Š API STATUS REPORT\")\n    print(\"=\" * 80)\n    print()\n    \n    for name, status, details in results:\n        print(f\"{status} {name}\")\n        print(f\"   â””â”€ {details}\")\n        print()\n    \n    print(\"=\" * 80)\n    print(\"ðŸ“ LEGEND:\")\n    print(\"=\" * 80)\n    print(\"âœ… WORKING       = Production-ready, reliable\")\n    print(\"âš ï¸  BOTH FAILED  = Both Replicate and Huggingface unavailable\")\n    print(\"âš ï¸  LIMITED      = Free tier limitations (rate limits, cold starts)\")\n    print(\"âš ï¸  TIMEOUT      = Request timeout (service may be slow)\")\n    print()\n    print(\"ðŸŽ¯ FALLBACK LOGIC:\")\n    print(\"   1. Try Replicate API (Primary - fast, reliable, $0.002/run)\")\n    print(\"   2. If failed â†’ Fallback to Huggingface Spaces (Backup - free, may timeout)\")\n    print(\"   3. If both failed â†’ Return error with details\")\n    print()\n    print(\"ðŸ“ˆ PRODUCTION RECOMMENDATION:\")\n    print(\"   âœ… Fix Old Photo - Replicate only (99.9% uptime)\")\n    print(\"   âœ… HD Image - Replicate with Huggingface fallback\")\n    print(\"   âš ï¸  Cartoonify - Need alternative model (both services unstable)\")\n    print()\n\nif __name__ == \"__main__\":\n    main()\n","size_bytes":6101},"test_face_swap_api.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nTest Face Swap API\n\"\"\"\n\nimport requests\nimport base64\nimport json\nfrom pathlib import Path\n\n# Test with sample images (you need to provide paths)\ndef test_face_swap():\n    # Read template image (target)\n    template_path = \"test_images/template.jpg\"  # Replace with actual path\n    source_path = \"test_images/face.jpg\"        # Replace with actual path\n    \n    if not Path(template_path).exists() or not Path(source_path).exists():\n        print(\"âš ï¸  Test images not found. Please provide:\")\n        print(f\"   - {template_path}\")\n        print(f\"   - {source_path}\")\n        return\n    \n    # Read and encode images\n    with open(template_path, 'rb') as f:\n        template_bytes = f.read()\n        template_base64 = f\"data:image/jpeg;base64,{base64.b64encode(template_bytes).decode()}\"\n    \n    with open(source_path, 'rb') as f:\n        source_bytes = f.read()\n        source_base64 = f\"data:image/jpeg;base64,{base64.b64encode(source_bytes).decode()}\"\n    \n    print(\"ðŸ”„ Testing Face Swap API...\")\n    print(f\"   Template: {template_path}\")\n    print(f\"   Source: {source_path}\")\n    \n    # Call API\n    response = requests.post(\n        'http://localhost:5000/api/ai/face-swap',\n        headers={'Content-Type': 'application/json'},\n        json={\n            'target_image': template_base64,\n            'source_face': source_base64\n        },\n        timeout=120\n    )\n    \n    if response.status_code == 200:\n        data = response.json()\n        if data.get('success'):\n            print(f\"âœ… Face swap successful!\")\n            print(f\"   Source: {data.get('source')}\")\n            \n            # Save result\n            result_base64 = data['image'].split(',')[1]\n            result_bytes = base64.b64decode(result_base64)\n            \n            output_path = \"face_swap_result.png\"\n            with open(output_path, 'wb') as f:\n                f.write(result_bytes)\n            \n            print(f\"ðŸ’¾ Result saved to: {output_path}\")\n        else:\n            print(f\"âŒ Face swap failed: {data.get('error')}\")\n    else:\n        print(f\"âŒ API error: {response.status_code}\")\n        print(f\"   {response.text}\")\n\nif __name__ == '__main__':\n    test_face_swap()\n","size_bytes":2218},"FACE_SWAP_FEATURE.md":{"content":"# ðŸ”„ Face Swap Feature - Complete Implementation\n\n## âœ… HoÃ n ThÃ nh 100%\n\nTÃ­nh nÄƒng Face Swap Ä‘Ã£ Ä‘Æ°á»£c implement Ä‘áº§y Ä‘á»§ vá»›i Replicate Pro API vÃ  Huggingface fallback!\n\n---\n\n## ðŸŽ¯ Tá»•ng Quan\n\n**Flow hoÃ n chá»‰nh:**\n```\nUser click template â†’ Chá»n áº£nh selfie â†’ Face Swap API (20-30s) â†’ Hiá»ƒn thá»‹ káº¿t quáº£ â†’ Download\n```\n\n**Chi phÃ­ & Performance:**\n- ðŸ’° Replicate Pro: $0.0027/láº§n (~370 runs/$1)\n- â±ï¸ Tá»‘c Ä‘á»™: ~27 giÃ¢y/request\n- ðŸ”„ Fallback: Huggingface Space (miá»…n phÃ­, cháº­m hÆ¡n)\n\n---\n\n## ðŸ“¦ Backend Implementation\n\n### 1. Face Swap Service (`services/image_ai_service.py`)\n\n```python\nasync def face_swap(self, target_image_base64, source_face_base64):\n    \"\"\"\n    Primary: Replicate codeplugtech/face-swap\n    Fallback: Huggingface felixrosberg/face-swap\n    \"\"\"\n```\n\n**Features:**\n- âœ… Async-safe vá»›i shared executor (khÃ´ng blocking)\n- âœ… Auto MIME type detection\n- âœ… Proper error handling & cleanup\n- âœ… 60 second timeout\n\n### 2. API Endpoint (`api_server.py`)\n\n```bash\nPOST /api/ai/face-swap\nContent-Type: application/json\n\n{\n  \"target_image\": \"data:image/jpeg;base64,...\",\n  \"source_face\": \"data:image/jpeg;base64,...\"\n}\n```\n\n**Response:**\n```json\n{\n  \"success\": true,\n  \"image\": \"data:image/png;base64,...\",\n  \"message\": \"Face swapped successfully\",\n  \"source\": \"replicate\"\n}\n```\n\n---\n\n## ðŸ“± Flutter Integration\n\n### 1. Service Layer (`lib/services/huggingface_service.dart`)\n\n```dart\nstatic Future<String> faceSwap({\n  required Uint8List targetImageBytes,\n  required Uint8List sourceFaceBytes,\n})\n```\n\n**Features:**\n- âœ… MIME type auto-detection (PNG, JPEG, GIF)\n- âœ… Data URI encoding\n- âœ… Platform-aware URL (web vs mobile)\n\n### 2. UI Integration (`lib/swapface/swapface_widget.dart`)\n\n**User Flow:**\n\n1. **Click Template** â†’ `_handleStyleSelection()`\n   - Má»Ÿ ImagePicker\n   - User chá»n áº£nh tá»« gallery/camera\n\n2. **Processing** â†’ Loading overlay hiá»ƒn thá»‹\n   ```dart\n   setState(() {\n     _model.isProcessing = true;\n   });\n   ```\n\n3. **API Call**\n   ```dart\n   final resultBase64 = await HuggingfaceService.faceSwap(\n     targetImageBytes: templateBytes,\n     sourceFaceBytes: userPhotoBytes,\n   );\n   ```\n\n4. **Show Result** â†’ Dialog vá»›i áº£nh vÃ  download button\n\n5. **Download** â†’ Platform-specific implementation\n   - Web: `dart:html` blob download\n   - Mobile: `dart:io` save to documents\n\n### 3. Platform-Specific Download\n\n**Conditional Imports:**\n```dart\nimport 'swapface_download_stub.dart'\n    if (dart.library.html) 'swapface_download_web.dart'\n    if (dart.library.io) 'swapface_download_mobile.dart';\n```\n\n**Files:**\n- `swapface_download_stub.dart` - Interface\n- `swapface_download_web.dart` - Web (dart:html)\n- `swapface_download_mobile.dart` - Mobile (dart:io)\n\n---\n\n## ðŸ–¼ï¸ Template Images Setup\n\n### âœ… Supabase Storage (Configured & Working!)\n\n**Æ¯u Ä‘iá»ƒm:**\n- âœ… KhÃ´ng tÄƒng kÃ­ch thÆ°á»›c APK\n- âœ… Update templates mÃ  khÃ´ng cáº§n rebuild app\n- âœ… CDN tá»‘c Ä‘á»™ cao\n\n**Current Templates (Female):**\n```\nface-swap-templates/female/\nâ”œâ”€â”€ beautiful-girl.jpg âœ…\nâ”œâ”€â”€ kate-upton.jpg âœ…\nâ”œâ”€â”€ nice-girl.jpg âœ…\nâ”œâ”€â”€ usa-girl.jpg âœ…\nâ””â”€â”€ wedding-face.jpeg âœ…\n```\n\n**Public URL Format:**\n```\nhttps://cvtlvrtvnwbvyhojetyt.supabase.co/storage/v1/object/public/face-swap-templates/female/{filename}\n```\n\n**Status:** All templates verified and working (HTTP 200) âœ…\n\n### Option 2: Local Assets (Fallback)\n\n```yaml\n# pubspec.yaml\nflutter:\n  assets:\n    - assets/images/face_swap_templates/female/\n    - assets/images/face_swap_templates/male/\n    - assets/images/face_swap_templates/mixed/\n```\n\n---\n\n## ðŸ§ª Testing\n\n### 1. Web Test Page\n\nMá»Ÿ: `http://localhost:5000/face_swap_test.html`\n\n**Features:**\n- Upload template image\n- Upload face image\n- Call API & show result\n- Download result\n\n### 2. Python API Test\n\n```bash\npython3 test_face_swap_api.py\n```\n\n**Requirements:**\n- Táº¡o folder `test_images/`\n- Add `template.jpg` vÃ  `face.jpg`\n\n### 3. Flutter Manual Test\n\n1. Run app (web hoáº·c build APK)\n2. Navigate to Ghostface page\n3. Click any template\n4. Pick user photo\n5. Wait 20-30 seconds\n6. View result & download\n\n---\n\n## ðŸ“Š Current Status\n\n### âœ… Completed Tasks\n\n1. âœ… Backend API implementation (Replicate + Huggingface)\n2. âœ… Flutter service integration\n3. âœ… UI/UX complete flow\n4. âœ… Platform-specific download (web + mobile)\n5. âœ… Error handling & loading states\n6. âœ… Documentation & guides\n7. âœ… Test utilities\n8. âœ… Supabase template integration (5 female templates uploaded & verified)\n\n### ðŸ—ï¸ Architecture Highlights\n\n- **Async-Safe**: Shared executor, no blocking operations\n- **Cross-Platform**: Conditional imports for web/mobile\n- **Error Handling**: Try-catch with user feedback via SnackBar\n- **Resource Cleanup**: Temp files properly cleaned up\n- **Production-Ready**: Architect reviewed & approved\n\n---\n\n## ðŸš€ Next Steps\n\n### User Actions Required:\n\n1. **Upload Template Images**\n   - Follow `SUPABASE_STORAGE_GUIDE.md`\n   - Or copy to `assets/images/face_swap_templates/`\n\n2. **Test Face Swap**\n   - Web: Use `/face_swap_test.html`\n   - Mobile: Build APK vÃ  test\n\n3. **Deploy APK**\n   - Backend Ä‘Ã£ production-ready\n   - Build APK: `flutter build apk --release`\n   - Deploy via Codemagic hoáº·c local\n\n### Optional Enhancements:\n\n- [ ] Add gallery save permission for Android\n- [ ] Implement share intent on mobile\n- [ ] Add face swap history/cache\n- [ ] Multiple face detection & selection\n- [ ] Custom style degree adjustment\n\n---\n\n## ðŸ“ Key Files Modified\n\n**Backend:**\n- `services/image_ai_service.py` - Face swap service\n- `api_server.py` - API endpoint\n\n**Frontend:**\n- `lib/services/huggingface_service.dart` - API client\n- `lib/swapface/swapface_widget.dart` - UI integration\n- `lib/swapface/swapface_model.dart` - State management\n- `lib/swapface/swapface_download_*.dart` - Platform downloads\n\n**Documentation:**\n- `FACE_SWAP_FEATURE.md` (this file)\n- `SUPABASE_STORAGE_GUIDE.md`\n- `replit.md` (updated)\n\n**Testing:**\n- `face_swap_test.html`\n- `test_face_swap_api.py`\n\n---\n\n## ðŸ’¡ Tips\n\n1. **First Time Use**: Test vá»›i web (`/face_swap_test.html`) trÆ°á»›c khi test mobile\n2. **Upload Template**: DÃ¹ng Supabase Storage Ä‘á»ƒ dá»… quáº£n lÃ½\n3. **Performance**: Replicate API máº¥t 20-30s, user cáº§n tháº¥y loading indicator\n4. **Error Handling**: Check logs náº¿u API fail Ä‘á»ƒ debug\n5. **APK Size**: DÃ¹ng Supabase thay vÃ¬ assets Ä‘á»ƒ giáº£m APK size\n\n---\n\n## â“ Troubleshooting\n\n### Issue: Face swap timeout\n- **Cause**: Replicate model Ä‘ang quÃ¡ táº£i hoáº·c image quÃ¡ lá»›n\n- **Fix**: Resize image trÆ°á»›c khi upload, hoáº·c retry\n\n### Issue: Mobile build fails\n- **Cause**: Platform-specific imports\n- **Fix**: Code Ä‘Ã£ fix vá»›i conditional imports, rebuild clean\n\n### Issue: Download khÃ´ng hoáº¡t Ä‘á»™ng\n- **Web**: Check browser console logs\n- **Mobile**: Check app permissions (storage)\n\n### Issue: Template khÃ´ng hiá»ƒn thá»‹\n- **Check**: Supabase bucket public settings\n- **Check**: URL format Ä‘Ãºng\n- **Fallback**: DÃ¹ng local assets\n\n---\n\n## ðŸŽ‰ Summary\n\nFace Swap feature hoÃ n toÃ n sáºµn sÃ ng cho production! \n\n**User cÃ³ thá»ƒ:**\n- âœ… Click template style báº¥t ká»³\n- âœ… Chá»n áº£nh selfie tá»« gallery/camera\n- âœ… Xem káº¿t quáº£ face swap trong 20-30s\n- âœ… Download áº£nh káº¿t quáº£ vá» mÃ¡y\n\n**Backend:**\n- âœ… Replicate Pro API (primary, fast, reliable)\n- âœ… Huggingface fallback (backup, free)\n- âœ… Async-safe, production-ready architecture\n\n**Ready to deploy APK!** ðŸš€\n","size_bytes":7543},"ios/Flutter/ephemeral/flutter_lldb_helper.py":{"content":"#\n# Generated file, do not edit.\n#\n\nimport lldb\n\ndef handle_new_rx_page(frame: lldb.SBFrame, bp_loc, extra_args, intern_dict):\n    \"\"\"Intercept NOTIFY_DEBUGGER_ABOUT_RX_PAGES and touch the pages.\"\"\"\n    base = frame.register[\"x0\"].GetValueAsAddress()\n    page_len = frame.register[\"x1\"].GetValueAsUnsigned()\n\n    # Note: NOTIFY_DEBUGGER_ABOUT_RX_PAGES will check contents of the\n    # first page to see if handled it correctly. This makes diagnosing\n    # misconfiguration (e.g. missing breakpoint) easier.\n    data = bytearray(page_len)\n    data[0:8] = b'IHELPED!'\n\n    error = lldb.SBError()\n    frame.GetThread().GetProcess().WriteMemory(base, data, error)\n    if not error.Success():\n        print(f'Failed to write into {base}[+{page_len}]', error)\n        return\n\ndef __lldb_init_module(debugger: lldb.SBDebugger, _):\n    target = debugger.GetDummyTarget()\n    # Caveat: must use BreakpointCreateByRegEx here and not\n    # BreakpointCreateByName. For some reasons callback function does not\n    # get carried over from dummy target for the later.\n    bp = target.BreakpointCreateByRegex(\"^NOTIFY_DEBUGGER_ABOUT_RX_PAGES$\")\n    bp.SetScriptCallbackFunction('{}.handle_new_rx_page'.format(__name__))\n    bp.SetAutoContinue(True)\n    print(\"-- LLDB integration loaded --\")\n","size_bytes":1276},"FACE_SWAP_AUTO_TEMPLATES.md":{"content":"# Face Swap Auto-Loading Templates Feature\n\n## Overview\nFace swap templates are now automatically loaded from Supabase Storage, eliminating the need for manual code updates when adding new templates.\n\n## How It Works\n\n### Architecture\n```\nSupabase Storage (face-swap-templates bucket)\n    â”œâ”€â”€ female/\n    â”œâ”€â”€ male/\n    â””â”€â”€ mixed/\n         â†“\nFaceSwapTemplateRepository.fetchAllTemplates()\n         â†“\nSwapfaceModel.loadTemplates()\n         â†“\nSwapfaceWidget (UI with loading/error/success states)\n```\n\n### Key Components\n\n#### 1. FaceSwapTemplateRepository (`lib/backend/supabase/face_swap_template_repository.dart`)\n- Fetches templates from Supabase Storage using `list()` API\n- Auto-discovers files from female/, male/, mixed/ folders\n- Filters image files (jpg, jpeg, png, webp)\n- Formats display names (removes extension, capitalizes words)\n- Generates public URLs for each template\n\n#### 2. SwapfaceModel (`lib/swapface/swapface_model.dart`)\n- Loading states: `isTemplatesLoading`, `templatesError`\n- Dynamic template lists: `femaleStyles`, `maleStyles`, `mixedStyles`\n- `loadTemplates()` method fetches and populates templates\n- `allTemplates` getter combines all categories for carousel\n\n#### 3. SwapfaceWidget (`lib/swapface/swapface_widget.dart`)\n- Loads templates on `initState`\n- Shows loading spinner while fetching\n- Displays error UI with retry button on failure\n- Shows empty state if no templates found\n- Renders carousel when templates loaded successfully\n\n## Adding New Templates\n\n### Simple Process:\n1. Upload image files to Supabase Storage bucket `face-swap-templates`\n2. Choose folder: `female/`, `male/`, or `mixed/`\n3. That's it! App will auto-discover on next load\n\n### Example:\n```\nUpload: male/handsome.jpg, male/themen.jpg\nResult: Templates auto-appear in carousel as \"Handsome\" and \"Themen\"\n```\n\n## UI States\n\n### 1. Loading State\n- Purple circular spinner\n- \"Loading templates...\" text\n- Shown during initial fetch\n\n### 2. Error State\n- Red error icon\n- \"Failed to load templates\" message\n- Error details displayed\n- Purple \"Retry\" button\n\n### 3. Empty State\n- \"No templates available\" message\n- Shown when folders are empty\n\n### 4. Success State\n- PageView carousel with templates\n- Animated scaling for center item\n- Dot indicators\n- First template auto-selected\n\n## Current Templates (Auto-Loaded)\n\n### Female (5 templates)\n- Beautiful Girl\n- Kate Upton\n- Nice Girl\n- USA Girl\n- Wedding Face\n\n### Male (4 templates)\n- Aquaman\n- Handsome\n- Superman\n- Themen\n\n### Mixed (2 templates)\n- Beckham\n- Parka Clothing\n\n**Total: 11 templates** (dynamically loaded)\n\n## Benefits\nâœ… No code changes needed when adding templates\nâœ… Clean separation of data and code\nâœ… Easy template management via Supabase UI\nâœ… Automatic error handling and retry\nâœ… Scalable solution for unlimited templates\n\n## Mobile Download Enhancement\nFace swap results now save to **Gallery/Photos app** using `gal` package instead of internal storage. Users can easily find downloaded images in their device's photo gallery.\n\n---\n*Last Updated: October 2025*\n","size_bytes":3080},"build_with_all_ads.sh":{"content":"#!/bin/bash\n\n# Build APK/AAB with all AdMob and AppLovin secrets for fallback ads\n# Usage: \n#   ./build_with_all_ads.sh apk      # Build APK\n#   ./build_with_all_ads.sh appbundle # Build AAB\n#   ./build_with_all_ads.sh web      # Build Web\n\nBUILD_TYPE=\"${1:-apk}\"\n\nflutter build $BUILD_TYPE --release \\\n  --dart-define=SUPPORT_EMAIL=\"${SUPPORT_EMAIL:-jokerlin135@gmail.com}\" \\\n  --dart-define=ADMOB_APP_ID=\"$ADMOB_APP_ID\" \\\n  --dart-define=ADMOB_BANNER_AD_UNIT_ID=\"$ADMOB_BANNER_AD_UNIT_ID\" \\\n  --dart-define=ADMOB_INTERSTITIAL_AD_UNIT_ID=\"$ADMOB_INTERSTITIAL_AD_UNIT_ID\" \\\n  --dart-define=ADMOB_NATIVE_AD_UNIT_ID=\"$ADMOB_NATIVE_AD_UNIT_ID\" \\\n  --dart-define=ADMOB_APP_OPEN_AD_UNIT_ID=\"$ADMOB_APP_OPEN_AD_UNIT_ID\" \\\n  --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"$ADMOB_REWARDED_AD_UNIT_ID\" \\\n  --dart-define=APPLOVIN_SDK_KEY=\"$APPLOVIN_SDK_KEY\" \\\n  --dart-define=APPLOVIN_BANNER_AD_UNIT_ID=\"$APPLOVIN_BANNER_AD_UNIT_ID\" \\\n  --dart-define=APPLOVIN_INTERSTITIAL_AD_UNIT_ID=\"$APPLOVIN_INTERSTITIAL_AD_UNIT_ID\" \\\n  --dart-define=APPLOVIN_APP_OPEN_AD_UNIT_ID=\"$APPLOVIN_APP_OPEN_AD_UNIT_ID\" \\\n  --dart-define=APPLOVIN_REWARDED_AD_UNIT_ID=\"$APPLOVIN_REWARDED_AD_UNIT_ID\" \\\n  --dart-define=APPLOVIN_NATIVE_AD_UNIT_ID=\"$APPLOVIN_NATIVE_AD_UNIT_ID\"\n","size_bytes":1237},"AD_SETUP_GUIDE.md":{"content":"# ðŸ“± HÆ°á»›ng dáº«n Setup & Debug Ads\n\n## ðŸ” Kiá»ƒm tra Ads Ä‘Ã£ hoáº¡t Ä‘á»™ng chÆ°a\n\n### **BÆ°á»›c 1: Xem Logcat/Console**\n\nKhi app khá»Ÿi Ä‘á»™ng, báº¡n sáº½ tháº¥y logs sau:\n\n#### **AppLovin Ads:**\n```\nðŸ” AppLovin Configuration Check:\n  SDK Key: âœ… Found (hoáº·c âŒ MISSING)\n  Rewarded Ad Unit: âœ… Found (hoáº·c âŒ MISSING)\n  Banner Ad Unit: âœ… Found (hoáº·c âŒ MISSING)\n  Interstitial Ad Unit: âœ… Found (hoáº·c âŒ MISSING)\n```\n\n#### **AdMob Ads:**\n```\nðŸ” AdMob Rewarded Configuration Check:\n  Rewarded Ad Unit: âœ… Found (hoáº·c âŒ MISSING - will use test ads)\n```\n\n### **BÆ°á»›c 2: Náº¿u tháº¥y âŒ MISSING**\n\n**NguyÃªn nhÃ¢n:** App khÃ´ng Ä‘Æ°á»£c build vá»›i ad configuration\n\n**Giáº£i phÃ¡p:**\n```bash\n# Build vá»›i táº¥t cáº£ ad secrets\n./build_with_all_ads.sh apk\n\n# Hoáº·c build App Bundle\n./build_with_all_ads.sh appbundle\n```\n\n---\n\n## ðŸ“¦ Package Name\n\n**ÄÃºng:** `com.visoai.photoheadshot`\n\nKiá»ƒm tra trong:\n- `android/app/build.gradle` â†’ `applicationId \"com.visoai.photoheadshot\"`\n- `android/app/src/main/AndroidManifest.xml` â†’ `package=\"com.visoai.photoheadshot\"`\n\n---\n\n## ðŸŽ¯ Test Ads Configuration\n\n### **Option 1: AdMob Test Ads (KhuyÃªn dÃ¹ng - ÄÆ¡n giáº£n nháº¥t)**\n\nAdMob tá»± Ä‘á»™ng dÃ¹ng test ads náº¿u khÃ´ng cÃ³ production ID:\n\n**Android Test IDs (Ä‘Ã£ cÃ³ sáºµn trong code):**\n- Banner: `ca-app-pub-3940256099942544/6300978111`\n- Interstitial: `ca-app-pub-3940256099942544/1033173712`\n- Rewarded: `ca-app-pub-3940256099942544/5224354917` âœ…\n\n**iOS Test IDs (Ä‘Ã£ cÃ³ sáºµn trong code):**\n- Banner: `ca-app-pub-3940256099942544/2934735716`\n- Interstitial: `ca-app-pub-3940256099942544/4411468910`\n- Rewarded: `ca-app-pub-3940256099942544/1712485313` âœ…\n\n**Æ¯u Ä‘iá»ƒm:**\n- âœ… KhÃ´ng cáº§n Ä‘Äƒng kÃ½\n- âœ… Hoáº¡t Ä‘á»™ng ngay láº­p tá»©c\n- âœ… KhÃ´ng bá»‹ banned vÃ¬ policy violation\n\n### **Option 2: AppLovin Test Mode**\n\n**Setup trong AppLovin Dashboard:**\n1. VÃ o https://dash.applovin.com/\n2. Settings â†’ Test Mode â†’ Add Test Device\n3. Nháº­p Package Name: `com.visoai.photoheadshot`\n4. Nháº­p Device ID (xem trong Logcat lÃºc khá»Ÿi Ä‘á»™ng)\n\n**Hoáº·c programmatically:**\n```dart\nAppLovinMAX.setTestDeviceAdvertisingIds(['YOUR_DEVICE_ID']);\n```\n\n---\n\n## ðŸ”§ Debugging Steps\n\n### **1. Build Ä‘Ãºng cÃ¡ch:**\n```bash\n# Äáº£m báº£o secrets Ä‘Ã£ cÃ³ trong Replit\necho $APPLOVIN_SDK_KEY\necho $ADMOB_REWARDED_AD_UNIT_ID\n\n# Build APK vá»›i ad configuration\n./build_with_all_ads.sh apk\n```\n\n### **2. Install & Check Logs:**\n```bash\n# Install APK\nadb install build/app/outputs/flutter-apk/app-release.apk\n\n# Xem logs\nadb logcat | grep -E \"AppLovin|AdMob|Rewarded\"\n```\n\n### **3. Kiá»ƒm tra logs khi app khá»Ÿi Ä‘á»™ng:**\n\n**Náº¿u tháº¥y:**\n```\nâœ… AppLovin MAX initialized successfully\nâœ… AdMob initialized successfully\nâœ… Rewarded ad loaded\n```\nâ†’ **Ads hoáº¡t Ä‘á»™ng tá»‘t!**\n\n**Náº¿u tháº¥y:**\n```\nâŒ AppLovin SDK Key not found\nðŸ’¡ Build with: ./build_with_all_ads.sh apk\n```\nâ†’ **Báº¡n chÆ°a build Ä‘Ãºng cÃ¡ch**\n\n---\n\n## ðŸš€ Alternative: Unity Ads (Náº¿u AppLovin/AdMob khÃ´ng hoáº¡t Ä‘á»™ng)\n\nUnity Ads ráº¥t dá»… setup vÃ  tá»± Ä‘á»™ng test mode:\n\n### **Setup:**\n\n1. **Add package:**\n```yaml\n# pubspec.yaml\ndependencies:\n  unity_ads_plugin: ^0.3.11\n```\n\n2. **Initialize:**\n```dart\n// main.dart\nimport 'package:unity_ads_plugin/unity_ads_plugin.dart';\n\nawait UnityAds.init(\n  gameId: Platform.isAndroid ? '4374881' : '4374880', // Test IDs\n  testMode: true, // Tá»± Ä‘á»™ng test ads\n);\n```\n\n3. **Show Rewarded Ad:**\n```dart\nUnityAds.load(\n  placementId: 'Rewarded_Android',\n  onComplete: (placementId) => print('Ad loaded'),\n  onFailed: (placementId, error, message) => print('Ad failed'),\n);\n\nUnityAds.showVideoAd(\n  placementId: 'Rewarded_Android',\n  onComplete: (placementId) {\n    // User xem xong ad\n    _swapFace();\n  },\n);\n```\n\n**Æ¯u Ä‘iá»ƒm Unity Ads:**\n- âœ… Tá»± Ä‘á»™ng test mode\n- âœ… KhÃ´ng cáº§n setup phá»©c táº¡p\n- âœ… Fill rate cao\n- âœ… Há»— trá»£ Flutter tá»‘t\n\n---\n\n## ðŸ“Š Recommended Ad Strategy\n\n### **Best Setup (2025):**\n\n**Primary:** AdMob (Test Ads)\n- Dá»… setup nháº¥t\n- Fill rate cao\n- Google test ads luÃ´n hoáº¡t Ä‘á»™ng\n\n**Fallback:** Unity Ads\n- Tá»± Ä‘á»™ng test mode\n- á»”n Ä‘á»‹nh\n- Dá»… integrate\n\n**Implementation:**\n```dart\n// Try AdMob first\nawait AdMobRewardedService.showRewardedAd(\n  onComplete: () => _swapFace(),\n  onFailed: () async {\n    // Fallback to Unity Ads\n    UnityAds.showVideoAd(\n      placementId: 'Rewarded_Android',\n      onComplete: (placementId) => _swapFace(),\n    );\n  },\n);\n```\n\n---\n\n## â“ FAQ\n\n### **Q: Táº¡i sao ads khÃ´ng hiá»ƒn thá»‹?**\nA: 99% do app khÃ´ng Ä‘Æ°á»£c build vá»›i `./build_with_all_ads.sh apk`\n\n### **Q: AdMob test ads cÃ³ hoáº¡t Ä‘á»™ng mÃ£i khÃ´ng?**\nA: CÃ³! Google cho phÃ©p dÃ¹ng test ads vÃ´ thá»i háº¡n trong development.\n\n### **Q: AppLovin test mode setup nhÆ° tháº¿ nÃ o?**\nA: VÃ o Dashboard â†’ Settings â†’ Test Mode â†’ Add device vá»›i package name `com.visoai.photoheadshot`\n\n### **Q: CÃ³ cÃ¡ch nÃ o dá»… hÆ¡n khÃ´ng?**\nA: DÃ¹ng AdMob test ads (Ä‘Ã£ cÃ³ sáºµn trong code) - khÃ´ng cáº§n setup gÃ¬ cáº£!\n\n---\n\n## ðŸ“ Summary\n\n**Äá»ƒ ads hoáº¡t Ä‘á»™ng:**\n\n1. âœ… Build vá»›i: `./build_with_all_ads.sh apk`\n2. âœ… Xem logs khi app khá»Ÿi Ä‘á»™ng\n3. âœ… Náº¿u AppLovin fail â†’ AdMob fallback tá»± Ä‘á»™ng\n4. âœ… Náº¿u cáº£ 2 fail â†’ CÃ¢n nháº¯c Unity Ads\n\n**AdMob test ads (ca-app-pub-3940256099942544/...) lÃ  lá»±a chá»n Ä‘Æ¡n giáº£n nháº¥t vÃ  LUÃ”N hoáº¡t Ä‘á»™ng!**\n","size_bytes":5441},"DEBUG_ADS.md":{"content":"# Debug \"Ads not ready\" Issue\n\n## BÆ°á»›c 1: Xem Logcat khi App khá»Ÿi Ä‘á»™ng\n\n```powershell\n# Káº¿t ná»‘i Ä‘iá»‡n thoáº¡i vÃ  xem ads logs\nadb logcat -c  # Clear logs cÅ©\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded|ERROR|WARN\"\n```\n\n**TÃ¬m cÃ¡c dÃ²ng:**\n- `AppLovin MAX initialized` hoáº·c `AppLovin initialization failed`\n- `AdMob Rewarded ad loaded` hoáº·c `AdMob ad failed to load`\n- `ERROR` hoáº·c `WARN` liÃªn quan Ä‘áº¿n ads\n\n---\n\n## BÆ°á»›c 2: Test láº¡i vá»›i Google Test Ads\n\nNáº¿u báº¡n Ä‘ang dÃ¹ng **production ad IDs**, chÃºng cÃ³ thá»ƒ chÆ°a Ä‘Æ°á»£c approve hoáº·c chÆ°a setup Ä‘Ãºng.\n\n**Giáº£i phÃ¡p: DÃ¹ng Google Test Ads (luÃ´n hoáº¡t Ä‘á»™ng)**\n\n### Sá»­a file `secrets.env`:\n\n```bash\n# Thay tháº¿ báº±ng Google Test Ad IDs\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\nexport ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-3940256099942544/6300978111\"\nexport ADMOB_INTERSTITIAL_AD_UNIT_ID=\"ca-app-pub-3940256099942544/1033173712\"\n\n# Äá»ƒ trá»‘ng AppLovin náº¿u chÆ°a setup test mode\n# export APPLOVIN_SDK_KEY=\"\"\n# export APPLOVIN_REWARDED_AD_UNIT_ID=\"\"\n```\n\n### Build láº¡i:\n\n```powershell\n.\\build_with_all_ads.ps1 apk\nadb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n---\n\n## BÆ°á»›c 3: Kiá»ƒm tra App Logs\n\nKhi app khá»Ÿi Ä‘á»™ng, tÃ¬m dÃ²ng:\n\n### âœ… Ads hoáº¡t Ä‘á»™ng tá»‘t:\n```\n[OK] AppLovin SDK Key: Found\n[OK] AppLovin initialized successfully\n[OK] Rewarded ad loaded successfully\n```\n\n### âŒ Ads khÃ´ng hoáº¡t Ä‘á»™ng:\n```\n[ERROR] AppLovin initialization failed: Invalid SDK Key\n[ERROR] AdMob ad failed to load: AD_UNIT_NOT_READY\n[WARN] Using AdMob fallback...\n```\n\n---\n\n## Common Issues & Solutions\n\n### Issue 1: \"Invalid SDK Key\" hoáº·c \"Ad Unit not found\"\n\n**NguyÃªn nhÃ¢n:** Production ad IDs chÆ°a Ä‘Æ°á»£c setup trong AdMob/AppLovin dashboard\n\n**Giáº£i phÃ¡p:** DÃ¹ng Google Test Ad IDs (xem BÆ°á»›c 2)\n\n---\n\n### Issue 2: \"No fill\" hoáº·c \"Network error\"\n\n**NguyÃªn nhÃ¢n:** KhÃ´ng cÃ³ internet hoáº·c ad network khÃ´ng cÃ³ ads available\n\n**Giáº£i phÃ¡p:**\n- Kiá»ƒm tra internet connection\n- Thá»­ láº¡i sau vÃ i phÃºt\n- DÃ¹ng Test Ad IDs\n\n---\n\n### Issue 3: \"App ID not set\" (AppLovin)\n\n**NguyÃªn nhÃ¢n:** Thiáº¿u APPLOVIN_SDK_KEY hoáº·c invalid\n\n**Giáº£i phÃ¡p:** \n- Äá»ƒ trá»‘ng AppLovin secrets trong secrets.env\n- App sáº½ tá»± Ä‘á»™ng fallback sang AdMob\n\n```bash\n# secrets.env - Chá»‰ dÃ¹ng AdMob\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\n# KhÃ´ng set APPLOVIN_SDK_KEY\n```\n\n---\n\n### Issue 4: Ads cáº§n thá»i gian load\n\n**NguyÃªn nhÃ¢n:** Ads load asynchronously, cáº§n 2-5 giÃ¢y\n\n**Giáº£i phÃ¡p:** Äá»£i vÃ i giÃ¢y sau khi app khá»Ÿi Ä‘á»™ng, rá»“i click \"Watch Ad\"\n\n---\n\n## Recommended: Build vá»›i CHá»ˆ AdMob Test Ads\n\nÄÃ¢y lÃ  cÃ¡ch **dá»… nháº¥t vÃ  cháº¯c cháº¯n hoáº¡t Ä‘á»™ng**:\n\n### 1. Sá»­a secrets.env:\n\n```bash\nexport SUPABASE_URL=\"your_url_here\"\nexport SUPABASE_ANON_KEY=\"your_key_here\"\nexport HUGGINGFACE_TOKEN=\"your_token_here\"\nexport REPLICATE_API_TOKEN=\"your_token_here\"\n\n# Chá»‰ dÃ¹ng Google Test Ads (luÃ´n hoáº¡t Ä‘á»™ng)\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\nexport ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-3940256099942544/6300978111\"\n\n# KHÃ”NG set AppLovin (Ä‘á»ƒ app dÃ¹ng AdMob)\n# export APPLOVIN_SDK_KEY=\"\"\n```\n\n### 2. Build láº¡i:\n\n```powershell\n.\\build_with_all_ads.ps1 apk\nadb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n### 3. Test:\n\n1. Má»Ÿ app\n2. **Äá»£i 5 giÃ¢y** Ä‘á»ƒ ads load\n3. Click \"Swap Face - Watch Ad\"\n4. AdMob test ad sáº½ hiá»ƒn thá»‹\n\n---\n\n## Debug Commands\n\n```powershell\n# Xem táº¥t cáº£ logs\nadb logcat\n\n# Chá»‰ xem ads logs\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded\"\n\n# Xem ERROR logs\nadb logcat | Select-String \"ERROR\"\n\n# Clear logs vÃ  start fresh\nadb logcat -c\nadb logcat | Select-String \"AppLovin|AdMob\"\n```\n\n---\n\n## TL;DR - Quick Fix\n\n```powershell\n# 1. Edit secrets.env - Chá»‰ dÃ¹ng AdMob Test Ads\nnotepad secrets.env\n\n# 2. Copy vÃ o secrets.env:\n# export ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\n\n# 3. Build láº¡i\n.\\build_with_all_ads.ps1 apk\n\n# 4. Install\nadb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# 5. Xem logs\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded\"\n\n# 6. Má»Ÿ app, Ä‘á»£i 5 giÃ¢y, click Watch Ad\n```\n\n---\n\n## Expected Logcat Output (Success)\n\n```\nI/AppLovinService: SDK Key found: xxx\nI/AppLovinService: Initializing AppLovin MAX...\nI/AppLovinService: AppLovin MAX initialized successfully\nI/AppLovinService: Loading rewarded ad...\nI/AppLovinService: Rewarded ad loaded successfully\n\n-- OR (if AppLovin fails) --\n\nE/AppLovinService: AppLovin initialization failed\nI/AdMobRewardedService: Using AdMob fallback...\nI/AdMobRewardedService: AdMob rewarded ad loaded successfully\n```\n","size_bytes":4778},"REPLIT_MIGRATION_GUIDE.md":{"content":"# HÆ°á»›ng Dáº«n Di Chuyá»ƒn Project Sang TÃ i Khoáº£n Replit KhÃ¡c\n\n## ðŸ“‹ Tá»•ng Quan\n\nHÆ°á»›ng dáº«n nÃ y giÃºp báº¡n upload code lÃªn GitHub vÃ  import vÃ o tÃ i khoáº£n Replit má»›i. ToÃ n bá»™ quy trÃ¬nh máº¥t khoáº£ng **15-20 phÃºt**.\n\n---\n\n## ðŸš€ BÆ°á»›c 1: Chuáº©n Bá»‹ Code TrÃªn Replit Hiá»‡n Táº¡i\n\n### 1.1. Kiá»ƒm tra file .gitignore\n\nÄáº£m báº£o file `.gitignore` Ä‘Ã£ loáº¡i trá»« cÃ¡c file nháº¡y cáº£m:\n\n```bash\n# Kiá»ƒm tra .gitignore cÃ³ Ä‘áº§y Ä‘á»§ chÆ°a\ncat .gitignore\n```\n\nFile `.gitignore` pháº£i cÃ³:\n```\n# Secrets vÃ  mÃ´i trÆ°á»ng\n*.env\nsecrets.env\n.env.local\n\n# Build outputs\nbuild/\n.dart_tool/\n.flutter-plugins\n.flutter-plugins-dependencies\n\n# IDE\n.idea/\n*.iml\n.vscode/\n\n# Packages\n.packages\npubspec.lock\n```\n\n### 1.2. XÃ¡c nháº­n khÃ´ng commit secrets\n\n```bash\n# Kiá»ƒm tra khÃ´ng cÃ³ secrets trong code\ngrep -r \"SUPABASE_URL\" lib/ || echo \"âœ… Safe\"\ngrep -r \"REPLICATE_API_TOKEN\" lib/ || echo \"âœ… Safe\"\n```\n\nNáº¿u tháº¥y secrets hardcoded â†’ **XÃ“A NGAY** trÆ°á»›c khi push lÃªn GitHub!\n\n---\n\n## ðŸ“¤ BÆ°á»›c 2: Upload LÃªn GitHub\n\n### 2.1. Táº¡o Repository Má»›i TrÃªn GitHub\n\n1. VÃ o [github.com/new](https://github.com/new)\n2. Äiá»n thÃ´ng tin:\n   - **Repository name:** `viso-ai-photo-avatar` (hoáº·c tÃªn khÃ¡c)\n   - **Visibility:** Private hoáº·c Public (tÃ¹y chá»n)\n   - **âœ… KHÃ”NG** tick \"Add README\" (vÃ¬ Ä‘Ã£ cÃ³ code)\n3. Click **Create repository**\n\n### 2.2. Push Code LÃªn GitHub Tá»« Replit\n\n**TrÃªn Replit Shell, cháº¡y cÃ¡c lá»‡nh sau:**\n\n```bash\n# Khá»Ÿi táº¡o Git (náº¿u chÆ°a cÃ³)\ngit init\n\n# Add remote GitHub repository (thay YOUR_USERNAME vÃ  YOUR_REPO)\ngit remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git\n\n# Add táº¥t cáº£ files\ngit add .\n\n# Commit\ngit commit -m \"Initial commit - Viso AI Photo Avatar App\"\n\n# Push lÃªn GitHub\ngit branch -M main\ngit push -u origin main\n```\n\n**âš ï¸ Náº¿u gáº·p lá»—i authentication:**\n\nSá»­ dá»¥ng **Personal Access Token (PAT)**:\n1. VÃ o GitHub â†’ Settings â†’ Developer settings â†’ Personal access tokens â†’ Tokens (classic)\n2. Generate new token (classic)\n3. Chá»n scopes: `repo` (full control)\n4. Copy token\n5. Push vá»›i token:\n```bash\ngit remote set-url origin https://YOUR_TOKEN@github.com/YOUR_USERNAME/YOUR_REPO.git\ngit push -u origin main\n```\n\n### 2.3. XÃ¡c Nháº­n Code ÄÃ£ Upload\n\n1. VÃ o repository GitHub: `https://github.com/YOUR_USERNAME/YOUR_REPO`\n2. Kiá»ƒm tra cÃ³ cÃ¡c files chÃ­nh:\n   - âœ… `lib/` folder\n   - âœ… `pubspec.yaml`\n   - âœ… `api_server.py`\n   - âœ… `requirements.txt`\n   - âœ… `replit.md`\n   - âŒ **KHÃ”NG** cÃ³ `secrets.env` hoáº·c `.env`\n\n---\n\n## ðŸ“¥ BÆ°á»›c 3: Import VÃ o TÃ i Khoáº£n Replit Má»›i\n\n### 3.1. ÄÄƒng Nháº­p TÃ i Khoáº£n Replit Má»›i\n\n1. Logout tÃ i khoáº£n hiá»‡n táº¡i (hoáº·c dÃ¹ng browser khÃ¡c)\n2. Login tÃ i khoáº£n Replit má»›i táº¡i [replit.com](https://replit.com)\n\n### 3.2. Import Project Tá»« GitHub\n\n**CÃ¡ch 1 - Rapid Import (Nhanh - Cho Public Repo):**\n\n1. VÃ o URL sau (thay `YOUR_USERNAME` vÃ  `YOUR_REPO`):\n   ```\n   https://replit.com/github.com/YOUR_USERNAME/YOUR_REPO\n   ```\n2. Replit sáº½ tá»± Ä‘á»™ng import â†’ Click **Import** Ä‘á»ƒ xÃ¡c nháº­n\n\n**CÃ¡ch 2 - Guided Import (Äáº§y Ä‘á»§ - Cho Private/Public Repo):**\n\n1. VÃ o [replit.com/import](https://replit.com/import)\n2. Chá»n **GitHub** lÃ m nguá»“n import\n3. Click **Connect GitHub** vÃ  authorize Replit truy cáº­p GitHub\n4. Chá»n repository cáº§n import tá»« danh sÃ¡ch\n5. Chá»n **Privacy settings** (Public/Private)\n6. Click **Import from GitHub**\n\n### 3.3. Äá»£i Import HoÃ n Táº¥t\n\nReplit sáº½:\n- âœ… Copy toÃ n bá»™ code\n- âœ… Tá»± Ä‘á»™ng detect ngÃ´n ngá»¯ (Flutter + Python)\n- âœ… Tá»± Ä‘á»™ng cÃ i dependencies (`pubspec.yaml`, `requirements.txt`)\n- â³ CÃ³ thá»ƒ máº¥t 2-5 phÃºt\n\n---\n\n## ðŸ”§ BÆ°á»›c 4: Cáº¥u HÃ¬nh Láº¡i TrÃªn Replit Má»›i\n\n### 4.1. âš ï¸ QUAN TRá»ŒNG: Setup Secrets (API Keys)\n\nReplit **KHÃ”NG** import secrets vÃ¬ lÃ½ do báº£o máº­t. Báº¡n PHáº¢I add láº¡i thá»§ cÃ´ng:\n\n1. **Má»Ÿ Secrets tool:**\n   - Click sidebar â†’ **Tools** â†’ **Secrets**\n   - Hoáº·c click biá»ƒu tÆ°á»£ng khÃ³a ðŸ”’ á»Ÿ sidebar\n\n2. **Add tá»«ng secret:**\n\n| Key | Value | Nguá»“n láº¥y |\n|-----|-------|-----------|\n| `SUPABASE_URL` | `https://xxxxx.supabase.co` | Supabase Project Settings |\n| `SUPABASE_ANON_KEY` | `eyJhbGc...` | Supabase Project Settings â†’ API |\n| `HUGGINGFACE_TOKEN` | `hf_xxxxx` | Huggingface â†’ Settings â†’ Access Tokens |\n| `REPLICATE_API_TOKEN` | `r8_xxxxx` | Replicate â†’ Account â†’ API Tokens |\n\n**CÃ¡ch thÃªm secret:**\n- Click **+ New Secret**\n- Nháº­p **Key** (vÃ­ dá»¥: `SUPABASE_URL`)\n- Nháº­p **Value** (copy tá»« nguá»“n tÆ°Æ¡ng á»©ng)\n- Click **Add Secret**\n\n### 4.2. Kiá»ƒm Tra Workflow\n\n1. **Má»Ÿ Workflows tool:**\n   - Click sidebar â†’ **Tools** â†’ **Workflows**\n   - Hoáº·c click biá»ƒu tÆ°á»£ng âš™ï¸\n\n2. **Kiá»ƒm tra workflow \"Server\" Ä‘Ã£ cÃ³ chÆ°a:**\n\nNáº¿u **CHÆ¯A CÃ“** â†’ Add workflow má»›i:\n- **Name:** `Server`\n- **Command:** `python3 api_server.py`\n- **Output type:** `webview`\n- **Wait for port:** `5000`\n\nNáº¿u **ÄÃƒ CÃ“** â†’ Kiá»ƒm tra command Ä‘Ãºng lÃ  `python3 api_server.py`\n\n### 4.3. CÃ i Äáº·t Dependencies (Náº¿u Cáº§n)\n\nReplit thÆ°á»ng tá»± Ä‘á»™ng cÃ i, nhÆ°ng náº¿u thiáº¿u:\n\n**Flutter:**\n```bash\nflutter pub get\n```\n\n**Python:**\n```bash\npip install -r requirements.txt\n```\n\n---\n\n## âœ… BÆ°á»›c 5: Test VÃ  Cháº¡y App\n\n### 5.1. Build Flutter Web\n\n```bash\nflutter build web --release\n```\n\nÄá»£i build xong (khoáº£ng 1-2 phÃºt).\n\n### 5.2. Start Server\n\nClick nÃºt **Run** á»Ÿ Ä‘áº§u mÃ n hÃ¬nh hoáº·c:\n\n```bash\npython3 api_server.py\n```\n\n### 5.3. Kiá»ƒm Tra App Hoáº¡t Äá»™ng\n\n1. **Web preview sáº½ má»Ÿ tá»± Ä‘á»™ng** táº¡i `http://0.0.0.0:5000`\n2. **Test cÃ¡c chá»©c nÄƒng:**\n   - âœ… Homepage load Ä‘Æ°á»£c\n   - âœ… Face Swap templates hiá»ƒn thá»‹ (kiá»ƒm tra Supabase connection)\n   - âœ… Äa ngÃ´n ngá»¯ hoáº¡t Ä‘á»™ng (Settings â†’ Language)\n   - âœ… API AI hoáº¡t Ä‘á»™ng (test HD photo, face swap)\n\n### 5.4. Kiá»ƒm Tra Console Logs\n\nNáº¿u cÃ³ lá»—i, check logs:\n\n1. Click **Console** tab dÆ°á»›i mÃ n hÃ¬nh\n2. TÃ¬m lá»—i:\n   - âŒ `KeyError: 'SUPABASE_URL'` â†’ ChÆ°a setup secrets\n   - âŒ `Failed to load templates` â†’ Sai Supabase credentials\n   - âŒ `Replicate API error` â†’ Sai REPLICATE_API_TOKEN\n\n---\n\n## ðŸ› BÆ°á»›c 6: Troubleshooting\n\n### âŒ Lá»—i: \"Secrets not found\"\n\n**NguyÃªn nhÃ¢n:** ChÆ°a add secrets hoáº·c sai tÃªn key.\n\n**Giáº£i phÃ¡p:**\n1. VÃ o **Tools â†’ Secrets**\n2. XÃ¡c nháº­n cÃ³ Ä‘á»§ 4 secrets: `SUPABASE_URL`, `SUPABASE_ANON_KEY`, `HUGGINGFACE_TOKEN`, `REPLICATE_API_TOKEN`\n3. Key pháº£i **CHÃNH XÃC** (khÃ´ng cÃ³ khoáº£ng tráº¯ng, viáº¿t hoa Ä‘Ãºng)\n\n### âŒ Lá»—i: \"Port 5000 already in use\"\n\n**Giáº£i phÃ¡p:**\n```bash\n# Kill process cÅ©\npkill -f api_server.py\n# Cháº¡y láº¡i\npython3 api_server.py\n```\n\n### âŒ Lá»—i: \"Flutter not found\"\n\n**Giáº£i phÃ¡p:**\n```bash\n# Install Flutter module\nnix-env -iA nixpkgs.flutter\n```\n\n### âŒ Lá»—i: Templates khÃ´ng load\n\n**NguyÃªn nhÃ¢n:** Sai Supabase credentials.\n\n**Giáº£i phÃ¡p:**\n1. Kiá»ƒm tra `SUPABASE_URL` vÃ  `SUPABASE_ANON_KEY` Ä‘Ãºng chÆ°a\n2. Test Supabase connection:\n```bash\ncurl -H \"apikey: YOUR_SUPABASE_ANON_KEY\" \\\n     \"YOUR_SUPABASE_URL/storage/v1/bucket/face-swap-templates\"\n```\n\n### âŒ Lá»—i: AI features khÃ´ng hoáº¡t Ä‘á»™ng\n\n**NguyÃªn nhÃ¢n:** Sai API tokens.\n\n**Giáº£i phÃ¡p:**\n1. Kiá»ƒm tra `HUGGINGFACE_TOKEN` vÃ  `REPLICATE_API_TOKEN`\n2. Test Replicate API:\n```bash\ncurl -H \"Authorization: Token YOUR_REPLICATE_API_TOKEN\" \\\n     https://api.replicate.com/v1/models\n```\n\n---\n\n## ðŸ“± BÆ°á»›c 7: Build APK (Optional - TrÃªn Local Windows)\n\nReplit chá»‰ há»— trá»£ Flutter Web. Äá»ƒ build APK:\n\n### 7.1. Clone Code Vá» MÃ¡y Local\n\n```bash\ngit clone https://github.com/YOUR_USERNAME/YOUR_REPO.git\ncd YOUR_REPO\n```\n\n### 7.2. Táº¡o File secrets.env\n\nTáº¡o file `secrets.env` (dÃ¹ng `secrets.env.template` lÃ m máº«u):\n\n```env\nSUPABASE_URL=https://xxxxx.supabase.co\nSUPABASE_ANON_KEY=eyJhbGc...\nHUGGINGFACE_TOKEN=hf_xxxxx\nREPLICATE_API_TOKEN=r8_xxxxx\nADMOB_REWARDED_AD_UNIT_ID=ca-app-pub-3940256099942544/5224354917\nAPPLOVIN_SDK_KEY=your_key_here\n```\n\n### 7.3. Build APK\n\n**Windows PowerShell:**\n```powershell\n.\\build_with_all_ads.ps1 apk\n```\n\n**Unix/Mac:**\n```bash\nchmod +x build_with_all_ads.sh\n./build_with_all_ads.sh apk\n```\n\nAPK output: `build/app/outputs/flutter-apk/app-release.apk`\n\n---\n\n## ðŸ“ Checklist Tá»•ng Há»£p\n\n### TrÃªn Replit CÅ©:\n- [ ] Kiá»ƒm tra `.gitignore` Ä‘áº§y Ä‘á»§\n- [ ] KhÃ´ng cÃ³ secrets hardcoded trong code\n- [ ] Push code lÃªn GitHub thÃ nh cÃ´ng\n\n### TrÃªn GitHub:\n- [ ] Repository Ä‘Ã£ cÃ³ Ä‘áº§y Ä‘á»§ code\n- [ ] KhÃ´ng cÃ³ file `secrets.env` hoáº·c `.env`\n\n### TrÃªn Replit Má»›i:\n- [ ] Import project thÃ nh cÃ´ng\n- [ ] Add Ä‘á»§ 4 secrets (Supabase, Huggingface, Replicate)\n- [ ] Workflow \"Server\" Ä‘Ã£ setup Ä‘Ãºng\n- [ ] Dependencies Ä‘Ã£ cÃ i xong\n- [ ] Build Flutter Web thÃ nh cÃ´ng\n- [ ] App cháº¡y Ä‘Æ°á»£c á»Ÿ port 5000\n- [ ] Test cÃ¡c features hoáº¡t Ä‘á»™ng\n\n### Testing:\n- [ ] Homepage load Ä‘Æ°á»£c\n- [ ] Face Swap templates hiá»ƒn thá»‹\n- [ ] Äa ngÃ´n ngá»¯ hoáº¡t Ä‘á»™ng\n- [ ] AI features hoáº¡t Ä‘á»™ng (HD, face swap, etc.)\n\n---\n\n## ðŸ”— Links Tham Kháº£o\n\n- **Replit Import:** [replit.com/import](https://replit.com/import)\n- **GitHub Token:** [github.com/settings/tokens](https://github.com/settings/tokens)\n- **Supabase Dashboard:** [app.supabase.com](https://app.supabase.com)\n- **Huggingface Tokens:** [huggingface.co/settings/tokens](https://huggingface.co/settings/tokens)\n- **Replicate API:** [replicate.com/account/api-tokens](https://replicate.com/account/api-tokens)\n\n---\n\n## ðŸ“ž Há»— Trá»£\n\nNáº¿u gáº·p váº¥n Ä‘á»:\n1. Kiá»ƒm tra **Console logs** trong Replit\n2. Xem file **PROJECT_GUIDE.md** cho hÆ°á»›ng dáº«n tá»•ng quan\n3. Xem file **QUICK_REFERENCE.md** cho commands nhanh\n4. DÃ¹ng Replit Agent Ä‘á»ƒ debug\n\n---\n\n**ChÃºc báº¡n migration thÃ nh cÃ´ng! ðŸš€**\n","size_bytes":9880},"TEST_ADB_GUIDE.md":{"content":"# HÆ°á»›ng dáº«n Test ADB Logcat trÃªn Samsung\n\n## BÆ°á»›c 1: Enable USB Debugging trÃªn Samsung\n\n### Náº¿u chÆ°a báº­t Developer Options:\n\n1. Má»Ÿ **Settings** (CÃ i Ä‘áº·t)\n2. KÃ©o xuá»‘ng cuá»‘i â†’ **About phone** (ThÃ´ng tin Ä‘iá»‡n thoáº¡i)\n3. TÃ¬m **Build number** (Sá»‘ báº£n dá»±ng)\n4. **Tap 7 láº§n** vÃ o Build number\n5. Nháº­p máº­t kháº©u/PIN náº¿u cÃ³\n6. Tháº¥y thÃ´ng bÃ¡o: \"You are now a developer!\"\n\n### Báº­t USB Debugging:\n\n1. Quay láº¡i **Settings**\n2. **Developer options** (TÃ¹y chá»n dÃ nh cho nhÃ  phÃ¡t triá»ƒn)\n3. Báº­t **USB debugging** (Gá»¡ lá»—i USB)\n4. Báº­t **Install via USB** (CÃ i Ä‘áº·t qua USB) - náº¿u cÃ³\n5. Confirm \"Allow USB debugging\"\n\n---\n\n## BÆ°á»›c 2: Kiá»ƒm tra ADB káº¿t ná»‘i\n\n### Trong VSCode PowerShell:\n\n```powershell\n# Kiá»ƒm tra ADB cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng\nadb version\n\n# Náº¿u lá»—i \"adb: command not found\", cáº§n add Flutter/Android SDK vÃ o PATH\n# Hoáº·c dÃ¹ng full path:\nC:\\Users\\YourName\\AppData\\Local\\Android\\Sdk\\platform-tools\\adb.exe version\n```\n\n### Kiá»ƒm tra devices:\n\n```powershell\n# Xem danh sÃ¡ch devices\nadb devices\n\n# NÃªn tháº¥y:\n# List of devices attached\n# ABC123456789    device    <-- Samsung cá»§a báº¡n\n```\n\n**Náº¿u tháº¥y:**\n- `unauthorized` â†’ Má»Ÿ khoÃ¡ Ä‘iá»‡n thoáº¡i, accept \"Allow USB debugging\" popup\n- `no devices` â†’ Kiá»ƒm tra USB cable, thá»­ port USB khÃ¡c\n\n---\n\n## BÆ°á»›c 3: Cháº¡y Logcat Ä‘á»ƒ Debug Ads\n\n### Clear logs cÅ©:\n\n```powershell\nadb logcat -c\n```\n\n### Xem realtime ads logs:\n\n```powershell\n# Chá»‰ xem ads-related logs\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded|VisoAI\"\n```\n\n### Hoáº·c lÆ°u logs vÃ o file:\n\n```powershell\n# LÆ°u táº¥t cáº£ logs vÃ o file\nadb logcat > logs.txt\n\n# Sau Ä‘Ã³ search trong file\nSelect-String -Path logs.txt -Pattern \"AppLovin|AdMob|Rewarded\"\n```\n\n---\n\n## BÆ°á»›c 4: Test Ads Flow\n\n### Má»Ÿ 2 PowerShell windows:\n\n**Window 1: Run logcat**\n```powershell\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded|ERROR|WARN\"\n```\n\n**Window 2: Commands**\n```powershell\n# Uninstall app cÅ©\nadb uninstall com.visoai.photoheadshot\n\n# Install app má»›i\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# Má»Ÿ app\nadb shell am start -n com.visoai.photoheadshot/.MainActivity\n```\n\n**Trong app:**\n1. Äá»£i 5-10 giÃ¢y\n2. Click vÃ o Ghostface\n3. Add photo\n4. Click \"Swap Face - Watch Ad\"\n\n**Xem logs trong Window 1** Ä‘á»ƒ tháº¥y:\n- Ad initialization\n- Ad loading status\n- Errors (náº¿u cÃ³)\n\n---\n\n## BÆ°á»›c 5: TÃ¬m Lá»—i Cá»¥ Thá»ƒ\n\n### Sau khi click \"Watch Ad\", tÃ¬m dÃ²ng:\n\n#### âœ… Success (Ads hoáº¡t Ä‘á»™ng):\n```\nI/AppLovinService: AppLovin MAX initialized successfully\nI/AppLovinService: Rewarded ad loaded successfully\nI/AppLovinService: Showing rewarded ad\n```\n\n#### âŒ AppLovin Failed:\n```\nE/AppLovinService: AppLovin initialization failed: Invalid SDK Key\nI/AdMobRewardedService: Falling back to AdMob...\n```\n\n#### âŒ Both Failed:\n```\nE/AppLovinService: Failed to load rewarded ad\nE/AdMobRewardedService: AdMob ad failed to load: ERROR_CODE_NO_FILL\n```\n\n---\n\n## Troubleshooting\n\n### \"adb: command not found\"\n\n**Giáº£i phÃ¡p 1: Add ADB vÃ o PATH**\n```powershell\n# TÃ¬m adb.exe location (thÆ°á»ng trong Flutter SDK hoáº·c Android SDK)\n# C:\\Users\\YourName\\AppData\\Local\\Android\\Sdk\\platform-tools\\\n\n# Add vÃ o PATH táº¡m thá»i:\n$env:Path += \";C:\\Users\\YourName\\AppData\\Local\\Android\\Sdk\\platform-tools\"\n\n# Test láº¡i\nadb version\n```\n\n**Giáº£i phÃ¡p 2: DÃ¹ng full path**\n```powershell\nC:\\Users\\YourName\\AppData\\Local\\Android\\Sdk\\platform-tools\\adb.exe devices\n```\n\n### \"unauthorized\"\n\n1. Unlock Ä‘iá»‡n thoáº¡i\n2. Sáº½ tháº¥y popup \"Allow USB debugging?\"\n3. Check \"Always allow from this computer\"\n4. Click OK\n5. Cháº¡y láº¡i: `adb devices`\n\n### \"no devices\"\n\n1. Thá»­ USB cable khÃ¡c (má»™t sá»‘ cable chá»‰ charge, khÃ´ng data)\n2. Thá»­ USB port khÃ¡c\n3. Táº¯t/báº­t USB debugging\n4. Cháº¡y: `adb kill-server` rá»“i `adb start-server`\n\n---\n\n## Quick Test Commands\n\n```powershell\n# 1. Check connection\nadb devices\n\n# 2. Clear old logs\nadb logcat -c\n\n# 3. Start logging\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded\"\n\n# 4. (Trong Ä‘iá»‡n thoáº¡i) Má»Ÿ app vÃ  click \"Watch Ad\"\n\n# 5. Xem logs Ä‘á»ƒ tÃ¬m error\n```\n\n---\n\n## Common Log Patterns\n\n### Pattern 1: Invalid SDK Key\n```\nE/AppLovinService: SDK Key not found or invalid\nE/AppLovinService: Error code: -1\n```\nâ†’ **Fix:** DÃ¹ng test ad IDs trong secrets.env\n\n### Pattern 2: Ad Unit Not Ready\n```\nW/AdMobRewardedService: Ad unit not ready\nW/AdMobRewardedService: Please wait for initialization\n```\nâ†’ **Fix:** Äá»£i lÃ¢u hÆ¡n (5-10 giÃ¢y)\n\n### Pattern 3: No Fill\n```\nE/AdMobRewardedService: Ad failed to load\nE/AdMobRewardedService: Error code: 3 (NO_FILL)\n```\nâ†’ **Fix:** DÃ¹ng Google test ad IDs (ca-app-pub-3940256099942544/...)\n\n---\n\n## Expected Success Logs\n\n```\nI/VisoAI: App started\nI/AppLovinService: Checking AppLovin configuration...\nI/AppLovinService: SDK Key: Found\nI/AppLovinService: Rewarded Ad Unit: Found\nI/AppLovinService: Initializing AppLovin MAX...\nI/AppLovinService: AppLovin MAX initialized successfully\nI/AppLovinService: Loading rewarded ad...\nI/AppLovinService: Rewarded ad loaded successfully\nI/AppLovinService: Ad is ready to show\n-- User clicks \"Watch Ad\" --\nI/AppLovinService: Showing rewarded ad\nI/AppLovinService: User completed watching ad\nI/AppLovinService: Reward granted\n```\n","size_bytes":5324},"PROJECT_GUIDE.md":{"content":"# ðŸ“š Viso AI - HÆ°á»›ng dáº«n ToÃ n Diá»‡n\n\n**Project:** Flutter AI Photo/Avatar Application  \n**Platform:** Web (Replit) + Mobile (Android/iOS)  \n**Package Name:** `com.visoai.photoheadshot`\n\n---\n\n## ðŸ“‹ Má»¥c Lá»¥c\n\n1. [Tá»•ng Quan Dá»± Ãn](#1-tá»•ng-quan-dá»±-Ã¡n)\n2. [Kiáº¿n TrÃºc Há»‡ Thá»‘ng](#2-kiáº¿n-trÃºc-há»‡-thá»‘ng)\n3. [Setup MÃ´i TrÆ°á»ng Development](#3-setup-mÃ´i-trÆ°á»ng-development)\n4. [Build & Deploy](#4-build--deploy)\n5. [Ad Monetization System](#5-ad-monetization-system)\n6. [Multi-Language Support](#6-multi-language-support)\n7. [Testing & Debugging](#7-testing--debugging)\n8. [Troubleshooting](#8-troubleshooting)\n9. [Next Steps](#9-next-steps)\n\n---\n\n## 1. Tá»•ng Quan Dá»± Ãn\n\n### 1.1 Má»¥c ÄÃ­ch\nViso AI lÃ  á»©ng dá»¥ng Flutter táº¡o AI headshots vÃ  avatars chuyÃªn nghiá»‡p vá»›i cÃ¡c tÃ­nh nÄƒng:\n- **Face Swapping:** HoÃ¡n Ä‘á»•i khuÃ´n máº·t vá»›i AI\n- **Photo Enhancement:** NÃ¢ng cáº¥p cháº¥t lÆ°á»£ng áº£nh HD\n- **Photo Restoration:** KhÃ´i phá»¥c áº£nh cÅ©\n- **AI Style Templates:** 20+ template phong cÃ¡ch khÃ¡c nhau\n\n### 1.2 Tech Stack\n\n**Frontend:**\n- Flutter 3.32.0 (Dart 3.8.0)\n- FlutterFlow-generated components\n- Material Design + Custom UI\n\n**Backend:**\n- Python Flask (API proxy server)\n- Supabase (Database, Storage, Auth)\n\n**AI Services:**\n- Replicate API (Primary - Face swap, GFPGAN)\n- Huggingface API (Backup - Stable Diffusion, Real-ESRGAN, VToonify)\n\n**Monetization:**\n- **Web:** Google AdMob\n- **Mobile:** AppLovin MAX (Primary) + AdMob (Fallback)\n\n**Languages:** 20+ languages (6 fully translated, 14 with English fallback)\n\n---\n\n## 2. Kiáº¿n TrÃºc Há»‡ Thá»‘ng\n\n### 2.1 Project Structure\n\n```\nvisoaiflow-backup/\nâ”œâ”€â”€ lib/                          # Flutter source code\nâ”‚   â”œâ”€â”€ main.dart                 # App entry point\nâ”‚   â”œâ”€â”€ flutter_flow/            # FlutterFlow components\nâ”‚   â”‚   â””â”€â”€ internationalization.dart  # Translations (kTranslationsMap)\nâ”‚   â”œâ”€â”€ services/                # Business logic\nâ”‚   â”‚   â”œâ”€â”€ applovin_service.dart     # AppLovin MAX integration\nâ”‚   â”‚   â””â”€â”€ admob_rewarded_service.dart  # AdMob fallback\nâ”‚   â”œâ”€â”€ swapface/                # Face swap feature\nâ”‚   â”‚   â””â”€â”€ swapface_widget.dart      # Ghostface page with ads\nâ”‚   â””â”€â”€ ...\nâ”œâ”€â”€ android/                     # Android native code\nâ”‚   â””â”€â”€ app/\nâ”‚       â”œâ”€â”€ build.gradle         # Package name config\nâ”‚       â””â”€â”€ src/main/AndroidManifest.xml\nâ”œâ”€â”€ web/                         # Web build output\nâ”œâ”€â”€ api_server.py               # Python Flask backend\nâ”œâ”€â”€ build_with_all_ads.sh       # Build script (Linux/Mac)\nâ”œâ”€â”€ build_with_all_ads.ps1      # Build script (Windows PowerShell)\nâ”œâ”€â”€ secrets.env.template        # Template for secrets\nâ””â”€â”€ replit.md                   # Project documentation\n```\n\n### 2.2 Data Flow\n\n```\nUser Action\n    â†“\nFlutter UI (lib/)\n    â†“\nService Layer (lib/services/)\n    â†“\n[Face Swap] â†’ Python Backend (api_server.py) â†’ Replicate API â†’ Result\n[Ads] â†’ AppLovin MAX â†’ Success/Fail â†’ AdMob Fallback\n[Templates] â†’ Supabase Storage (auto-load via list() API)\n```\n\n### 2.3 Ad System Architecture\n\n```\nUser clicks \"Watch Ad\"\n    â†“\nTry AppLovin MAX\n    â†“\n    â”œâ”€â”€ Success â†’ Show ad â†’ Reward user\n    â””â”€â”€ Failed â†’ Fallback to AdMob\n            â†“\n            â”œâ”€â”€ Success â†’ Show ad â†’ Reward user\n            â””â”€â”€ Failed â†’ Show error message\n```\n\n---\n\n## 3. Setup MÃ´i TrÆ°á»ng Development\n\n### 3.1 Replit Environment (Web Development)\n\n**Hiá»‡n tráº¡ng:**\n- âœ… Flutter Web Ä‘ang cháº¡y trÃªn Replit\n- âœ… Python backend Ä‘ang hoáº¡t Ä‘á»™ng\n- âœ… Workflow: `Server` (python3 api_server.py)\n- âœ… URL: http://0.0.0.0:5000\n\n**Secrets Ä‘Ã£ config (trong Replit Secrets):**\n- `SUPABASE_URL`\n- `SUPABASE_ANON_KEY`\n- `HUGGINGFACE_TOKEN`\n- `REPLICATE_API_TOKEN`\n- `APPLOVIN_SDK_KEY`\n- `APPLOVIN_REWARDED_AD_UNIT_ID`\n- `ADMOB_REWARDED_AD_UNIT_ID`\n\n**LÆ°u Ã½:**\n- Replit **CHá»ˆ support Flutter Web**\n- KhÃ´ng thá»ƒ build APK/iOS trÃªn Replit\n- Mobile build cáº§n mÃ¡y local vá»›i Flutter SDK\n\n### 3.2 Local Development Environment (Mobile)\n\n**YÃªu cáº§u:**\n- Flutter SDK 3.32.0+\n- Android SDK (cho Android build)\n- Xcode (cho iOS build - Mac only)\n- Git\n\n**Setup:**\n\n```bash\n# 1. Clone project\ngit clone <your-repo-url>\ncd visoaiflow-backup\n\n# 2. Install dependencies\nflutter pub get\n\n# 3. Check environment\nflutter doctor\n\n# 4. Táº¡o secrets.env (xem 3.3)\n```\n\n### 3.3 Secrets Configuration\n\n**Táº¡o file `secrets.env`:**\n\n```bash\n# Copy template\ncp secrets.env.template secrets.env\n\n# Edit vÃ  Ä‘iá»n thÃ´ng tin\nnano secrets.env  # hoáº·c notepad secrets.env trÃªn Windows\n```\n\n**Ná»™i dung secrets.env:**\n\n```bash\n# Supabase (Required)\nexport SUPABASE_URL=\"https://your-project.supabase.co\"\nexport SUPABASE_ANON_KEY=\"your_anon_key_here\"\n\n# AI APIs (Required)\nexport HUGGINGFACE_TOKEN=\"hf_xxxxxxxxxxxxx\"\nexport REPLICATE_API_TOKEN=\"r8_xxxxxxxxxxxxx\"\n\n# AdMob (Optional - dÃ¹ng test ads náº¿u khÃ´ng cÃ³)\nexport ADMOB_APP_ID=\"ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX\"\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-XXXXXXXXXXXXXXXX/XXXXXXXXXX\"\nexport ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-XXXXXXXXXXXXXXXX/XXXXXXXXXX\"\nexport ADMOB_INTERSTITIAL_AD_UNIT_ID=\"ca-app-pub-XXXXXXXXXXXXXXXX/XXXXXXXXXX\"\n\n# AppLovin MAX (Optional - dÃ¹ng test mode náº¿u khÃ´ng cÃ³)\nexport APPLOVIN_SDK_KEY=\"your_sdk_key_here\"\nexport APPLOVIN_REWARDED_AD_UNIT_ID=\"your_ad_unit_id\"\nexport APPLOVIN_BANNER_AD_UNIT_ID=\"your_ad_unit_id\"\nexport APPLOVIN_INTERSTITIAL_AD_UNIT_ID=\"your_ad_unit_id\"\nexport APPLOVIN_APP_OPEN_AD_UNIT_ID=\"your_ad_unit_id\"\n```\n\n**Google Test Ad IDs (Äá»ƒ testing):**\n\n```bash\n# Android Test Ads (LuÃ´n hoáº¡t Ä‘á»™ng)\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\nexport ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-3940256099942544/6300978111\"\nexport ADMOB_INTERSTITIAL_AD_UNIT_ID=\"ca-app-pub-3940256099942544/1033173712\"\n```\n\n---\n\n## 4. Build & Deploy\n\n### 4.1 Build Flutter Web (Replit)\n\n**Automatic:**\n- Replit tá»± Ä‘á»™ng build vÃ  serve trÃªn port 5000\n- Workflow \"Server\" cháº¡y `python3 api_server.py`\n\n**Manual Rebuild:**\n```bash\nflutter build web --release\n```\n\n**Publish Web:**\n- Click \"Deploy\" button trong Replit\n- Chá»n deployment type (VM/Autoscale)\n- App sáº½ cÃ³ public URL\n\n### 4.2 Build Android APK (Local Machine)\n\n#### **Linux/Mac:**\n\n```bash\n# 1. Táº¡o secrets.env (náº¿u chÆ°a cÃ³)\ncp secrets.env.template secrets.env\nnano secrets.env  # Äiá»n thÃ´ng tin\n\n# 2. Build vá»›i script\n./build_with_all_ads.sh apk\n\n# 3. APK location:\n# build/app/outputs/flutter-apk/app-release.apk\n\n# 4. Install lÃªn Ä‘iá»‡n thoáº¡i\nadb install build/app/outputs/flutter-apk/app-release.apk\n```\n\n#### **Windows PowerShell:**\n\n```powershell\n# 1. Táº¡o secrets.env\nCopy-Item secrets.env.template secrets.env\nnotepad secrets.env  # Äiá»n thÃ´ng tin\n\n# 2. Cho phÃ©p cháº¡y PowerShell script\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n\n# 3. Build vá»›i script\n.\\build_with_all_ads.ps1 apk\n\n# 4. APK location:\n# build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# 5. Install lÃªn Ä‘iá»‡n thoáº¡i\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n#### **Manual Build (Náº¿u script khÃ´ng hoáº¡t Ä‘á»™ng):**\n\n```powershell\n# Set environment variables\n$env:SUPABASE_URL = \"your_url\"\n$env:SUPABASE_ANON_KEY = \"your_key\"\n$env:ADMOB_REWARDED_AD_UNIT_ID = \"ca-app-pub-3940256099942544/5224354917\"\n\n# Build APK\nflutter build apk --release `\n  --dart-define=SUPABASE_URL=\"$env:SUPABASE_URL\" `\n  --dart-define=SUPABASE_ANON_KEY=\"$env:SUPABASE_ANON_KEY\" `\n  --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"$env:ADMOB_REWARDED_AD_UNIT_ID\"\n```\n\n### 4.3 Build App Bundle (For Google Play)\n\n```bash\n# Linux/Mac\n./build_with_all_ads.sh appbundle\n\n# Windows PowerShell\n.\\build_with_all_ads.ps1 appbundle\n\n# Output: build/app/outputs/bundle/release/app-release.aab\n```\n\n### 4.4 Build iOS (Mac Only)\n\n```bash\n./build_with_all_ads.sh ios\n\n# Output: build/ios/iphoneos/Runner.app\n```\n\n---\n\n## 5. Ad Monetization System\n\n### 5.1 Ad Networks\n\n**Platform-Specific:**\n- **Web:** Google AdMob only\n- **Mobile (iOS/Android):** AppLovin MAX (Primary) + AdMob (Fallback)\n\n**Ad Types Implemented:**\n- âœ… Rewarded Ads (Face swap feature)\n- âœ… Banner Ads (Bottom of pages)\n- âœ… Interstitial Ads (Between actions)\n- âœ… App Open Ads (App launch)\n\n### 5.2 Implementation Details\n\n**Files:**\n- `lib/services/applovin_service.dart` - AppLovin MAX integration\n- `lib/services/admob_rewarded_service.dart` - AdMob fallback\n- `lib/main.dart` - Ad initialization\n- `lib/swapface/swapface_widget.dart` - Rewarded ad usage\n\n**Flow:**\n1. User clicks \"Swap Face - Watch Ad\"\n2. App tries AppLovin MAX first\n3. If AppLovin fails â†’ Fallback to AdMob\n4. If ad shown successfully â†’ User can swap face\n5. If both fail â†’ Show error message\n\n### 5.3 Debug Logging\n\nBuild APK cÃ³ comprehensive logging Ä‘á»ƒ debug ads:\n\n**Khi app khá»Ÿi Ä‘á»™ng:**\n```\nðŸ” AppLovin Configuration Check:\n  SDK Key: âœ… Found (hoáº·c âŒ MISSING)\n  Rewarded Ad Unit: âœ… Found (hoáº·c âŒ MISSING)\n\nðŸ” AdMob Rewarded Configuration Check:\n  Rewarded Ad Unit: âœ… Found (hoáº·c âŒ MISSING - will use test ads)\n```\n\n**Khi load ads:**\n```\nâœ… AppLovin MAX initialized successfully\nâœ… Rewarded ad loaded\n```\n\n**Náº¿u fail:**\n```\nâŒ AppLovin initialization failed: [error]\nðŸ’¡ Falling back to AdMob...\n```\n\n### 5.4 Testing Ads\n\n**Option 1: Google Test Ads (KhuyÃªn dÃ¹ng)**\n- DÃ¹ng test ad IDs trong secrets.env\n- IDs: `ca-app-pub-3940256099942544/...`\n- LuÃ´n hoáº¡t Ä‘á»™ng, khÃ´ng cáº§n approval\n- KhÃ´ng risk bá»‹ banned\n\n**Option 2: AppLovin Test Mode**\n- Setup trong AppLovin Dashboard\n- Add device ID vÃ o test devices\n- Requires configuration\n\n**Option 3: Production Ads**\n- DÃ¹ng real ad unit IDs\n- Cáº§n approve trong AdMob/AppLovin dashboard\n- Risk invalid traffic náº¿u test nhiá»u\n\n**Khuyáº¿n nghá»‹:** DÃ¹ng Google Test Ads cho development!\n\n---\n\n## 6. Multi-Language Support\n\n### 6.1 Supported Languages (20 Total)\n\n**Fully Translated (6):**\n- English (en)\n- FranÃ§ais (fr)\n- EspaÃ±ol LatAm (es)\n- PortuguÃªs Brasil (pt)\n- ç®€ä½“ä¸­æ–‡ ä¸­å›½ (zh_Hans)\n- ç¹é«”ä¸­æ–‡ è‡ºç£/é¦™æ¸¯ (zh_Hant)\n\n**Available with English Fallback (14):**\n- Deutsch (de), Italiano (it), Ð ÑƒÑÑÐºÐ¸Ð¹ (ru), TÃ¼rkÃ§e (tr)\n- Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© (ar), ÙØ§Ø±Ø³ÛŒ (fa), à¤¹à¤¿à¤¨à¥à¤¦à¥€ (hi)\n- Indonesia (id), Tiáº¿ng Viá»‡t (vi), à¹„à¸—à¸¢ (th)\n- í•œêµ­ì–´ (ko), æ—¥æœ¬èªž (ja), Polski (pl), Nederlands (nl)\n\n### 6.2 Translation System\n\n**Location:** `lib/flutter_flow/internationalization.dart`\n\n**Structure:**\n```dart\nfinal Map<String, Map<String, String>> kTranslationsMap = {\n  'unique_key_1': {\n    'en': 'English text',\n    'fr': 'Texte franÃ§ais',\n    'es': 'Texto espaÃ±ol',\n    // ...\n  },\n  'unique_key_2': {\n    // ...\n  },\n};\n```\n\n**Features:**\n- Locale normalization (de-DE â†’ de, pt-PT â†’ pt)\n- Automatic fallback to English\n- Language selection dialog in Settings\n- Persistent language preferences\n\n### 6.3 Adding New Translations\n\n1. Edit `lib/flutter_flow/internationalization.dart`\n2. Find key in `kTranslationsMap`\n3. Add translation for your language code\n4. Rebuild app\n\n---\n\n## 7. Testing & Debugging\n\n### 7.1 Testing Web Version (Replit)\n\n**Live Preview:**\n- URL: http://0.0.0.0:5000\n- Click \"Webview\" trong Replit\n\n**Check Console:**\n```bash\n# Xem workflow logs\n# Click vÃ o \"Console\" tab trong Replit\n```\n\n### 7.2 Testing Mobile APK\n\n#### **A. Setup ADB Connection**\n\n**Enable USB Debugging on Phone:**\n1. Settings â†’ About phone\n2. Tap \"Build number\" 7 times\n3. Developer options â†’ USB debugging (ON)\n\n**Check Connection:**\n```powershell\nadb devices\n\n# Should show:\n# List of devices attached\n# ABC123456    device\n```\n\n#### **B. Install APK**\n\n```powershell\n# Install\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# Or reinstall\nadb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# Uninstall\nadb uninstall com.visoai.photoheadshot\n```\n\n#### **C. View Logs (QUAN TRá»ŒNG)**\n\n**Method 1: Realtime Logs**\n\n```powershell\n# Window 1: Logcat\nadb logcat -c\nadb logcat | Select-String \"visoai|AppLovin|AdMob|Flutter|ERROR\"\n\n# Window 2: Launch app\nadb shell am start -n com.visoai.photoheadshot/.MainActivity\n```\n\n**Method 2: Save to File**\n\n```powershell\n# Start logging\nadb logcat > app_logs.txt\n\n# Má»Ÿ app, test features, Ä‘á»£i 30 giÃ¢y\n\n# Stop logging (Ctrl+C)\n\n# Search logs\nSelect-String -Path app_logs.txt -Pattern \"AppLovin|AdMob|ERROR\"\n```\n\n#### **D. Debug Ads**\n\n**Expected Success Logs:**\n```\nI/flutter: [OK] AppLovin SDK Key: Found\nI/flutter: [OK] AdMob Rewarded Ad Unit: Found\nI/AppLovinSdk: Initializing SDK...\nI/AppLovinSdk: SDK initialized successfully\nI/AppLovinSdk: Rewarded ad loaded\nI/flutter: Showing rewarded ad\n```\n\n**Common Error Logs:**\n```\nE/flutter: AppLovin SDK Key: MISSING\nE/AppLovinSdk: Invalid SDK Key\nE/AdMob: Ad failed to load: ERROR_CODE_NO_FILL\nW/flutter: Ad not ready yet, please wait\n```\n\n### 7.3 Common Test Scenarios\n\n**Test 1: App Launch**\n- âœ… App opens without crash\n- âœ… Templates load from Supabase\n- âœ… Ads initialize in background\n\n**Test 2: Face Swap with Ad**\n- âœ… Click Ghostface â†’ Add photo\n- âœ… Click \"Swap Face - Watch Ad\"\n- âœ… Ad displays (AppLovin or AdMob)\n- âœ… After watching ad â†’ Face swap works\n\n**Test 3: Language Switching**\n- âœ… Settings â†’ Language\n- âœ… Select different language\n- âœ… UI updates to new language\n- âœ… Language persists after app restart\n\n**Test 4: Photo Enhancement**\n- âœ… Upload photo\n- âœ… Apply HD enhancement\n- âœ… Image upscaled correctly\n- âœ… Download works\n\n---\n\n## 8. Troubleshooting\n\n### 8.1 Build Errors\n\n#### **Error: \"flutter: command not found\"**\n\n**Giáº£i phÃ¡p:**\n```bash\n# Add Flutter to PATH\nexport PATH=\"$PATH:/path/to/flutter/bin\"\n\n# Hoáº·c dÃ¹ng full path\n/path/to/flutter/bin/flutter build apk\n```\n\n#### **Error: \"Android SDK not found\"**\n\n**Giáº£i phÃ¡p:**\n- Install Android Studio\n- Run `flutter doctor`\n- Follow instructions to install SDK\n\n#### **Error: PowerShell script syntax error**\n\n**Giáº£i phÃ¡p:**\n- Äáº£m báº£o file `build_with_all_ads.ps1` khÃ´ng cÃ³ emoji\n- DÃ¹ng manual build command (xem section 4.2)\n\n### 8.2 Ad Issues\n\n#### **Issue: \"Ads not ready yet\"**\n\n**NguyÃªn nhÃ¢n:**\n- Ads chÆ°a Ä‘Æ°á»£c build vá»›i ad configuration\n- Ad IDs invalid hoáº·c chÆ°a approve\n- Internet connection issue\n\n**Giáº£i phÃ¡p:**\n1. **Kiá»ƒm tra build cÃ³ ad IDs khÃ´ng:**\n   ```powershell\n   # Xem logcat khi app khá»Ÿi Ä‘á»™ng\n   adb logcat | Select-String \"AppLovin|AdMob\"\n   \n   # TÃ¬m dÃ²ng:\n   # [OK] ADMOB_REWARDED_AD_UNIT_ID: Found\n   ```\n\n2. **DÃ¹ng Google Test Ads:**\n   ```bash\n   # secrets.env\n   export ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\n   ```\n\n3. **Rebuild APK:**\n   ```powershell\n   .\\build_with_all_ads.ps1 apk\n   adb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n   ```\n\n4. **Äá»£i lÃ¢u hÆ¡n:**\n   - Ads load asynchronously (2-10 giÃ¢y)\n   - Äá»£i 10 giÃ¢y sau khi app má»Ÿ\n\n#### **Issue: AppLovin initialization failed**\n\n**Giáº£i phÃ¡p:**\n- Bá» AppLovin, chá»‰ dÃ¹ng AdMob\n- Comment out AppLovin secrets trong secrets.env\n- App sáº½ tá»± Ä‘á»™ng dÃ¹ng AdMob\n\n#### **Issue: \"No fill\" error**\n\n**NguyÃªn nhÃ¢n:**\n- Ad network khÃ´ng cÃ³ ads available\n- Internet connection issue\n- Invalid ad unit ID\n\n**Giáº£i phÃ¡p:**\n- DÃ¹ng Google Test Ad IDs\n- Check internet connection\n- Thá»­ láº¡i sau vÃ i phÃºt\n\n### 8.3 App Crashes\n\n#### **Check Crash Logs:**\n\n```powershell\n# Xem crash logs\nadb logcat | Select-String \"FATAL|AndroidRuntime|crash\"\n```\n\n#### **Common Crashes:**\n\n**Crash on launch:**\n- Missing Supabase credentials\n- Invalid secrets configuration\n- Missing dependencies\n\n**Crash on face swap:**\n- API token invalid\n- Network error\n- Backend server down\n\n### 8.4 Template Loading Issues\n\n**Issue: Templates khÃ´ng hiá»ƒn thá»‹**\n\n**Giáº£i phÃ¡p:**\n1. Check Supabase connection\n2. Verify templates exist in Storage bucket `face-swap-templates`\n3. Check logs:\n   ```powershell\n   adb logcat | Select-String \"Supabase|Template|Storage\"\n   ```\n\n---\n\n## 9. Next Steps\n\n### 9.1 Development Roadmap\n\n**Short-term (1-2 weeks):**\n- [ ] Fix ads loading delay\n- [ ] Optimize template loading speed\n- [ ] Add more translations (Vietnamese, Korean, Japanese)\n- [ ] Improve error messages\n\n**Mid-term (1 month):**\n- [ ] Setup GitHub Actions for auto-build\n- [ ] Implement user authentication\n- [ ] Add favorites/history feature\n- [ ] Setup Firebase Analytics\n\n**Long-term (3+ months):**\n- [ ] Launch on Google Play Store\n- [ ] Launch on Apple App Store\n- [ ] Add premium subscription\n- [ ] Implement social sharing\n\n### 9.2 Production Deployment\n\n#### **Web Deployment (Replit):**\n1. Click \"Deploy\" button\n2. Select deployment type:\n   - **Autoscale:** For stateless apps (recommended)\n   - **VM:** For always-running apps\n3. Configure custom domain (optional)\n4. Deploy!\n\n#### **Mobile Deployment:**\n\n**Google Play Store:**\n1. Build App Bundle: `.\\build_with_all_ads.ps1 appbundle`\n2. Create Google Play Console account\n3. Setup app listing, screenshots, description\n4. Upload AAB file\n5. Submit for review\n\n**Apple App Store:**\n1. Build iOS: `./build_with_all_ads.sh ios` (Mac only)\n2. Create Apple Developer account\n3. Setup App Store Connect\n4. Upload IPA via Xcode\n5. Submit for review\n\n### 9.3 Monitoring & Analytics\n\n**Setup Firebase:**\n```bash\n# Add Firebase to project\nflutter pub add firebase_core firebase_analytics\n\n# Initialize in main.dart\nawait Firebase.initializeApp();\n```\n\n**Track Events:**\n- App launches\n- Face swaps completed\n- Ads viewed\n- Errors/crashes\n- User retention\n\n### 9.4 Performance Optimization\n\n**Current Status:**\n- Web build size: ~2MB (optimized)\n- APK size: ~80MB (can be reduced with split APKs)\n- Face swap time: 5-10 seconds\n\n**Improvements:**\n- [ ] Implement image caching\n- [ ] Optimize template loading\n- [ ] Reduce APK size with ProGuard\n- [ ] Add loading skeletons\n- [ ] Implement progressive image loading\n\n---\n\n## 10. Resources & References\n\n### 10.1 Documentation Links\n\n**Flutter:**\n- https://docs.flutter.dev/\n- https://pub.dev/packages\n\n**Ad Networks:**\n- AdMob: https://developers.google.com/admob/flutter\n- AppLovin: https://developers.applovin.com/en/max/flutter\n\n**Backend:**\n- Supabase: https://supabase.com/docs\n- Replicate: https://replicate.com/docs\n- Huggingface: https://huggingface.co/docs\n\n### 10.2 Important Files Reference\n\n| File | Purpose |\n|------|---------|\n| `lib/main.dart` | App entry point, ad initialization |\n| `lib/flutter_flow/internationalization.dart` | Translations (line 287+) |\n| `lib/services/applovin_service.dart` | AppLovin MAX integration |\n| `lib/services/admob_rewarded_service.dart` | AdMob fallback |\n| `lib/swapface/swapface_widget.dart` | Face swap with rewarded ads |\n| `android/app/build.gradle` | Package name, version |\n| `android/app/src/main/AndroidManifest.xml` | Permissions, package |\n| `api_server.py` | Python Flask backend |\n| `build_with_all_ads.sh` | Build script (Unix) |\n| `build_with_all_ads.ps1` | Build script (Windows) |\n| `secrets.env` | Environment variables (NOT committed) |\n| `replit.md` | Project memory/preferences |\n\n### 10.3 Support & Community\n\n**Issues?**\n- Check logs first: `adb logcat`\n- Search error messages\n- Review this guide's Troubleshooting section\n\n**Contact:**\n- Replit Support (for platform issues)\n- Flutter Community (for Flutter questions)\n- AI Service providers (for API issues)\n\n---\n\n## ðŸ“ Summary\n\nViso AI lÃ  Flutter app hoÃ n chá»‰nh vá»›i:\n- âœ… Multi-platform (Web + Mobile)\n- âœ… AI-powered features (Face swap, Enhancement)\n- âœ… Dual ad network monetization\n- âœ… 20+ language support\n- âœ… Production-ready codebase\n\n**Development:**\n- Web: Replit (live at port 5000)\n- Mobile: Local build vá»›i Flutter SDK\n\n**Build Process:**\n- Web: Auto-build trÃªn Replit\n- Android: `.\\build_with_all_ads.ps1 apk`\n- iOS: `./build_with_all_ads.sh ios`\n\n**Testing:**\n- DÃ¹ng Google Test Ads\n- Debug vá»›i `adb logcat`\n- Check logs khi app khá»Ÿi Ä‘á»™ng\n\n**Next:** Deploy to production hoáº·c continue development theo roadmap!\n\n---\n\n**Last Updated:** October 10, 2025  \n**Flutter Version:** 3.32.0  \n**Package Name:** com.visoai.photoheadshot\n","size_bytes":20223},"WINDOWS_BUILD_GUIDE.md":{"content":"# ðŸªŸ HÆ°á»›ng dáº«n Build APK trÃªn Windows\n\n## ðŸ“‹ YÃªu cáº§u\n\n- âœ… Flutter SDK Ä‘Ã£ cÃ i Ä‘áº·t\n- âœ… Android SDK Ä‘Ã£ cÃ i Ä‘áº·t\n- âœ… PowerShell (cÃ³ sáºµn trÃªn Windows)\n\n---\n\n## ðŸš€ CÃ¡ch Build APK\n\n### **BÆ°á»›c 1: Táº¡o file secrets.env**\n\n```powershell\n# Copy template\nCopy-Item secrets.env.template secrets.env\n\n# Má»Ÿ vÃ  Ä‘iá»n thÃ´ng tin\nnotepad secrets.env\n```\n\n**Äiá»n vÃ o secrets.env:**\n```bash\nexport SUPABASE_URL=\"https://your-project.supabase.co\"\nexport SUPABASE_ANON_KEY=\"your_anon_key_here\"\nexport HUGGINGFACE_TOKEN=\"hf_xxxxxxxxxxxx\"\nexport REPLICATE_API_TOKEN=\"r8_xxxxxxxxxxxx\"\n\n# Äá»ƒ test ads, dÃ¹ng Google test IDs:\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\nexport ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-3940256099942544/6300978111\"\nexport ADMOB_INTERSTITIAL_AD_UNIT_ID=\"ca-app-pub-3940256099942544/1033173712\"\n\n# AppLovin (optional)\nexport APPLOVIN_SDK_KEY=\"your_key_here\"\nexport APPLOVIN_REWARDED_AD_UNIT_ID=\"your_id_here\"\n```\n\n### **BÆ°á»›c 2: Cháº¡y PowerShell script**\n\n**Má»Ÿ PowerShell trong thÆ° má»¥c project:**\n\n```powershell\n# Cho phÃ©p cháº¡y script (chá»‰ cáº§n cháº¡y 1 láº§n)\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n\n# Build APK\n.\\build_with_all_ads.ps1 apk\n\n# Hoáº·c build App Bundle\n.\\build_with_all_ads.ps1 appbundle\n```\n\n### **BÆ°á»›c 3: CÃ i APK lÃªn Ä‘iá»‡n thoáº¡i**\n\n```powershell\n# Káº¿t ná»‘i Ä‘iá»‡n thoáº¡i qua USB, báº­t USB Debugging\n\n# Install APK\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# Xem logs khi app cháº¡y\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded\"\n```\n\n---\n\n## âŒ Lá»—i thÆ°á»ng gáº·p\n\n### **1. \"execution of scripts is disabled\"**\n\n**Lá»—i:**\n```\n.\\build_with_all_ads.ps1 : File cannot be loaded because running scripts is disabled\n```\n\n**Giáº£i phÃ¡p:**\n```powershell\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n```\n\n### **2. \"flutter: command not found\"**\n\n**Lá»—i:**\n```\nflutter : The term 'flutter' is not recognized\n```\n\n**Giáº£i phÃ¡p:**\n- CÃ i Flutter SDK: https://docs.flutter.dev/get-started/install/windows\n- ThÃªm Flutter vÃ o PATH\n\n### **3. \"Android SDK not found\"**\n\n**Giáº£i phÃ¡p:**\n```powershell\n# Kiá»ƒm tra Android SDK\nflutter doctor\n\n# CÃ i Android Studio Ä‘á»ƒ cÃ³ SDK\n```\n\n### **4. Syntax error vá»›i `$env:VARIABLE`**\n\nNáº¿u báº¡n cháº¡y command thá»§ cÃ´ng, **Äá»ªNG dÃ¹ng `$VARIABLE`**, pháº£i dÃ¹ng `$env:VARIABLE`:\n\n**âŒ SAI:**\n```powershell\nflutter build apk --dart-define=ADMOB_APP_ID=\"$ADMOB_APP_ID\"\n```\n\n**âœ… ÄÃšNG:**\n```powershell\nflutter build apk --dart-define=ADMOB_APP_ID=\"$env:ADMOB_APP_ID\"\n```\n\n---\n\n## ðŸ” Kiá»ƒm tra ads cÃ³ hoáº¡t Ä‘á»™ng khÃ´ng\n\n### **Xem logs khi app khá»Ÿi Ä‘á»™ng:**\n\n```powershell\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded\"\n```\n\n**Náº¿u tháº¥y:**\n```\nâœ… AppLovin SDK Key: Found\nâœ… AdMob Rewarded Ad Unit: Found\nâœ… Rewarded ad loaded\n```\nâ†’ **Ads hoáº¡t Ä‘á»™ng!**\n\n**Náº¿u tháº¥y:**\n```\nâŒ AppLovin SDK Key: MISSING\nðŸ’¡ Using AdMob test ads as fallback\n```\nâ†’ **App khÃ´ng Ä‘Æ°á»£c build vá»›i secrets** â†’ Cháº¡y láº¡i script\n\n---\n\n## ðŸ’¡ Tips\n\n### **Build nhanh hÆ¡n:**\n\n```powershell\n# Build APK split theo ABI (file nhá» hÆ¡n)\nflutter build apk --split-per-abi --release `\n  --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"$env:ADMOB_REWARDED_AD_UNIT_ID\"\n```\n\n### **Build mÃ  khÃ´ng cáº§n secrets.env:**\n\n```powershell\n# Set environment variables trá»±c tiáº¿p\n$env:ADMOB_REWARDED_AD_UNIT_ID = \"ca-app-pub-3940256099942544/5224354917\"\n$env:SUPABASE_URL = \"https://your-project.supabase.co\"\n\n# Build\n.\\build_with_all_ads.ps1 apk\n```\n\n### **DÃ¹ng Git Bash thay vÃ¬ PowerShell:**\n\nNáº¿u báº¡n cÃ i Git for Windows, cÃ³ thá»ƒ dÃ¹ng bash script:\n\n```bash\n# Trong Git Bash\n./build_with_all_ads.sh apk\n```\n\n---\n\n## ðŸ“¦ Vá»‹ trÃ­ file sau khi build\n\n**APK:**\n```\nbuild\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n**App Bundle:**\n```\nbuild\\app\\outputs\\bundle\\release\\app-release.aab\n```\n\n---\n\n## â“ FAQ\n\n### **Q: CÃ³ cáº§n production ad IDs khÃ´ng?**\nA: KhÃ´ng! DÃ¹ng Google test ads (`ca-app-pub-3940256099942544/...`) Ä‘á»ƒ test.\n\n### **Q: Táº¡i sao khÃ´ng dÃ¹ng bash script?**\nA: Bash script (`.sh`) khÃ´ng cháº¡y trÃªn PowerShell. Pháº£i dÃ¹ng PowerShell script (`.ps1`).\n\n### **Q: Build xong rá»“i install lÃªn Ä‘iá»‡n thoáº¡i tháº¿ nÃ o?**\nA: \n1. Báº­t USB Debugging trÃªn Ä‘iá»‡n thoáº¡i\n2. Káº¿t ná»‘i USB\n3. Cháº¡y: `adb install build\\app\\outputs\\flutter-apk\\app-release.apk`\n\n### **Q: CÃ³ cÃ¡ch nÃ o Ä‘Æ¡n giáº£n hÆ¡n khÃ´ng?**\nA: DÃ¹ng Flutter Web (Ä‘ang cháº¡y trÃªn Replit) Ä‘á»ƒ test trÆ°á»›c!\n\n---\n\n## ðŸŽ¯ TL;DR (QuÃ¡ dÃ i khÃ´ng Ä‘á»c)\n\n```powershell\n# 1. Táº¡o secrets.env\nCopy-Item secrets.env.template secrets.env\nnotepad secrets.env  # Äiá»n thÃ´ng tin\n\n# 2. Cho phÃ©p cháº¡y script\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n\n# 3. Build APK\n.\\build_with_all_ads.ps1 apk\n\n# 4. Install\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n**Done!** ðŸŽ‰\n","size_bytes":4950},"DEBUG_APP_LOGCAT.md":{"content":"# Debug Viso AI App vá»›i Logcat\n\n## BÆ°á»›c 1: Filter logs theo package name\n\nThay vÃ¬ filter theo keyword, filter theo **package name** cá»§a app:\n\n```powershell\n# Clear logs\nadb logcat -c\n\n# Xem ONLY Viso AI app logs\nadb logcat | Select-String \"com.visoai.photoheadshot\"\n```\n\n---\n\n## BÆ°á»›c 2: Má»Ÿ app vÃ  xem logs NGAY Láº¬P Tá»¨C\n\n### Trong PowerShell Window 1:\n\n```powershell\n# Start logcat TRÆ¯á»šC KHI má»Ÿ app\nadb logcat -c\nadb logcat | Select-String \"com.visoai.photoheadshot|AppLovin|AdMob|Flutter\"\n```\n\n### TrÃªn Ä‘iá»‡n thoáº¡i:\n\n1. **Táº¯t app Viso AI** (náº¿u Ä‘ang má»Ÿ)\n2. **Force stop:** Settings â†’ Apps â†’ Viso AI â†’ Force Stop\n3. **Má»Ÿ app láº¡i** tá»« launcher\n4. **Äá»¢I 10 GIÃ‚Y** Ä‘á»ƒ ads load\n5. Click **Ghostface** â†’ Add photo â†’ **\"Watch Ad\"**\n\n### Xem Window 1:\n\nBáº¡n sáº½ tháº¥y logs tá»« app!\n\n---\n\n## BÆ°á»›c 3: Náº¿u váº«n khÃ´ng tháº¥y logs gÃ¬\n\n### Check app cÃ³ crash khÃ´ng:\n\n```powershell\n# Xem táº¥t cáº£ logs liÃªn quan Ä‘áº¿n crashes\nadb logcat | Select-String \"FATAL|AndroidRuntime|crash\"\n```\n\n### Hoáº·c xem logs cá»§a Flutter engine:\n\n```powershell\n# Flutter apps dÃ¹ng Flutter tag\nadb logcat | Select-String \"flutter|Flutter\"\n```\n\n### Hoáº·c filter theo process ID:\n\n```powershell\n# 1. TÃ¬m process ID cá»§a app\nadb shell ps | Select-String \"visoai\"\n\n# Output sáº½ cÃ³ dáº¡ng:\n# u0_a123      12345  1234  ... com.visoai.photoheadshot\n\n# 2. Filter logs theo PID (thay 12345 báº±ng PID tháº­t)\nadb logcat | Select-String \"12345\"\n```\n\n---\n\n## BÆ°á»›c 4: Xem ALL logs (No filter)\n\nNáº¿u cÃ¡c cÃ¡ch trÃªn khÃ´ng Ä‘Æ°á»£c, xem táº¥t cáº£ logs:\n\n```powershell\n# LÆ°u táº¥t cáº£ logs vÃ o file\nadb logcat > all_logs.txt\n\n# Trong Ä‘iá»‡n thoáº¡i: Má»Ÿ app â†’ Click \"Watch Ad\"\n\n# Sau 30 giÃ¢y, dá»«ng logcat (Ctrl+C)\n\n# Search trong file\nSelect-String -Path all_logs.txt -Pattern \"AppLovin|AdMob|Rewarded|visoai\"\n```\n\n---\n\n## Expected Logs (Náº¿u app hoáº¡t Ä‘á»™ng Ä‘Ãºng)\n\n### Khi app khá»Ÿi Ä‘á»™ng:\n\n```\nI/flutter: [OK] Loading secrets from secrets.env...\nI/flutter: [OK] AppLovin SDK Key: Found\nI/flutter: [OK] AdMob Rewarded Ad Unit: Found\nI/flutter: Initializing AppLovin MAX...\nI/AppLovinSdk: Initializing SDK with key: xxx\nI/flutter: AppLovin MAX initialized successfully\n```\n\n### Khi click \"Watch Ad\":\n\n```\nI/flutter: Loading rewarded ad...\nI/AppLovinSdk: Loading rewarded ad for unit: xxx\nI/AppLovinSdk: Rewarded ad loaded successfully\nI/flutter: Showing rewarded ad\n```\n\n### Náº¿u ad failed:\n\n```\nE/flutter: AppLovin failed to load: Invalid SDK Key\nE/flutter: Falling back to AdMob...\nI/flutter: AdMob rewarded ad loaded\n```\n\n---\n\n## Quick Debug Commands\n\n```powershell\n# 1. Force stop app\nadb shell am force-stop com.visoai.photoheadshot\n\n# 2. Clear logs\nadb logcat -c\n\n# 3. Start logcat vá»›i multiple filters\nadb logcat | Select-String \"visoai|AppLovin|AdMob|Flutter|FATAL\"\n\n# 4. Launch app\nadb shell am start -n com.visoai.photoheadshot/.MainActivity\n\n# 5. Xem logs realtime\n```\n\n---\n\n## Alternative: Logcat vá»›i Colors (Dá»… Ä‘á»c hÆ¡n)\n\n```powershell\n# Install pidcat (optional)\n# https://github.com/JakeWharton/pidcat\n\n# Hoáº·c dÃ¹ng Android Studio Logcat viewer\n```\n\n---\n\n## TL;DR - Cháº¡y ngay:\n\n```powershell\n# Window 1: Logcat\nadb logcat -c\nadb logcat | Select-String \"visoai|AppLovin|AdMob|Flutter|ERROR\"\n\n# Window 2: Launch app\nadb shell am force-stop com.visoai.photoheadshot\nadb shell am start -n com.visoai.photoheadshot/.MainActivity\n\n# Äá»£i 10 giÃ¢y â†’ Click \"Watch Ad\" â†’ Xem Window 1\n```\n","size_bytes":3474},"BUILD_MANUAL_WINDOWS.md":{"content":"# Build Manual cho Windows (KhÃ´ng dÃ¹ng script)\n\nNáº¿u PowerShell script khÃ´ng cháº¡y Ä‘Æ°á»£c, báº¡n cÃ³ thá»ƒ build thá»§ cÃ´ng:\n\n## CÃ¡ch 1: Build vá»›i AdMob Test Ads (ÄÆ¡n giáº£n nháº¥t)\n\n```powershell\nflutter build apk --release --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\" --dart-define=ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-3940256099942544/6300978111\" --dart-define=ADMOB_INTERSTITIAL_AD_UNIT_ID=\"ca-app-pub-3940256099942544/1033173712\"\n```\n\n**LÆ°u Ã½:** Báº¡n váº«n cáº§n SUPABASE_URL vÃ  cÃ¡c API keys khÃ¡c. Xem cÃ¡ch 2.\n\n---\n\n## CÃ¡ch 2: Build vá»›i táº¥t cáº£ secrets (Copy/Paste tá»« Replit)\n\n### BÆ°á»›c 1: Láº¥y secrets tá»« Replit\n\nVÃ o Replit project â†’ Tools â†’ Secrets, copy cÃ¡c giÃ¡ trá»‹:\n- SUPABASE_URL\n- SUPABASE_ANON_KEY\n- HUGGINGFACE_TOKEN\n- REPLICATE_API_TOKEN\n\n### BÆ°á»›c 2: Set environment variables trong PowerShell\n\n```powershell\n# Set tá»«ng biáº¿n (thay YOUR_VALUE báº±ng giÃ¡ trá»‹ tháº­t)\n$env:SUPABASE_URL = \"https://your-project.supabase.co\"\n$env:SUPABASE_ANON_KEY = \"your_anon_key\"\n$env:HUGGINGFACE_TOKEN = \"hf_xxxxx\"\n$env:REPLICATE_API_TOKEN = \"r8_xxxxx\"\n\n# Ad IDs (dÃ¹ng test ads)\n$env:ADMOB_REWARDED_AD_UNIT_ID = \"ca-app-pub-3940256099942544/5224354917\"\n$env:ADMOB_BANNER_AD_UNIT_ID = \"ca-app-pub-3940256099942544/6300978111\"\n```\n\n### BÆ°á»›c 3: Build APK\n\n```powershell\nflutter build apk --release --dart-define=SUPABASE_URL=\"$env:SUPABASE_URL\" --dart-define=SUPABASE_ANON_KEY=\"$env:SUPABASE_ANON_KEY\" --dart-define=HUGGINGFACE_TOKEN=\"$env:HUGGINGFACE_TOKEN\" --dart-define=REPLICATE_API_TOKEN=\"$env:REPLICATE_API_TOKEN\" --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"$env:ADMOB_REWARDED_AD_UNIT_ID\" --dart-define=ADMOB_BANNER_AD_UNIT_ID=\"$env:ADMOB_BANNER_AD_UNIT_ID\"\n```\n\n---\n\n## CÃ¡ch 3: Build command má»™t dÃ²ng (All-in-one)\n\n**Thay tháº¿ YOUR_XXX báº±ng giÃ¡ trá»‹ tháº­t:**\n\n```powershell\nflutter build apk --release --dart-define=SUPABASE_URL=\"https://YOUR_PROJECT.supabase.co\" --dart-define=SUPABASE_ANON_KEY=\"YOUR_ANON_KEY\" --dart-define=HUGGINGFACE_TOKEN=\"YOUR_HF_TOKEN\" --dart-define=REPLICATE_API_TOKEN=\"YOUR_REPLICATE_TOKEN\" --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\n```\n\n---\n\n## Install APK\n\n```powershell\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n---\n\n## Xem logs\n\n```powershell\n# Xem ads logs\nadb logcat | Select-String \"AppLovin|AdMob|Rewarded\"\n\n# Hoáº·c táº¥t cáº£ logs\nadb logcat\n```\n\n---\n\n## Troubleshooting\n\n### \"flutter: command not found\"\n\n**Giáº£i phÃ¡p:**\n```powershell\n# Kiá»ƒm tra Flutter cÃ³ trong PATH khÃ´ng\nflutter --version\n\n# Náº¿u khÃ´ng cÃ³, add Flutter vÃ o PATH hoáº·c dÃ¹ng full path\nC:\\path\\to\\flutter\\bin\\flutter build apk --release ...\n```\n\n### \"Unable to locate Android SDK\"\n\n**Giáº£i phÃ¡p:**\n```powershell\n# Cháº¡y flutter doctor\nflutter doctor\n\n# CÃ i Android Studio Ä‘á»ƒ cÃ³ SDK\n# https://developer.android.com/studio\n```\n\n### Build thÃ nh cÃ´ng nhÆ°ng ads khÃ´ng hiá»ƒn thá»‹\n\n**Kiá»ƒm tra:**\n1. App cÃ³ Ä‘Æ°á»£c build vá»›i `--dart-define` khÃ´ng?\n2. Xem logcat khi app khá»Ÿi Ä‘á»™ng:\n   ```powershell\n   adb logcat | Select-String \"AppLovin|AdMob\"\n   ```\n3. TÃ¬m dÃ²ng: \"[OK] ADMOB_REWARDED_AD_UNIT_ID: Found\"\n\n---\n\n## Test Ads IDs (Google AdMob - LuÃ´n hoáº¡t Ä‘á»™ng)\n\n**Android:**\n- Rewarded: `ca-app-pub-3940256099942544/5224354917`\n- Banner: `ca-app-pub-3940256099942544/6300978111`\n- Interstitial: `ca-app-pub-3940256099942544/1033173712`\n\n**iOS:**\n- Rewarded: `ca-app-pub-3940256099942544/1712485313`\n- Banner: `ca-app-pub-3940256099942544/2934735716`\n- Interstitial: `ca-app-pub-3940256099942544/4411468910`\n\n---\n\n## TL;DR - Quickest way\n\n```powershell\n# 1. Set minimal secrets\n$env:SUPABASE_URL = \"https://your-project.supabase.co\"\n$env:SUPABASE_ANON_KEY = \"your_key\"\n\n# 2. Build\nflutter build apk --release --dart-define=SUPABASE_URL=\"$env:SUPABASE_URL\" --dart-define=SUPABASE_ANON_KEY=\"$env:SUPABASE_ANON_KEY\" --dart-define=ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\n\n# 3. Install\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n","size_bytes":4067},"QUICK_REFERENCE.md":{"content":"# âš¡ Quick Reference - Viso AI\n\nTÃ i liá»‡u tham kháº£o nhanh cho cÃ¡c task thÆ°á»ng dÃ¹ng.\n\n---\n\n## ðŸš€ Build APK (Windows)\n\n```powershell\n# 1. Setup secrets.env (láº§n Ä‘áº§u tiÃªn)\nCopy-Item secrets.env.template secrets.env\nnotepad secrets.env  # Äiá»n Supabase URL, keys, vÃ  test ads\n\n# 2. Build APK\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n.\\build_with_all_ads.ps1 apk\n\n# 3. Install\nadb install build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n---\n\n## ðŸ” Debug Ads\n\n```powershell\n# Terminal 1: Logcat\nadb logcat -c\nadb logcat | Select-String \"visoai|AppLovin|AdMob|Flutter|ERROR\"\n\n# Terminal 2: Launch app\nadb shell am start -n com.visoai.photoheadshot/.MainActivity\n\n# Má»Ÿ app â†’ Äá»£i 10s â†’ Click \"Watch Ad\" â†’ Xem logs\n```\n\n---\n\n## ðŸ§ª Google Test Ad IDs (Always works)\n\n```bash\n# secrets.env\nexport ADMOB_REWARDED_AD_UNIT_ID=\"ca-app-pub-3940256099942544/5224354917\"\nexport ADMOB_BANNER_AD_UNIT_ID=\"ca-app-pub-3940256099942544/6300978111\"\nexport ADMOB_INTERSTITIAL_AD_UNIT_ID=\"ca-app-pub-3940256099942544/1033173712\"\n```\n\n---\n\n## ðŸ“± ADB Commands\n\n```powershell\n# Check connection\nadb devices\n\n# Install APK\nadb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n\n# Uninstall\nadb uninstall com.visoai.photoheadshot\n\n# Launch app\nadb shell am start -n com.visoai.photoheadshot/.MainActivity\n\n# View logs\nadb logcat | Select-String \"visoai|ERROR\"\n\n# Save logs to file\nadb logcat > logs.txt\n```\n\n---\n\n## ðŸ› Common Issues & Quick Fixes\n\n### \"Ads not ready yet\"\n```powershell\n# 1. Check build cÃ³ ads config\nadb logcat | Select-String \"AppLovin|AdMob\"\n# TÃ¬m: \"[OK] ADMOB_REWARDED_AD_UNIT_ID: Found\"\n\n# 2. Náº¿u MISSING â†’ Rebuild vá»›i test ads\n# Edit secrets.env, dÃ¹ng Google test IDs\n.\\build_with_all_ads.ps1 apk\n\n# 3. Äá»£i 10 giÃ¢y sau khi app má»Ÿ\n```\n\n### \"flutter: command not found\"\n```powershell\n# Add Flutter to PATH\n$env:Path += \";C:\\path\\to\\flutter\\bin\"\n```\n\n### \"adb: command not found\"\n```powershell\n# Add ADB to PATH\n$env:Path += \";C:\\Users\\YourName\\AppData\\Local\\Android\\Sdk\\platform-tools\"\n```\n\n### \"PowerShell script error\"\n```powershell\n# Cho phÃ©p cháº¡y script\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n```\n\n---\n\n## ðŸ“‚ Important Files\n\n| File | Location |\n|------|----------|\n| **Main app** | `lib/main.dart` |\n| **Translations** | `lib/flutter_flow/internationalization.dart` (line 287+) |\n| **Ad services** | `lib/services/applovin_service.dart`, `admob_rewarded_service.dart` |\n| **Face swap page** | `lib/swapface/swapface_widget.dart` |\n| **Build scripts** | `build_with_all_ads.ps1` (Windows), `.sh` (Unix) |\n| **Secrets** | `secrets.env` (create from `.template`) |\n| **Package config** | `android/app/build.gradle` |\n\n---\n\n## ðŸ”‘ Secrets Checklist\n\n**Required:**\n- âœ… SUPABASE_URL\n- âœ… SUPABASE_ANON_KEY\n- âœ… HUGGINGFACE_TOKEN\n- âœ… REPLICATE_API_TOKEN\n\n**For Ads (Optional - use test IDs):**\n- ADMOB_REWARDED_AD_UNIT_ID\n- APPLOVIN_SDK_KEY (náº¿u dÃ¹ng AppLovin)\n\n---\n\n## ðŸŒ URLs\n\n- **Replit Web:** http://0.0.0.0:5000\n- **Package Name:** com.visoai.photoheadshot\n\n---\n\n## ðŸ“š Full Documentation\n\n- **Comprehensive Guide:** `PROJECT_GUIDE.md`\n- **Windows Build:** `WINDOWS_BUILD_GUIDE.md`\n- **Ad Setup:** `AD_SETUP_GUIDE.md`\n- **Debug Guide:** `DEBUG_APP_LOGCAT.md`\n\n---\n\n## âš¡ TL;DR - Build & Test\n\n```powershell\n# 1. Setup (láº§n Ä‘áº§u)\nCopy-Item secrets.env.template secrets.env\nnotepad secrets.env  # Add: SUPABASE_URL, keys, test ads\n\n# 2. Build\nSet-ExecutionPolicy -Scope Process -ExecutionPolicy Bypass\n.\\build_with_all_ads.ps1 apk\n\n# 3. Debug\nadb logcat -c\nadb logcat | Select-String \"visoai|AppLovin|AdMob|ERROR\"\n\n# 4. Install & test\nadb install -r build\\app\\outputs\\flutter-apk\\app-release.apk\n```\n\n**Done!** ðŸŽ‰\n","size_bytes":3732},"HD_IMAGE_API_REFERENCE.md":{"content":"# HD Image Enhancement API Reference\n\n## ðŸ“‹ Overview\n\nThis document lists the best AI APIs for HD image upscaling and enhancement, integrated into the Viso AI application with intelligent fallback strategy.\n\n---\n\n## ðŸŽ¯ Implementation Strategy\n\nThe HD Image feature uses a **3-tier intelligent fallback system**:\n\n1. **PRIMARY**: Huggingface Inference API (Pro) - 10s timeout\n2. **FALLBACK**: Replicate API (fast, reliable, $0.0019/run)\n3. **LAST RESORT**: Huggingface Space (free backup)\n\n---\n\n## ðŸ”¥ Huggingface Inference API (Primary)\n\n### **1. Stable Diffusion x4 Upscaler** â­ BEST FOR 4X SCALE\n- **Model ID**: `stabilityai/stable-diffusion-x4-upscaler`\n- **Type**: Diffusion-based super-resolution\n- **Upscaling Factor**: 4x\n- **API Endpoint**: `https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-x4-upscaler`\n- **Best For**: Maximum quality 4x upscaling\n- **Features**:\n  - Text-guided upscaling for better control\n  - Excellent quality on diverse images\n  - Handles complex degradations well\n\n**Implementation Status**: âœ… Integrated with 10s timeout\n\n### **2. Real-ESRGAN Inference API**\n- **Model ID**: `nightmareai/real-esrgan`\n- **Type**: GAN-based super-resolution\n- **Upscaling Factor**: 2x, 4x\n- **API Endpoint**: `https://api-inference.huggingface.co/models/nightmareai/real-esrgan`\n- **Best For**: 2x upscaling, real-world images\n- **Features**:\n  - Fast inference\n  - Handles real-world degradations (blur, noise, compression)\n  - No prompt required\n\n**Implementation Status**: âœ… Integrated for 2x scale with 10s timeout\n\n---\n\n## ðŸš€ Replicate API (Fallback)\n\n### **1. nightmareai/real-esrgan** â­ CURRENTLY USED\n- **Model ID**: `nightmareai/real-esrgan:42fed1c4974146d4d2414e2be2c5277c7fcf05fcc3a73abf41610695738c1d7b`\n- **Type**: GAN-based super-resolution\n- **Hardware**: Nvidia T4 (cheap) or A100 (faster)\n- **Speed**: \n  - T4: ~1.8s for 2Ã— upscale\n  - A100: ~0.7s for 2Ã— upscale\n- **Cost**: ~$0.0019 per run (~526 runs per $1)\n- **Features**:\n  - Optional `face_enhance` for AI faces\n  - Max input: 1440p recommended\n  - Very cost-effective\n\n**Implementation Status**: âœ… Integrated as fallback\n\n**API Call Example**:\n```python\noutput = replicate.run(\n    \"nightmareai/real-esrgan:42fed1c4974146d4d2414e2be2c5277c7fcf05fcc3a73abf41610695738c1d7b\",\n    input={\n        \"image\": data_uri,\n        \"scale\": 2,  # or 4\n        \"face_enhance\": False\n    }\n)\n```\n\n### **2. batouresearch/magic-image-refiner** (Alternative)\n- **Model ID**: `batouresearch/magic-image-refiner`\n- **Type**: General upscaling, refining, inpainting\n- **Output**: 1024Ã—1024px or 2048Ã—2048px\n- **Speed**: Fast\n- **Features**:\n  - Adjustable `resemblance` parameter (0-1)\n  - Adjustable `creativity` parameter (0-1)\n  - Best overall quality\n\n**Implementation Status**: âŒ Available but not integrated\n\n### **3. jingyunliang/swinir** (Alternative)\n- **Model ID**: `jingyunliang/swinir`\n- **Type**: Fast upscaling for web\n- **Speed**: 4-4.5s for 4Ã— upscale\n- **Features**:\n  - Removes JPEG artifacts\n  - Excellent for landscapes and portraits\n  - Better than Real-ESRGAN (without face enhancements)\n\n**Implementation Status**: âŒ Available but not integrated\n\n---\n\n## ðŸ”„ Huggingface Space (Last Resort)\n\n### **Real-ESRGAN Space**\n- **Space**: `akhaliq/Real-ESRGAN`\n- **Type**: Gradio-based inference\n- **Features**:\n  - Reliable backup\n  - No token required (public)\n  - Slower than API/Replicate\n\n**Implementation Status**: âœ… Integrated as last resort\n\n---\n\n## ðŸ“Š Comparison Table\n\n| API/Model | Provider | Speed | Quality | Cost | Timeout | Status |\n|-----------|----------|-------|---------|------|---------|--------|\n| **SD x4 Upscaler** | HF Inference | Medium | Excellent | Free* | 10s | âœ… **Primary (4x)** |\n| **Real-ESRGAN Inference** | HF Inference | Fast | Very Good | Free* | 10s | âœ… **Primary (2x)** |\n| **Real-ESRGAN** | Replicate | Very Fast | Very Good | $0.0019 | 30s | âœ… Fallback |\n| **Magic Refiner** | Replicate | Fast | Excellent | ~$0.02 | 30s | âŒ Available |\n| **SwinIR** | Replicate | Fast | Very Good | ~$0.01 | 30s | âŒ Available |\n| **Real-ESRGAN Space** | HF Space | Slow | Good | Free | 60s | âœ… Last Resort |\n\n*Free with HF Pro subscription or rate-limited\n\n---\n\n## ðŸ”§ Current Implementation\n\n### File: `services/image_ai_service.py`\n\n```python\nasync def hd_image(self, image_base64, scale=4):\n    \"\"\"\n    HD Image Enhancement with Intelligent Fallback\n    Strategy:\n    1. PRIMARY: Huggingface Inference API (timeout 10s)\n    2. FALLBACK: Replicate Real-ESRGAN (reliable)\n    3. LAST RESORT: Huggingface Space (backup)\n    \"\"\"\n    \n    # 1. Try Huggingface Inference API (10s timeout)\n    if huggingface_token:\n        image_bytes, _ = self._decode_base64_image(image_base64)\n        \n        # Select model based on scale\n        if scale == 4:\n            api_url = \"https://api-inference.huggingface.co/models/stabilityai/stable-diffusion-x4-upscaler\"\n        else:\n            api_url = \"https://api-inference.huggingface.co/models/nightmareai/real-esrgan\"\n        \n        headers = {\"Authorization\": f\"Bearer {huggingface_token}\"}\n        \n        # Send raw binary image bytes (NOT JSON)\n        response = requests.post(api_url, headers=headers, data=image_bytes, timeout=10)\n        \n        # Use asyncio.wait_for for timeout control\n        try:\n            content = await asyncio.wait_for(\n                loop.run_in_executor(None, _call_hf_api),\n                timeout=10.0\n            )\n            return {\"success\": True, \"image\": f\"data:image/png;base64,{result_base64}\"}\n        except asyncio.TimeoutError:\n            # Fall through to Replicate\n            pass\n    \n    # 2. Fallback to Replicate\n    if replicate_token:\n        # Use nightmareai/real-esrgan\n        output = replicate.run(\"nightmareai/real-esrgan:...\", input={...})\n        return {\"success\": True, \"image\": result}\n    \n    # 3. Last resort: Huggingface Space\n    client = self._init_real_esrgan_backup()\n    result = client.predict(temp_file)\n    return {\"success\": True, \"image\": result}\n```\n\n**Key Implementation Details**:\n- âœ… Send **raw binary bytes** to Huggingface Inference API (NOT JSON)\n- âœ… Use `asyncio.wait_for(timeout=10.0)` for strict timeout control\n- âœ… Proper error handling with fallback on timeout or failure\n- âœ… Model selection based on scale factor (4x = SD x4, 2x = Real-ESRGAN)\n\n### Timeout Handling\n\n- **Huggingface Inference API**: 10 second timeout (configurable)\n- **Replicate**: 30 second timeout for download\n- **Huggingface Space**: Default Gradio timeout (~60s)\n\n### Error Flow\n\n```\nUser uploads image\n    â†“\nTry HF Inference API (10s timeout)\n    â”œâ”€ Success â†’ Return result\n    â”œâ”€ Timeout â†’ Fallback to Replicate\n    â””â”€ Error â†’ Fallback to Replicate\n         â†“\nTry Replicate (30s timeout)\n    â”œâ”€ Success â†’ Return result\n    â””â”€ Error â†’ Try HF Space\n         â†“\nTry HF Space (60s timeout)\n    â”œâ”€ Success â†’ Return result\n    â””â”€ Error â†’ Return error to user\n```\n\n---\n\n## ðŸ“ Environment Variables\n\nRequired secrets for full functionality:\n\n```bash\n# Huggingface (Primary)\nHUGGINGFACE_TOKEN=\"hf_xxxxxxxxxxxxx\"\n\n# Replicate (Fallback)\nREPLICATE_API_TOKEN=\"r8_xxxxxxxxxxxxx\"\n```\n\n---\n\n## ðŸ§ª Testing\n\n### Test 4x Upscaling (Stable Diffusion)\n```bash\nPOST /api/ai/hd-image\n{\n  \"image\": \"data:image/jpeg;base64,...\",\n  \"scale\": 4\n}\n\nExpected: Uses Stable Diffusion x4 Upscaler\n```\n\n### Test 2x Upscaling (Real-ESRGAN)\n```bash\nPOST /api/ai/hd-image\n{\n  \"image\": \"data:image/jpeg;base64,...\",\n  \"scale\": 2\n}\n\nExpected: Uses Real-ESRGAN Inference API\n```\n\n### Test Timeout Fallback\n```bash\n# Simulate HF timeout by removing HUGGINGFACE_TOKEN\nunset HUGGINGFACE_TOKEN\n\nPOST /api/ai/hd-image\n{\n  \"image\": \"data:image/jpeg;base64,...\",\n  \"scale\": 4\n}\n\nExpected: Falls back to Replicate\n```\n\n---\n\n## ðŸ“š API Documentation Links\n\n### Huggingface\n- Stable Diffusion x4: https://huggingface.co/stabilityai/stable-diffusion-x4-upscaler\n- Real-ESRGAN: https://huggingface.co/nightmareai/real-esrgan\n- Inference API Docs: https://huggingface.co/docs/api-inference\n\n### Replicate\n- Real-ESRGAN: https://replicate.com/nightmareai/real-esrgan\n- Magic Refiner: https://replicate.com/batouresearch/magic-image-refiner\n- SwinIR: https://replicate.com/jingyunliang/swinir\n- API Docs: https://replicate.com/docs/reference/http\n\n### Huggingface Spaces\n- Real-ESRGAN Space: https://huggingface.co/spaces/akhaliq/Real-ESRGAN\n- Gradio Client Docs: https://www.gradio.app/guides/getting-started-with-the-python-client\n\n---\n\n## ðŸŽ¯ Future Improvements\n\n### Potential Enhancements:\n1. **Add Magic Image Refiner** as alternative Replicate fallback\n2. **Add SwinIR** for faster 4x upscaling\n3. **Dynamic model selection** based on image characteristics\n4. **Batch processing** support for multiple images\n5. **Quality metrics** tracking (PSNR, SSIM)\n6. **Cost optimization** based on usage patterns\n\n### Model Rotation Strategy:\n- Monitor success rates and latency for each provider\n- Dynamically adjust primary/fallback based on performance\n- Implement circuit breaker pattern for failing services\n\n---\n\n**Last Updated**: October 11, 2025  \n**Implementation**: âœ… Complete  \n**Status**: Production Ready\n","size_bytes":9227},"run_ios_simulator.sh":{"content":"#!/bin/zsh\n\necho \"ðŸš€ Running Viso AI on iOS Simulator...\"\n\n# Load secrets tá»« file\nif [ ! -f secrets.env ]; then\n    echo \"âŒ Error: secrets.env not found! Please create it from secrets.env.template\"\n    exit 1\nfi\n\nsource secrets.env\n\n# List available simulators\necho \"ðŸ“± Available simulators:\"\nxcrun simctl list devices | grep \"iPhone\"\n\n# Run vá»›i hot reload enabled\necho \"\"\necho \"ðŸ”¥ Starting app with hot reload...\"\nflutter run \\\n  --dart-define=SUPABASE_URL=$SUPABASE_URL \\\n  --dart-define=SUPABASE_ANON_KEY=$SUPABASE_ANON_KEY \\\n  --dart-define=HUGGINGFACE_TOKEN=$HUGGINGFACE_TOKEN \\\n  --dart-define=REPLICATE_API_TOKEN=$REPLICATE_API_TOKEN \\\n  --dart-define=ADMOB_APP_ID_IOS=${ADMOB_APP_ID_IOS:-ca-app-pub-3940256099942544~1458002511} \\\n  --dart-define=ADMOB_REWARDED_AD_UNIT_ID=${ADMOB_REWARDED_AD_UNIT_ID:-ca-app-pub-3940256099942544/1712485313} \\\n  --dart-define=APPLOVIN_SDK_KEY=${APPLOVIN_SDK_KEY:-test_key} \\\n  --dart-define=SUPPORT_EMAIL=${SUPPORT_EMAIL:-jokerlin135@gmail.com} \\\n  -d 'iPhone 16'\n","size_bytes":1017},"MACOS_BUILD_GUIDE.md":{"content":"# ðŸŽ HÆ°á»›ng dáº«n Build iOS trÃªn macOS M1\n\n## âœ… Prerequisites (ÄÃ£ cÃ³)\n- âœ… macOS M1\n- âœ… VSCode \n- âœ… Zsh vá»›i Flutter SDK Ä‘Ã£ config\n- âœ… iPhone 16 Simulator\n\n## ðŸ“‹ BÆ°á»›c 1: Kiá»ƒm tra mÃ´i trÆ°á»ng\n\n```zsh\n# Kiá»ƒm tra Flutter\nflutter doctor\n\n# Kiá»ƒm tra Xcode\nxcodebuild -version\n\n# Kiá»ƒm tra simulators\nxcrun simctl list devices | grep \"iPhone 16\"\n```\n\n**Náº¿u thiáº¿u CocoaPods:**\n```zsh\nsudo gem install cocoapods\n```\n\n---\n\n## ðŸ”‘ BÆ°á»›c 2: Setup Secrets File\n\n### Táº¡o `secrets.env` (náº¿u chÆ°a cÃ³)\n```zsh\ncp secrets.env.template secrets.env\n```\n\n### Edit file secrets.env\n```zsh\n# Má»Ÿ báº±ng VSCode\ncode secrets.env\n\n# HOáº¶C dÃ¹ng nano\nnano secrets.env\n```\n\n### Ná»™i dung `secrets.env`:\n```bash\n# Required - API Keys\nSUPABASE_URL=https://your-project.supabase.co\nSUPABASE_ANON_KEY=your_supabase_anon_key\nHUGGINGFACE_TOKEN=hf_xxxxxxxxxxxxx\nREPLICATE_API_TOKEN=r8_xxxxxxxxxxxxx\n\n# Ads (optional - dÃ¹ng test IDs náº¿u khÃ´ng cÃ³ real keys)\nADMOB_APP_ID_IOS=ca-app-pub-3940256099942544~1458002511\nADMOB_REWARDED_AD_UNIT_ID=ca-app-pub-3940256099942544/1712485313\nAPPLOVIN_SDK_KEY=your_applovin_sdk_key\n\n# Support Email\nSUPPORT_EMAIL=jokerlin135@gmail.com\n```\n\n**ðŸ’¡ Tip:** Copy keys tá»« Windows project (secrets.env) sang macOS, chá»‰ cáº§n Ä‘á»•i `ADMOB_APP_ID_ANDROID` â†’ `ADMOB_APP_ID_IOS`\n\n---\n\n## ðŸš€ BÆ°á»›c 3: Build & Run (CHá»ŒN 1 TRONG 2 CÃCH)\n\n### **CÃ¡ch 1: Quick Run (RECOMMENDED) - Hot Reload âš¡**\n\n```zsh\n# Cho quyá»n thá»±c thi script\nchmod +x run_ios_simulator.sh\n\n# Run ngay (khÃ´ng cáº§n build riÃªng)\n./run_ios_simulator.sh\n```\n\n**âœ… Æ¯u Ä‘iá»ƒm:**\n- Nhanh nháº¥t (1-2 phÃºt)\n- Há»— trá»£ Hot Reload (sá»­a code khÃ´ng cáº§n restart)\n- Tá»± Ä‘á»™ng load secrets\n\n---\n\n### **CÃ¡ch 2: Build riÃªng rá»“i Run**\n\n```zsh\n# Cho quyá»n thá»±c thi\nchmod +x build_ios_simulator.sh\n\n# Build\n./build_ios_simulator.sh\n\n# Run\nflutter run -d 'iPhone 16'\n```\n\n---\n\n## ðŸ“± BÆ°á»›c 4: Test Feedback Dialog\n\n### Sau khi app cháº¡y trÃªn simulator:\n\n1. **Scroll down trang Homepage**\n2. **TÃ¬m button \"Tell us âœ¨\"** (mÃ u tÃ­m, gÃ³c pháº£i)\n3. **Tap button** â†’ Má»Ÿ feedback dialog\n4. **Nháº­p feedback:** \"Test from iOS simulator\"\n5. **Tap Submit button**\n6. **Kiá»ƒm tra:**\n   - âœ… Submit button KHÃ”NG bá»‹ che bá»Ÿi device navigation bar\n   - âœ… Mail app má»Ÿ vá»›i email template gá»­i tá»›i `SUPPORT_EMAIL`\n   - âœ… Dialog Ä‘Ã³ng + hiá»‡n thÃ´ng bÃ¡o \"Thank you for your feedback!\"\n\n---\n\n## ðŸ› Debug Commands\n\n### Xem logs realtime\n```zsh\n# Flutter logs\nflutter logs\n\n# iOS system logs\nxcrun simctl spawn booted log stream --predicate 'process == \"Runner\"'\n```\n\n### Clean build náº¿u lá»—i\n```zsh\nflutter clean\nrm -rf ios/Pods ios/.symlinks ios/Podfile.lock\nflutter pub get\ncd ios && pod install && cd ..\n```\n\n### Restart simulator\n```zsh\n# Kill simulator\nkillall Simulator\n\n# Reopen\nopen -a Simulator\n```\n\n---\n\n## âš¡ Quick Commands Cheat Sheet\n\n```zsh\n# 1. First time setup\nchmod +x *.sh\ncp secrets.env.template secrets.env\ncode secrets.env  # Fill in your keys\n\n# 2. Run app (cÃ³ hot reload)\n./run_ios_simulator.sh\n\n# 3. Xem logs\nflutter logs\n\n# 4. Clean náº¿u lá»—i\nflutter clean && flutter pub get && cd ios && pod install && cd ..\n\n# 5. List simulators\nxcrun simctl list devices | grep iPhone\n```\n\n---\n\n## ðŸŽ¯ So sÃ¡nh Windows vs macOS\n\n| Feature | Windows (APK) | macOS (iOS Simulator) |\n|---------|---------------|----------------------|\n| **Build time** | 5-10 phÃºt | 1-2 phÃºt |\n| **Hot Reload** | âŒ Cáº§n rebuild APK | âœ… Instant reload |\n| **Script** | `.ps1` (PowerShell) | `.sh` (Zsh) |\n| **Install** | Copy APK sang phone | Run trá»±c tiáº¿p |\n| **Debug** | `adb logcat` | `flutter logs` |\n\n---\n\n## âœ… Expected Output\n\n```\nðŸš€ Running Viso AI on iOS Simulator...\nðŸ“± Available simulators:\n    iPhone 16 (XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX) (Booted)\n\nðŸ”¥ Starting app with hot reload...\nLaunching lib/main.dart on iPhone 16 in debug mode...\nRunning pod install...\nRunning Xcode build...\nXcode build done.                                           15.2s\nSyncing files to device iPhone 16...\nFlutter run key commands.\nr Hot reload. ðŸ”¥ðŸ”¥ðŸ”¥\nR Hot restart.\nh List all available interactive commands.\nd Detach (terminate \"flutter run\" but leave application running).\nc Clear the screen\nq Quit (terminate the application on the device).\n\nðŸ’ª Running with sound null safety ðŸ’ª\n\nAn Observatory debugger and profiler on iPhone 16 is available at: http://127.0.0.1:xxxxx/\nThe Flutter DevTools debugger and profiler on iPhone 16 is available at: http://127.0.0.1:xxxxx/\n```\n\n---\n\n## ðŸŽ‰ Success Checklist\n\n- [ ] Simulator iPhone 16 Ä‘Ã£ boot\n- [ ] App cháº¡y thÃ nh cÃ´ng\n- [ ] Trang Homepage hiá»ƒn thá»‹ Ä‘Ãºng\n- [ ] Button \"Tell us âœ¨\" xuáº¥t hiá»‡n\n- [ ] Tap button â†’ Dialog má»Ÿ\n- [ ] Submit button KHÃ”NG bá»‹ che\n- [ ] Tap Submit â†’ Mail app má»Ÿ vá»›i template\n- [ ] Email gá»­i tá»›i Ä‘á»‹a chá»‰ trong `SUPPORT_EMAIL`\n\n---\n\n## ðŸ“ž Support\n\nNáº¿u gáº·p lá»—i:\n1. Check `flutter doctor`\n2. Clean build: `flutter clean`\n3. Reinstall pods: `cd ios && pod install`\n4. Xem logs: `flutter logs`\n","size_bytes":5084},"build_ios_simulator.sh":{"content":"#!/bin/zsh\n\necho \"ðŸŽ Building Viso AI for iOS Simulator (macOS M1)...\"\n\n# Load secrets tá»« file\nif [ ! -f secrets.env ]; then\n    echo \"âŒ Error: secrets.env not found! Please create it from secrets.env.template\"\n    exit 1\nfi\n\nsource secrets.env\n\n# Clean previous build\necho \"ðŸ§¹ Cleaning previous build...\"\nflutter clean\nrm -rf ios/Pods ios/.symlinks ios/Podfile.lock\n\n# Get dependencies\necho \"ðŸ“¦ Getting Flutter dependencies...\"\nflutter pub get\n\n# Install iOS pods\necho \"ðŸ“± Installing CocoaPods dependencies...\"\ncd ios && pod install && cd ..\n\n# Build for iOS Simulator with dart-define\necho \"ðŸ”¨ Building for iOS Simulator...\"\nflutter build ios \\\n  --simulator \\\n  --dart-define=SUPABASE_URL=$SUPABASE_URL \\\n  --dart-define=SUPABASE_ANON_KEY=$SUPABASE_ANON_KEY \\\n  --dart-define=HUGGINGFACE_TOKEN=$HUGGINGFACE_TOKEN \\\n  --dart-define=REPLICATE_API_TOKEN=$REPLICATE_API_TOKEN \\\n  --dart-define=ADMOB_APP_ID_IOS=${ADMOB_APP_ID_IOS:-ca-app-pub-3940256099942544~1458002511} \\\n  --dart-define=ADMOB_REWARDED_AD_UNIT_ID=${ADMOB_REWARDED_AD_UNIT_ID:-ca-app-pub-3940256099942544/1712485313} \\\n  --dart-define=APPLOVIN_SDK_KEY=${APPLOVIN_SDK_KEY:-test_key} \\\n  --dart-define=SUPPORT_EMAIL=${SUPPORT_EMAIL:-jokerlin135@gmail.com}\n\necho \"\"\necho \"âœ… Build complete!\"\necho \"ðŸ“± To run on simulator:\"\necho \"   flutter run -d 'iPhone 16'\"\n","size_bytes":1340},"build_production_android.sh":{"content":"#!/bin/bash\n\n# Production Android AAB Build Script for Google Play Store\n# This script builds a release AAB with obfuscation and proper signing\n\necho \"ðŸ¤– Building Production Android AAB for Google Play Store...\"\n\n# Check if prod.json exists\nif [ ! -f prod.json ]; then\n    echo \"âŒ Error: prod.json not found!\"\n    echo \"Please create prod.json with your production API keys\"\n    echo \"Use .env.example as template\"\n    exit 1\nfi\n\n# Check if keystore exists\nif [ ! -f android/key.properties ]; then\n    echo \"âŒ Error: android/key.properties not found!\"\n    echo \"\"\n    echo \"Please create upload keystore first:\"\n    echo \"  keytool -genkey -v -keystore upload-keystore.jks \\\\\"\n    echo \"    -keyalg RSA -keysize 2048 -validity 10000 \\\\\"\n    echo \"    -alias upload\"\n    echo \"\"\n    echo \"Then create android/key.properties with:\"\n    echo \"  storePassword=YOUR_PASSWORD\"\n    echo \"  keyPassword=YOUR_PASSWORD\"\n    echo \"  keyAlias=upload\"\n    echo \"  storeFile=../upload-keystore.jks\"\n    exit 1\nfi\n\n# Clean previous build\necho \"ðŸ§¹ Cleaning previous build...\"\nflutter clean\n\n# Get dependencies\necho \"ðŸ“¦ Getting dependencies...\"\nflutter pub get\n\n# Build production AAB\necho \"ðŸ”¨ Building release AAB with obfuscation...\"\nflutter build appbundle \\\n  --release \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --dart-define-from-file=prod.json\n\n# Check if build succeeded\nif [ $? -eq 0 ]; then\n    echo \"\"\n    echo \"âœ… Build successful!\"\n    echo \"\"\n    echo \"ðŸ“¦ AAB file location:\"\n    ls -lh build/app/outputs/bundle/release/app-release.aab\n    echo \"\"\n    echo \"ðŸ“¤ Next steps:\"\n    echo \"1. Go to Google Play Console: https://play.google.com/console\"\n    echo \"2. Select your app\"\n    echo \"3. Go to Release â†’ Testing â†’ Internal testing (or Production)\"\n    echo \"4. Upload: build/app/outputs/bundle/release/app-release.aab\"\n    echo \"\"\nelse\n    echo \"\"\n    echo \"âŒ Build failed! Check errors above.\"\n    exit 1\nfi\n","size_bytes":1948},"PRIVACY_POLICY_TEMPLATE.md":{"content":"# Privacy Policy Template for Viso AI\n\n**âš ï¸ IMPORTANT:** This is a template. You MUST customize it with your actual business info, legal review, and host it on a public HTTPS URL before submitting to app stores.\n\n---\n\n# Privacy Policy\n\n**Last Updated:** [DATE]\n\n## Introduction\n\nWelcome to Viso AI (\"we,\" \"our,\" or \"us\"). This Privacy Policy explains how we collect, use, disclose, and safeguard your information when you use our mobile application Viso AI - Photo Avatar Headshot (the \"App\").\n\nPlease read this privacy policy carefully. If you do not agree with the terms of this privacy policy, please do not access the App.\n\n## Information We Collect\n\n### 1. Personal Information\nWe may collect the following personal information:\n\n- **Photos and Images**: Photos you upload to the App for AI processing\n- **Email Address**: When you submit feedback (optional)\n- **Device Information**: Device type, operating system, unique device identifiers\n\n### 2. Automatically Collected Information\nWhen you use the App, we may automatically collect:\n\n- **Usage Data**: App features used, session duration, app interactions\n- **Device Data**: IP address, browser type, operating system\n- **Advertising ID**: For personalized advertising (can be opted out)\n\n## How We Use Your Information\n\nWe use the collected information for:\n\n1. **App Functionality**\n   - Process images using AI models (face swapping, photo enhancement, etc.)\n   - Save processed images to your device\n\n2. **Service Improvement**\n   - Analyze app usage to improve features\n   - Fix bugs and optimize performance\n\n3. **Advertising**\n   - Display personalized ads via Google AdMob and AppLovin MAX\n   - Measure ad performance\n\n4. **Communication**\n   - Respond to feedback and support requests\n   - Send important app updates (with your consent)\n\n## Third-Party Services\n\nWe use the following third-party services that may collect your information:\n\n### AI Processing Services\n- **Huggingface** - AI image processing\n  - Privacy Policy: https://huggingface.co/privacy\n- **Replicate** - AI model inference\n  - Privacy Policy: https://replicate.com/privacy\n\n### Backend Services\n- **Supabase** - Cloud database and storage\n  - Privacy Policy: https://supabase.com/privacy\n\n### Advertising Networks\n- **Google AdMob** - Mobile advertising\n  - Privacy Policy: https://policies.google.com/privacy\n- **AppLovin MAX** - Mobile advertising\n  - Privacy Policy: https://www.applovin.com/privacy/\n\n### Analytics (if applicable)\n- **Google Analytics** (if you use it)\n  - Privacy Policy: https://policies.google.com/privacy\n\n## Data Sharing and Disclosure\n\nWe may share your information with:\n\n1. **Service Providers**: Third-party companies that help us operate the App (Supabase, Huggingface, Replicate)\n2. **Advertising Partners**: Ad networks for personalized advertising (AdMob, AppLovin)\n3. **Legal Requirements**: When required by law or to protect our rights\n4. **Business Transfers**: In case of merger, acquisition, or sale of assets\n\nWe **DO NOT sell** your personal information to third parties.\n\n## Data Security\n\nWe implement appropriate technical and organizational security measures to protect your information:\n\n- Encrypted data transmission (HTTPS/TLS)\n- Secure cloud storage (Supabase)\n- Regular security audits\n- Access controls and authentication\n\nHowever, no method of transmission over the internet is 100% secure. We cannot guarantee absolute security.\n\n## Data Retention\n\n- **Uploaded Photos**: Processed immediately and not permanently stored on our servers\n- **Usage Data**: Retained for [X] months for analytics purposes\n- **Feedback Emails**: Retained until resolved, then deleted\n\n## Your Privacy Rights\n\nDepending on your location, you may have the following rights:\n\n### All Users\n- **Access**: Request a copy of your personal data\n- **Deletion**: Request deletion of your data\n- **Correction**: Request correction of inaccurate data\n- **Opt-out**: Opt-out of personalized advertising\n\n### EU/UK Users (GDPR)\n- Right to data portability\n- Right to restrict processing\n- Right to object to processing\n- Right to withdraw consent\n\n### California Users (CCPA)\n- Right to know what personal information is collected\n- Right to delete personal information\n- Right to opt-out of sale of personal information\n- Right to non-discrimination\n\n**To exercise your rights**, contact us at: [SUPPORT_EMAIL]\n\n## Children's Privacy\n\nOur App is **NOT intended for children under 13** (or 16 in the EU). We do not knowingly collect personal information from children. If you are a parent and believe your child has provided us with personal information, please contact us immediately.\n\n## Advertising and Tracking\n\n### Personalized Ads\nWe use advertising IDs to show personalized ads. You can opt-out:\n\n**Android**: Settings â†’ Google â†’ Ads â†’ Opt out of Ads Personalization\n**iOS**: Settings â†’ Privacy â†’ Tracking â†’ Disable \"Allow Apps to Request to Track\"\n\n### Do Not Track\nWe currently do not respond to Do Not Track (DNT) signals.\n\n## International Data Transfers\n\nYour information may be transferred to and processed in countries outside your country of residence. We ensure appropriate safeguards are in place (e.g., Standard Contractual Clauses).\n\n## Changes to This Privacy Policy\n\nWe may update this Privacy Policy from time to time. We will notify you of any changes by:\n\n- Posting the new Privacy Policy on this page\n- Updating the \"Last Updated\" date\n- Sending an in-app notification (for material changes)\n\n## Contact Us\n\nIf you have questions or concerns about this Privacy Policy, please contact us:\n\n**Email**: [SUPPORT_EMAIL]\n**Address**: [YOUR_COMPANY_ADDRESS]\n**Website**: [YOUR_WEBSITE]\n\n---\n\n## Data Safety Information (For App Stores)\n\n### Data Collected\nâœ… Photos and Videos - For app functionality (AI processing)\nâœ… Device Identifiers - For advertising\nâœ… App Activity - For analytics\n\n### Data Usage\nâœ… App Functionality - Image processing\nâœ… Advertising - Personalized ads\nâœ… Analytics - Usage statistics\n\n### Data Sharing\nâœ… Third-party service providers (Supabase, Huggingface, Replicate)\nâœ… Advertising partners (AdMob, AppLovin)\n\n### Data Security\nâœ… Data encrypted in transit (HTTPS)\nâœ… Data encrypted at rest (Supabase)\n\n### User Controls\nâœ… Request data deletion via email\nâœ… Opt-out of personalized ads in device settings\n\n---\n\n**End of Privacy Policy**\n\n---\n\n## ðŸ“ Customization Checklist\n\nBefore publishing, replace:\n- [ ] `[DATE]` - Current date\n- [ ] `[SUPPORT_EMAIL]` - Your support email (from SUPPORT_EMAIL env var)\n- [ ] `[X]` months - Data retention period\n- [ ] `[YOUR_COMPANY_ADDRESS]` - Your legal business address\n- [ ] `[YOUR_WEBSITE]` - Your company website\n- [ ] Add any additional third-party services you use\n- [ ] Get legal review (recommended)\n- [ ] Host on HTTPS URL (GitHub Pages, Netlify, or your domain)\n\n## ðŸŒ Where to Host Privacy Policy\n\n**Option 1: GitHub Pages (Free)**\n1. Create `privacy-policy.html` from this template\n2. Push to GitHub repo\n3. Enable GitHub Pages in Settings\n4. URL: `https://username.github.io/repo/privacy-policy.html`\n\n**Option 2: Your Website**\n- Host at `https://yourdomain.com/privacy-policy`\n\n**Option 3: Free Privacy Policy Generators**\n- Termly.io\n- TermsFeed.com\n- PrivacyPolicies.com\n\n**âš ï¸ Requirements:**\n- Must be publicly accessible (HTTPS)\n- Cannot be editable (no Google Docs in edit mode)\n- Must be specific to your app (not generic)\n","size_bytes":7430},"build_production_ios.sh":{"content":"#!/bin/zsh\n\n# Production iOS IPA Build Script for Apple App Store\n# This script builds a release IPA with obfuscation for App Store submission\n\necho \"ðŸŽ Building Production iOS IPA for Apple App Store...\"\n\n# Check if prod.json exists\nif [ ! -f prod.json ]; then\n    echo \"âŒ Error: prod.json not found!\"\n    echo \"Please create prod.json with your production API keys\"\n    echo \"Use .env.example as template\"\n    exit 1\nfi\n\n# Check Xcode version\nXCODE_VERSION=$(xcodebuild -version | head -n 1 | awk '{print $2}')\nXCODE_MAJOR=$(echo $XCODE_VERSION | cut -d. -f1)\n\nif [ \"$XCODE_MAJOR\" -lt 16 ]; then\n    echo \"âš ï¸  Warning: Xcode version $XCODE_VERSION detected\"\n    echo \"Apple requires Xcode 16+ for App Store submissions in 2025\"\n    echo \"Please update Xcode from Mac App Store\"\n    echo \"\"\n    read -p \"Continue anyway? (y/N): \" -n 1 -r\n    echo\n    if [[ ! $REPLY =~ ^[Yy]$ ]]; then\n        exit 1\n    fi\nfi\n\n# Clean previous build\necho \"ðŸ§¹ Cleaning previous build...\"\nflutter clean\n\n# Get dependencies\necho \"ðŸ“¦ Getting dependencies...\"\nflutter pub get\n\n# Install CocoaPods\necho \"ðŸ“± Installing CocoaPods dependencies...\"\ncd ios\npod install\ncd ..\n\n# Build production IPA\necho \"ðŸ”¨ Building release IPA with obfuscation...\"\nflutter build ipa \\\n  --release \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --dart-define-from-file=prod.json\n\n# Check if build succeeded\nif [ $? -eq 0 ]; then\n    echo \"\"\n    echo \"âœ… Build successful!\"\n    echo \"\"\n    echo \"ðŸ“¦ Archive location:\"\n    ls -d build/ios/archive/*.xcarchive\n    echo \"\"\n    echo \"ðŸ“¤ Next steps:\"\n    echo \"1. Open Xcode: Window â†’ Organizer\"\n    echo \"2. Select the latest archive (Runner)\"\n    echo \"3. Click 'Validate App' to check for issues\"\n    echo \"4. Click 'Distribute App' to upload to App Store Connect\"\n    echo \"5. Monitor upload status in App Store Connect â†’ Activities\"\n    echo \"\"\n    echo \"Alternative - Open archive in Xcode:\"\n    echo \"  open build/ios/archive/Runner.xcarchive\"\n    echo \"\"\nelse\n    echo \"\"\n    echo \"âŒ Build failed! Check errors above.\"\n    exit 1\nfi\n","size_bytes":2083},"FIREBASE_REMOTE_CONFIG_SETUP.md":{"content":"# ðŸ”¥ Firebase Remote Config Setup Guide - Báº­t/Táº¯t Ads Tá»« Xa\n\n## ðŸ“‹ TÃ“M Táº®T\n\nGuide nÃ y hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch setup **Firebase Remote Config** Ä‘á»ƒ:\n- âœ… Báº­t/táº¯t ads tá»« xa (khÃ´ng cáº§n update app)\n- âœ… Control banner ads, rewarded ads riÃªng biá»‡t\n- âœ… Marketing strategy: Táº¯t ads khi 0-5k users â†’ Báº­t ads khi 5k-10k users\n- âœ… 100% policy-compliant (Google official solution)\n\n---\n\n## ðŸš€ BÆ¯á»šC 1: Táº O FIREBASE PROJECT\n\n### 1.1. Táº¡o Project (hoáº·c dÃ¹ng project cÃ³ sáºµn)\n\n1. VÃ o [Firebase Console](https://console.firebase.google.com)\n2. Click **\"Add project\"** (hoáº·c chá»n project hiá»‡n táº¡i)\n3. Äiá»n tÃªn project: `viso-ai-photo-avatar` (hoáº·c tÃªn tÃ¹y chá»n)\n4. Enable Google Analytics (recommended)\n5. Click **\"Create project\"**\n\n---\n\n## ðŸ“± BÆ¯á»šC 2: THÃŠM ANDROID APP\n\n### 2.1. ThÃªm Android App vÃ o Firebase\n\n1. Trong Firebase Console, click **âš™ï¸ Project Settings**\n2. Click **\"Add app\"** â†’ Chá»n **Android** icon\n3. Äiá»n thÃ´ng tin:\n   ```\n   Android package name: com.visoai.photoheadshot\n   App nickname (optional): Viso AI Android\n   Debug signing certificate SHA-1: (optional, bá» qua)\n   ```\n4. Click **\"Register app\"**\n\n### 2.2. Download google-services.json\n\n1. Click **\"Download google-services.json\"**\n2. Copy file vÃ o project táº¡i: `android/app/google-services.json`\n\n### 2.3. Cáº¥u hÃ¬nh Android (ÄÃ£ cÃ³ sáºµn)\n\nFirebase SDK Ä‘Ã£ Ä‘Æ°á»£c setup sáºµn trong project nÃ y. Verify file `android/build.gradle`:\n\n```gradle\n// ÄÃ£ cÃ³: Google Services plugin\nbuildscript {\n    dependencies {\n        classpath 'com.google.gms:google-services:4.4.2'\n    }\n}\n```\n\nFile `android/app/build.gradle`:\n\n```gradle\n// ÄÃ£ cÃ³: Apply plugin\napply plugin: 'com.google.gms.google-services'\n```\n\n---\n\n## ðŸŽ BÆ¯á»šC 3: THÃŠM iOS APP\n\n### 3.1. ThÃªm iOS App vÃ o Firebase\n\n1. Trong Firebase Console, click **\"Add app\"** â†’ Chá»n **iOS** icon\n2. Äiá»n thÃ´ng tin:\n   ```\n   iOS bundle ID: com.visoai.photoheadshot\n   App nickname (optional): Viso AI iOS\n   App Store ID: (bá» qua náº¿u chÆ°a publish)\n   ```\n3. Click **\"Register app\"**\n\n### 3.2. Download GoogleService-Info.plist\n\n1. Click **\"Download GoogleService-Info.plist\"**\n2. Copy file vÃ o project:\n   - **Manual:** Äáº·t trong `ios/Runner/GoogleService-Info.plist`\n   - **Xcode:** Drag & drop vÃ o `Runner` folder (recommended)\n\n### 3.3. Cáº¥u hÃ¬nh iOS (ÄÃ£ cÃ³ sáºµn)\n\nFirebase SDK Ä‘Ã£ Ä‘Æ°á»£c setup sáºµn. Verify file `ios/Runner/Info.plist`:\n\n```xml\n<!-- ÄÃ£ cÃ³: Google Services URL Scheme -->\n<key>CFBundleURLTypes</key>\n<array>\n    <dict>\n        <key>CFBundleURLSchemes</key>\n        <array>\n            <string>REVERSED_CLIENT_ID</string>\n        </array>\n    </dict>\n</array>\n```\n\n---\n\n## ðŸŒ BÆ¯á»šC 4: THÃŠM WEB APP (Optional)\n\n### 4.1. ThÃªm Web App\n\n1. Click **\"Add app\"** â†’ Chá»n **Web** icon (</> icon)\n2. Äiá»n App nickname: `Viso AI Web`\n3. âœ… Check **\"Also set up Firebase Hosting\"** (recommended)\n4. Click **\"Register app\"**\n\n### 4.2. Copy Firebase Config\n\nFirebase sáº½ hiá»ƒn thá»‹ config code:\n\n```javascript\nconst firebaseConfig = {\n  apiKey: \"AIzaSy...\",\n  authDomain: \"viso-ai-....firebaseapp.com\",\n  projectId: \"viso-ai-...\",\n  storageBucket: \"viso-ai-....appspot.com\",\n  messagingSenderId: \"...\",\n  appId: \"1:...:web:...\",\n  measurementId: \"G-...\"\n};\n```\n\n**âœ… DONE - File `lib/firebase_options.dart` Ä‘Ã£ Ä‘Æ°á»£c táº¡o vá»›i config thá»±c táº¿:**\n\n```dart\nimport 'package:firebase_core/firebase_core.dart' show FirebaseOptions;\nimport 'package:flutter/foundation.dart' show defaultTargetPlatform, kIsWeb, TargetPlatform;\n\nclass DefaultFirebaseOptions {\n  static FirebaseOptions get currentPlatform {\n    if (kIsWeb) {\n      return web;\n    }\n    switch (defaultTargetPlatform) {\n      case TargetPlatform.android:\n        return android;\n      case TargetPlatform.iOS:\n        return ios;\n      case TargetPlatform.macOS:\n        return ios;\n      default:\n        throw UnsupportedError('Unsupported platform');\n    }\n  }\n\n  static const FirebaseOptions web = FirebaseOptions(\n    apiKey: 'AIzaSyC2VGc-o0LbF10JHn-nRU53chEY5FiXO_c',\n    authDomain: 'viso-ai-photo-avatar.firebaseapp.com',\n    projectId: 'viso-ai-photo-avatar',\n    storageBucket: 'viso-ai-photo-avatar.firebasestorage.app',\n    messagingSenderId: '987545828793',\n    appId: '1:987545828793:web:8ae2e8f8feda5c44bb4a68',\n    measurementId: 'G-ETCJCW0GDT',\n  );\n\n  static const FirebaseOptions android = FirebaseOptions(\n    apiKey: 'AIzaSyCbqiWSgg7FqVt3luFUerAibXk97lnxYaE',\n    appId: '1:987545828793:android:7c1fbb39b74255a4bb4a68',\n    messagingSenderId: '987545828793',\n    projectId: 'viso-ai-photo-avatar',\n    storageBucket: 'viso-ai-photo-avatar.firebasestorage.app',\n  );\n\n  static const FirebaseOptions ios = FirebaseOptions(\n    apiKey: 'AIzaSyATFSyLkOYrpLvQ87Qu6_grUUkmuBaL9ak',\n    appId: '1:987545828793:ios:836edababf0b4769bb4a68',\n    messagingSenderId: '987545828793',\n    projectId: 'viso-ai-photo-avatar',\n    storageBucket: 'viso-ai-photo-avatar.firebasestorage.app',\n    iosBundleId: 'com.visoai.photoheadshot',\n  );\n}\n```\n\n**âœ… DONE - `main.dart` Ä‘Ã£ Ä‘Æ°á»£c update:**\n\n```dart\nimport 'firebase_options.dart';\n\nvoid main() async {\n  await Firebase.initializeApp(\n    options: DefaultFirebaseOptions.currentPlatform,\n  );\n  // ...\n}\n```\n\n---\n\n## âš™ï¸ BÆ¯á»šC 5: SETUP REMOTE CONFIG PARAMETERS\n\n### 5.1. VÃ o Remote Config\n\n1. Firebase Console â†’ **Engage** â†’ **Remote Config**\n2. Click **\"Create configuration\"**\n\n### 5.2. Táº¡o Parameters\n\nClick **\"Add parameter\"** cho tá»«ng parameter sau:\n\n#### **Parameter 1: ads_enabled**\n```\nParameter key: ads_enabled\nData type: Boolean\nDefault value: false  â† Báº®T Äáº¦U Vá»šI FALSE (marketing phase)\nDescription: Master switch to enable/disable all ads\n```\n\n#### **Parameter 2: banner_ads_enabled**\n```\nParameter key: banner_ads_enabled\nData type: Boolean\nDefault value: false\nDescription: Control banner ads in bottom navigation\n```\n\n#### **Parameter 3: rewarded_ads_enabled**\n```\nParameter key: rewarded_ads_enabled\nData type: Boolean\nDefault value: false\nDescription: Control rewarded ads (face swap, etc.)\n```\n\n#### **Parameter 4: interstitial_ads_enabled**\n```\nParameter key: interstitial_ads_enabled\nData type: Boolean\nDefault value: false\nDescription: Control interstitial ads (future use)\n```\n\n#### **Parameter 5: app_open_ads_enabled**\n```\nParameter key: app_open_ads_enabled\nData type: Boolean\nDefault value: false\nDescription: Control app open ads (shown on app launch/resume)\n```\n\n#### **Parameter 6: native_ads_enabled**\n```\nParameter key: native_ads_enabled\nData type: Boolean\nDefault value: false\nDescription: Control native ads (future use)\n```\n\n#### **Parameter 7: min_user_count_for_ads**\n```\nParameter key: min_user_count_for_ads\nData type: Number\nDefault value: 5000\nDescription: Minimum user count before enabling ads\n```\n\n### 5.3. Publish Changes\n\n1. Click **\"Publish changes\"**\n2. Confirm vá»›i **\"Publish\"**\n\nâœ… **Remote Config Ä‘Ã£ sáºµn sÃ ng!**\n\n---\n\n## ðŸŽ® BÆ¯á»šC 6: TEST REMOTE CONFIG\n\n### 6.1. Build & Run App\n\n**Web:**\n```bash\nflutter run -d chrome\n```\n\n**Android:**\n```bash\nflutter run\n```\n\n**iOS:**\n```bash\nflutter run\n```\n\n### 6.2. Check Console Logs\n\nKhi app khá»Ÿi Ä‘á»™ng, anh sáº½ tháº¥y logs:\n\n```\nâœ… Firebase initialized\nâœ… Remote Config initialized\n   - ads_enabled: false\n   - banner_ads_enabled: false\n   - rewarded_ads_enabled: false\n   - app_open_ads_enabled: false\n   - native_ads_enabled: false\nðŸš« Ads disabled via Remote Config - skipping ad initialization\n```\n\n### 6.3. Verify Ads Disabled\n\n- âœ… Bottom navigation KHÃ”NG cÃ³ ad banner\n- âœ… Face swap button KHÃ”NG yÃªu cáº§u xem ads (proceed trá»±c tiáº¿p)\n- âœ… Console log: \"ðŸš« Rewarded ads disabled via Remote Config\"\n\n---\n\n## ðŸ“ˆ BÆ¯á»šC 7: Báº¬T ADS THEO CHIáº¾N LÆ¯á»¢C\n\n### 7.1. Marketing Phase (0-5k users)\n\n**Firebase Console â†’ Remote Config:**\n\n```\nads_enabled = false\nbanner_ads_enabled = false\nrewarded_ads_enabled = false\napp_open_ads_enabled = false\nnative_ads_enabled = false\n```\n\n**Click \"Publish changes\"**\n\n**Káº¿t quáº£:**\n- âœ… User download app â†’ KHÃ”NG tháº¥y ads\n- âœ… Tráº£i nghiá»‡m mÆ°á»£t mÃ  â†’ Retention cao\n- âœ… Word-of-mouth marketing tá»‘t\n\n### 7.2. Monetization Phase (5k+ users)\n\n**Firebase Console â†’ Remote Config:**\n\n```\nads_enabled = true              â† Toggle to TRUE (master switch)\nbanner_ads_enabled = true       â† Enable banner ads\nrewarded_ads_enabled = true     â† Enable rewarded ads\napp_open_ads_enabled = true     â† Enable app open ads\nnative_ads_enabled = false      â† Keep disabled (future use)\n```\n\n**Click \"Publish changes\"**\n\n**Káº¿t quáº£:**\n- âœ… Ads báº­t NGAY Láº¬P Tá»¨C (khÃ´ng cáº§n update app!)\n- âœ… User hiá»‡n táº¡i: Báº¯t Ä‘áº§u tháº¥y ads\n- âœ… User má»›i: Tháº¥y ads tá»« Ä‘áº§u\n\n### 7.3. Verify Changes\n\n**User má»Ÿ app láº¡i:**\n```\nâœ… Firebase initialized\nâœ… Remote Config initialized\n   - ads_enabled: true          â† Changed!\n   - banner_ads_enabled: true\n   - rewarded_ads_enabled: true\n   - app_open_ads_enabled: true\n   - native_ads_enabled: false\nðŸ“¢ Ads enabled via Remote Config - initializing ad services\n```\n\n- âœ… Bottom navigation cÃ³ ad banner\n- âœ… Face swap yÃªu cáº§u xem rewarded ad\n- âœ… Ads hoáº¡t Ä‘á»™ng bÃ¬nh thÆ°á»ng\n\n---\n\n## ðŸŽ¯ BÆ¯á»šC 8: ADVANCED - CONDITIONAL TARGETING\n\n### 8.1. Add Conditions (Optional)\n\nFirebase Remote Config há»— trá»£ targeting theo:\n- **Country/Region**: Báº­t ads chá»‰ á»Ÿ US, táº¯t á»Ÿ Vietnam\n- **App Version**: Báº­t ads tá»« version 1.2.0+\n- **User Property**: Táº¯t ads cho premium users\n- **Random Percentile**: A/B testing (50% users tháº¥y ads)\n\n**VÃ­ dá»¥: Táº¯t ads cho Vietnam (marketing):**\n\n1. Click **\"Add condition\"** trong Remote Config\n2. Chá»n **\"User in region/country\"**\n3. Select **\"Vietnam\"**\n4. Set value: `ads_enabled = false`\n5. Default (other countries): `ads_enabled = true`\n\n### 8.2. User Property - Premium Users\n\n**In app code:**\n\n```dart\nimport 'package:firebase_analytics/firebase_analytics.dart';\n\n// Set user property\nawait FirebaseAnalytics.instance.setUserProperty(\n  name: 'user_type',\n  value: 'premium',\n);\n```\n\n**Firebase Console:**\n\n1. Add condition â†’ **\"User property\"**\n2. Property: `user_type`\n3. Operator: `exactly matches`\n4. Value: `premium`\n5. Set: `ads_enabled = false`\n\n---\n\n## ðŸ”„ BÆ¯á»šC 9: UPDATE & REFRESH FLOW\n\n### 9.1. App Lifecycle Refresh\n\nCode Ä‘Ã£ tá»± Ä‘á»™ng refresh khi app resume:\n\n```dart\n// In main.dart\n@override\nvoid didChangeAppLifecycleState(AppLifecycleState state) {\n  if (state == AppLifecycleState.resumed) {\n    RemoteConfigService().refresh();\n  }\n}\n```\n\n### 9.2. Manual Refresh (Optional)\n\nThÃªm button trong Settings page:\n\n```dart\nElevatedButton(\n  onPressed: () async {\n    await RemoteConfigService().refresh();\n    ScaffoldMessenger.of(context).showSnackBar(\n      SnackBar(content: Text('Config updated!')),\n    );\n  },\n  child: Text('Refresh Ads Config'),\n)\n```\n\n### 9.3. Fetch Intervals\n\n**Development:**\n```dart\nminimumFetchInterval: const Duration(minutes: 1),  // Test nhanh\n```\n\n**Production:**\n```dart\nminimumFetchInterval: const Duration(hours: 12),  // Tiáº¿t kiá»‡m quota\n```\n\n---\n\n## âš ï¸ TROUBLESHOOTING\n\n### Issue 1: Firebase not initialized\n\n**Error:**\n```\nâŒ Firebase not configured (will use defaults)\n```\n\n**Fix:**\n1. Verify `google-services.json` (Android) trong `android/app/`\n2. Verify `GoogleService-Info.plist` (iOS) trong `ios/Runner/`\n3. Verify `firebase_options.dart` cÃ³ Ä‘Ãºng API keys\n\n### Issue 2: Remote Config returns default values\n\n**Possible causes:**\n1. ChÆ°a publish changes trong Firebase Console\n2. Fetch interval chÆ°a háº¿t (Ä‘á»£i 1 phÃºt hoáº·c restart app)\n3. Network issue (check internet connection)\n\n**Fix:**\n```dart\n// Force fetch immediately (debug only)\nawait _remoteConfig.setConfigSettings(RemoteConfigSettings(\n  fetchTimeout: const Duration(seconds: 10),\n  minimumFetchInterval: Duration.zero,  // No caching\n));\nawait _remoteConfig.fetchAndActivate();\n```\n\n### Issue 3: Ads váº«n hiá»‡n dÃ¹ remote config = false\n\n**Check:**\n1. Xem console logs Ä‘á»ƒ verify remote config values\n2. Clear app data vÃ  reinstall\n3. Verify code check remote config trÆ°á»›c khi show ads:\n\n```dart\nif (RemoteConfigService().adsEnabled) {\n  // Show ads\n}\n```\n\n---\n\n## ðŸ“Š MONITORING & ANALYTICS\n\n### 10.1. Check Firebase Analytics\n\n1. Firebase Console â†’ **Analytics** â†’ **Events**\n2. Monitor events:\n   - `remote_config_fetched`\n   - `remote_config_activated`\n   - Ad events (impressions, clicks)\n\n### 10.2. A/B Testing (Advanced)\n\n1. Firebase Console â†’ **A/B Testing**\n2. Create experiment:\n   - **Goal:** Optimize ad revenue\n   - **Variant A:** `ads_enabled = false` (50% users)\n   - **Variant B:** `ads_enabled = true` (50% users)\n3. Track metrics:\n   - Revenue per user\n   - Retention rate\n   - Session duration\n\n---\n\n## âœ… FINAL CHECKLIST\n\n### Firebase Setup:\n- [ ] Firebase project created\n- [ ] Android app added + google-services.json downloaded\n- [ ] iOS app added + GoogleService-Info.plist downloaded\n- [ ] Web app added (optional) + firebase_options.dart created\n- [ ] Remote Config parameters created (ads_enabled, banner_ads_enabled, etc.)\n- [ ] Default values set (false for marketing phase)\n- [ ] Changes published\n\n### App Integration:\n- [ ] Dependencies installed (firebase_core, firebase_remote_config)\n- [ ] RemoteConfigService created\n- [ ] main.dart updated (initialize Firebase + Remote Config)\n- [ ] Ads initialization conditional on remote config\n- [ ] Bottom navigation checks remote config\n- [ ] Rewarded ads check remote config\n- [ ] Console logs verify remote config values\n\n### Testing:\n- [ ] App builds successfully\n- [ ] Remote Config fetched on launch\n- [ ] Ads disabled when remote config = false\n- [ ] Ads enabled when remote config = true\n- [ ] Toggle in Firebase Console works instantly\n\n---\n\n## ðŸŽ‰ DONE!\n\nAnh Ä‘Ã£ setup xong Firebase Remote Config! Giá» anh cÃ³ thá»ƒ:\n\n1. **Marketing Phase:** Toggle `ads_enabled = false` â†’ KhÃ´ng ads, giá»¯ users\n2. **Monetization Phase:** Toggle `ads_enabled = true` â†’ Báº­t ads ngay láº­p tá»©c\n3. **Premium Users:** Set condition `user_type = premium` â†’ Táº¯t ads\n4. **A/B Testing:** Test 50% users cÃ³ ads, 50% khÃ´ng ads â†’ Tá»‘i Æ°u revenue\n\n**ðŸš€ Chiáº¿n lÆ°á»£c thÃ nh cÃ´ng!**\n\n---\n\n## ðŸ“ž SUPPORT\n\nCÃ³ váº¥n Ä‘á»? Check:\n1. Console logs khi app khá»Ÿi Ä‘á»™ng\n2. Firebase Console â†’ Remote Config â†’ Published values\n3. `SECURITY_AND_REMOTE_ADS_GUIDE.md` Ä‘á»ƒ hiá»ƒu cÃ¡ch hoáº¡t Ä‘á»™ng\n\n**Happy monetizing! ðŸ’°**\n","size_bytes":14534},"QUICK_PRODUCTION_COMMANDS.md":{"content":"# âš¡ Quick Production Build Commands\n\n## ðŸ“‹ Prerequisites\n\n1. **Create prod.json** (REAL API keys):\n   ```bash\n   cp prod.json.example prod.json\n   # Edit prod.json with your production keys\n   ```\n\n2. **Android**: Create upload keystore (first time only):\n   ```bash\n   keytool -genkey -v -keystore upload-keystore.jks \\\n     -keyalg RSA -keysize 2048 -validity 10000 \\\n     -alias upload\n   \n   # Create android/key.properties with keystore info\n   ```\n\n3. **iOS**: Enroll in Apple Developer Program ($99/year)\n\n---\n\n## ðŸ¤– Android Production (Google Play Store)\n\n### Build AAB:\n```bash\nchmod +x build_production_android.sh\n./build_production_android.sh\n```\n\n### Manual build:\n```bash\nflutter build appbundle \\\n  --release \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --dart-define-from-file=prod.json\n```\n\n**Output:** `build/app/outputs/bundle/release/app-release.aab`\n\n**Upload to:** https://play.google.com/console\n\n---\n\n## ðŸŽ iOS Production (Apple App Store)\n\n### Build IPA:\n```bash\nchmod +x build_production_ios.sh\n./build_production_ios.sh\n```\n\n### Manual build:\n```bash\nflutter build ipa \\\n  --release \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --dart-define-from-file=prod.json\n```\n\n**Output:** `build/ios/archive/Runner.xcarchive`\n\n**Upload via Xcode:**\n1. Window â†’ Organizer\n2. Validate App\n3. Distribute App\n\n**Upload to:** https://appstoreconnect.apple.com\n\n---\n\n## ðŸ“ Required Files\n\n### Android:\n- âœ… `prod.json` - Production API keys\n- âœ… `upload-keystore.jks` - App signing key\n- âœ… `android/key.properties` - Keystore config\n- âœ… Privacy policy URL (hosted on HTTPS)\n- âœ… Data Safety Form (in Play Console)\n\n### iOS:\n- âœ… `prod.json` - Production API keys\n- âœ… `ios/Runner/PrivacyInfo.xcprivacy` - Privacy manifest\n- âœ… Privacy policy URL (hosted on HTTPS)\n- âœ… App Store Connect info complete\n\n---\n\n## ðŸ” Security Checklist\n\n- [ ] NEVER commit `prod.json` to Git\n- [ ] NEVER commit `upload-keystore.jks` to Git\n- [ ] NEVER commit `android/key.properties` to Git\n- [ ] Always use `--obfuscate` for production\n- [ ] Store keystore backup safely (1Password, etc.)\n- [ ] Use REAL API keys (not test keys)\n\n---\n\n## ðŸ“Š Version Management\n\nUpdate version before each release:\n\n**Edit `pubspec.yaml`:**\n```yaml\nversion: 1.2.3+4\n#       ^^^ Version name (users see)\n#           ^ Build number (must increment)\n```\n\n---\n\n## ðŸ› Common Issues\n\n### Android: \"Target SDK version too low\"\n**Fix:** Set `targetSdkVersion 35` in `android/app/build.gradle`\n\n### iOS: \"Missing API declaration\"\n**Fix:** Add Required Reason APIs to `PrivacyInfo.xcprivacy`\n\n### Both: \"Secrets not found\"\n**Fix:** Ensure `prod.json` exists with all required keys\n\n---\n\n## ðŸ“š Full Documentation\n\nFor detailed instructions, see:\n- **PRODUCTION_BUILD_GUIDE.md** - Complete build & publish guide\n- **PRIVACY_POLICY_TEMPLATE.md** - Privacy policy template\n","size_bytes":2892},"PRODUCTION_BUILD_GUIDE.md":{"content":"# ðŸš€ HÆ°á»›ng Dáº«n Build Production - Google Play & App Store (2025)\n\n## ðŸ“‹ Tá»•ng Quan\n\nGuide nÃ y hÆ°á»›ng dáº«n chi tiáº¿t cÃ¡ch build, config vÃ  upload app lÃªn Google Play Store vÃ  Apple App Store theo Ä‘Ãºng chuáº©n policies 2025.\n\n---\n\n# ðŸ“± PHáº¦N 1: GOOGLE PLAY STORE (ANDROID)\n\n## âœ… Requirements Má»›i Nháº¥t (2025)\n\n### 1. **Format: AAB (KHÃ”NG pháº£i APK)**\n- Google Play **báº¯t buá»™c** Android App Bundle (.aab) tá»« 2021\n- APK chá»‰ dÃ¹ng Ä‘á»ƒ test local, KHÃ”NG Ä‘Æ°á»£c upload lÃªn Play Store\n\n### 2. **Target API Level 35 (Android 15)**\n- Tá»« **31/8/2025**: Táº¥t cáº£ app má»›i pháº£i target API 35+\n- Extension Ä‘áº¿n **1/11/2025** (náº¿u cáº§n)\n\n### 3. **16KB Page Size Support** (Tá»« 1/11/2025)\n- App pháº£i há»— trá»£ 16KB memory page size trÃªn 64-bit devices\n- Cáº§n Android Gradle Plugin (AGP) 8.5.1+\n\n---\n\n## ðŸ”§ BÆ°á»›c 1: Cáº¥u HÃ¬nh Build\n\n### 1.1. Update `android/app/build.gradle`\n\n```gradle\nandroid {\n    compileSdkVersion 35  // âœ… Báº¯t buá»™c 2025\n    \n    defaultConfig {\n        applicationId \"com.visoai.photoheadshot\"\n        minSdkVersion 21\n        targetSdkVersion 35  // âœ… Báº¯t buá»™c 2025\n        versionCode flutterVersionCode.toInteger()\n        versionName flutterVersionName\n        multiDexEnabled true\n    }\n}\n```\n\n### 1.2. Update `android/build.gradle`\n\n```gradle\nbuildscript {\n    dependencies {\n        classpath 'com.android.tools.build:gradle:8.5.1'  // âœ… Cáº§n 8.5.1+ cho 16KB\n    }\n}\n```\n\n### 1.3. Táº¡o Upload Keystore (Láº¦N Äáº¦U DUY NHáº¤T)\n\n```bash\n# Táº¡o keystore Ä‘á»ƒ sign app\nkeytool -genkey -v -keystore upload-keystore.jks \\\n  -keyalg RSA -keysize 2048 -validity 10000 \\\n  -alias upload\n\n# Nháº­p thÃ´ng tin:\n# - Password keystore\n# - Password key alias\n# - Há» tÃªn, tá»• chá»©c, thÃ nh phá»‘, quá»‘c gia\n```\n\n**âš ï¸ QUAN TRá»ŒNG:** LÆ°u file `upload-keystore.jks` vÃ  passwords an toÃ n! Máº¥t keystore = khÃ´ng update app Ä‘Æ°á»£c!\n\n### 1.4. Táº¡o `android/key.properties`\n\n```properties\nstorePassword=YOUR_STORE_PASSWORD\nkeyPassword=YOUR_KEY_PASSWORD\nkeyAlias=upload\nstoreFile=../upload-keystore.jks\n```\n\n### 1.5. Config Signing trong `android/app/build.gradle`\n\n```gradle\n// ThÃªm trÆ°á»›c android {}\ndef keystoreProperties = new Properties()\ndef keystorePropertiesFile = rootProject.file('key.properties')\nif (keystorePropertiesFile.exists()) {\n    keystoreProperties.load(new FileInputStream(keystorePropertiesFile))\n}\n\nandroid {\n    ...\n    signingConfigs {\n        release {\n            keyAlias keystoreProperties['keyAlias']\n            keyPassword keystoreProperties['keyPassword']\n            storeFile keystoreProperties['storeFile'] ? file(keystoreProperties['storeFile']) : null\n            storePassword keystoreProperties['storePassword']\n        }\n    }\n    buildTypes {\n        release {\n            signingConfig signingConfigs.release\n            minifyEnabled true\n            shrinkResources true\n        }\n    }\n}\n```\n\n### 1.6. Update `.gitignore`\n\n```gitignore\n# Keystore files\n*.jks\n*.keystore\nkey.properties\n\n# Environment configs\nsecrets.env\nprod.json\n```\n\n---\n\n## ðŸ”‘ BÆ°á»›c 2: Secrets Management\n\n### 2.1. Táº¡o `prod.json` cho production\n\n```json\n{\n  \"SUPABASE_URL\": \"https://your-project.supabase.co\",\n  \"SUPABASE_ANON_KEY\": \"your_production_anon_key\",\n  \"HUGGINGFACE_TOKEN\": \"hf_xxxxxxxxxxxxx\",\n  \"REPLICATE_API_TOKEN\": \"r8_xxxxxxxxxxxxx\",\n  \"ADMOB_APP_ID_ANDROID\": \"ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX\",\n  \"ADMOB_REWARDED_AD_UNIT_ID\": \"ca-app-pub-XXXXXXXXXXXXXXXX/XXXXXXXXXX\",\n  \"APPLOVIN_SDK_KEY\": \"your_production_applovin_key\",\n  \"SUPPORT_EMAIL\": \"support@yourdomain.com\"\n}\n```\n\n**âš ï¸ LÆ¯U Ã:** \n- DÃ¹ng **REAL API keys** cho production\n- KHÃ”NG commit file nÃ y lÃªn Git\n- Store trong password manager (1Password, LastPass, etc.)\n\n---\n\n## ðŸ“± BÆ°á»›c 3: Permissions & Privacy\n\n### 3.1. Permissions ÄÃ£ CÃ³ (AndroidManifest.xml)\n\nApp hiá»‡n táº¡i xin cÃ¡c permissions:\n```xml\nâœ… INTERNET - Káº¿t ná»‘i API\nâœ… WRITE_EXTERNAL_STORAGE (API â‰¤32) - LÆ°u áº£nh (Android 12-)\nâœ… READ_EXTERNAL_STORAGE (API â‰¤32) - Äá»c áº£nh (Android 12-)\nâœ… READ_MEDIA_IMAGES (API 33+) - Äá»c áº£nh (Android 13+)\n```\n\n### 3.2. Runtime Permissions (ÄÃ£ Implement)\n\nApp Ä‘Ã£ implement runtime permission requests trong code:\n- `permission_handler` package tá»± Ä‘á»™ng request quyá»n khi cáº§n\n- User pháº£i approve má»—i permission lÃºc runtime\n\n---\n\n## ðŸ“„ BÆ°á»›c 4: Privacy Policy & Data Safety\n\n### 4.1. Privacy Policy (Báº®T BUá»˜C)\n\n**YÃªu cáº§u:**\n- âœ… Host trÃªn URL public (HTTPS)\n- âœ… KHÃ”NG dÃ¹ng Google Docs editable\n- âœ… DÃ¹ng domain riÃªng hoáº·c GitHub Pages\n\n**Ná»™i dung Báº®T BUá»˜C pháº£i cÃ³:**\n1. **Data Collection** - Dá»¯ liá»‡u gÃ¬ Ä‘Æ°á»£c thu tháº­p\n2. **Data Usage** - DÃ¹ng Ä‘á»ƒ lÃ m gÃ¬\n3. **Third-party Sharing** - Chia sáº» vá»›i ai (Supabase, Huggingface, Replicate, AdMob, AppLovin)\n4. **User Rights** - Quyá»n xÃ³a data, export data\n5. **Security Practices** - Báº£o máº­t nhÆ° tháº¿ nÃ o\n6. **Contact Info** - Email support, Ä‘á»‹a chá»‰ cÃ´ng ty\n\n**Template Privacy Policy:** (Xem file `PRIVACY_POLICY_TEMPLATE.md`)\n\n### 4.2. Data Safety Form (Google Play Console)\n\nKhi upload app, pháº£i Ä‘iá»n form nÃ y:\n\n**Data Types Collected:**\n- âœ… **Photos/Videos** - User upload áº£nh Ä‘á»ƒ xá»­ lÃ½ AI\n- âœ… **Device ID** - AdMob/AppLovin dÃ¹ng cho ads targeting\n- âœ… **App Activity** - Analytics tracking\n\n**Data Usage:**\n- âœ… App functionality - Xá»­ lÃ½ áº£nh AI\n- âœ… Advertising - Hiá»ƒn thá»‹ ads\n- âœ… Analytics - Theo dÃµi usage\n\n**Data Sharing:**\n- âœ… Supabase - Store áº£nh processed\n- âœ… Huggingface/Replicate - AI processing\n- âœ… AdMob/AppLovin - Ad networks\n\n---\n\n## ðŸ—ï¸ BÆ°á»›c 5: Build Production AAB\n\n### 5.1. Clean Build\n\n```bash\nflutter clean\nflutter pub get\n```\n\n### 5.2. Build Release AAB\n\n```bash\nflutter build appbundle \\\n  --release \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --dart-define-from-file=prod.json\n```\n\n**Flags giáº£i thÃ­ch:**\n- `--release` - Build production mode\n- `--obfuscate` - Báº£o vá»‡ code khá»i reverse engineering\n- `--split-debug-info` - TÃ¡ch debug symbols cho crash reporting\n- `--dart-define-from-file` - Inject secrets tá»« prod.json\n\n### 5.3. Verify Output\n\n```bash\n# File AAB á»Ÿ Ä‘Ã¢y:\nls -lh build/app/outputs/bundle/release/app-release.aab\n\n# Check size (thÆ°á»ng 20-50MB)\n```\n\n---\n\n## ðŸ“¤ BÆ°á»›c 6: Upload LÃªn Google Play Console\n\n### 6.1. Táº¡o App (Láº§n Äáº§u)\n\n1. VÃ o [Google Play Console](https://play.google.com/console)\n2. Click **Create App**\n3. Äiá»n thÃ´ng tin:\n   - App name: **Viso AI - Photo Avatar Headshot**\n   - Default language: **English (United States)**\n   - App type: **App**\n   - Free/Paid: **Free** (hoáº·c Paid náº¿u cÃ³ in-app purchase)\n\n### 6.2. Complete Store Listing\n\n**Main Store Listing:**\n- âœ… App name (tá»‘i Ä‘a 50 kÃ½ tá»±)\n- âœ… Short description (tá»‘i Ä‘a 80 kÃ½ tá»±)\n- âœ… Full description (tá»‘i Ä‘a 4000 kÃ½ tá»±)\n- âœ… App icon (512x512 PNG)\n- âœ… Screenshots (tá»‘i thiá»ƒu 2 áº£nh, tá»‘i Ä‘a 8 áº£nh)\n  - Phone: 16:9 hoáº·c 9:16\n  - Tablet: TÃ¹y chá»n\n- âœ… Feature graphic (1024x500 PNG)\n\n**App Content:**\n- âœ… Privacy policy URL\n- âœ… App access (full access hay cáº§n login?)\n- âœ… Ads declaration (Yes - app cÃ³ ads)\n- âœ… Content rating (Ä‘iá»n questionnaire)\n- âœ… Target audience (18+ recommended vÃ¬ cÃ³ AI content)\n- âœ… News app declaration (No)\n- âœ… COVID-19 contact tracing (No)\n- âœ… Data safety (Ä‘iá»n form)\n\n### 6.3. Upload AAB\n\n1. **Testing Track (Recommended First):**\n   - Release â†’ Testing â†’ Internal testing\n   - Upload `app-release.aab`\n   - Add testers (email addresses)\n   - Review & Start rollout\n\n2. **Production (Sau khi test xong):**\n   - Release â†’ Production\n   - Upload `app-release.aab`\n   - Review & Start rollout\n\n### 6.4. Review Process\n\n- â±ï¸ Thá»i gian: 1-7 ngÃ y\n- ðŸ“§ Sáº½ nháº­n email khi approved/rejected\n- âŒ Náº¿u rejected: Xem lÃ½ do, fix, upload láº¡i\n\n---\n\n## âœ… Android Checklist\n\n- [ ] Update `compileSdkVersion` & `targetSdkVersion` = 35\n- [ ] Update Android Gradle Plugin â‰¥ 8.5.1\n- [ ] Táº¡o upload keystore (láº§n Ä‘áº§u)\n- [ ] Config signing trong build.gradle\n- [ ] Táº¡o prod.json vá»›i REAL keys\n- [ ] Build AAB vá»›i --obfuscate\n- [ ] Host privacy policy URL\n- [ ] Complete Data Safety Form\n- [ ] Upload AAB lÃªn Internal Testing\n- [ ] Test trÃªn real devices\n- [ ] Promote to Production\n\n---\n\n# ðŸŽ PHáº¦N 2: APPLE APP STORE (iOS)\n\n## âœ… Requirements Má»›i Nháº¥t (2025)\n\n### 1. **Xcode 16+ & iOS 18 SDK** (Báº®T BUá»˜C)\n- Tá»« **April 2025**: Táº¥t cáº£ app pháº£i build vá»›i Xcode 16+\n- Deployment target: iOS 13+ váº«n OK (app cháº¡y trÃªn thiáº¿t bá»‹ cÅ© Ä‘Æ°á»£c)\n\n### 2. **Privacy Manifest** (Báº®T BUá»˜C tá»« 1/5/2024)\n- File `PrivacyInfo.xcprivacy` báº¯t buá»™c\n- Khai bÃ¡o Required Reason APIs\n- Third-party SDKs pháº£i cÃ³ privacy manifests\n\n### 3. **Apple Developer Program**\n- PhÃ­: **$99/nÄƒm** (báº¯t buá»™c Ä‘á»ƒ publish)\n\n---\n\n## ðŸ”§ BÆ°á»›c 1: Setup Development Environment\n\n### 1.1. Install/Update Xcode\n\n```bash\n# Download tá»« Mac App Store\n# Hoáº·c: https://developer.apple.com/xcode/\n\n# Set Xcode command-line tools\nsudo xcode-select --switch /Applications/Xcode.app\n\n# Verify\nxcodebuild -version  # Pháº£i â‰¥ 16.0\n```\n\n### 1.2. Update CocoaPods\n\n```bash\nsudo gem install cocoapods\npod repo update\n```\n\n### 1.3. Update Flutter & Dependencies\n\n```bash\nflutter upgrade\nflutter pub upgrade\nflutter clean\n```\n\n---\n\n## ðŸ”‘ BÆ°á»›c 2: iOS Privacy Manifest (Báº®T BUá»˜C)\n\n### 2.1. Táº¡o `PrivacyInfo.xcprivacy`\n\n1. Má»Ÿ `ios/Runner.xcworkspace` trong Xcode\n2. Right-click **Runner** folder â†’ New File\n3. Chá»n **iOS â†’ Resource â†’ App Privacy**\n4. Name: `PrivacyInfo.xcprivacy`\n5. Save vÃ o **Runner** folder\n\n### 2.2. Ná»™i Dung Privacy Manifest\n\n```xml\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\">\n<plist version=\"1.0\">\n<dict>\n    <!-- Tracking Declaration -->\n    <key>NSPrivacyTracking</key>\n    <true/>\n    \n    <!-- Required Reason APIs -->\n    <key>NSPrivacyAccessedAPITypes</key>\n    <array>\n        <!-- UserDefaults API -->\n        <dict>\n            <key>NSPrivacyAccessedAPIType</key>\n            <string>NSPrivacyAccessedAPICategoryUserDefaults</string>\n            <key>NSPrivacyAccessedAPITypeReasons</key>\n            <array>\n                <string>CA92.1</string> <!-- Store user preferences -->\n            </array>\n        </dict>\n        \n        <!-- File Timestamp API -->\n        <dict>\n            <key>NSPrivacyAccessedAPIType</key>\n            <string>NSPrivacyAccessedAPICategoryFileTimestamp</string>\n            <key>NSPrivacyAccessedAPITypeReasons</key>\n            <array>\n                <string>C617.1</string> <!-- Cache management -->\n            </array>\n        </dict>\n    </array>\n    \n    <!-- Data Collection -->\n    <key>NSPrivacyCollectedDataTypes</key>\n    <array>\n        <dict>\n            <key>NSPrivacyCollectedDataType</key>\n            <string>NSPrivacyCollectedDataTypePhotosorVideos</string>\n            <key>NSPrivacyCollectedDataTypeLinked</key>\n            <false/>\n            <key>NSPrivacyCollectedDataTypeTracking</key>\n            <false/>\n            <key>NSPrivacyCollectedDataTypePurposes</key>\n            <array>\n                <string>NSPrivacyCollectedDataTypePurposeAppFunctionality</string>\n            </array>\n        </dict>\n    </array>\n    \n    <!-- Tracking Domains -->\n    <key>NSPrivacyTrackingDomains</key>\n    <array>\n        <string>googleadservices.com</string>\n        <string>applovin.com</string>\n    </array>\n</dict>\n</plist>\n```\n\n**Approved Reason Codes:**\n- `CA92.1` - UserDefaults for app preferences\n- `C617.1` - File timestamps for cache\n- Xem Ä‘áº§y Ä‘á»§: [Apple Required Reason APIs](https://developer.apple.com/documentation/bundleresources/describing-use-of-required-reason-api)\n\n---\n\n## ðŸ“± BÆ°á»›c 3: Permissions & Info.plist\n\n### 3.1. Permissions ÄÃ£ CÃ³ (Info.plist)\n\n```xml\nâœ… NSPhotoLibraryUsageDescription - \"Viso AI needs access to your photo library to save your AI-generated images.\"\nâœ… NSPhotoLibraryAddUsageDescription - \"Viso AI needs permission to save AI-generated images to your photo library.\"\n```\n\n### 3.2. Camera Permission (Náº¿u cáº§n)\n\nNáº¿u app dÃ¹ng camera Ä‘á»ƒ chá»¥p áº£nh, thÃªm:\n\n```xml\n<key>NSCameraUsageDescription</key>\n<string>Viso AI needs camera access to take photos for AI processing.</string>\n```\n\n---\n\n## ðŸ—ï¸ BÆ°á»›c 4: Build Production IPA\n\n### 4.1. Update Version\n\nEdit `pubspec.yaml`:\n```yaml\nversion: 1.0.0+1\n#       ^^^ Version name (user sees)\n#           ^ Build number (increment má»—i láº§n upload)\n```\n\n### 4.2. Config Xcode Signing\n\n1. Má»Ÿ `ios/Runner.xcworkspace` trong Xcode\n2. Select **Runner** target\n3. Tab **Signing & Capabilities**:\n   - âœ… **Team**: Chá»n Apple Developer Team\n   - âœ… **Automatically manage signing**: Báº­t\n   - âœ… **Bundle Identifier**: `com.visoai.photoheadshot`\n\n### 4.3. Build IPA\n\n```bash\nflutter build ipa \\\n  --release \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --dart-define-from-file=prod.json\n```\n\n**Output:**\n- File IPA: `build/ios/ipa/*.ipa`\n- XCArchive: `build/ios/archive/Runner.xcarchive`\n\n---\n\n## ðŸ“¤ BÆ°á»›c 5: Upload LÃªn App Store\n\n### 5.1. Validate & Upload (Xcode)\n\n1. Má»Ÿ Xcode\n2. Menu: **Window â†’ Organizer**\n3. Tab **Archives** â†’ Chá»n archive má»›i nháº¥t\n4. Click **Validate App**:\n   - Chá»n distribution method: **App Store Connect**\n   - Chá»n distribution certificate\n   - Wait validation (2-5 phÃºt)\n5. Náº¿u validate OK â†’ Click **Distribute App**\n6. Monitor upload trong **Activities** tab\n\n### 5.2. App Store Connect Setup\n\n1. VÃ o [App Store Connect](https://appstoreconnect.apple.com)\n2. **My Apps â†’ + â†’ New App**\n3. Äiá»n thÃ´ng tin:\n   - **Platform**: iOS\n   - **Name**: Viso AI - Photo Avatar Headshot\n   - **Primary Language**: English (U.S.)\n   - **Bundle ID**: com.visoai.photoheadshot\n   - **SKU**: visoai-001 (unique identifier)\n\n### 5.3. Complete App Information\n\n**App Information:**\n- âœ… Category: Photo & Video\n- âœ… Subcategory: TÃ¹y chá»n\n- âœ… Content Rights: \"Does not use third-party content\"\n\n**Pricing:**\n- âœ… Price: Free (hoáº·c set giÃ¡)\n\n**App Privacy:**\n- âœ… Privacy Policy URL (báº¯t buá»™c)\n- âœ… Complete questionnaire vá» data collection\n\n**Age Rating:**\n- Complete questionnaire â†’ Likely 12+ or 17+ (vÃ¬ AI content)\n\n**App Review Information:**\n- âœ… Contact info (phone, email)\n- âœ… Demo account (náº¿u cáº§n login)\n- âœ… Notes cho reviewer\n\n**Version Information:**\n- âœ… Screenshots (tá»‘i thiá»ƒu):\n  - 6.5\" iPhone: 1242x2688 (2-10 áº£nh)\n  - 12.9\" iPad: 2048x2732 (optional)\n- âœ… Description (tá»‘i Ä‘a 4000 kÃ½ tá»±)\n- âœ… Keywords (tá»‘i Ä‘a 100 kÃ½ tá»±, cÃ¡ch nhau báº±ng dáº¥u pháº©y)\n- âœ… Support URL\n- âœ… Marketing URL (optional)\n\n### 5.4. Submit for Review\n\n1. Select build (tá»« Xcode upload)\n2. Complete all required fields\n3. Click **Submit for Review**\n4. Wait 1-7 days for approval\n\n---\n\n## âœ… iOS Checklist\n\n- [ ] Xcode 16+ installed\n- [ ] Apple Developer Program enrolled ($99/year)\n- [ ] Update CocoaPods\n- [ ] Create `PrivacyInfo.xcprivacy` vá»›i Required Reason APIs\n- [ ] Update Info.plist permissions\n- [ ] Config Xcode signing (Team, Bundle ID)\n- [ ] Táº¡o prod.json vá»›i REAL keys (iOS specific)\n- [ ] Build IPA vá»›i --obfuscate\n- [ ] Validate app trong Xcode Organizer\n- [ ] Upload to App Store Connect\n- [ ] Complete app information\n- [ ] Submit for review\n\n---\n\n# ðŸ” PHáº¦N 3: SECRETS MANAGEMENT BEST PRACTICES\n\n## ðŸ“ Cáº¥u TrÃºc Secrets Files\n\n```\nproject/\nâ”œâ”€â”€ .env/\nâ”‚   â”œâ”€â”€ dev.json          # Development (test keys)\nâ”‚   â”œâ”€â”€ staging.json      # Staging\nâ”‚   â””â”€â”€ prod.json         # Production (REAL keys)\nâ”œâ”€â”€ .env.example          # Template (commit vÃ o Git)\nâ””â”€â”€ .gitignore            # Cháº·n .env/ folder\n```\n\n## ðŸ”‘ Prod.json Template (Android & iOS)\n\n```json\n{\n  \"SUPABASE_URL\": \"https://xxxxx.supabase.co\",\n  \"SUPABASE_ANON_KEY\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\",\n  \"HUGGINGFACE_TOKEN\": \"hf_xxxxxxxxxxxxxxxxxxxxxxxx\",\n  \"REPLICATE_API_TOKEN\": \"r8_xxxxxxxxxxxxxxxxxxxxxxxx\",\n  \n  \"ADMOB_APP_ID_ANDROID\": \"ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX\",\n  \"ADMOB_APP_ID_IOS\": \"ca-app-pub-XXXXXXXXXXXXXXXX~XXXXXXXXXX\",\n  \"ADMOB_REWARDED_AD_UNIT_ID\": \"ca-app-pub-XXXXXXXXXXXXXXXX/XXXXXXXXXX\",\n  \n  \"APPLOVIN_SDK_KEY\": \"xxxxxxxxxxxxxxxxxxxxxxxxxxxxx\",\n  \n  \"SUPPORT_EMAIL\": \"support@yourdomain.com\"\n}\n```\n\n## ðŸ›¡ï¸ Security Best Practices\n\n1. **NEVER commit secrets to Git**\n   ```gitignore\n   .env/\n   *.env\n   prod.json\n   key.properties\n   *.jks\n   ```\n\n2. **Use password manager** (1Password, LastPass, Bitwarden)\n3. **Obfuscate builds**: Always use `--obfuscate`\n4. **Rotate keys** náº¿u bá»‹ leak\n5. **Use backend proxy** cho highly sensitive keys\n\n---\n\n# ðŸ“Š PHáº¦N 4: COMMON ISSUES & TROUBLESHOOTING\n\n## âŒ Google Play Rejections\n\n### Issue: \"Target API level too low\"\n**Fix:** Update `targetSdkVersion` = 35 trong `android/app/build.gradle`\n\n### Issue: \"Privacy policy URL invalid\"\n**Fix:** \n- Host trÃªn HTTPS\n- KhÃ´ng dÃ¹ng Google Docs editable\n- URL pháº£i active (khÃ´ng 404)\n\n### Issue: \"Data Safety form incomplete\"\n**Fix:** Äiá»n Ä‘áº§y Ä‘á»§ form, match vá»›i privacy policy\n\n### Issue: \"Missing required permissions declaration\"\n**Fix:** ThÃªm permissions vÃ o AndroidManifest.xml\n\n---\n\n## âŒ App Store Rejections\n\n### Issue: \"ITMS-91053: Missing API declaration\"\n**Fix:** Add Required Reason APIs vÃ o `PrivacyInfo.xcprivacy`\n\n### Issue: \"Invalid privacy manifest\"\n**Fix:** \n- Verify reason codes Ä‘Ãºng\n- Check XML format valid\n\n### Issue: \"App crashes on launch\"\n**Fix:**\n- Test trÃªn real device trÆ°á»›c khi submit\n- Check crash logs trong Xcode Organizer\n\n### Issue: \"Missing screenshot sizes\"\n**Fix:** Upload Ä‘á»§ sizes theo Apple requirements\n\n---\n\n# ðŸŽ¯ PHáº¦N 5: FINAL CHECKLIST\n\n## ðŸ“± Before Submitting to Stores:\n\n### Both Platforms:\n- [ ] Test app thoroughly trÃªn real devices\n- [ ] All features work vá»›i REAL API keys\n- [ ] Privacy policy hosted vÃ  accessible\n- [ ] Screenshots cháº¥t lÆ°á»£ng cao\n- [ ] App description Ä‘áº§y Ä‘á»§, háº¥p dáº«n\n- [ ] Support email responsive\n- [ ] Version numbers correct\n\n### Android Specific:\n- [ ] AAB file build thÃ nh cÃ´ng\n- [ ] Signed vá»›i upload keystore\n- [ ] Data Safety Form complete\n- [ ] Content rating complete\n- [ ] Target API 35\n\n### iOS Specific:\n- [ ] IPA file build thÃ nh cÃ´ng\n- [ ] Privacy Manifest complete\n- [ ] All Required Reason APIs declared\n- [ ] Xcode signing configured\n- [ ] TestFlight tested (optional nhÆ°ng recommended)\n\n---\n\n## ðŸ“ž Support Resources\n\n- **Google Play Help**: https://support.google.com/googleplay/android-developer\n- **App Store Connect Help**: https://developer.apple.com/support/app-store-connect/\n- **Flutter Deployment Docs**: https://docs.flutter.dev/deployment\n\n---\n\n**ðŸŽ‰ CHÃšC ANH LAUNCH THÃ€NH CÃ”NG!** ðŸš€\n","size_bytes":18944},"SECURITY_AND_REMOTE_ADS_GUIDE.md":{"content":"# ðŸ” Báº£o Máº­t Secrets & Remote Control Ads Guide\n\n## âš ï¸ Sá»° THáº¬T Vá»€ Báº¢O Máº¬T API KEYS TRONG APP\n\n### ðŸš¨ **CÃ‚U TRáº¢ Lá»œI NGáº®N Gá»ŒN:**\n\n**CÃ“, secrets trong `prod.json` váº«n cÃ³ thá»ƒ bá»‹ extract ra Ä‘Æ°á»£c ngay cáº£ khi dÃ¹ng `--dart-define` vÃ  `--obfuscate`!**\n\n---\n\n## ðŸ“± PHáº¦N 1: Báº¢O Máº¬T SECRETS - Sá»° THáº¬T Cáº¦N BIáº¾T\n\n### âŒ **Nhá»¯ng GÃ¬ KHÃ”NG An ToÃ n:**\n\n#### 1. **--dart-define KHÃ”NG báº£o máº­t 100%**\n```bash\n# DÃ¹ build vá»›i obfuscate...\nflutter build appbundle --obfuscate --dart-define-from-file=prod.json\n\n# Hacker váº«n extract Ä‘Æ°á»£c báº±ng:\napktool d app-release.apk\nstrings lib/arm64-v8a/libapp.so | grep -i \"api\\|token\\|key\"\n```\n\n**Káº¿t quáº£:** API keys cá»§a anh sáº½ hiá»‡n ra nhÆ° nÃ y:\n```\nhf_abcdefghijklmnopqrstuvwxyz12345\nr8_zyxwvutsrqponmlkjihgfedcba54321\neyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...\n```\n\n#### 2. **Obfuscation chá»‰ lÃ  \"che má»\", khÃ´ng pháº£i \"mÃ£ hÃ³a\"**\n- `--obfuscate` chá»‰ rename class/function names\n- String literals (API keys) váº«n nguyÃªn vÄƒn trong binary\n- Tools nhÆ° `reFlutter`, `darter` dá»… dÃ ng extract\n\n#### 3. **Debug APK nguy hiá»ƒm HÆ N Ná»®A**\n- File `kernel_blob.bin` chá»©a source code nguyÃªn báº£n (ká»ƒ cáº£ comments!)\n- Extract báº±ng: `strings kernel_blob.bin > code.dart`\n\n---\n\n### âœ… **Giáº¢I PHÃP AN TOÃ€N:**\n\n## ðŸ”‘ **PhÃ¢n Loáº¡i Secrets:**\n\n### **1. Ad Unit IDs (AdMob, AppLovin) - KHÃ”NG NGUY HIá»‚M**\n```json\n{\n  \"ADMOB_APP_ID_ANDROID\": \"ca-app-pub-XXXXXXXX~XXXXXXXXXX\",\n  \"ADMOB_REWARDED_AD_UNIT_ID\": \"ca-app-pub-XXXXXXXX/XXXXXXXXXX\",\n  \"APPLOVIN_SDK_KEY\": \"xxxxxxxxxxxxxxxxxxxxxxx\"\n}\n```\n\n**âœ… AN TOÃ€N Ä‘á»ƒ embed trong app:**\n- Ad IDs Ä‘Æ°á»£c **design Ä‘á»ƒ public** (pháº£i khai bÃ¡o trong AndroidManifest.xml/Info.plist)\n- Hacker biáº¿t cÅ©ng khÃ´ng lÃ m gÃ¬ Ä‘Æ°á»£c (khÃ´ng charge tiá»n anh)\n- Chá»‰ hoáº¡t Ä‘á»™ng vá»›i package name/bundle ID cá»§a app anh\n\n### **2. API Tokens (Replicate, Huggingface) - NGUY HIá»‚M!!!**\n```json\n{\n  \"REPLICATE_API_TOKEN\": \"r8_xxxxx\",  // âŒ NGUY HIá»‚M\n  \"HUGGINGFACE_TOKEN\": \"hf_xxxxx\"     // âŒ NGUY HIá»‚M\n}\n```\n\n**âŒ KHÃ”NG AN TOÃ€N vÃ¬:**\n- Hacker extract Ä‘Æ°á»£c â†’ DÃ¹ng API vá»›i token cá»§a anh\n- Replicate charge **$0.0019/láº§n** â†’ Hacker cháº¡y 10,000 láº§n = **$19**\n- Huggingface Pro **$9/thÃ¡ng** â†’ Hacker dÃ¹ng miá»…n phÃ­\n\n---\n\n## ðŸ›¡ï¸ **GIáº¢I PHÃP Báº¢O Máº¬T CHO PRODUCTION:**\n\n### **Option 1: Backend Proxy (KHUYáº¾N NGHá»Š)**\n\n**Architecture:**\n```\nFlutter App            Backend Server           AI Services\n   â”‚                        â”‚                        â”‚\n   â”‚  1. Request HD photo   â”‚                        â”‚\n   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                        â”‚\n   â”‚                        â”‚  2. Call Replicate    â”‚\n   â”‚                        â”‚   (with server token)  â”‚\n   â”‚                        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚\n   â”‚                        â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚\n   â”‚  3. Return result      â”‚                        â”‚\n   â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                        â”‚\n```\n\n**Implementation:**\n\n**Backend (Python Flask - ÄÃ£ cÃ³ `api_server.py`):**\n```python\n# api_server.py (Ä‘Ã£ cÃ³ sáºµn)\n@app.route('/api/ai/hd-image', methods=['POST'])\ndef handle_hd_image():\n    # Token stored on SERVER, not in app\n    REPLICATE_TOKEN = os.getenv('REPLICATE_API_TOKEN')\n    \n    # Process request\n    image_data = request.json['image']\n    result = replicate_api.upscale(image_data, token=REPLICATE_TOKEN)\n    \n    return jsonify(result)\n```\n\n**Flutter (KhÃ´ng cáº§n Replicate token):**\n```dart\n// Chá»‰ cáº§n gá»i backend\nfinal response = await http.post(\n  Uri.parse('https://your-backend.com/api/ai/hd-image'),\n  body: jsonEncode({'image': base64Image}),\n);\n```\n\n**âœ… Æ¯u Ä‘iá»ƒm:**\n- Token KHÃ”NG bao giá» cÃ³ trong app\n- Hacker decompile cÅ©ng vÃ´ Ã­ch\n- Control Ä‘Æ°á»£c rate limiting, usage tracking\n\n---\n\n### **Option 2: Supabase Edge Functions (Alternative)**\n\n```typescript\n// Supabase Edge Function\nimport { serve } from \"https://deno.land/std/http/server.ts\";\n\nserve(async (req) => {\n  const { image } = await req.json();\n  \n  // Token stored in Supabase secrets\n  const REPLICATE_TOKEN = Deno.env.get(\"REPLICATE_API_TOKEN\");\n  \n  const response = await fetch(\"https://api.replicate.com/v1/predictions\", {\n    headers: { Authorization: `Token ${REPLICATE_TOKEN}` },\n    body: JSON.stringify({ input: { image } })\n  });\n  \n  return new Response(await response.text());\n});\n```\n\n---\n\n## ðŸ“± PHáº¦N 2: REMOTE CONTROL ADS (Báº¬T/Táº®T Tá»ª XA)\n\n### âœ… **CÃ‚U TRáº¢ Lá»œI: HOÃ€N TOÃ€N Há»¢P Lá»†!**\n\n**Google AdMob chÃ­nh thá»©c há»— trá»£ vÃ  KHUYáº¾N KHÃCH dÃ¹ng Firebase Remote Config Ä‘á»ƒ control ads!**\n\n---\n\n## ðŸ”¥ **Firebase Remote Config Solution (KHUYáº¾N NGHá»Š)**\n\n### **Táº¡i Sao DÃ¹ng Firebase Remote Config?**\n\nâœ… **Policy-compliant**: Google cÃ³ tutorial chÃ­nh thá»©c vá» viá»‡c nÃ y  \nâœ… **Real-time updates**: Thay Ä‘á»•i ngay láº­p tá»©c, khÃ´ng cáº§n update app  \nâœ… **Free tier**: 2,000 active users miá»…n phÃ­  \nâœ… **A/B testing**: Test revenue vá»›i/khÃ´ng ads  \nâœ… **Targeting**: Báº­t ads theo country, version, user segment  \n\n**âš ï¸ Use Case Cá»§a Anh:**\n- LÃºc Ä‘áº§u: `show_ads = false` â†’ 0-5k users khÃ´ng tháº¥y ads\n- Sau Ä‘Ã³: `show_ads = true` â†’ 5k-10k users báº¯t Ä‘áº§u tháº¥y ads\n- Premium users: `show_ads = false` â†’ Paid users khÃ´ng ads\n\n---\n\n### **ðŸš€ Implementation Chi Tiáº¿t:**\n\n#### **BÆ°á»›c 1: Setup Firebase (Náº¿u chÆ°a cÃ³)**\n\n```bash\n# Add Firebase dependencies\nflutter pub add firebase_core\nflutter pub add firebase_remote_config\nflutter pub add firebase_analytics  # Cáº§n cho targeting\n```\n\n**Setup Firebase:**\n1. VÃ o [Firebase Console](https://console.firebase.google.com)\n2. Create project hoáº·c dÃ¹ng project hiá»‡n táº¡i\n3. Add Android app (package: `com.visoai.photoheadshot`)\n4. Add iOS app (bundle: `com.visoai.photoheadshot`)\n5. Download `google-services.json` (Android) vÃ  `GoogleService-Info.plist` (iOS)\n\n#### **BÆ°á»›c 2: Create Remote Config Parameters**\n\n**Firebase Console â†’ Engage â†’ Remote Config:**\n\nTáº¡o cÃ¡c parameters:\n```json\n{\n  \"ads_enabled\": true,              // Báº­t/táº¯t toÃ n bá»™ ads\n  \"banner_ads_enabled\": true,       // Báº­t/táº¯t banner ads\n  \"rewarded_ads_enabled\": true,     // Báº­t/táº¯t rewarded ads\n  \"interstitial_ads_enabled\": true, // Báº­t/táº¯t interstitial ads\n  \"min_user_count_for_ads\": 5000    // Chá»‰ show ads khi â‰¥ 5k users\n}\n```\n\n**Add Conditions (Optional):**\n- Country: `ads_enabled = false` cho Vietnam (marketing phase)\n- User Property: `ads_enabled = false` cho premium users\n- App Version: `ads_enabled = true` chá»‰ tá»« version 1.2.0+\n\n#### **BÆ°á»›c 3: Flutter Code Implementation**\n\n**Create `lib/services/remote_config_service.dart`:**\n\n```dart\nimport 'package:firebase_remote_config/firebase_remote_config.dart';\n\nclass RemoteConfigService {\n  static final RemoteConfigService _instance = RemoteConfigService._internal();\n  factory RemoteConfigService() => _instance;\n  RemoteConfigService._internal();\n\n  final FirebaseRemoteConfig _remoteConfig = FirebaseRemoteConfig.instance;\n\n  // Ad control flags\n  bool get adsEnabled => _remoteConfig.getBool('ads_enabled');\n  bool get bannerAdsEnabled => _remoteConfig.getBool('banner_ads_enabled');\n  bool get rewardedAdsEnabled => _remoteConfig.getBool('rewarded_ads_enabled');\n  bool get interstitialAdsEnabled => _remoteConfig.getBool('interstitial_ads_enabled');\n  int get minUserCountForAds => _remoteConfig.getInt('min_user_count_for_ads');\n\n  Future<void> initialize() async {\n    try {\n      // Set defaults (khi offline hoáº·c fetch fail)\n      await _remoteConfig.setDefaults({\n        'ads_enabled': false,  // Default: KHÃ”NG show ads (an toÃ n)\n        'banner_ads_enabled': false,\n        'rewarded_ads_enabled': false,\n        'interstitial_ads_enabled': false,\n        'min_user_count_for_ads': 5000,\n      });\n\n      // Config settings\n      await _remoteConfig.setConfigSettings(RemoteConfigSettings(\n        fetchTimeout: const Duration(minutes: 1),\n        minimumFetchInterval: const Duration(hours: 1), // Production: 12 hours\n      ));\n\n      // Fetch and activate\n      await _remoteConfig.fetchAndActivate();\n      \n      print('âœ… Remote Config initialized');\n      print('Ads enabled: $adsEnabled');\n    } catch (e) {\n      print('âŒ Remote Config error: $e');\n      // Fallback to defaults\n    }\n  }\n\n  // Refresh config (gá»i khi app resume tá»« background)\n  Future<void> refresh() async {\n    await _remoteConfig.fetchAndActivate();\n  }\n}\n```\n\n**Update `main.dart`:**\n\n```dart\nimport 'package:firebase_core/firebase_core.dart';\nimport 'firebase_options.dart';\n\nvoid main() async {\n  WidgetsFlutterBinding.ensureInitialized();\n  \n  // Initialize Firebase\n  await Firebase.initializeApp(\n    options: DefaultFirebaseOptions.currentPlatform,\n  );\n  \n  // Initialize Remote Config\n  await RemoteConfigService().initialize();\n  \n  // Initialize ads ONLY if enabled\n  if (RemoteConfigService().adsEnabled) {\n    await initializeAds();  // HÃ m init AdMob/AppLovin\n  }\n  \n  runApp(MyApp());\n}\n```\n\n**Update Ad Widgets:**\n\n```dart\n// lib/components/bottom_navigation_with_ad.dart\nWidget build(BuildContext context) {\n  final remoteConfig = RemoteConfigService();\n  \n  return Column(\n    children: [\n      // Show ad banner ONLY if enabled\n      if (remoteConfig.adsEnabled && remoteConfig.bannerAdsEnabled)\n        Container(\n          height: 50,\n          color: Colors.black,\n          child: AdWidget(ad: bannerAd),\n        )\n      else\n        SizedBox.shrink(), // KhÃ´ng show gÃ¬\n      \n      // Bottom navigation\n      BottomNavigationBar(...),\n    ],\n  );\n}\n```\n\n**Rewarded Ads:**\n\n```dart\nvoid showRewardedAd() {\n  final remoteConfig = RemoteConfigService();\n  \n  // Check remote config trÆ°á»›c\n  if (!remoteConfig.adsEnabled || !remoteConfig.rewardedAdsEnabled) {\n    // KhÃ´ng cÃ³ ads â†’ cho user dÃ¹ng feature luÃ´n\n    proceedWithFeature();\n    return;\n  }\n  \n  // Show rewarded ad\n  rewardedAd?.show(\n    onUserEarnedReward: (ad, reward) {\n      proceedWithFeature();\n    },\n  );\n}\n```\n\n---\n\n## ðŸŽ¯ **Use Case Thá»±c Táº¿ Cá»§a Anh:**\n\n### **Giai Äoáº¡n 1: Marketing (0-5k users)**\n\n**Firebase Console:**\n```json\n{\n  \"ads_enabled\": false,\n  \"min_user_count_for_ads\": 5000\n}\n```\n\n**Káº¿t quáº£:**\n- âœ… User download app â†’ KhÃ´ng tháº¥y ads\n- âœ… Tráº£i nghiá»‡m mÆ°á»£t mÃ  â†’ Retention cao\n- âœ… Word-of-mouth marketing tá»‘t\n\n### **Giai Äoáº¡n 2: Monetization (5k-10k users)**\n\n**Firebase Console (chá»‰ cáº§n click toggle):**\n```json\n{\n  \"ads_enabled\": true,  // â† Chá»‰ cáº§n Ä‘á»•i true\n  \"banner_ads_enabled\": true,\n  \"rewarded_ads_enabled\": true\n}\n```\n\n**Káº¿t quáº£:**\n- âœ… Ads báº­t ngay láº­p tá»©c (khÃ´ng cáº§n update app)\n- âœ… User hiá»‡n táº¡i: Báº¯t Ä‘áº§u tháº¥y ads\n- âœ… User má»›i: Tháº¥y ads ngay tá»« Ä‘áº§u\n\n### **Giai Äoáº¡n 3: Premium Users**\n\n**Add condition targeting:**\n- User Property: `is_premium = true`\n- Parameter value: `ads_enabled = false`\n\n**Hoáº·c dÃ¹ng code:**\n```dart\nbool shouldShowAds() {\n  final remoteConfig = RemoteConfigService();\n  final userService = UserService();\n  \n  // Premium users: KHÃ”NG ads\n  if (userService.isPremiumUser) return false;\n  \n  // Check remote config\n  return remoteConfig.adsEnabled;\n}\n```\n\n---\n\n## ðŸ“Š **Alternative: Supabase Remote Config (Náº¿u khÃ´ng muá»‘n dÃ¹ng Firebase)**\n\n### **Setup Table:**\n\n```sql\nCREATE TABLE app_config (\n  id INT PRIMARY KEY,\n  ads_enabled BOOLEAN DEFAULT false,\n  banner_ads_enabled BOOLEAN DEFAULT false,\n  rewarded_ads_enabled BOOLEAN DEFAULT false,\n  min_user_count INT DEFAULT 5000,\n  updated_at TIMESTAMP DEFAULT NOW()\n);\n\nINSERT INTO app_config (id, ads_enabled) VALUES (1, false);\n```\n\n### **Flutter Code:**\n\n```dart\nclass SupabaseRemoteConfig {\n  Future<Map<String, dynamic>> fetchConfig() async {\n    final response = await Supabase.instance.client\n        .from('app_config')\n        .select()\n        .eq('id', 1)\n        .single();\n    \n    return response.data;\n  }\n  \n  bool get adsEnabled => _config['ads_enabled'] ?? false;\n}\n```\n\n**âœ… Æ¯u Ä‘iá»ƒm Supabase:**\n- ÄÃ£ cÃ³ sáºµn Supabase trong project\n- KhÃ´ng cáº§n thÃªm dependency\n- Control Ä‘áº§y Ä‘á»§ qua SQL\n\n**âŒ NhÆ°á»£c Ä‘iá»ƒm:**\n- KhÃ´ng cÃ³ A/B testing tá»± Ä‘á»™ng\n- KhÃ´ng cÃ³ targeting theo country/version\n- Pháº£i tá»± implement caching\n\n---\n\n## âš–ï¸ **POLICY COMPLIANCE - CÃ“ VI PHáº M KHÃ”NG?**\n\n### âœ… **CÃ‚U TRáº¢ Lá»œI: HOÃ€N TOÃ€N Há»¢P Lá»†!**\n\n#### **Google Play Policy:**\n- âœ… **Allowed**: Báº­t/táº¯t ads qua code logic\n- âœ… **Allowed**: KhÃ´ng show ads cho premium users\n- âœ… **Allowed**: A/B testing ad frequency\n- âŒ **Not Allowed**: Click fraud, fake impressions, hidden ads\n\n#### **AdMob Policy:**\n- âœ… **Allowed**: Remote Config control (cÃ³ tutorial chÃ­nh thá»©c)\n- âœ… **Allowed**: Conditional ad display\n- âœ… **Allowed**: User-triggered ad removal (premium purchase)\n- âŒ **Not Allowed**: Manipulate eCPM floors Ä‘á»ƒ \"táº¯t\" ads\n\n#### **App Store Policy:**\n- âœ… **Allowed**: Dynamic ad control\n- âœ… **Allowed**: In-app purchase Ä‘á»ƒ remove ads\n- âœ… **Allowed**: Regional ad restrictions\n- âŒ **Not Allowed**: Hidden tracking, deceptive practices\n\n**ðŸ“š Official Google Tutorial:**\n- [Firebase Remote Config + AdMob](https://firebase.google.com/docs/tutorials/optimize-ad-frequency)\n- Case study: MegaJogos tÄƒng 300% revenue báº±ng Remote Config\n\n---\n\n## ðŸ—ï¸ **KIáº¾N TRÃšC PRODUCTION KHUYáº¾N NGHá»Š:**\n\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚              Flutter App                        â”‚\nâ”‚                                                 â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Remote Config Service                   â”‚  â”‚\nâ”‚  â”‚  - ads_enabled: bool                     â”‚  â”‚\nâ”‚  â”‚  - banner_ads_enabled: bool              â”‚  â”‚\nâ”‚  â”‚  - rewarded_ads_enabled: bool            â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                 â”‚\nâ”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚\nâ”‚  â”‚  Ad Manager                              â”‚  â”‚\nâ”‚  â”‚  - Check remote config trÆ°á»›c khi show    â”‚  â”‚\nâ”‚  â”‚  - Fallback khi offline                  â”‚  â”‚\nâ”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚\nâ”‚                                                 â”‚\nâ”‚  ðŸ“± Ad Unit IDs (trong prod.json - OK)         â”‚\nâ”‚  - ADMOB_APP_ID: ca-app-pub-xxx~xxx            â”‚\nâ”‚  - APPLOVIN_SDK_KEY: xxx                       â”‚\nâ”‚                                                 â”‚\nâ”‚  âŒ KHÃ”NG cÃ³ Replicate/Huggingface tokens      â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n                      â–²\n                      â”‚ Fetch config\n                      â”‚\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         Firebase Remote Config                  â”‚\nâ”‚         (hoáº·c Supabase app_config table)        â”‚\nâ”‚                                                 â”‚\nâ”‚  {                                              â”‚\nâ”‚    \"ads_enabled\": true/false,                   â”‚\nâ”‚    \"banner_ads_enabled\": true/false,            â”‚\nâ”‚    \"rewarded_ads_enabled\": true/false           â”‚\nâ”‚  }                                              â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚         Backend Server (api_server.py)          â”‚\nâ”‚                                                 â”‚\nâ”‚  ðŸ” Replicate API Token (server-side)          â”‚\nâ”‚  ðŸ” Huggingface API Token (server-side)        â”‚\nâ”‚                                                 â”‚\nâ”‚  Endpoints:                                     â”‚\nâ”‚  - POST /api/ai/hd-image                        â”‚\nâ”‚  - POST /api/ai/face-swap                       â”‚\nâ”‚  - POST /api/ai/fix-old-photo                   â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## âœ… **CHECKLIST PRODUCTION:**\n\n### **Secrets Management:**\n- [ ] Ad Unit IDs trong `prod.json` (OK, khÃ´ng nguy hiá»ƒm)\n- [ ] Replicate/Huggingface tokens KHÃ”NG cÃ³ trong app\n- [ ] Backend proxy cho AI API calls\n- [ ] Supabase credentials trong app (OK, cÃ³ RLS policies)\n\n### **Remote Ads Control:**\n- [ ] Firebase Remote Config setup\n- [ ] Default values: `ads_enabled = false` (an toÃ n)\n- [ ] Ad widgets check remote config trÆ°á»›c khi show\n- [ ] Fallback khi offline/fetch fail\n- [ ] Targeting conditions (premium users, countries, versions)\n\n### **Policy Compliance:**\n- [ ] KhÃ´ng manipulate ad auction\n- [ ] KhÃ´ng fake impressions/clicks\n- [ ] Privacy policy mention ad control\n- [ ] GDPR consent trÆ°á»›c khi show ads\n\n---\n\n## ðŸŽ¯ **TÃ“M Táº®T - NHá»®NG GÃŒ ANH Cáº¦N LÃ€M:**\n\n### **1. Báº£o Máº­t Secrets:**\n\n**âœ… AN TOÃ€N Ä‘á»ƒ trong prod.json:**\n```json\n{\n  \"ADMOB_APP_ID_ANDROID\": \"...\",\n  \"ADMOB_REWARDED_AD_UNIT_ID\": \"...\",\n  \"APPLOVIN_SDK_KEY\": \"...\",\n  \"SUPABASE_URL\": \"...\",\n  \"SUPABASE_ANON_KEY\": \"...\",\n  \"SUPPORT_EMAIL\": \"...\"\n}\n```\n\n**âŒ DI CHUYá»‚N RA BACKEND:**\n```json\n{\n  \"REPLICATE_API_TOKEN\": \"...\",  // â† Move to backend\n  \"HUGGINGFACE_TOKEN\": \"...\"     // â† Move to backend\n}\n```\n\n### **2. Remote Ads Control:**\n\n**Option A: Firebase Remote Config (KHUYáº¾N NGHá»Š)**\n```bash\nflutter pub add firebase_core firebase_remote_config\n# Setup nhÆ° hÆ°á»›ng dáº«n trÃªn\n```\n\n**Option B: Supabase Config Table**\n```sql\nCREATE TABLE app_config (\n  ads_enabled BOOLEAN DEFAULT false\n);\n```\n\n### **3. Implementation:**\n```dart\n// main.dart\nvoid main() async {\n  await Firebase.initializeApp();\n  await RemoteConfigService().initialize();\n  \n  if (RemoteConfigService().adsEnabled) {\n    await initializeAds();\n  }\n  \n  runApp(MyApp());\n}\n\n// Ad widgets\nif (RemoteConfigService().bannerAdsEnabled) {\n  showBannerAd();\n}\n```\n\n---\n\n## ðŸ“ž **CÃ¢u Há»i ThÆ°á»ng Gáº·p:**\n\n**Q: CÃ³ cáº§n update app khi báº­t/táº¯t ads khÃ´ng?**  \nA: KHÃ”NG! Remote Config update real-time, user restart app lÃ  tháº¥y thay Ä‘á»•i.\n\n**Q: Náº¿u user offline thÃ¬ sao?**  \nA: DÃ¹ng giÃ¡ trá»‹ default hoáº·c cached value láº§n fetch trÆ°á»›c.\n\n**Q: Chi phÃ­ Firebase Remote Config?**  \nA: Free cho 2,000 active users, sau Ä‘Ã³ $0.01/1000 fetches.\n\n**Q: AdMob cÃ³ ban account vÃ¬ táº¯t ads khÃ´ng?**  \nA: KHÃ”NG! ÄÃ¢y lÃ  use case chÃ­nh thá»©c Ä‘Æ°á»£c Google support.\n\n---\n\n**ðŸŽ‰ Káº¾T LUáº¬N:**\n\n1. **Ad IDs trong prod.json = OK**\n2. **API Tokens pháº£i move ra backend**\n3. **Remote Config báº­t/táº¯t ads = HOÃ€N TOÃ€N Há»¢P Lá»†**\n4. **Use case cá»§a anh = Chiáº¿n lÆ°á»£c marketing thÃ´ng minh**\n\nCÃ³ gÃ¬ tháº¯c máº¯c thÃªm cá»© há»i em nhÃ© anh! ðŸš€\n","size_bytes":19812},"REVENUECAT_TESTING_GUIDE.md":{"content":"# ðŸ§ª RevenueCat IAP Testing Guide\n\n## âš ï¸ Quan trá»ng\n**RevenueCat IAP KHÃ”NG hoáº¡t Ä‘á»™ng trÃªn Web/Replit!** \nBáº¯t buá»™c pháº£i test trÃªn Android device tháº­t hoáº·c emulator.\n\n---\n\n## ðŸ“‹ Prerequisites\n\n### 1. Build APK trÃªn mÃ¡y local\n```bash\nflutter pub get\nflutter build apk --debug\n```\nOutput: `build/app/outputs/flutter-apk/app-debug.apk`\n\n### 2. Setup RevenueCat Dashboard\n\n#### A. Login RevenueCat\nhttps://app.revenuecat.com (dÃ¹ng test key: `test_OvwtrjRddtWRHgmNdZgxCTiYLYX`)\n\n**Project Info:**\n- **Project ID:** projb4face67\n- **Offering ID (RevenueCat ID):** ofrng1c5b1a3712\n\n#### B. Create Products (Tab \"Products\")\nClick \"Add Product\" vÃ  táº¡o 3 products:\n\n| Product ID | Type | Price |\n|-----------|------|-------|\n| `lifetime_2050k` | Non-consumable | â‚«2,050,000 VND |\n| `yearly_944k` | Auto-renewable subscription | â‚«944,000 VND |\n| `weekly_165k` | Auto-renewable subscription | â‚«165,000 VND |\n\n**LÆ°u Ã½:** Product ID pháº£i trÃ¹ng vá»›i Google Play Console sau nÃ y!\n\n#### C. Create Entitlement (Tab \"Entitlements\")\n1. Click \"New Entitlement\"\n2. Identifier: `premium`\n3. Description: \"Full access to all premium features\"\n4. Attach all 3 products trÃªn\n\n#### D. Create Offering (Tab \"Offerings\")\n1. Click \"New Offering\"\n2. Identifier: `default` (tÃªn nÃ y khá»›p vá»›i code trong `RevenueCatService`)\n3. Add 3 packages:\n   - Package Type: **Lifetime** â†’ Product: `lifetime_2050k`\n   - Package Type: **Annual** â†’ Product: `yearly_944k`\n   - Package Type: **Weekly** â†’ Product: `weekly_165k`\n\n---\n\n## ðŸŽ¯ Testing Scenarios\n\n### Scenario 1: Test Mode (KhÃ´ng cáº§n Google Play setup)\n\nRevenueCat cÃ³ **Test Mode** cho phÃ©p mock purchases!\n\n**BÆ°á»›c thá»±c hiá»‡n:**\n1. Install APK: `adb install build/app/outputs/flutter-apk/app-debug.apk`\n2. Open app â†’ Navigate to Pro page\n3. **Quan sÃ¡t:**\n   - Loading spinner hiá»ƒn thá»‹ khi load packages\n   - 3 subscription cards render vá»›i:\n     - âœ… Dynamic prices tá»« RevenueCat\n     - âœ… Badges (BEST VALUE, SAVE 89%)\n     - âœ… Selection states (tap Ä‘á»ƒ select)\n4. Click \"Continue\" â†’ Purchase flow\n   - **Test mode:** Sáº½ show mock purchase dialog\n   - **Production:** Redirect Ä‘áº¿n Google Play billing\n\n**Check logs:**\n```bash\nadb logcat | grep RevenueCat\n```\n\nExpected output:\n```\nâœ… Loaded 3 subscription packages\nPackage: Lifetime - â‚«2,050,000\nPackage: Yearly - â‚«944,000\nPackage: Weekly - â‚«165,000\n```\n\n---\n\n### Scenario 2: Test Restore Flow\n\n**BÆ°á»›c thá»±c hiá»‡n:**\n1. Click \"Restore\" button trÃªn Pro page\n2. **Test mode:** Mock restore thÃ nh cÃ´ng\n3. **Production:** Restore tá»« Google Play\n\nExpected:\n- Success: SnackBar \"Purchases restored successfully!\"\n- No purchases: SnackBar \"No previous purchases found\"\n- Error: SnackBar \"Failed to restore purchases\"\n\n---\n\n### Scenario 3: Production Testing (Sau khi setup Google Play)\n\n**Prerequisites:**\n- Google Play Console account\n- App published (internal testing track)\n- Products configured trÃªn Play Console\n\n**Steps:**\n1. Replace test key vá»›i production key:\n   ```dart\n   // lib/main.dart\n   await RevenueCat.configure(\n     PurchasesConfiguration(\"appl_xxxxxxxxxxxxx\"), // Production key\n   );\n   ```\n\n2. Build release APK:\n   ```bash\n   flutter build apk --release\n   ```\n\n3. Upload lÃªn Internal Testing track\n\n4. Test vá»›i licensed tester account:\n   - Add email vÃ o \"License testers\" trÃªn Play Console\n   - Install app tá»« Play Store (internal testing link)\n   - Navigate to Pro page â†’ See real prices\n   - Click Continue â†’ Real Google Play purchase flow\n\n---\n\n## ðŸ› Troubleshooting\n\n### Issue 1: \"No packages available\"\n**NguyÃªn nhÃ¢n:** RevenueCat Dashboard chÆ°a setup Ä‘Ãºng\n\n**Fix:**\n1. Check offering identifier = `default`\n2. Verify 3 packages exist trong offering\n3. Check API key Ä‘Ãºng (test/production)\n\n### Issue 2: \"Failed to load subscription plans\"\n**NguyÃªn nhÃ¢n:** Network error hoáº·c API key sai\n\n**Fix:**\n1. Check internet connection\n2. Verify API key trong `main.dart`\n3. Check logs: `adb logcat | grep RevenueCat`\n\n### Issue 3: Purchase khÃ´ng hoáº¡t Ä‘á»™ng\n**NguyÃªn nhÃ¢n:** \n- Test mode: Normal behavior (mock purchase)\n- Production: ChÆ°a setup Google Play products\n\n**Fix:**\n1. **Test mode:** Purchases sáº½ mock - OK!\n2. **Production:** Setup products trÃªn Google Play Console vá»›i cÃ¹ng product IDs\n\n### Issue 4: Web shows hardcoded prices\n**NguyÃªn nhÃ¢n:** Web bundle chÆ°a rebuild\n\n**Fix:**\n```bash\nflutter clean\nflutter build web --release\n```\n\n**LÆ°u Ã½:** IAP váº«n khÃ´ng hoáº¡t Ä‘á»™ng trÃªn web (limitation cá»§a RevenueCat SDK)\n\n---\n\n## ðŸ“Š Expected Pro Page Behavior\n\n### Loading State\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚   Loading spinner       â”‚\nâ”‚   (CircularProgressIndicator) â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n### Success State (3 packages loaded)\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”\nâ”‚BEST   â”‚  â”‚SAVE   â”‚  â”‚       â”‚\nâ”‚VALUE  â”‚  â”‚89%    â”‚  â”‚       â”‚\nâ”‚  âˆž    â”‚  â”‚  ðŸ“…   â”‚  â”‚  ðŸ—“ï¸   â”‚\nâ”‚Lifetimeâ”‚ â”‚ Year  â”‚  â”‚ Week  â”‚\nâ”‚â‚«2,050,â”‚  â”‚â‚«944,  â”‚  â”‚â‚«165,  â”‚\nâ”‚000    â”‚  â”‚000    â”‚  â”‚000    â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”˜\n   ^(selected)\n```\n\n### Error State\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ Failed to load          â”‚\nâ”‚ subscription plans.     â”‚\nâ”‚ Please try again.       â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n```\n\n---\n\n## âœ… Success Criteria\n\n### âœ“ Dynamic Pricing Works\n- [ ] Prices load tá»« RevenueCat (not hardcoded)\n- [ ] 3 cards render correctly\n- [ ] Weekly daily cost computed: â‚«23,571/day\n\n### âœ“ Selection State\n- [ ] First package (Lifetime) auto-selected\n- [ ] Tap other cards â†’ Selection updates\n- [ ] Selected card highlights (border color)\n\n### âœ“ Purchase Flow\n- [ ] Continue button disabled khi loading\n- [ ] Continue button calls RevenueCat purchase\n- [ ] Loading dialog shows \"Processing purchase...\"\n- [ ] Success/error snackbar displays\n\n### âœ“ Restore Flow\n- [ ] Restore button calls RevenueCat restore\n- [ ] Snackbar shows restore result\n\n---\n\n## ðŸ“ Next Steps After Testing\n\n1. **Google Play Setup:**\n   - Create app listing trÃªn Play Console\n   - Add in-app products (same IDs as RevenueCat)\n   - Submit for review\n\n2. **Replace Test Key:**\n   - Get production API key tá»« RevenueCat\n   - Update `main.dart`\n\n3. **Production Build:**\n   ```bash\n   flutter build appbundle --release\n   ```\n\n4. **Upload to Play Store:**\n   - Upload AAB file (not APK)\n   - Internal testing â†’ Closed testing â†’ Production\n\n---\n\n## ðŸ’¡ Tips\n\n- **RevenueCat Test Mode** free testing - no billing!\n- **Google Play Internal Testing** - test vá»›i real purchases (Google returns money)\n- **Licensed Testers** - add team emails Ä‘á»ƒ test miá»…n phÃ­\n- **RevenueCat Dashboard** - Monitor all purchases/subscriptions\n\n---\n\n## ðŸ”— Resources\n\n- RevenueCat Dashboard: https://app.revenuecat.com\n- RevenueCat Docs: https://docs.revenuecat.com\n- Google Play Console: https://play.google.com/console\n- Testing Guide: https://docs.revenuecat.com/docs/google-play-store\n","size_bytes":7338},"REVENUECAT_IAP_SETUP_GUIDE.md":{"content":"# ðŸ›’ RevenueCat In-App Purchase - Complete Setup Guide\n\n## ðŸ“‹ Má»¤C Lá»¤C\n\n1. [Tá»•ng quan](#tá»•ng-quan)\n2. [Setup RevenueCat Dashboard](#setup-revenuecat-dashboard)\n3. [Test NGAY khÃ´ng cáº§n Google Play](#test-ngay-khÃ´ng-cáº§n-google-play)\n4. [Implement vÃ o Flutter App](#implement-vÃ o-flutter-app)\n5. [Testing Guide](#testing-guide)\n6. [Troubleshooting](#troubleshooting)\n\n---\n\n## ðŸŽ¯ Tá»”NG QUAN\n\n### âœ… ÄÃ£ HoÃ n ThÃ nh\n\n- [x] RevenueCat account created\n- [x] Android app created trong RevenueCat\n- [x] Test API key: `test_OvwtrjRddtWRHgmNdZgxCTiYLYX`\n- [x] Project ID: projb4face67\n- [x] Offering ID: ofrng1c5b1a3712\n- [x] `purchases_flutter` package installed\n- [x] `RevenueCatService` created\n\n### ðŸš€ Tiáº¿p Theo\n\n- [ ] Setup products trong RevenueCat Dashboard\n- [ ] Configure entitlements & offerings\n- [ ] Integrate vÃ o Pro page\n- [ ] Test purchases locally\n- [ ] Link Google Play sau khi approved\n\n---\n\n## ðŸ“± SETUP REVENUECAT DASHBOARD\n\n### BÆ°á»›c 1: Táº¡o Products (Test Mode)\n\n**RevenueCat Dashboard â†’ Products**\n\nClick **\"Add Product\"** cho má»—i subscription plan:\n\n#### **Product 1: Weekly**\n```\nProduct ID: viso_ai_weekly\nDisplay Name: Weekly Premium\nType: Subscription\nDuration: 1 Week\nTest Price: $7.99\n```\n\n#### **Product 2: Yearly**\n```\nProduct ID: viso_ai_yearly\nDisplay Name: Yearly Premium - Best Value\nType: Subscription\nDuration: 1 Year\nTest Price: $49.99\n```\n\n#### **Product 3: Lifetime**\n```\nProduct ID: viso_ai_lifetime\nDisplay Name: Lifetime Premium\nType: Non-renewing Subscription (or One-time purchase)\nTest Price: $99.99\n```\n\n> **LÆ°u Ã½:** ÄÃ¢y lÃ  **test products** - RevenueCat sáº½ tá»± Ä‘á»™ng mock purchases. KhÃ´ng cáº§n Google Play account!\n\n---\n\n### BÆ°á»›c 2: Táº¡o Entitlements\n\n**RevenueCat Dashboard â†’ Entitlements**\n\nClick **\"Add Entitlement\"**:\n\n```\nEntitlement ID: pro\nDisplay Name: Premium Features\nDescription: Unlock all premium features, no ads, unlimited creations\n\nAttach Products:\n- viso_ai_weekly\n- viso_ai_yearly\n- viso_ai_lifetime\n```\n\n> **Entitlement** = Quyá»n truy cáº­p premium. Khi user mua báº¥t ká»³ product nÃ o â†’ Nháº­n entitlement \"pro\" â†’ App unlock features.\n\n---\n\n### BÆ°á»›c 3: Táº¡o Offerings\n\n**RevenueCat Dashboard â†’ Offerings**\n\nClick **\"Create Offering\"**:\n\n```\nOffering ID: default\nDisplay Name: Premium Plans\nDescription: Choose your subscription plan\n```\n\n**Add Packages:**\n\n1. **Lifetime Package**\n   ```\n   Package Identifier: $rc_lifetime\n   Product: viso_ai_lifetime\n   ```\n\n2. **Annual Package**\n   ```\n   Package Identifier: $rc_annual\n   Product: viso_ai_yearly\n   ```\n\n3. **Weekly Package**\n   ```\n   Package Identifier: $rc_weekly\n   Product: viso_ai_weekly\n   ```\n\n> **Offerings** = NhÃ³m cÃ¡c gÃ³i subscription Ä‘á»ƒ hiá»ƒn thá»‹ cho user. App sáº½ load \"default\" offering.\n\n---\n\n### BÆ°á»›c 4: Configure Test Mode\n\n**RevenueCat Dashboard â†’ Settings â†’ Test mode**\n\n- âœ… Enable test mode\n- âœ… Test purchases are FREE\n- âœ… No Google Play/App Store needed\n\n---\n\n## âœ… TEST NGAY KHÃ”NG Cáº¦N GOOGLE PLAY\n\n### Option 1: RevenueCat Test Mode (RECOMMEND)\n\n**RevenueCat tá»± Ä‘á»™ng mock purchases khi dÃ¹ng test API key!**\n\n```dart\n// App tá»± Ä‘á»™ng dÃ¹ng test key\nRevenueCatService.initialize(); // Uses test_OvwtrjRddtWRHgmNdZgxCTiYLYX\n\n// Load offerings\nfinal packages = await RevenueCatService().getSubscriptionPackages();\n// âœ… Returns test products (viso_ai_weekly, yearly, lifetime)\n\n// Purchase\nfinal result = await RevenueCatService().purchasePackage(packages[0]);\n// âœ… Mock purchase - MIá»„N PHÃ, khÃ´ng cáº§n Google Play!\n\n// Check status\nfinal isPro = await RevenueCatService().isPremiumUser();\n// âœ… Returns true náº¿u mock purchase thÃ nh cÃ´ng\n```\n\n**Kiá»ƒm tra trong RevenueCat Dashboard:**\n- **Dashboard â†’ Customers** â†’ Tháº¥y test user vá»›i active subscription\n- **Dashboard â†’ Events** â†’ Tháº¥y purchase events\n\n---\n\n### Option 2: Google Play Internal Testing (Khi account approved)\n\n**Sau khi Google Play account Ä‘Æ°á»£c approve:**\n\n1. **Upload APK lÃªn Internal Testing**\n   ```bash\n   flutter build apk --release\n   ```\n\n2. **Google Play Console â†’ Internal Testing**\n   - Upload APK\n   - Add testers (max 100 emails)\n\n3. **Install via Internal Testing link**\n\n4. **Test purchases:**\n   - Purchases lÃ  **SANDBOX** (miá»…n phÃ­)\n   - RevenueCat auto-detect sandbox mode\n   - âœ… Test real purchase flow\n\n---\n\n## ðŸ’» IMPLEMENT VÃ€O FLUTTER APP\n\n### BÆ°á»›c 1: Initialize RevenueCat trong main.dart\n\n**File: `lib/main.dart`**\n\n```dart\nimport '/services/revenue_cat_service.dart';\n\nvoid main() async {\n  // ... existing Firebase init ...\n  \n  await UserService().initialize();\n  await RemoteConfigService().initialize();\n  \n  // Initialize RevenueCat\n  await RevenueCatService().initialize();\n  \n  // ... rest of main ...\n}\n```\n\n---\n\n### BÆ°á»›c 2: Update Pro Page Model\n\n**File: `lib/pro/pro_model.dart`**\n\n```dart\nimport '/flutter_flow/flutter_flow_util.dart';\nimport 'pro_widget.dart' show ProWidget;\nimport 'package:flutter/material.dart';\nimport 'package:purchases_flutter/purchases_flutter.dart';\n\nclass ProModel extends FlutterFlowModel<ProWidget> {\n  // State fields\n  int? selectedPackageIndex;\n  List<Package> availablePackages = [];\n  bool isLoading = true;\n  String? errorMessage;\n\n  @override\n  void initState(BuildContext context) {}\n\n  @override\n  void dispose() {}\n}\n```\n\n---\n\n### BÆ°á»›c 3: Update Pro Widget - Load Products\n\n**File: `lib/pro/pro_widget.dart`**\n\n**Add imports:**\n```dart\nimport '/services/revenue_cat_service.dart';\nimport 'package:purchases_flutter/purchases_flutter.dart';\n```\n\n**Update initState:**\n```dart\n@override\nvoid initState() {\n  super.initState();\n  _model = createModel(context, () => ProModel());\n  \n  // Load RevenueCat products\n  _loadProducts();\n}\n\nFuture<void> _loadProducts() async {\n  setState(() {\n    _model.isLoading = true;\n    _model.errorMessage = null;\n  });\n\n  try {\n    final packages = await RevenueCatService().getSubscriptionPackages();\n    \n    setState(() {\n      _model.availablePackages = packages;\n      _model.isLoading = false;\n      \n      // Auto-select first package (Lifetime - best value)\n      if (packages.isNotEmpty) {\n        _model.selectedPackageIndex = 0;\n      }\n    });\n    \n    debugPrint('âœ… Loaded ${packages.length} subscription packages');\n  } catch (e) {\n    setState(() {\n      _model.isLoading = false;\n      _model.errorMessage = 'Failed to load subscription plans: $e';\n    });\n    \n    debugPrint('âŒ Error loading products: $e');\n  }\n}\n```\n\n---\n\n### BÆ°á»›c 4: Update Restore Button Handler\n\n**Find \"Restore\" button (line ~100-140):**\n\n```dart\nFFButtonWidget(\n  onPressed: () async {\n    // Show loading\n    ScaffoldMessenger.of(context).showSnackBar(\n      SnackBar(content: Text('Restoring purchases...')),\n    );\n    \n    // Restore purchases\n    final result = await RevenueCatService().restorePurchases();\n    \n    if (result.success && result.isPremium) {\n      // Success\n      ScaffoldMessenger.of(context).showSnackBar(\n        SnackBar(\n          content: Text('âœ… Purchases restored! You are now premium.'),\n          backgroundColor: Colors.green,\n        ),\n      );\n      \n      // Navigate back to homepage\n      context.pushNamed(HomepageWidget.routeName);\n    } else {\n      // No purchases found\n      ScaffoldMessenger.of(context).showSnackBar(\n        SnackBar(\n          content: Text(result.message ?? 'No active purchases found'),\n          backgroundColor: Colors.orange,\n        ),\n      );\n    }\n  },\n  text: FFLocalizations.of(context).getText('8de8u8eh' /* Restore */),\n  // ... existing options ...\n),\n```\n\n---\n\n### BÆ°á»›c 5: Display Real Product Prices\n\n**Find subscription card section (line ~420-900) - Replace hardcoded prices:**\n\n**Before (hardcoded):**\n```dart\nText(\n  'â‚«2,050,000',  // Hardcoded\n  style: TextStyle(fontSize: 32, fontWeight: FontWeight.bold),\n),\n```\n\n**After (dynamic from RevenueCat):**\n```dart\n// Show loading state\nif (_model.isLoading)\n  CircularProgressIndicator(color: Colors.white)\nelse if (_model.errorMessage != null)\n  Text(\n    'Error loading prices',\n    style: TextStyle(color: Colors.red),\n  )\nelse\n  // Display packages from RevenueCat\n  Row(\n    mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n    children: _model.availablePackages.asMap().entries.map((entry) {\n      final index = entry.key;\n      final package = entry.value;\n      final product = package.storeProduct;\n      final isSelected = _model.selectedPackageIndex == index;\n      \n      return GestureDetector(\n        onTap: () {\n          setState(() {\n            _model.selectedPackageIndex = index;\n          });\n        },\n        child: Container(\n          width: 110.0,\n          height: 160.0,\n          decoration: BoxDecoration(\n            color: isSelected ? Color(0xFF9810FA) : Colors.transparent,\n            borderRadius: BorderRadius.circular(16.0),\n            border: Border.all(\n              color: Colors.white,\n              width: isSelected ? 2.0 : 1.0,\n            ),\n          ),\n          child: Padding(\n            padding: EdgeInsets.all(12.0),\n            child: Column(\n              mainAxisAlignment: MainAxisAlignment.spaceBetween,\n              children: [\n                // Badge (BEST VALUE, etc.)\n                if (package.packageType == PackageType.lifetime)\n                  Container(\n                    padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),\n                    decoration: BoxDecoration(\n                      color: Color(0xFF1E2939),\n                      borderRadius: BorderRadius.circular(12),\n                    ),\n                    child: Text(\n                      'BEST',\n                      style: TextStyle(color: Colors.white, fontSize: 10),\n                    ),\n                  )\n                else if (package.packageType == PackageType.annual)\n                  Container(\n                    padding: EdgeInsets.symmetric(horizontal: 8, vertical: 4),\n                    decoration: BoxDecoration(\n                      color: Color(0xFF00C950),\n                      borderRadius: BorderRadius.circular(12),\n                    ),\n                    child: Text(\n                      'SAVE 89%',\n                      style: TextStyle(color: Colors.white, fontSize: 10),\n                    ),\n                  ),\n                \n                // Icon\n                Icon(\n                  package.packageType == PackageType.lifetime\n                      ? Icons.all_inclusive\n                      : package.packageType == PackageType.annual\n                          ? Icons.calendar_today\n                          : Icons.calendar_view_week,\n                  color: Colors.white,\n                  size: 32,\n                ),\n                \n                // Package name\n                Text(\n                  package.packageType == PackageType.lifetime\n                      ? 'Lifetime'\n                      : package.packageType == PackageType.annual\n                          ? 'Year'\n                          : 'Week',\n                  style: TextStyle(\n                    color: Colors.white,\n                    fontSize: 16,\n                    fontWeight: FontWeight.bold,\n                  ),\n                ),\n                \n                // Price\n                Text(\n                  product.priceString,  // âœ… Real price from store\n                  style: TextStyle(\n                    color: Colors.white,\n                    fontSize: 20,\n                    fontWeight: FontWeight.bold,\n                  ),\n                  textAlign: TextAlign.center,\n                ),\n                \n                // Duration\n                if (package.packageType != PackageType.lifetime)\n                  Text(\n                    '1 purchase',\n                    style: TextStyle(\n                      color: Colors.white70,\n                      fontSize: 12,\n                    ),\n                  ),\n              ],\n            ),\n          ),\n        ),\n      );\n    }).toList(),\n  ),\n```\n\n---\n\n### BÆ°á»›c 6: Update Continue Button\n\n**Find \"Continue\" button (usually near bottom):**\n\n```dart\nFFButtonWidget(\n  onPressed: _model.isLoading || _model.selectedPackageIndex == null\n      ? null\n      : () async {\n    // Get selected package\n    final package = _model.availablePackages[_model.selectedPackageIndex!];\n    \n    // Show loading\n    showDialog(\n      context: context,\n      barrierDismissible: false,\n      builder: (context) => Center(\n        child: CircularProgressIndicator(),\n      ),\n    );\n    \n    try {\n      // Purchase\n      final result = await RevenueCatService().purchasePackage(package);\n      \n      // Close loading\n      Navigator.of(context).pop();\n      \n      if (result.success && result.isPremium) {\n        // Success!\n        ScaffoldMessenger.of(context).showSnackBar(\n          SnackBar(\n            content: Text('ðŸŽ‰ Welcome to Premium!'),\n            backgroundColor: Colors.green,\n          ),\n        );\n        \n        // Navigate to homepage\n        context.pushNamed(HomepageWidget.routeName);\n      } else if (result.userCancelled) {\n        // User cancelled\n        debugPrint('User cancelled purchase');\n      } else {\n        // Error\n        ScaffoldMessenger.of(context).showSnackBar(\n          SnackBar(\n            content: Text(result.error ?? 'Purchase failed'),\n            backgroundColor: Colors.red,\n          ),\n        );\n      }\n    } catch (e) {\n      // Close loading\n      Navigator.of(context).pop();\n      \n      ScaffoldMessenger.of(context).showSnackBar(\n        SnackBar(\n          content: Text('Error: $e'),\n          backgroundColor: Colors.red,\n        ),\n      );\n    }\n  },\n  text: FFLocalizations.of(context).getText('Continue'),\n  options: FFButtonOptions(\n    width: double.infinity,\n    height: 56.0,\n    color: Color(0xFF9810FA),\n    textStyle: TextStyle(\n      color: Colors.white,\n      fontSize: 18,\n      fontWeight: FontWeight.bold,\n    ),\n    borderRadius: BorderRadius.circular(28),\n  ),\n),\n```\n\n---\n\n## ðŸ§ª TESTING GUIDE\n\n### Test 1: Load Products\n\n**Steps:**\n1. Build debug APK:\n   ```bash\n   flutter build apk --debug\n   ```\n\n2. Install trÃªn Android device\n\n3. Open app â†’ Navigate to Pro page\n\n4. **Expected:**\n   - âœ… Loading indicator appears\n   - âœ… 3 packages load (Lifetime, Year, Week)\n   - âœ… Prices display from RevenueCat test products\n   - âœ… Console logs: \"âœ… Loaded 3 subscription packages\"\n\n---\n\n### Test 2: Mock Purchase (RevenueCat Test Mode)\n\n**Steps:**\n1. Select a package (e.g., Weekly)\n\n2. Click \"Continue\"\n\n3. **Expected:**\n   - âœ… Purchase dialog appears (mock)\n   - âœ… Purchase succeeds immediately (no payment)\n   - âœ… Snackbar: \"ðŸŽ‰ Welcome to Premium!\"\n   - âœ… Navigate back to homepage\n   - âœ… Ads automatically disabled (premium user)\n\n4. **Verify in RevenueCat Dashboard:**\n   - Dashboard â†’ Customers â†’ See new test customer\n   - Customer has active \"pro\" entitlement\n\n---\n\n### Test 3: Restore Purchases\n\n**Steps:**\n1. Uninstall app\n\n2. Reinstall app\n\n3. Open Pro page\n\n4. Click \"Restore\"\n\n5. **Expected:**\n   - âœ… Snackbar: \"Restoring purchases...\"\n   - âœ… RevenueCat checks previous purchases\n   - âœ… If found: \"âœ… Purchases restored! You are now premium.\"\n   - âœ… Premium status restored â†’ Ads disabled\n\n---\n\n### Test 4: Premium User - Ads Disabled\n\n**Steps:**\n1. Complete a purchase\n\n2. Navigate to any page with ads (Homepage, AI Tools, etc.)\n\n3. **Expected:**\n   - âŒ NO Banner Ads displayed\n   - âŒ NO App Open Ads\n   - âŒ NO Rewarded Ads required\n   - âœ… UserService().isPremiumUser = true\n   - âœ… RemoteConfigService() auto-bypasses ads\n\n---\n\n## ðŸ”§ TROUBLESHOOTING\n\n### Issue 1: \"No offerings available\"\n\n**Problem:** `_currentOfferings?.current == null`\n\n**Solutions:**\n1. Check RevenueCat Dashboard â†’ Products â†’ At least 1 product created\n2. Check Entitlements â†’ Products attached\n3. Check Offerings â†’ \"default\" offering exists\n4. Wait 5 minutes for RevenueCat sync\n\n---\n\n### Issue 2: \"Purchase fails immediately\"\n\n**Problem:** PurchasesErrorCode.productNotAvailableForPurchaseError\n\n**Solutions:**\n1. **Using test mode:** Products auto-available\n2. **Using Google Play:** \n   - App uploaded to Internal Testing\n   - Products created in Play Console\n   - Products activated\n   - RevenueCat linked to Play Console (service account)\n\n---\n\n### Issue 3: \"Restore returns no purchases\"\n\n**Problem:** No active subscriptions found\n\n**Solutions:**\n1. **Test mode:** Make at least 1 mock purchase first\n2. **Google Play:** \n   - Purchase made on same Google account\n   - Subscription still active (not expired/cancelled)\n3. Check RevenueCat Dashboard â†’ Customers â†’ Verify purchase exists\n\n---\n\n### Issue 4: \"Prices show $0.00\"\n\n**Problem:** Products not loaded from store\n\n**Solutions:**\n1. **Test mode:** Check Products in RevenueCat Dashboard have prices\n2. **Google Play:** \n   - Products created in Play Console\n   - Prices set correctly\n   - App uploaded (minimum Internal Testing)\n\n---\n\n## ðŸ“ NEXT STEPS - KHI GOOGLE PLAY APPROVED\n\n### 1. Create Products in Google Play Console\n\n**Google Play Console â†’ Monetize â†’ In-app products**\n\n```\nviso_ai_weekly:\n- Price: â‚«165,000\n- Billing: Every 1 week\n\nviso_ai_yearly:\n- Price: â‚«944,000  \n- Billing: Every 1 year\n\nviso_ai_lifetime:\n- Price: â‚«2,050,000\n- Type: Non-renewing subscription\n```\n\n---\n\n### 2. Link RevenueCat to Google Play\n\n**RevenueCat Dashboard â†’ Project Settings â†’ Service Credentials**\n\n1. Download `service-account.json` from Google Play Console:\n   - **Settings** â†’ **API access** â†’ **Service accounts**\n   - Create or use existing service account\n   - Grant \"View financial data\" permission\n   - Download JSON key\n\n2. Upload to RevenueCat:\n   - Click **\"Google Play\"**\n   - Upload `service-account.json`\n   - Click **\"Save\"**\n\n---\n\n### 3. Import Products\n\n**RevenueCat Dashboard â†’ Products**\n\nClick **\"Import from Google Play\"**\n\nRevenueCat auto-syncs:\n- âœ… Product IDs\n- âœ… Prices\n- âœ… Subscription durations\n\n---\n\n### 4. Switch to Production API Key\n\n**âš ï¸ CRITICAL - Security Notice:**\n\n**NEVER ship the test key to production!** Test key = `test_OvwtrjRddtWRHgmNdZgxCTiYLYX` is for local development only.\n\n**When ready for production:**\n\n1. RevenueCat Dashboard â†’ **API Keys**\n2. Copy **Public SDK key (Production)** for Android & iOS:\n   - Android: `prod_xxxxxxxxxxxxx`\n   - iOS: `appl_xxxxxxxxxxxxx`\n\n3. **Option A: Using Replit Secrets (RECOMMENDED)**\n   ```\n   1. Replit Console â†’ Secrets (Lock icon)\n   2. Add secrets:\n      - REVENUECAT_ANDROID_KEY=prod_xxxxxxxxxxxxx\n      - REVENUECAT_IOS_KEY=appl_xxxxxxxxxxxxx\n   3. App auto-loads from environment\n   ```\n\n4. **Option B: Build-time configuration**\n   ```bash\n   # Android\n   flutter build apk --release \\\n     --dart-define=REVENUECAT_ANDROID_KEY=prod_xxxxx\n\n   # iOS\n   flutter build ipa --release \\\n     --dart-define=REVENUECAT_IOS_KEY=appl_xxxxx\n   ```\n\n5. **Verify production key loaded:**\n   - Check logs: `ðŸ›’ Initializing RevenueCat with key: prod_xxxxx...`\n   - If logs show `test_uSu...` â†’ **STOP! Still using test key!**\n\n---\n\n## ðŸŽ¯ SUMMARY\n\n### âœ… Current Status\n\n- [x] RevenueCat SDK integrated\n- [x] RevenueCatService created\n- [x] Test API key configured\n- [x] Can test purchases locally (mock)\n\n### ðŸš€ Test NOW (KhÃ´ng cáº§n Google Play)\n\n```bash\n# Build debug APK\nflutter build apk --debug\n\n# Install\nadb install build/app/outputs/flutter-apk/app-debug.apk\n\n# Test purchases (FREE, mock mode)\n```\n\n### ðŸ“± Production (Sau khi Google Play approved)\n\n1. Create products in Play Console\n2. Link RevenueCat â†” Google Play\n3. Import products\n4. Switch to production API key\n5. Upload release APK\n6. Test with real sandbox purchases (still FREE)\n\n---\n\n## ðŸ’¡ KEY POINTS\n\n**Email khÃ¡c nhau:** âœ… RevenueCat email A, Play Console email B = OK\n\n**Thanh toÃ¡n:** ðŸ’° Google Play â†’ Bank anh | RevenueCat khÃ´ng Ä‘á»™ng vÃ o tiá»n\n\n**Doanh thu >$10k:** ðŸ“Š RevenueCat charge 1% tracked revenue ($15k â†’ pay $50/month)\n\n**Test miá»…n phÃ­:**\n- âœ… RevenueCat test mode (ngay bÃ¢y giá»)\n- âœ… Google Play sandbox (sau khi approved)\n- âœ… KhÃ´ng máº¥t tiá»n cho cáº£ 2 options!\n\n---\n\n**CÃ³ tháº¯c máº¯c gÃ¬ anh inbox em nhÃ©! ðŸ˜Š**\n","size_bytes":20246},"PRO_PAGE_INTEGRATION_INSTRUCTIONS.md":{"content":"# ðŸ›’ Pro Page Integration - RevenueCat Dynamic Subscription Cards\n\n## ðŸ“‹ TL;DR\n\nPro widget hiá»‡n táº¡i cÃ³ **1127 dÃ²ng** code (99% lÃ  UI styling tá»« FlutterFlow). Anh chá»‰ cáº§n:\n1. âœ… Add 2 imports\n2. âœ… Update initState (add 1 method call)\n3. âœ… Update Restore button handler\n4. âœ… Update Continue button handler  \n5. âœ… Replace 3 hardcoded subscription cards vá»›i dynamic rendering\n\n**Estimated time:** 10-15 phÃºt\n\n---\n\n## âœ… ÄÃƒ HOÃ€N THÃ€NH\n\n- [x] `RevenueCatService` created vÃ  tested\n- [x] `ProModel` updated vá»›i fields: `isLoading`, `errorMessage`, `availablePackages`, `selectedPackageIndex`\n- [x] RevenueCat initialized trong `main.dart`\n\n---\n\n## ðŸ”§ CÃC BÆ¯á»šC INTEGRATE\n\n### **BÆ°á»›c 1: Add Imports** (Line 1-10)\n\n**File:** `lib/pro/pro_widget.dart`\n\n**Add these imports:**\n```dart\nimport '/services/revenue_cat_service.dart';\nimport 'package:purchases_flutter/purchases_flutter.dart';\n```\n\n**Result:**\n```dart\nimport '/flutter_flow/flutter_flow_icon_button.dart';\nimport '/flutter_flow/flutter_flow_theme.dart';\nimport '/flutter_flow/flutter_flow_util.dart';\nimport '/flutter_flow/flutter_flow_widgets.dart';\nimport '/index.dart';\nimport '/services/revenue_cat_service.dart';  // âœ… NEW\nimport 'package:flutter/material.dart';\nimport 'package:google_fonts/google_fonts.dart';\nimport 'package:purchases_flutter/purchases_flutter.dart';  // âœ… NEW\nimport 'pro_model.dart';\nexport 'pro_model.dart';\n```\n\n---\n\n### **BÆ°á»›c 2: Update initState** (Line ~28-32)\n\n**BEFORE:**\n```dart\n@override\nvoid initState() {\n  super.initState();\n  _model = createModel(context, () => ProModel());\n}\n```\n\n**AFTER:**\n```dart\n@override\nvoid initState() {\n  super.initState();\n  _model = createModel(context, () => ProModel());\n  \n  // Load RevenueCat subscription packages\n  _loadSubscriptionPackages();\n}\n\n/// Load subscription packages from RevenueCat\nFuture<void> _loadSubscriptionPackages() async {\n  setState(() {\n    _model.isLoading = true;\n    _model.errorMessage = null;\n  });\n\n  try {\n    final packages = await RevenueCatService().getSubscriptionPackages();\n    \n    setState(() {\n      _model.availablePackages = packages;\n      _model.isLoading = false;\n      \n      // Auto-select first package (Lifetime - best value)\n      if (packages.isNotEmpty) {\n        _model.selectedPackageIndex = 0;\n      }\n    });\n    \n    debugPrint('âœ… Loaded ${packages.length} subscription packages');\n  } catch (e) {\n    setState(() {\n      _model.isLoading = false;\n      _model.errorMessage = 'Failed to load subscription plans. Please try again.';\n    });\n    \n    debugPrint('âŒ Error loading packages: $e');\n  }\n}\n```\n\n---\n\n### **BÆ°á»›c 3: Update Restore Button** (Line ~100-140)\n\n**Find this:**\n```dart\nFFButtonWidget(\n  onPressed: () {\n    print('Button pressed ...');\n  },\n  text: FFLocalizations.of(context).getText(\n    '8de8u8eh' /* Restore */,\n  ),\n```\n\n**Replace with:**\n```dart\nFFButtonWidget(\n  onPressed: () async {\n    // Show loading\n    ScaffoldMessenger.of(context).showSnackBar(\n      SnackBar(\n        content: Text('Restoring purchases...'),\n        duration: Duration(seconds: 2),\n      ),\n    );\n    \n    // Restore purchases\n    try {\n      final result = await RevenueCatService().restorePurchases();\n      \n      if (result.success && result.isPremium) {\n        // Success\n        if (context.mounted) {\n          ScaffoldMessenger.of(context).showSnackBar(\n            SnackBar(\n              content: Text('âœ… Purchases restored! You are now premium.'),\n              backgroundColor: Colors.green,\n              duration: Duration(seconds: 3),\n            ),\n          );\n          \n          // Navigate back to homepage\n          context.pushNamed(HomepageWidget.routeName);\n        }\n      } else {\n        // No purchases found\n        if (context.mounted) {\n          ScaffoldMessenger.of(context).showSnackBar(\n            SnackBar(\n              content: Text(result.message ?? 'No active purchases found'),\n              backgroundColor: Colors.orange,\n              duration: Duration(seconds: 3),\n            ),\n          );\n        }\n      }\n    } catch (e) {\n      if (context.mounted) {\n        ScaffoldMessenger.of(context).showSnackBar(\n          SnackBar(\n            content: Text('Error restoring purchases: $e'),\n            backgroundColor: Colors.red,\n            duration: Duration(seconds: 3),\n          ),\n        );\n      }\n    }\n  },\n  text: FFLocalizations.of(context).getText(\n    '8de8u8eh' /* Restore */,\n  ),\n```\n\n---\n\n### **BÆ°á»›c 4: Update Continue Button** (Line ~945-980)\n\n**Find this:**\n```dart\nFFButtonWidget(\n  onPressed: () {\n    print('Button pressed ...');\n  },\n  text: FFLocalizations.of(context).getText(\n    '6qgq3qxc' /* Continue */,\n  ),\n```\n\n**Replace with:**\n```dart\nFFButtonWidget(\n  onPressed: _model.isLoading || \n             _model.selectedPackageIndex == null ||\n             _model.availablePackages.isEmpty\n      ? null\n      : () async {\n    // Get selected package\n    final package = _model.availablePackages[_model.selectedPackageIndex!];\n    \n    // Show loading dialog\n    showDialog(\n      context: context,\n      barrierDismissible: false,\n      builder: (context) => Center(\n        child: Container(\n          padding: EdgeInsets.all(24),\n          decoration: BoxDecoration(\n            color: Colors.white,\n            borderRadius: BorderRadius.circular(12),\n          ),\n          child: Column(\n            mainAxisSize: MainAxisSize.min,\n            children: [\n              CircularProgressIndicator(),\n              SizedBox(height: 16),\n              Text(\n                'Processing purchase...',\n                style: TextStyle(fontSize: 16),\n              ),\n            ],\n          ),\n        ),\n      ),\n    );\n    \n    try {\n      // Purchase package\n      final result = await RevenueCatService().purchasePackage(package);\n      \n      // Close loading dialog\n      if (context.mounted) {\n        Navigator.of(context).pop();\n      }\n      \n      if (result.success && result.isPremium) {\n        // Success!\n        if (context.mounted) {\n          ScaffoldMessenger.of(context).showSnackBar(\n            SnackBar(\n              content: Text('ðŸŽ‰ Welcome to Premium! All features unlocked.'),\n              backgroundColor: Colors.green,\n              duration: Duration(seconds: 3),\n            ),\n          );\n          \n          // Navigate back to homepage\n          await Future.delayed(Duration(seconds: 1));\n          if (context.mounted) {\n            context.pushNamed(HomepageWidget.routeName);\n          }\n        }\n      } else if (result.userCancelled) {\n        // User cancelled - no message needed\n        debugPrint('User cancelled purchase');\n      } else {\n        // Error\n        if (context.mounted) {\n          ScaffoldMessenger.of(context).showSnackBar(\n            SnackBar(\n              content: Text(result.error ?? 'Purchase failed. Please try again.'),\n              backgroundColor: Colors.red,\n              duration: Duration(seconds: 3),\n            ),\n          );\n        }\n      }\n    } catch (e) {\n      // Close loading dialog\n      if (context.mounted) {\n        Navigator.of(context).pop();\n      }\n      \n      if (context.mounted) {\n        ScaffoldMessenger.of(context).showSnackBar(\n          SnackBar(\n            content: Text('Error: $e'),\n            backgroundColor: Colors.red,\n            duration: Duration(seconds: 3),\n          ),\n        );\n      }\n    }\n  },\n  text: FFLocalizations.of(context).getText(\n    '6qgq3qxc' /* Continue */,\n  ),\n```\n\n---\n\n### **BÆ°á»›c 5: Replace Hardcoded Subscription Cards** (Line ~504-1027)\n\nÄÃ¢y lÃ  pháº§n **phá»©c táº¡p nháº¥t** vÃ¬ cÃ³ **500+ dÃ²ng code styling** cho 3 cards.\n\n#### **Option A: Keep Hardcoded UI + Update Prices Only (SIMPLEST)**\n\nGiá»¯ nguyÃªn UI structure, chá»‰ replace 3 hardcoded prices vá»›i dynamic prices:\n\n**Find these 3 prices vÃ  replace:**\n\n1. **Lifetime price** (Line ~570):\n   ```dart\n   // BEFORE\n   Text(\n     FFLocalizations.of(context).getText(\n       'b1j0s4jo' /* â‚«2,050,000 */,\n     ),\n   \n   // AFTER\n   Text(\n     _model.availablePackages.isNotEmpty && _model.availablePackages.length > 0\n         ? _model.availablePackages[0].storeProduct.priceString\n         : 'â‚«2,050,000',  // Fallback\n   ```\n\n2. **Yearly price** (Line ~743):\n   ```dart\n   // BEFORE\n   Text(\n     FFLocalizations.of(context).getText(\n       'hsgsqr0o' /* â‚«944,000 */,\n     ),\n   \n   // AFTER\n   Text(\n     _model.availablePackages.length > 1\n         ? _model.availablePackages[1].storeProduct.priceString\n         : 'â‚«944,000',  // Fallback\n   ```\n\n3. **Weekly price** (Line ~915):\n   ```dart\n   // BEFORE\n   Text(\n     FFLocalizations.of(context).getText(\n       'uxqsw0x2' /* â‚«165,000 */,\n     ),\n   \n   // AFTER\n   Text(\n     _model.availablePackages.length > 2\n         ? _model.availablePackages[2].storeProduct.priceString\n         : 'â‚«165,000',  // Fallback\n   ```\n\n**Pros:** Simplest, keeps existing UI  \n**Cons:** Prices won't match if RevenueCat products order changes\n\n---\n\n#### **Option B: Full Dynamic Rendering (RECOMMENDED)**\n\nReplace toÃ n bá»™ 3 cards section vá»›i dynamic rendering tá»« packages.\n\n**Find this Row (Line ~504):**\n```dart\nRow(\n  mainAxisSize: MainAxisSize.max,\n  mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n  children: [\n    Container(  // First card (Lifetime)\n      width: 110.0,\n      ...\n    ),\n    Container(  // Second card (Year)\n      ...\n    ),\n    Container(  // Third card (Week)\n      ...\n    ),\n  ].divide(SizedBox(width: 8.0)),\n),\n```\n\n**Replace entire Row vá»›i:**\n```dart\n// Dynamic subscription cards from RevenueCat\n_model.isLoading\n    ? Center(\n        child: Padding(\n          padding: EdgeInsets.all(32.0),\n          child: CircularProgressIndicator(\n            color: Colors.white,\n          ),\n        ),\n      )\n    : _model.errorMessage != null\n        ? Center(\n            child: Padding(\n              padding: EdgeInsets.all(24.0),\n              child: Text(\n                _model.errorMessage!,\n                textAlign: TextAlign.center,\n                style: TextStyle(\n                  color: Colors.white,\n                  fontSize: 16,\n                ),\n              ),\n            ),\n          )\n        : Row(\n            mainAxisSize: MainAxisSize.max,\n            mainAxisAlignment: MainAxisAlignment.spaceEvenly,\n            children: _model.availablePackages.asMap().entries.map((entry) {\n              final index = entry.key;\n              final package = entry.value;\n              final product = package.storeProduct;\n              final isSelected = _model.selectedPackageIndex == index;\n              \n              // Package metadata\n              final isLifetime = package.packageType == PackageType.lifetime;\n              final isAnnual = package.packageType == PackageType.annual;\n              final isWeekly = package.packageType == PackageType.weekly;\n              \n              return GestureDetector(\n                onTap: () {\n                  setState(() {\n                    _model.selectedPackageIndex = index;\n                  });\n                },\n                child: Container(\n                  width: 110.0,\n                  height: 160.0,\n                  decoration: BoxDecoration(\n                    color: isSelected \n                        ? Color(0xFF9810FA) \n                        : FlutterFlowTheme.of(context).accent1,\n                    borderRadius: BorderRadius.circular(16.0),\n                    border: Border.all(\n                      color: FlutterFlowTheme.of(context).secondaryBackground,\n                      width: isSelected ? 2.0 : 1.0,\n                    ),\n                  ),\n                  child: Padding(\n                    padding: EdgeInsets.all(12.0),\n                    child: Column(\n                      mainAxisSize: MainAxisSize.max,\n                      mainAxisAlignment: MainAxisAlignment.spaceBetween,\n                      children: [\n                        // Badge (BEST VALUE, SAVE 89%, etc.)\n                        if (isLifetime)\n                          Container(\n                            width: double.infinity,\n                            height: 24.0,\n                            decoration: BoxDecoration(\n                              color: Color(0xFF1E2939),\n                              borderRadius: BorderRadius.circular(12.0),\n                            ),\n                            child: Align(\n                              alignment: AlignmentDirectional(0.0, 0.0),\n                              child: Text(\n                                'BEST VALUE',\n                                textAlign: TextAlign.center,\n                                style: TextStyle(\n                                  color: Colors.white,\n                                  fontSize: 12.0,\n                                  fontWeight: FontWeight.w500,\n                                ),\n                              ),\n                            ),\n                          )\n                        else if (isAnnual)\n                          Container(\n                            width: double.infinity,\n                            height: 24.0,\n                            decoration: BoxDecoration(\n                              color: Color(0xFF00C950),\n                              borderRadius: BorderRadius.circular(12.0),\n                            ),\n                            child: Align(\n                              alignment: AlignmentDirectional(0.0, 0.0),\n                              child: Text(\n                                'SAVE 89%',\n                                textAlign: TextAlign.center,\n                                style: TextStyle(\n                                  color: Colors.white,\n                                  fontSize: 12.0,\n                                  fontWeight: FontWeight.w500,\n                                ),\n                              ),\n                            ),\n                          )\n                        else\n                          SizedBox(height: 24.0), // Placeholder for alignment\n                        \n                        // Icon\n                        Column(\n                          children: [\n                            Text(\n                              isLifetime ? 'âˆž' : isAnnual ? 'ðŸ“…' : 'ðŸ—“ï¸',\n                              textAlign: TextAlign.center,\n                              style: TextStyle(\n                                fontSize: 30.0,\n                                color: Colors.white,\n                              ),\n                            ),\n                            SizedBox(height: 8),\n                            Text(\n                              isLifetime \n                                  ? 'Lifetime\\n1 purchase' \n                                  : isAnnual \n                                      ? 'Year\\nBest value' \n                                      : 'Week\\nâ‚«23,571/day',\n                              textAlign: TextAlign.center,\n                              style: TextStyle(\n                                color: Colors.white,\n                                fontSize: 14.0,\n                                height: 1.4,\n                              ),\n                            ),\n                          ],\n                        ),\n                        \n                        // Price (DYNAMIC from RevenueCat!)\n                        Text(\n                          product.priceString,\n                          textAlign: TextAlign.center,\n                          style: TextStyle(\n                            color: Colors.white,\n                            fontSize: 18.0,\n                            fontWeight: FontWeight.bold,\n                          ),\n                        ),\n                      ],\n                    ),\n                  ),\n                ),\n              );\n            }).toList(),\n          ),\n```\n\n**Pros:** Fully dynamic, adapts to any products in RevenueCat  \n**Cons:** More code to replace\n\n---\n\n## ðŸ§ª TESTING\n\n### Test 1: Load Products\n1. Open Pro page\n2. **Expected:** Loading spinner â†’ 3 cards appear vá»›i real prices tá»« RevenueCat\n\n### Test 2: Select Package\n1. Tap on a package card\n2. **Expected:** Card highlights (purple background, thicker border)\n\n### Test 3: Purchase\n1. Select package\n2. Click \"Continue\"\n3. **Expected:** Loading dialog â†’ Success message â†’ Navigate to homepage â†’ Ads disabled\n\n### Test 4: Restore\n1. Click \"Restore\"\n2. **Expected:** \"Restoring...\" â†’ Success/No purchases message\n\n---\n\n## ðŸŽ¯ SUMMARY\n\n**Integration complexity:**\n- **Option A** (Update prices only): â­â­â˜†â˜†â˜† (5 phÃºt - Easiest)\n- **Option B** (Full dynamic rendering): â­â­â­â­â˜† (15 phÃºt - Recommended)\n\n**Recommended: Option B** - Fully dynamic, production-ready\n\n---\n\n**Questions? Let me know! ðŸ˜Š**\n","size_bytes":16939},"BUILD_APK_TESTING_GUIDE.md":{"content":"# ðŸ§ª Build APK Ä‘á»ƒ Test Ads + IAP\n\n## ðŸŽ¯ Má»¥c tiÃªu\nBuild APK debug Ä‘á»ƒ test **Cáº¢ Ads VÃ€ IAP** trÃªn device tháº­t.\n\n---\n\n## âœ… Prerequisites (Setup trÆ°á»›c khi build)\n\n### **A. Setup Firebase Remote Config (Enable Ads)**\n\n#### **BÆ°á»›c 1: Login Firebase Console**\nhttps://console.firebase.google.com/project/viso-ai-photo-avatar\n\n#### **BÆ°á»›c 2: VÃ o Remote Config**\n```\nFirebase Console â†’ Engage â†’ Remote Config\n```\n\n#### **BÆ°á»›c 3: ThÃªm Parameters (6 params)**\n\nClick **\"Add parameter\"** vÃ  táº¡o tá»«ng parameter sau:\n\n| Parameter name | Data type | Default value |\n|----------------|-----------|---------------|\n| `ads_enabled` | Boolean | `true` |\n| `banner_ads_enabled` | Boolean | `true` |\n| `rewarded_ads_enabled` | Boolean | `true` |\n| `interstitial_ads_enabled` | Boolean | `true` |\n| `app_open_ads_enabled` | Boolean | `true` |\n| `native_ads_enabled` | Boolean | `false` |\n\n**LÆ°u Ã½:**\n- âš ï¸ **TÃªn pháº£i CHÃNH XÃC** (trÃ¹ng vá»›i code trong `RemoteConfigService`)\n- âš ï¸ **Toggle \"Use in-app default\" = OFF** (Ä‘á»ƒ dÃ¹ng giÃ¡ trá»‹ tá»« Console)\n\n#### **BÆ°á»›c 4: Publish Changes**\n```\nClick \"Publish changes\" button (mÃ u xanh) á»Ÿ gÃ³c trÃªn bÃªn pháº£i\n```\n\n**Verify:**\n```\nâœ… 6 parameters hiá»ƒn thá»‹ trong Remote Config dashboard\nâœ… Status: Published\n```\n\n---\n\n### **B. Setup RevenueCat (Enable IAP)**\n\n#### **BÆ°á»›c 1: Login RevenueCat Dashboard**\nhttps://app.revenuecat.com\n\n#### **BÆ°á»›c 2: Create Products**\n(Tab \"Products\" â†’ Click \"Add product\")\n\n| Product ID | Type | Description |\n|-----------|------|-------------|\n| `lifetime_2050k` | Non-consumable | Lifetime access |\n| `yearly_944k` | Auto-renewable subscription | Yearly subscription |\n| `weekly_165k` | Auto-renewable subscription | Weekly subscription |\n\n#### **BÆ°á»›c 3: Create Entitlement**\n(Tab \"Entitlements\" â†’ Click \"New entitlement\")\n\n- **Identifier:** `premium`\n- **Description:** Full access to premium features\n- **Attach products:** Select all 3 products above\n\n#### **BÆ°á»›c 4: Create Offering**\n(Tab \"Offerings\" â†’ Click \"New offering\")\n\n- **Identifier:** `default`\n- **Add 3 packages:**\n  1. Package type: **Lifetime** â†’ Product: `lifetime_2050k`\n  2. Package type: **Annual** â†’ Product: `yearly_944k`\n  3. Package type: **Weekly** â†’ Product: `weekly_165k`\n\n**Verify:**\n```\nâœ… 3 products created\nâœ… 1 entitlement \"premium\" with 3 attached products\nâœ… 1 offering \"default\" with 3 packages\n```\n\n---\n\n## ðŸ› ï¸ Build APK (TrÃªn mÃ¡y Local)\n\n### **Prerequisites:**\n- âœ… Android Studio hoáº·c Android SDK installed\n- âœ… Flutter SDK installed\n- âœ… USB Debugging enabled trÃªn Android device\n\n### **BÆ°á»›c 1: Download Project**\n\n**Option A: Download ZIP tá»« Replit**\n1. Click \"...\" menu â†’ Download as ZIP\n2. Extract ZIP file\n3. Open terminal táº¡i thÆ° má»¥c project\n\n**Option B: Clone tá»« GitHub (náº¿u anh Ä‘Ã£ push)**\n```bash\ngit clone <your-repo-url>\ncd viso-ai-project\n```\n\n### **BÆ°á»›c 2: Install Dependencies**\n\n```bash\n# Terminal (táº¡i thÆ° má»¥c project)\nflutter pub get\n```\n\nExpected output:\n```\nRunning \"flutter pub get\" in viso-ai-project...\nResolving dependencies... (X.Xs)\nGot dependencies!\n```\n\n### **BÆ°á»›c 3: Verify Firebase Setup**\n\n```bash\nflutter doctor\n```\n\nExpected:\n```\nâœ“ Flutter (Channel stable, 3.32.0)\nâœ“ Android toolchain - develop for Android devices\nâœ“ Connected device (1 available)  â† Cáº§n cÃ³ dÃ²ng nÃ y!\n```\n\n### **BÆ°á»›c 4: Build APK Debug**\n\n```bash\n# Build debug APK (cÃ³ debug symbols, faster build)\nflutter build apk --debug\n```\n\n**Build time:** 3-5 phÃºt (láº§n Ä‘áº§u cÃ³ thá»ƒ lÃ¢u hÆ¡n)\n\n**Output location:**\n```\nbuild/app/outputs/flutter-apk/app-debug.apk\n```\n\n**File size:** ~50-70MB\n\n---\n\n## ðŸ“± Install & Test APK\n\n### **A. Install APK lÃªn Device**\n\n**Option 1: Via USB (Khuyáº¿n nghá»‹)**\n```bash\n# Connect device via USB â†’ Enable USB debugging\n\n# Install APK\nadb install build/app/outputs/flutter-apk/app-debug.apk\n\n# Or use flutter directly\nflutter install\n```\n\n**Option 2: Transfer APK file**\n1. Copy `app-debug.apk` vÃ o device (via USB/cloud)\n2. Open file trÃªn device\n3. Allow \"Install from unknown sources\"\n4. Install app\n\n---\n\n### **B. Test Ads Flow**\n\n#### **1. Launch App**\n```\nOpen app â†’ Wait for Firebase Remote Config fetch\n```\n\n**Check logs** (náº¿u connected via USB):\n```bash\nadb logcat | grep RemoteConfig\n```\n\nExpected output:\n```\nâœ… Remote Config initialized\n   - ads_enabled: true\n   - banner_ads_enabled: true\n   - rewarded_ads_enabled: true\n   - app_open_ads_enabled: true\n```\n\n#### **2. Navigate Pages â†’ Verify Ads Display**\n\n| Page | Ad Type | Expected Behavior |\n|------|---------|-------------------|\n| **Homepage** | Banner Ad | Shows at bottom navigation |\n| **AI Tools** | Banner Ad | Shows at bottom navigation |\n| **Face Swap** | Rewarded Ad | Button \"Watch ad to unlock\" |\n| **App Open** | App Open Ad | Shows when app opened |\n\n**Screenshots:**\n- âœ… Banner ads visible vá»›i AdMob/AppLovin ads\n- âœ… Rewarded ad button clickable\n- âœ… App open ad shows (náº¿u enabled)\n\n#### **3. Test Premium Bypass**\n```\nNavigate to Pro page â†’ Complete purchase (test mode)\n  â†’ Navigate back to Homepage\n  â†’ âœ… Banner ads KHÃ”NG hiá»ƒn thá»‹ ná»¯a (premium user)\n```\n\n---\n\n### **C. Test IAP Flow**\n\n#### **1. Navigate to Pro Page**\n```\nOpen app â†’ Tap profile icon â†’ Pro page\n```\n\n#### **2. Verify Subscription Cards Load**\n\nExpected:\n```\nâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”\nâ”‚ BEST VALUE  â”‚  â”‚ SAVE 89%    â”‚  â”‚             â”‚\nâ”‚     âˆž       â”‚  â”‚     ðŸ“…      â”‚  â”‚     ðŸ—“ï¸      â”‚\nâ”‚  Lifetime   â”‚  â”‚    Year     â”‚  â”‚    Week     â”‚\nâ”‚  $99.99     â”‚  â”‚   $49.99    â”‚  â”‚   $7.99     â”‚\nâ””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜\n     ^(selected)\n```\n\n**Check:**\n- âœ… Loading spinner shows briefly\n- âœ… 3 cards render vá»›i badges\n- âœ… Prices load tá»« RevenueCat (dynamic)\n- âœ… First card (Lifetime) auto-selected\n\n#### **3. Test Purchase Flow (Test Mode)**\n\n```bash\n# Tap Continue button\nâ†’ Loading dialog: \"Processing purchase...\"\nâ†’ RevenueCat test mode: Mock purchase success\nâ†’ SnackBar: \"Purchase successful!\"\nâ†’ Navigate back â†’ Ads disabled (premium user)\n```\n\n**Check logs:**\n```bash\nadb logcat | grep RevenueCat\n```\n\nExpected:\n```\nâœ… Loaded 3 subscription packages\nPackage: Lifetime - $99.99\nPackage: Yearly - $49.99\nPackage: Weekly - $7.99\nâœ… Purchase successful (test mode)\n```\n\n#### **4. Test Restore Flow**\n\n```bash\n# Tap Restore button\nâ†’ RevenueCat restore API called\nâ†’ SnackBar: \"Purchases restored successfully!\" (hoáº·c \"No purchases found\")\n```\n\n---\n\n## ðŸ› Troubleshooting\n\n### **Issue 1: \"No subscription packages available\"**\n\n**NguyÃªn nhÃ¢n:** RevenueCat Dashboard chÆ°a setup Ä‘Ãºng\n\n**Fix:**\n1. Verify offering identifier = `default` (pháº£i trÃ¹ng vá»›i code)\n2. Check 3 packages exist trong offering\n3. Verify API key trong `lib/services/revenue_cat_service.dart` (test_OvwtrjRddtWRHgmNdZgxCTiYLYX)\n\n**Logs:**\n```bash\nadb logcat | grep RevenueCat\n# âŒ Error loading packages: ...\n```\n\n---\n\n### **Issue 2: \"Ads not showing\"**\n\n**NguyÃªn nhÃ¢n:** Remote Config chÆ°a fetch hoáº·c AdMob test mode\n\n**Fix:**\n1. **Check Remote Config:**\n   ```bash\n   adb logcat | grep \"ads_enabled\"\n   # Expected: ads_enabled: true\n   ```\n\n2. **Enable test ads:**\n   - AdMob test ads cÃ³ thá»ƒ khÃ´ng show ngay\n   - Wait 1-2 minutes sau khi install\n   - Test vá»›i device Ä‘Ã£ Ä‘Äƒng kÃ½ test ads trÃªn AdMob\n\n3. **Check Firebase Console:**\n   - Remote Config parameters published?\n   - Values = true?\n\n---\n\n### **Issue 3: \"Flutter build fails\"**\n\n**NguyÃªn nhÃ¢n:** Android SDK hoáº·c dependencies issues\n\n**Fix:**\n```bash\n# Clean build\nflutter clean\nflutter pub get\n\n# Check dependencies\nflutter doctor -v\n\n# Ensure Android SDK installed\n# Android Studio â†’ SDK Manager â†’ Install Android SDK\n```\n\n---\n\n### **Issue 4: \"Cannot install APK\"**\n\n**NguyÃªn nhÃ¢n:** Device security settings\n\n**Fix:**\n```\nSettings â†’ Security â†’ Unknown sources â†’ Enable\nSettings â†’ Apps â†’ Special access â†’ Install unknown apps â†’ Allow\n```\n\n---\n\n## ðŸ“Š Expected Behavior Summary\n\n### **Free User (No IAP):**\n- âœ… Ads hiá»ƒn thá»‹ (banner, rewarded, app open)\n- âœ… Pro page shows subscription options\n- âœ… Remote Config: ads_enabled = true\n\n### **Premium User (After IAP purchase):**\n- âœ… Ads KHÃ”NG hiá»ƒn thá»‹ (auto-bypass)\n- âœ… Pro page shows \"Already premium\" or success\n- âœ… Remote Config still returns true, but UserService.isPremiumUser overrides\n\n### **Test Mode (RevenueCat):**\n- âœ… Purchases are mocked (khÃ´ng charge tiá»n)\n- âœ… Restore works with mock data\n- âœ… Premium status persists after restart\n\n---\n\n## ðŸ”„ Update Workflow\n\nKhi anh muá»‘n test láº¡i sau khi update code:\n\n```bash\n# 1. Update code trÃªn Replit\n# (Edit files, commit changes)\n\n# 2. Download ZIP hoáº·c pull tá»« GitHub\ngit pull origin main\n\n# 3. Rebuild APK\nflutter clean\nflutter pub get\nflutter build apk --debug\n\n# 4. Reinstall\nadb install -r build/app/outputs/flutter-apk/app-debug.apk\n\n# 5. Test láº¡i\n```\n\n**LÆ°u Ã½:** \n- `-r` flag = reinstall (giá»¯ data cÅ©)\n- Náº¿u muá»‘n clean install: Uninstall app trÆ°á»›c â†’ Install má»›i\n\n---\n\n## âœ… Success Checklist\n\n### **Firebase Remote Config:**\n- [ ] 6 parameters created trong Firebase Console\n- [ ] All values = true (ads enabled)\n- [ ] Changes published\n- [ ] App logs show \"ads_enabled: true\"\n\n### **RevenueCat IAP:**\n- [ ] 3 products created\n- [ ] 1 entitlement \"premium\" with 3 products\n- [ ] 1 offering \"default\" with 3 packages\n- [ ] Pro page loads 3 subscription cards\n- [ ] Purchase flow works (test mode)\n- [ ] Restore flow works\n\n### **APK Build & Install:**\n- [ ] APK built successfully (~50-70MB)\n- [ ] APK installed on device\n- [ ] App launches without crashes\n- [ ] Ads display correctly\n- [ ] IAP Pro page functional\n\n### **Integration Test:**\n- [ ] Free user: Ads show\n- [ ] Purchase subscription â†’ Ads disappear\n- [ ] Restart app â†’ Premium status persists\n- [ ] Restore purchases works\n\n---\n\n## ðŸš€ Next Steps (Production)\n\nSau khi test OK, Ä‘á»ƒ deploy production:\n\n1. **Google Play Console Setup:**\n   - Create app listing\n   - Add in-app products (same IDs)\n   - Submit for review\n\n2. **Replace Test Keys:**\n   ```dart\n   // main.dart\n   await RevenueCat.configure(\n     PurchasesConfiguration(\"appl_xxxxxxxxxxxxx\"), // Production key\n   );\n   ```\n\n3. **Build Release APK:**\n   ```bash\n   flutter build appbundle --release\n   # Output: build/app/outputs/bundle/release/app-release.aab\n   ```\n\n4. **Upload to Play Store:**\n   - Internal testing â†’ Closed testing â†’ Production\n\n---\n\n## ðŸ“š Resources\n\n- **Firebase Console:** https://console.firebase.google.com/project/viso-ai-photo-avatar\n- **RevenueCat Dashboard:** https://app.revenuecat.com\n- **AdMob Console:** https://apps.admob.com\n- **AppLovin Dashboard:** https://dash.applovin.com\n\n---\n\n## ðŸ’¡ Pro Tips\n\nâœ… **Test vá»›i nhiá»u scenarios:**\n- Fresh install (no cache)\n- With/without internet\n- Free user vs Premium user\n- Different device regions\n\nâœ… **Monitor logs real-time:**\n```bash\nadb logcat | grep -E \"RemoteConfig|RevenueCat|AdMob|AppLovin\"\n```\n\nâœ… **Test ads cáº§n thá»i gian:**\n- AdMob test ads cÃ³ thá»ƒ khÃ´ng show ngay\n- Wait 5-10 minutes sau install\n- Try navigate nhiá»u pages Ä‘á»ƒ trigger ads\n\nâœ… **RevenueCat test mode FREE:**\n- KhÃ´ng charge tiá»n\n- Unlimited mock purchases\n- Perfect cho development testing\n","size_bytes":11591},"start_server.sh":{"content":"#!/bin/bash\n\n# Start script for Viso AI - Photo Avatar Headshot App\n# This script handles Flutter web build and starts the Python backend server\n\n# Exit on critical errors\nset -e\n\n# Setup Flutter SDK\nFLUTTER_DIR=\"/home/runner/flutter\"\nif [ ! -x \"$FLUTTER_DIR/bin/flutter\" ]; then\n    echo \"âš ï¸  Flutter SDK not found. Running setup...\"\n    if ! bash setup_flutter.sh; then\n        echo \"âŒ Flutter SDK setup failed. Cannot continue.\"\n        echo \"ðŸ“ Please check the logs and run: bash setup_flutter.sh\"\n        exit 1\n    fi\nfi\n\n# Verify Flutter is now available\nif [ ! -x \"$FLUTTER_DIR/bin/flutter\" ]; then\n    echo \"âŒ Flutter SDK still not available after setup. Aborting.\"\n    exit 1\nfi\n\nexport PATH=\"$FLUTTER_DIR/bin:$PATH\"\n\n# Don't exit on non-critical errors after this point (for Flutter build timeout handling)\nset +e\n\necho \"ðŸš€ Starting Viso AI Setup...\"\n\n# Ensure build directory exists\nmkdir -p build/web\n\n# Check if Flutter web build exists\nif [ ! -f \"build/web/index.html\" ]; then\n    echo \"ðŸ“¦ Flutter web build not found. Building now...\"\n    echo \"âš ï¸  This may take 5-10 minutes on first run...\"\n    \n    # Build Flutter web (HTML renderer will be configured in build output)\n    flutter build web --release 2>&1 | tail -20 &\n    BUILD_PID=$!\n    \n    # Wait for build to complete or timeout after 8 minutes\n    timeout 480 bash -c \"while kill -0 $BUILD_PID 2>/dev/null; do sleep 2; done\" || true\n    \n    if [ ! -f \"build/web/index.html\" ]; then\n        echo \"âš ï¸  Flutter build is still in progress...\"\n        echo \"ðŸ“ Creating minimal placeholder index.html...\"\n        \n        # Create a minimal placeholder that shows the build is in progress\n        cat > build/web/index.html << 'EOF'\n<!DOCTYPE html>\n<html>\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Viso AI - Building...</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n            height: 100vh;\n            margin: 0;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n        }\n        .container {\n            text-align: center;\n            padding: 2rem;\n        }\n        .spinner {\n            border: 4px solid rgba(255,255,255,0.3);\n            border-radius: 50%;\n            border-top: 4px solid white;\n            width: 40px;\n            height: 40px;\n            animation: spin 1s linear infinite;\n            margin: 20px auto;\n        }\n        @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n        }\n    </style>\n</head>\n<body>\n    <div class=\"container\">\n        <h1>ðŸŽ¨ Viso AI - Photo Avatar & Headshot</h1>\n        <div class=\"spinner\"></div>\n        <p>Building Flutter web application...</p>\n        <p style=\"font-size: 0.9em; opacity: 0.8;\">This may take a few minutes. Please refresh the page in a moment.</p>\n        <script>\n            // Auto-refresh every 30 seconds to check if build is complete\n            setTimeout(() => location.reload(), 30000);\n        </script>\n    </div>\n</body>\n</html>\nEOF\n        echo \"âœ… Placeholder page created. Continue building in background...\"\n    fi\nelse\n    echo \"âœ… Flutter web build found\"\nfi\n\n# Start the Python backend server\necho \"ðŸŒ Starting Python backend server on port 5000...\"\npython3 api_server.py\n","size_bytes":3503},"setup_flutter.sh":{"content":"#!/bin/bash\n# Flutter SDK Installation Script for Replit\n# This script installs Flutter 3.x stable for use in the Viso AI project\n\nset -e\n\nFLUTTER_DIR=\"/home/runner/flutter\"\n\necho \"ðŸ”§ Setting up Flutter SDK for Replit...\"\n\n# Check if Flutter is already installed\nif [ -d \"$FLUTTER_DIR\" ] && [ -x \"$FLUTTER_DIR/bin/flutter\" ]; then\n    echo \"âœ… Flutter SDK already installed at $FLUTTER_DIR\"\n    export PATH=\"$FLUTTER_DIR/bin:$PATH\"\n    flutter --version 2>&1 | head -5 || echo \"Flutter installed but may need initialization\"\n    exit 0\nfi\n\n# Install unzip if not available (Replit has nix package manager)\nif ! command -v unzip &> /dev/null; then\n    echo \"ðŸ“¦ Installing unzip via nix...\"\n    if command -v nix-env &> /dev/null; then\n        nix-env -iA nixpkgs.unzip 2>&1 | tail -5\n    else\n        echo \"âŒ Cannot install unzip automatically. Please install it manually:\"\n        echo \"   Via Replit UI: Tools â†’ Packages â†’ Search 'unzip' â†’ Install\"\n        echo \"   Or run: nix-env -iA nixpkgs.unzip\"\n        exit 1\n    fi\n    \n    # Verify installation\n    if ! command -v unzip &> /dev/null; then\n        echo \"âŒ unzip installation failed. Please install manually.\"\n        exit 1\n    fi\nfi\n\n# Clone Flutter SDK\necho \"ðŸ“¥ Downloading Flutter SDK (stable branch)...\"\nif [ ! -d \"$FLUTTER_DIR\" ]; then\n    git clone https://github.com/flutter/flutter.git -b stable --depth 1 \"$FLUTTER_DIR\"\nfi\n\n# Add to PATH\nexport PATH=\"$FLUTTER_DIR/bin:$PATH\"\n\n# Run flutter doctor to trigger initial setup\necho \"ðŸ”§ Initializing Flutter (this may take a few minutes)...\"\ntimeout 300 flutter doctor || echo \"Flutter doctor timed out but SDK should be functional\"\n\necho \"âœ… Flutter SDK setup complete!\"\necho \"ðŸ“ To use Flutter, run: export PATH=\\\"$FLUTTER_DIR/bin:\\$PATH\\\"\"\n","size_bytes":1778},"services/face_swap_gateway.py":{"content":"\"\"\"\nMulti-Provider Face Swap Gateway with Production-Grade Reliability\n\nArchitecture:\n- Provider abstraction for easy switching/fallback\n- Cascading fallback: Replicate â†’ PiAPI\n- Retry logic with exponential backoff\n- Comprehensive input validation\n- Version pinning for stability\n- Webhook support for async operations (PiAPI)\n- Timeout handling per provider\n\nProviders:\n1. Replicate (Image): easel/advanced-face-swap, cdingram/face-swap\n2. PiAPI (Image + Video): Qubico/image-toolkit, Qubico/video-toolkit\n\"\"\"\n\nimport os\nimport base64\nimport asyncio\nimport re\nimport time\nimport hashlib\nfrom abc import ABC, abstractmethod\nfrom typing import Dict, Any, Optional, Tuple, List\nfrom enum import Enum\nimport requests\nimport replicate\nfrom PIL import Image\nimport io\n\nclass FaceSwapMediaType(Enum):\n    IMAGE = \"image\"\n    VIDEO = \"video\"\n\nclass FaceSwapProvider(ABC):\n    \"\"\"Base class for face swap providers\"\"\"\n    \n    @abstractmethod\n    async def swap_face(\n        self, \n        target: str, \n        source: str, \n        media_type: FaceSwapMediaType = FaceSwapMediaType.IMAGE,\n        **kwargs\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Perform face swap\n        \n        Args:\n            target: Target image/video (URL or base64)\n            source: Source face image (URL or base64)\n            media_type: Type of media (image or video)\n            **kwargs: Provider-specific parameters\n            \n        Returns:\n            Dict with 'success', 'result_url', 'message', 'provider'\n        \"\"\"\n        pass\n    \n    @abstractmethod\n    def get_name(self) -> str:\n        \"\"\"Return provider name\"\"\"\n        pass\n    \n    @abstractmethod\n    def get_timeout(self) -> int:\n        \"\"\"Return provider timeout in seconds\"\"\"\n        pass\n\nclass ReplicateProvider(FaceSwapProvider):\n    \"\"\"Replicate face swap provider with version pinning\"\"\"\n    \n    # Version-pinned models for stability (updated 2025-10-15)\n    MODELS = {\n        \"easel\": {\n            \"name\": \"easel/advanced-face-swap\",\n            \"version\": None,  # Use latest (April 2025)\n            \"params\": {\n                \"target_image\": None,\n                \"swap_image\": None,\n                \"hair_source\": \"target\"\n            },\n            \"timeout\": 90,\n            \"priority\": 1\n        },\n        \"omniedge\": {\n            \"name\": \"omniedgeio/face-swap\",\n            \"version\": None,  # Active alternative\n            \"params\": {\n                \"input_image\": None,\n                \"target_image\": None,\n                \"swap_image\": None\n            },\n            \"timeout\": 60,\n            \"priority\": 2\n        }\n    }\n    \n    def __init__(self, api_token: str):\n        self.api_token = api_token\n        os.environ[\"REPLICATE_API_TOKEN\"] = api_token\n    \n    def get_name(self) -> str:\n        return \"Replicate\"\n    \n    def get_timeout(self) -> int:\n        return max(model[\"timeout\"] for model in self.MODELS.values())\n    \n    async def swap_face(\n        self, \n        target: str, \n        source: str, \n        media_type: FaceSwapMediaType = FaceSwapMediaType.IMAGE,\n        **kwargs\n    ) -> Dict[str, Any]:\n        \"\"\"Replicate face swap (image only)\"\"\"\n        \n        if media_type == FaceSwapMediaType.VIDEO:\n            return {\n                \"success\": False,\n                \"error\": \"Replicate provider does not support video face swap\",\n                \"provider\": self.get_name()\n            }\n        \n        # Try models in priority order\n        sorted_models = sorted(self.MODELS.items(), key=lambda x: x[1][\"priority\"])\n        \n        last_error = None\n        last_model_name = \"unknown\"\n        last_timeout = 60\n        \n        for model_key, model_config in sorted_models:\n            try:\n                last_model_name = model_config[\"name\"]\n                last_timeout = model_config[\"timeout\"]\n                print(f\"ðŸ”„ [REPLICATE] Trying {last_model_name} (timeout={last_timeout}s)...\")\n                \n                # Prepare params\n                params = model_config[\"params\"].copy()\n                \n                # Map params based on model type\n                if \"target_image\" in params:\n                    params[\"target_image\"] = target\n                if \"input_image\" in params:\n                    params[\"input_image\"] = target\n                if \"swap_image\" in params:\n                    params[\"swap_image\"] = source\n                \n                # Remove None values\n                params = {k: v for k, v in params.items() if v is not None}\n                \n                # Run with timeout\n                def _run():\n                    return replicate.run(last_model_name, input=params)\n                \n                loop = asyncio.get_event_loop()\n                output = await asyncio.wait_for(\n                    loop.run_in_executor(None, _run),\n                    timeout=last_timeout\n                )\n                \n                # Debug: Print output type and content\n                print(f\"ðŸ” [REPLICATE] Output type: {type(output).__name__}\")\n                print(f\"ðŸ” [REPLICATE] Output content: {output}\")\n                \n                if output:\n                    # Handle different output types\n                    result_url = None\n                    \n                    # If output is a list, get first item\n                    if isinstance(output, list) and len(output) > 0:\n                        result_url = str(output[0])\n                        print(f\"ðŸ“‹ [REPLICATE] List output, using first item: {result_url}\")\n                    # If output is a FileOutput object, get url attribute\n                    elif hasattr(output, 'url'):\n                        result_url = str(output.url)  # type: ignore\n                        print(f\"ðŸ“Ž [REPLICATE] FileOutput, using .url: {result_url}\")\n                    # Otherwise convert to string\n                    else:\n                        result_url = str(output)\n                        print(f\"ðŸ“ [REPLICATE] Direct string conversion: {result_url}\")\n                    \n                    print(f\"âœ… [REPLICATE] Success via {last_model_name}, URL: {result_url[:100]}...\")\n                    return {\n                        \"success\": True,\n                        \"result_url\": result_url,\n                        \"message\": f\"Face swap completed via {last_model_name}\",\n                        \"provider\": self.get_name(),\n                        \"model\": last_model_name\n                    }\n                else:\n                    print(f\"âš ï¸ [REPLICATE] {last_model_name} returned no output\")\n                    continue\n                    \n            except asyncio.TimeoutError:\n                print(f\"â±ï¸ [REPLICATE] {last_model_name} timeout ({last_timeout}s)\")\n                continue\n            except Exception as e:\n                print(f\"âš ï¸ [REPLICATE] {last_model_name} failed: {type(e).__name__}: {e}\")\n                continue\n        \n        return {\n            \"success\": False,\n            \"error\": \"All Replicate models failed or timed out\",\n            \"provider\": self.get_name()\n        }\n\nclass PiAPIProvider(FaceSwapProvider):\n    \"\"\"PiAPI face swap provider with async support\"\"\"\n    \n    BASE_URL = \"https://api.piapi.ai/api/v1\"\n    \n    MODELS = {\n        \"image\": {\n            \"model\": \"Qubico/image-toolkit\",\n            \"task_type\": \"face-swap\",\n            \"timeout\": 60\n        },\n        \"video\": {\n            \"model\": \"Qubico/video-toolkit\",\n            \"task_type\": \"face-swap\",\n            \"timeout\": 120\n        }\n    }\n    \n    def __init__(self, api_key: str):\n        self.api_key = api_key\n    \n    def get_name(self) -> str:\n        return \"PiAPI\"\n    \n    def get_timeout(self) -> int:\n        return 120\n    \n    async def swap_face(\n        self, \n        target: str, \n        source: str, \n        media_type: FaceSwapMediaType = FaceSwapMediaType.IMAGE,\n        webhook_url: Optional[str] = None,\n        **kwargs\n    ) -> Dict[str, Any]:\n        \"\"\"PiAPI face swap with webhook support\"\"\"\n        \n        model_config = self.MODELS.get(media_type.value)\n        if not model_config:\n            return {\n                \"success\": False,\n                \"error\": f\"Unsupported media type: {media_type.value}\",\n                \"provider\": self.get_name()\n            }\n        \n        try:\n            print(f\"ðŸš€ [PIAPI] Starting {media_type.value} face swap...\")\n            \n            # Create task\n            payload = {\n                \"model\": model_config[\"model\"],\n                \"task_type\": model_config[\"task_type\"],\n                \"input\": {\n                    \"target_image\" if media_type == FaceSwapMediaType.IMAGE else \"target_video\": target,\n                    \"swap_image\": source\n                }\n            }\n            \n            # Add webhook if provided\n            if webhook_url:\n                payload[\"config\"] = {\n                    \"webhook_config\": {\n                        \"endpoint\": webhook_url,\n                        \"secret\": hashlib.sha256(f\"{self.api_key}{time.time()}\".encode()).hexdigest()[:32]\n                    }\n                }\n            \n            headers = {\n                \"X-API-Key\": self.api_key,\n                \"Content-Type\": \"application/json\",\n                \"Accept\": \"application/json\"\n            }\n            \n            def _create_task():\n                resp = requests.post(\n                    f\"{self.BASE_URL}/task\",\n                    json=payload,\n                    headers=headers,\n                    timeout=30\n                )\n                resp.raise_for_status()\n                return resp.json()\n            \n            loop = asyncio.get_event_loop()\n            create_response = await loop.run_in_executor(None, _create_task)\n            \n            if create_response.get(\"code\") != 200:\n                return {\n                    \"success\": False,\n                    \"error\": f\"Failed to create task: {create_response}\",\n                    \"provider\": self.get_name()\n                }\n            \n            task_id = create_response[\"data\"][\"task_id\"]\n            print(f\"ðŸ“‹ [PIAPI] Task created: {task_id}\")\n            \n            # If webhook provided, return immediately\n            if webhook_url:\n                return {\n                    \"success\": True,\n                    \"task_id\": task_id,\n                    \"status\": \"pending\",\n                    \"message\": \"Task created, webhook will be called when complete\",\n                    \"provider\": self.get_name(),\n                    \"async\": True\n                }\n            \n            # Poll for result\n            timeout = model_config[\"timeout\"]\n            start_time = time.time()\n            \n            while time.time() - start_time < timeout:\n                def _get_task():\n                    resp = requests.get(\n                        f\"{self.BASE_URL}/task/{task_id}\",\n                        headers=headers,\n                        timeout=30\n                    )\n                    resp.raise_for_status()\n                    return resp.json()\n                \n                result = await loop.run_in_executor(None, _get_task)\n                status = result[\"data\"][\"status\"]\n                \n                if status == \"completed\":\n                    output_key = \"image_url\" if media_type == FaceSwapMediaType.IMAGE else \"video_url\"\n                    result_url = result[\"data\"][\"output\"].get(output_key)\n                    \n                    print(f\"âœ… [PIAPI] Success - {media_type.value} ready\")\n                    return {\n                        \"success\": True,\n                        \"result_url\": result_url,\n                        \"message\": f\"Face swap completed via PiAPI ({media_type.value})\",\n                        \"provider\": self.get_name(),\n                        \"task_id\": task_id\n                    }\n                elif status == \"failed\":\n                    error = result[\"data\"].get(\"error\", \"Unknown error\")\n                    return {\n                        \"success\": False,\n                        \"error\": f\"Task failed: {error}\",\n                        \"provider\": self.get_name(),\n                        \"task_id\": task_id\n                    }\n                \n                # Wait before polling again\n                await asyncio.sleep(3)\n            \n            return {\n                \"success\": False,\n                \"error\": f\"Task timeout after {timeout}s\",\n                \"provider\": self.get_name(),\n                \"task_id\": task_id\n            }\n            \n        except Exception as e:\n            print(f\"âš ï¸ [PIAPI] Error: {type(e).__name__}: {e}\")\n            return {\n                \"success\": False,\n                \"error\": str(e),\n                \"provider\": self.get_name()\n            }\n\nclass FaceSwapGateway:\n    \"\"\"Multi-provider face swap gateway with fallback and retry\"\"\"\n    \n    def __init__(self):\n        self.replicate_token = os.environ.get('REPLICATE_API_TOKEN')\n        self.piapi_key = os.environ.get('PIAPI_API_KEY')\n        \n        # Initialize providers (Replicate first to save credits)\n        self.providers: List[FaceSwapProvider] = []\n        \n        # Replicate PRIMARY (cheaper, stable models)\n        if self.replicate_token:\n            self.providers.append(ReplicateProvider(self.replicate_token))\n            print(\"âœ… Replicate provider enabled (PRIMARY - budget-friendly)\")\n        \n        # PiAPI FALLBACK (99.9% SLA, enterprise-grade)\n        if self.piapi_key:\n            self.providers.append(PiAPIProvider(self.piapi_key))\n            print(\"âœ… PiAPI provider enabled (FALLBACK - 99.9% uptime SLA)\")\n        \n        print(f\"ðŸ”Œ Face Swap Gateway initialized with {len(self.providers)} provider(s)\")\n        if len(self.providers) > 1:\n            print(f\"ðŸ“Š Provider priority: {' â†’ '.join([p.get_name() for p in self.providers])}\")\n    \n    def _validate_input(self, data: str, media_type: FaceSwapMediaType = FaceSwapMediaType.IMAGE) -> Tuple[bool, Optional[str]]:\n        \"\"\"\n        Validate input (URL or base64) based on media type\n        Returns: (is_valid, error_message)\n        \"\"\"\n        # Check if URL\n        if data.startswith('http://') or data.startswith('https://'):\n            return True, None\n        \n        # Check if data URI (image or video)\n        if media_type == FaceSwapMediaType.VIDEO:\n            data_uri_pattern = r'^data:(image|video)/(jpeg|jpg|png|gif|webp|bmp|mp4|avi|mov|webm);base64,'\n        else:\n            data_uri_pattern = r'^data:image/(jpeg|jpg|png|gif|webp|bmp);base64,'\n        \n        if re.match(data_uri_pattern, data, re.IGNORECASE):\n            return True, None\n        \n        # Try to decode as base64\n        try:\n            base64.b64decode(data)\n            return True, None\n        except:\n            media_name = \"video\" if media_type == FaceSwapMediaType.VIDEO else \"image\"\n            return False, f\"Invalid input: must be URL or base64 encoded {media_name}\"\n    \n    def _normalize_base64(self, data: str) -> str:\n        \"\"\"\n        Normalize input to appropriate format\n        - URLs: preserve as-is (PiAPI needs URLs)\n        - Data URIs: preserve as-is\n        - Plain base64: convert to data URI\n        \"\"\"\n        # URL, return as-is (important for PiAPI!)\n        if data.startswith('http://') or data.startswith('https://'):\n            return data\n        \n        # Already data URI (image or video)\n        data_uri_pattern = r'^data:(image|video)/(jpeg|jpg|png|gif|webp|bmp|mp4|avi|mov);base64,'\n        if re.match(data_uri_pattern, data, re.IGNORECASE):\n            return data\n        \n        # Plain base64, add data URI prefix\n        # Try to detect image type from base64 data\n        try:\n            img_bytes = base64.b64decode(data)\n            img = Image.open(io.BytesIO(img_bytes))\n            format_map = {\n                'JPEG': 'jpeg',\n                'PNG': 'png',\n                'GIF': 'gif',\n                'WEBP': 'webp',\n                'BMP': 'bmp'\n            }\n            img_format = format_map.get(img.format or 'JPEG', 'jpeg')\n            return f\"data:image/{img_format};base64,{data}\"\n        except:\n            # Default to jpeg\n            return f\"data:image/jpeg;base64,{data}\"\n    \n    async def swap_face(\n        self,\n        target: str,\n        source: str,\n        media_type: FaceSwapMediaType = FaceSwapMediaType.IMAGE,\n        retry_count: int = 2,\n        webhook_url: Optional[str] = None,\n        **kwargs\n    ) -> Dict[str, Any]:\n        \"\"\"\n        Perform face swap with multi-provider fallback and retry\n        \n        Args:\n            target: Target image/video (URL or base64)\n            source: Source face (URL or base64)\n            media_type: Type of media (image or video)\n            retry_count: Number of retries per provider\n            webhook_url: Webhook URL for async operations (PiAPI only)\n            **kwargs: Provider-specific parameters\n        \"\"\"\n        \n        # Validate inputs based on media type\n        target_valid, target_error = self._validate_input(target, media_type)\n        if not target_valid:\n            return {\"success\": False, \"error\": target_error}\n        \n        # Source is always an image (face)\n        source_valid, source_error = self._validate_input(source, FaceSwapMediaType.IMAGE)\n        if not source_valid:\n            return {\"success\": False, \"error\": source_error}\n        \n        # Normalize to data URIs\n        target = self._normalize_base64(target)\n        source = self._normalize_base64(source)\n        \n        if not self.providers:\n            return {\n                \"success\": False,\n                \"error\": \"No face swap providers configured (missing API keys)\"\n            }\n        \n        # Try each provider with retry\n        for provider in self.providers:\n            print(f\"ðŸ”„ Trying provider: {provider.get_name()}\")\n            \n            for attempt in range(retry_count + 1):\n                try:\n                    if attempt > 0:\n                        # Exponential backoff\n                        wait_time = 2 ** attempt\n                        print(f\"â³ Retry {attempt}/{retry_count} after {wait_time}s...\")\n                        await asyncio.sleep(wait_time)\n                    \n                    result = await provider.swap_face(\n                        target=target,\n                        source=source,\n                        media_type=media_type,\n                        webhook_url=webhook_url if isinstance(provider, PiAPIProvider) else None,\n                        **kwargs\n                    )\n                    \n                    if result.get(\"success\"):\n                        return result\n                    \n                    print(f\"âš ï¸ Provider {provider.get_name()} failed: {result.get('error')}\")\n                    \n                except Exception as e:\n                    print(f\"âŒ Provider {provider.get_name()} error: {type(e).__name__}: {e}\")\n                    continue\n        \n        # All providers failed\n        return {\n            \"success\": False,\n            \"error\": \"All face swap providers failed after retries\",\n            \"error_code\": \"ALL_PROVIDERS_FAILED\"\n        }\n\n# Global gateway instance\nface_swap_gateway = FaceSwapGateway()\n","size_bytes":19401},"REVENUECAT_SETUP_GUIDE.md":{"content":"# RevenueCat Setup Guide for Viso AI\n\n## Overview\nViso AI uses RevenueCat for in-app purchase management. This guide helps you set up RevenueCat for testing and production.\n\n## Current Status\nâœ… RevenueCat SDK integrated in code  \nâœ… Pro page UI connected to RevenueCat  \nâŒ Products not configured (causing CONFIGURATION_ERROR)\n\n## Quick Fix for Testing\n\n### Option 1: iOS Testing with StoreKit Configuration (Recommended)\n\n**File Already Created:** `Configuration.storekit` in project root\n\n**Setup Steps:**\n\n1. **Open Xcode:**\n   ```bash\n   open ios/Runner.xcworkspace\n   ```\n\n2. **Configure StoreKit:**\n   - Click on scheme dropdown (top-left, near \"Runner\" button)\n   - Select \"Edit Scheme...\"\n   - Go to \"Run\" â†’ \"Options\" tab\n   - Under \"StoreKit Configuration\", click dropdown\n   - Select \"Configuration.storekit\"\n   - Click \"Close\"\n\n3. **Clean and Rebuild:**\n   ```bash\n   flutter clean\n   flutter build ios\n   ```\n\n4. **Run on Simulator:**\n   - Products will now load from local StoreKit file\n   - No need for App Store Connect setup\n\n**Products in StoreKit:**\n- âœ… Lifetime Premium: â‚«2,050,000 (visoai_lifetime)\n- âœ… Yearly Premium: â‚«944,000/year (visoai_yearly)\n- âœ… Weekly Premium: â‚«165,000/week (visoai_weekly)\n\n### Option 2: Android Testing (Requires Google Play Setup)\n\n**Current Issue:** Products must be configured in Google Play Console first.\n\n**Steps:**\n1. Upload APK to Google Play Console (Internal Testing track)\n2. Create in-app products:\n   - `visoai_lifetime` - Non-consumable - â‚«2,050,000\n   - `visoai_yearly` - Subscription - â‚«944,000/year\n   - `visoai_weekly` - Subscription - â‚«165,000/week\n3. Link RevenueCat to Google Play (RevenueCat Dashboard â†’ App Settings â†’ Google Play)\n4. Add tester email to Internal Testing track\n5. Wait 2-4 hours for products to sync\n\n## Production Setup\n\n### Step 1: RevenueCat Dashboard Configuration\n\n1. **Go to RevenueCat Dashboard:**\n   - URL: https://app.revenuecat.com\n   - Current Project: `projb4face67`\n   - Offering ID: `ofrng1c5b1a3712`\n\n2. **Configure Products:**\n   - Go to \"Products\" section\n   - Add Product IDs:\n     - `visoai_lifetime` (iOS/Android)\n     - `visoai_yearly` (iOS/Android)\n     - `visoai_weekly` (iOS/Android)\n\n3. **Setup Entitlements:**\n   - Go to \"Entitlements\"\n   - Create entitlement: `pro`\n   - Attach all products to `pro` entitlement\n\n4. **Create Offering:**\n   - Go to \"Offerings\"\n   - Create offering: `default` (or use existing `ofrng1c5b1a3712`)\n   - Add packages:\n     - Package: `$rc_lifetime` â†’ Product: `visoai_lifetime`\n     - Package: `$rc_annual` â†’ Product: `visoai_yearly`\n     - Package: `$rc_weekly` â†’ Product: `visoai_weekly`\n\n### Step 2: App Store Connect (iOS)\n\n1. **Create In-App Purchases:**\n   - Go to App Store Connect â†’ Your App â†’ In-App Purchases\n   - Create 3 products matching RevenueCat product IDs\n\n2. **Configure Products:**\n   ```\n   visoai_lifetime:\n   - Type: Non-Consumable\n   - Reference Name: Lifetime Premium\n   - Product ID: visoai_lifetime\n   - Price: â‚«2,050,000 (or $99.99 USD)\n   \n   visoai_yearly:\n   - Type: Auto-Renewable Subscription\n   - Reference Name: Yearly Premium\n   - Product ID: visoai_yearly\n   - Subscription Duration: 1 Year\n   - Price: â‚«944,000 (or $44.99 USD)\n   \n   visoai_weekly:\n   - Type: Auto-Renewable Subscription\n   - Reference Name: Weekly Premium\n   - Product ID: visoai_weekly\n   - Subscription Duration: 1 Week\n   - Price: â‚«165,000 (or $7.99 USD)\n   ```\n\n3. **Submit for Review:** Products must be approved before production use\n\n### Step 3: Google Play Console (Android)\n\n1. **Upload APK/AAB to Internal Testing track first**\n\n2. **Create In-App Products:**\n   - Go to Monetize â†’ Products â†’ In-app products\n   - Create same products as iOS\n\n3. **Create Subscriptions:**\n   - Go to Monetize â†’ Products â†’ Subscriptions\n   - Create subscription group: \"Viso AI Premium\"\n   - Add yearly and weekly subscriptions\n\n4. **Link to RevenueCat:**\n   - RevenueCat Dashboard â†’ App Settings â†’ Google Play\n   - Follow OAuth flow to link accounts\n\n### Step 4: Update API Keys (Production)\n\n**Current:** Using test key for all platforms\n```dart\nstatic const String _testApiKey = 'test_OvwtrjRddtWRHgmNdZgxCTiYLYX';\n```\n\n**Production:** Set environment variables or update code:\n```dart\n// In lib/services/revenue_cat_service.dart\nstatic const String _prodApiKeyAndroid = 'YOUR_ANDROID_KEY';\nstatic const String _prodApiKeyIOS = 'YOUR_IOS_KEY';\n```\n\nOr use build-time environment variables:\n```bash\nflutter build apk --dart-define=REVENUECAT_ANDROID_KEY=your_key\nflutter build ios --dart-define=REVENUECAT_IOS_KEY=your_key\n```\n\n## Troubleshooting\n\n### Error: CONFIGURATION_ERROR\n**Cause:** Products not found in App Store Connect or Google Play  \n**Fix:** \n- iOS: Use StoreKit Configuration (see Option 1 above)\n- Android: Setup products in Google Play Console\n\n### Error: Packages is EMPTY\n**Cause:** No offerings configured in RevenueCat  \n**Fix:** Create offering in RevenueCat dashboard and attach products\n\n### Error: readableErrorCode: STORE_PROBLEM\n**Cause:** App not signed correctly or sandbox environment issues  \n**Fix:** \n- iOS: Ensure proper provisioning profile\n- Android: Use release signing config for testing IAP\n\n### Testing Tips\n\n1. **Always test on real devices for IAP** (emulators have limitations)\n2. **Use sandbox accounts:**\n   - iOS: Settings â†’ App Store â†’ Sandbox Account\n   - Android: Add tester in Google Play Console â†’ License Testing\n3. **Clear app data between tests** to reset purchase state\n4. **Monitor RevenueCat Customer view** to see purchase events\n\n## Current Implementation\n\n### Pro Page (`lib/pro/pro_widget.dart`)\n- âœ… Loads packages from RevenueCat on init\n- âœ… Displays hardcoded UI for Web (RevenueCat not supported on Web)\n- âœ… Dynamic pricing from RevenueCat for mobile\n- âœ… Auto-selects first package (Lifetime - best value)\n- âœ… Purchase and Restore flows integrated\n\n### RevenueCat Service (`lib/services/revenue_cat_service.dart`)\n- âœ… Initialize SDK on app start\n- âœ… Load offerings and packages\n- âœ… Purchase flow with error handling\n- âœ… Restore purchases\n- âœ… Check premium status\n- âœ… Debug logging for troubleshooting\n\n## Next Steps\n\n1. âœ… **For immediate testing:** Use iOS with StoreKit Configuration\n2. â³ **For production:** Complete App Store Connect and Google Play setup\n3. â³ **Update API keys:** Replace test key with production keys\n4. â³ **Submit for review:** Get IAP products approved by Apple/Google\n\n## Support\n\n- **RevenueCat Docs:** https://docs.revenuecat.com\n- **RevenueCat Dashboard:** https://app.revenuecat.com\n- **Test API Key:** `test_OvwtrjRddtWRHgmNdZgxCTiYLYX`\n- **Project ID:** `projb4face67`\n- **Offering ID:** `ofrng1c5b1a3712`\n","size_bytes":6736},"RAILWAY_SETUP.md":{"content":"# ðŸš‚ Railway Deployment Guide - Viso AI Backend\n\n## Táº¡i Sao Railway?\n\nRailway Hobby ($5/thÃ¡ng) lÃ  lá»±a chá»n tá»‘i Æ°u cho production:\n\nâœ… **No Timeout Limit**: 300s timeout (vs Vercel 10s) - HoÃ n háº£o cho face swap (30-120s)  \nâœ… **Container 24/7**: KhÃ´ng cold start, performance á»•n Ä‘á»‹nh  \nâœ… **Custom Domain**: Domain cá»‘ Ä‘á»‹nh, khÃ´ng Ä‘á»•i khi restart  \nâœ… **Powerful**: 8GB RAM / 8 vCPU per service  \nâœ… **Cost-Effective**: Chá»‰ $5/thÃ¡ng (vs Vercel Pro Max $40/thÃ¡ng)\n\n---\n\n## ðŸ“‹ Chuáº©n Bá»‹\n\n### 1. **TÃ i Khoáº£n Cáº§n Thiáº¿t**\n- âœ… GitHub account (Ä‘á»ƒ connect Railway)\n- âœ… Railway account (sign up free táº¡i [railway.app](https://railway.app))\n- âœ… Credit card (cho Railway Hobby plan $5/thÃ¡ng)\n\n### 2. **API Keys**\nChuáº©n bá»‹ cÃ¡c API keys sau (láº¥y tá»« Replit Secrets):\n\n```bash\nHUGGINGFACE_TOKEN=hf_xxxxxxxxxxxxxxxxxxxxxxxx\nREPLICATE_API_TOKEN=r8_xxxxxxxxxxxxxxxxxxxxx\nPIAPI_API_KEY=xxxxxxxxxxxxxxxx  # Optional\nSUPABASE_URL=https://xxx.supabase.co  # Optional\nSUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxx  # Optional\n```\n\n---\n\n## ðŸš€ BÆ°á»›c 1: Push Code LÃªn GitHub\n\n### **1.1. Initialize Git (náº¿u chÆ°a cÃ³)**\n\n```bash\ngit init\ngit add .\ngit commit -m \"Prepare Railway deployment\"\n```\n\n### **1.2. Create GitHub Repository**\n\n1. VÃ o [github.com/new](https://github.com/new)\n2. Repository name: `visoai-backend`\n3. Set to **Public** hoáº·c **Private**\n4. Click \"Create repository\"\n\n### **1.3. Push Code**\n\n```bash\ngit branch -M main\ngit remote add origin https://github.com/YOUR_USERNAME/visoai-backend.git\ngit push -u origin main\n```\n\n---\n\n## ðŸ›¤ï¸ BÆ°á»›c 2: Deploy LÃªn Railway\n\n### **2.1. Create Railway Account**\n\n1. VÃ o [railway.app](https://railway.app)\n2. Click \"Login\" â†’ Sign in with GitHub\n3. Authorize Railway to access your GitHub\n\n### **2.2. Upgrade to Hobby Plan**\n\n1. Click avatar (gÃ³c trÃªn pháº£i) â†’ \"Account Settings\"\n2. Tab \"Plans\" â†’ Chá»n \"Hobby\" ($5/month)\n3. Add credit card â†’ Confirm\n\n### **2.3. Create New Project**\n\n1. Dashboard â†’ Click \"New Project\"\n2. Select \"Deploy from GitHub repo\"\n3. Chá»n repository `visoai-backend`\n4. Railway sáº½ tá»± Ä‘á»™ng detect vÃ  deploy!\n\n---\n\n## ðŸ” BÆ°á»›c 3: Add Environment Variables\n\n### **3.1. Open Service Settings**\n\n1. Click vÃ o service vá»«a deploy (tÃªn `visoai-backend`)\n2. Tab \"Variables\" â†’ Click \"Add Variable\"\n\n### **3.2. Add Required Variables**\n\nAdd tá»«ng biáº¿n sau (click \"Add Variable\" cho má»—i key):\n\n| Variable Name | Value | Required |\n|--------------|-------|----------|\n| `HUGGINGFACE_TOKEN` | `hf_xxx...` | âœ… Yes |\n| `REPLICATE_API_TOKEN` | `r8_xxx...` | âœ… Yes |\n| `PIAPI_API_KEY` | `xxx...` | âš ï¸ Optional |\n| `SUPABASE_URL` | `https://xxx.supabase.co` | âš ï¸ Optional |\n| `SUPABASE_ANON_KEY` | `eyJhbGci...` | âš ï¸ Optional |\n\n### **3.3. Redeploy**\n\nRailway sáº½ tá»± Ä‘á»™ng redeploy sau khi add variables.\n\n---\n\n## ðŸŒ BÆ°á»›c 4: Get Railway Domain\n\n### **4.1. Find Your Domain**\n\n1. Click vÃ o service\n2. Tab \"Settings\" â†’ Section \"Networking\"\n3. Click \"Generate Domain\"\n4. Copy domain (vÃ­ dá»¥: `visoai-backend-production.up.railway.app`)\n\n### **4.2. (Optional) Add Custom Domain**\n\nNáº¿u cÃ³ domain riÃªng:\n\n1. Tab \"Settings\" â†’ \"Networking\"\n2. Click \"Custom Domain\" â†’ Enter domain\n3. Add DNS records theo hÆ°á»›ng dáº«n Railway\n\n---\n\n## âœ… BÆ°á»›c 5: Verify Deployment\n\n### **5.1. Test Health Check**\n\n```bash\ncurl https://YOUR-RAILWAY-DOMAIN.up.railway.app/\n```\n\n**Expected response:**\n```json\n{\n  \"status\": \"online\",\n  \"service\": \"Viso AI Backend\",\n  \"version\": \"1.0.0\",\n  \"endpoints\": [...]\n}\n```\n\n### **5.2. Test Face Swap (nháº¹)**\n\n```bash\ncurl -X POST https://YOUR-RAILWAY-DOMAIN.up.railway.app/api/ai/face-swap \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"target_image\":\"data:image/png;base64,...\",\"source_face\":\"data:image/png;base64,...\"}' \\\n  -w \"\\nTime: %{time_total}s\\n\"\n```\n\nNáº¿u tráº£ vá» JSON response (khÃ´ng pháº£i timeout) â†’ **Deploy thÃ nh cÃ´ng!** âœ…\n\n---\n\n## ðŸ“± BÆ°á»›c 6: Update Flutter App\n\n### **6.1. Update API Domain**\n\nMá»Ÿ `lib/services/huggingface_service.dart`:\n\n```dart\n// Äá»•i dÃ²ng nÃ y:\nstatic const String _defaultApiDomain = '8bf1f206-1bbf-468e-94c3-c805a85c0cc0-00-3pryuqwgngpev.sisko.replit.dev';\n\n// ThÃ nh:\nstatic const String _defaultApiDomain = 'visoai-backend-production.up.railway.app';\n```\n\n### **6.2. Rebuild APK**\n\n```bash\n# Clean build cÅ©\nflutter clean\n\n# Build APK tá»‘i Æ°u\nflutter build apk --release --split-per-abi\n```\n\n**Káº¿t quáº£:** 3 APK files trong `build/app/outputs/flutter-apk/`\n\n### **6.3. Install APK**\n\n1. Gá»¡ app cÅ© (náº¿u cÃ³)\n2. Copy `app-arm64-v8a-release.apk` vÃ o Ä‘iá»‡n thoáº¡i\n3. CÃ i Ä‘áº·t vÃ  test face swap\n\n---\n\n## ðŸ’° Chi PhÃ­ Railway\n\n### **Hobby Plan Breakdown**\n\n```\n$5 credits/thÃ¡ng bao gá»“m:\n\nBackend Service:\n  â€¢ RAM: 512MB - 1GB\n  â€¢ vCPU: Shared\n  â€¢ Cost: ~$3-4/month\n\nPostgreSQL (Optional):\n  â€¢ RAM: 256MB\n  â€¢ Cost: ~$1-2/month\n\nTOTAL: ~$5/month (vá»«a Ä‘á»§ credits!)\n```\n\n### **Monitor Usage**\n\n1. Dashboard â†’ Project â†’ Tab \"Usage\"\n2. Xem estimated cost\n3. Set alerts náº¿u vÆ°á»£t $5\n\n---\n\n## ðŸ”§ Troubleshooting\n\n### **Issue 1: Build Failed**\n\n**Lá»—i:** `Failed to install requirements.txt`\n\n**Fix:**\n```bash\n# Verify requirements.txt format\ncat requirements.txt\n\n# Should NOT have syntax errors\n```\n\n### **Issue 2: App Crashed**\n\n**Check Logs:**\n1. Railway dashboard â†’ Service â†’ Tab \"Logs\"\n2. TÃ¬m error message\n3. Common issues:\n   - Missing environment variables\n   - Port binding error (Railway auto-set PORT)\n\n### **Issue 3: Timeout Still Happening**\n\n**Verify:**\n1. Check Railway logs for actual execution time\n2. Ensure gunicorn timeout = 300s (Ä‘Ã£ set trong Procfile)\n3. Test vá»›i curl vÃ  check response time\n\n---\n\n## ðŸ“Š Railway vs Vercel vs Replit\n\n| | **Railway Hobby** | **Vercel Free** | **Replit** |\n|---|---|---|---|\n| **Timeout** | âœ… 300s | âŒ 10s | âœ… No limit |\n| **Domain** | âœ… Cá»‘ Ä‘á»‹nh | âœ… Cá»‘ Ä‘á»‹nh | âŒ Äá»•i khi restart |\n| **Cold Start** | âœ… KhÃ´ng | âš ï¸ CÃ³ (1-3s) | âœ… KhÃ´ng |\n| **RAM** | âœ… 8GB | âš ï¸ 1GB | âš ï¸ Varies |\n| **Cost** | ðŸ’° $5/mo | âœ… Free | âœ… Free (dev) |\n| **Production Ready** | âœ… Yes | âš ï¸ Limited | âŒ No |\n\n---\n\n## ðŸŽ¯ Next Steps\n\n### **Production Checklist**\n\n- [ ] Deploy backend to Railway\n- [ ] Add all environment variables\n- [ ] Test all API endpoints\n- [ ] Update Flutter app with Railway domain\n- [ ] Build and test APK\n- [ ] Monitor Railway usage\n- [ ] (Optional) Add custom domain\n- [ ] (Optional) Setup monitoring/alerts\n\n---\n\n## ðŸ“š Resources\n\n- Railway Docs: https://docs.railway.com\n- Railway Discord: https://discord.gg/railway\n- GitHub repo: https://github.com/YOUR_USERNAME/visoai-backend\n\n---\n\n## ðŸ’¬ Support\n\nNáº¿u gáº·p váº¥n Ä‘á»:\n1. Check Railway logs first\n2. Verify environment variables\n3. Test API vá»›i curl\n4. Check GitHub repo cÃ³ push Ä‘á»§ files chÆ°a\n\n**Happy deploying!** ðŸš€\n","size_bytes":6945},"api/index.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nViso AI Backend API for Vercel\nConverted from BaseHTTPRequestHandler to Flask for serverless deployment\n\"\"\"\nimport os\nimport sys\nimport json\nimport asyncio\nfrom flask import Flask, request, jsonify\nfrom flask_cors import CORS\n\n# Add parent directory to path to import services\nsys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom services.image_ai_service import image_ai_service\nfrom services.face_swap_gateway import face_swap_gateway, FaceSwapMediaType\n\napp = Flask(__name__)\nCORS(app)\n\n# Environment variables\nHUGGINGFACE_TOKEN = os.getenv('HUGGINGFACE_TOKEN')\n\n@app.route('/')\ndef home():\n    \"\"\"Health check endpoint\"\"\"\n    return jsonify({\n        'status': 'online',\n        'service': 'Viso AI Backend',\n        'version': '1.0.0',\n        'endpoints': [\n            '/api/huggingface/text-generation',\n            '/api/huggingface/text-to-image',\n            '/api/ai/hd-image',\n            '/api/ai/fix-old-photo',\n            '/api/ai/cartoonify',\n            '/api/ai/face-swap',\n            '/api/ai/face-swap-v2',\n            '/api/ai/video-face-swap'\n        ]\n    })\n\n@app.route('/api/huggingface/text-generation', methods=['POST'])\ndef text_generation():\n    \"\"\"Text generation using Huggingface models\"\"\"\n    try:\n        data = request.get_json()\n        prompt = data.get('prompt', '')\n        model = data.get('model', 'mistralai/Mistral-7B-Instruct-v0.2')\n        \n        if not HUGGINGFACE_TOKEN:\n            return jsonify({'error': 'HUGGINGFACE_TOKEN not configured'}), 500\n        \n        import requests as http_requests\n        hf_url = f'https://api-inference.huggingface.co/models/{model}'\n        payload = {\n            'inputs': prompt,\n            'parameters': {\n                'max_new_tokens': data.get('max_tokens', 250),\n                'temperature': data.get('temperature', 0.7),\n                'top_p': data.get('top_p', 0.9),\n            }\n        }\n        \n        response = http_requests.post(\n            hf_url,\n            headers={'Authorization': f'Bearer {HUGGINGFACE_TOKEN}'},\n            json=payload,\n            timeout=30\n        )\n        \n        if response.status_code == 200:\n            return jsonify({'success': True, 'result': response.json()})\n        else:\n            return jsonify({'error': f'Huggingface API error: {response.text}'}), response.status_code\n            \n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/huggingface/text-to-image', methods=['POST'])\ndef text_to_image():\n    \"\"\"Text to image generation using Huggingface models\"\"\"\n    try:\n        data = request.get_json()\n        prompt = data.get('prompt', '')\n        model = data.get('model', 'stabilityai/stable-diffusion-2-1')\n        \n        if not HUGGINGFACE_TOKEN:\n            return jsonify({'error': 'HUGGINGFACE_TOKEN not configured'}), 500\n        \n        import requests as http_requests\n        import base64\n        \n        hf_url = f'https://api-inference.huggingface.co/models/{model}'\n        payload = {'inputs': prompt}\n        \n        response = http_requests.post(\n            hf_url,\n            headers={'Authorization': f'Bearer {HUGGINGFACE_TOKEN}'},\n            json=payload,\n            timeout=60\n        )\n        \n        if response.status_code == 200:\n            image_bytes = response.content\n            image_base64 = base64.b64encode(image_bytes).decode('utf-8')\n            return jsonify({\n                'success': True,\n                'image': f'data:image/png;base64,{image_base64}'\n            })\n        else:\n            return jsonify({'error': f'Huggingface API error: {response.text}'}), response.status_code\n            \n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/ai/hd-image', methods=['POST'])\ndef hd_image():\n    \"\"\"HD Image Enhancement using Real-ESRGAN\"\"\"\n    try:\n        data = request.get_json()\n        image_base64 = data.get('image', '')\n        scale = data.get('scale', 4)\n        \n        if not image_base64:\n            return jsonify({'error': 'No image provided'}), 400\n        \n        # Run async function\n        result = asyncio.run(image_ai_service.hd_image(image_base64, scale))\n        \n        if result['success']:\n            return jsonify(result)\n        else:\n            return jsonify(result), 500\n            \n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/ai/fix-old-photo', methods=['POST'])\ndef fix_old_photo():\n    \"\"\"Fix Old Photo using GFPGAN\"\"\"\n    try:\n        data = request.get_json()\n        image_base64 = data.get('image', '')\n        version = data.get('version', 'v1.3')\n        \n        if not image_base64:\n            return jsonify({'error': 'No image provided'}), 400\n        \n        result = asyncio.run(image_ai_service.fix_old_photo(image_base64, version))\n        \n        if result['success']:\n            return jsonify(result)\n        else:\n            return jsonify(result), 500\n            \n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/ai/cartoonify', methods=['POST'])\ndef cartoonify():\n    \"\"\"Cartoonify image using VToonify\"\"\"\n    try:\n        data = request.get_json()\n        image_base64 = data.get('image', '')\n        style = data.get('style', 'cartoon')\n        style_degree = data.get('style_degree', 0.5)\n        \n        if not image_base64:\n            return jsonify({'error': 'No image provided'}), 400\n        \n        result = asyncio.run(image_ai_service.cartoonify(image_base64, style, style_degree))\n        \n        if result['success']:\n            return jsonify(result)\n        else:\n            return jsonify(result), 500\n            \n    except Exception as e:\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/ai/face-swap', methods=['POST'])\ndef face_swap_legacy():\n    \"\"\"Face Swap (Legacy endpoint) - redirects to v2\"\"\"\n    return face_swap_v2()\n\n@app.route('/api/ai/face-swap-v2', methods=['POST'])\ndef face_swap_v2():\n    \"\"\"Face Swap using Multi-Provider Gateway (Replicate â†’ PiAPI)\"\"\"\n    try:\n        print(\"ðŸ“¥ [FACE_SWAP] Received request\")\n        data = request.get_json()\n        \n        target_image = data.get('target_image', '')\n        source_face = data.get('source_face', '')\n        \n        print(f\"ðŸ–¼ï¸  [FACE_SWAP] Target: {target_image[:50]}...\")\n        print(f\"ðŸ‘¤ [FACE_SWAP] Source: {source_face[:50]}...\")\n        \n        if not target_image or not source_face:\n            return jsonify({'error': 'Both target_image and source_face required'}), 400\n        \n        print(\"ðŸš€ [FACE_SWAP] Calling gateway...\")\n        result = asyncio.run(face_swap_gateway.swap_face(\n            target=target_image,\n            source=source_face,\n            media_type=FaceSwapMediaType.IMAGE\n        ))\n        \n        print(f\"ðŸ“¤ [FACE_SWAP] Result: success={result.get('success')}\")\n        \n        if result.get('success'):\n            # Download and convert to base64\n            result_url = result.get('result_url')\n            if result_url:\n                try:\n                    print(f\"â¬‡ï¸  [FACE_SWAP] Downloading result from: {result_url[:80]}...\")\n                    import base64\n                    import requests as http_requests\n                    \n                    img_response = http_requests.get(result_url, timeout=30)\n                    \n                    if img_response.status_code != 200:\n                        raise Exception(f\"HTTP {img_response.status_code} from result URL\")\n                    \n                    image_data = img_response.content\n                    print(f\"ðŸ“¦ [FACE_SWAP] Downloaded {len(image_data)} bytes\")\n                    \n                    # Validate image data\n                    if image_data.startswith(b'<!DOCTYPE') or image_data.startswith(b'<html'):\n                        raise Exception(\"Received HTML instead of image\")\n                    \n                    # Check for valid image signatures\n                    valid_signatures = [\n                        b'\\xFF\\xD8\\xFF',  # JPEG\n                        b'\\x89PNG',        # PNG\n                        b'GIF8',           # GIF\n                        b'RIFF',           # WEBP\n                        b'BM'              # BMP\n                    ]\n                    \n                    is_valid = any(image_data.startswith(sig) for sig in valid_signatures)\n                    if not is_valid:\n                        raise Exception(f\"Invalid image signature. First bytes: {image_data[:20]}\")\n                    \n                    # Convert to base64\n                    result_base64 = base64.b64encode(image_data).decode('utf-8')\n                    print(f\"âœ… [FACE_SWAP] Successfully encoded {len(result_base64)} base64 chars\")\n                    \n                    return jsonify({\n                        'success': True,\n                        'image': result_base64,  # Changed from 'result' to 'image' for Flutter compatibility\n                        'provider': result.get('provider', 'unknown')\n                    })\n                    \n                except Exception as download_error:\n                    print(f\"âŒ [FACE_SWAP] Download failed: {download_error}\")\n                    return jsonify({\n                        'success': False,\n                        'error': f'Failed to download result: {str(download_error)}'\n                    }), 500\n            else:\n                return jsonify({'success': False, 'error': 'No result URL in response'}), 500\n        else:\n            error_msg = result.get('error', 'Unknown error')\n            return jsonify({'success': False, 'error': error_msg}), 500\n            \n    except Exception as e:\n        print(f\"âŒ [FACE_SWAP] Error: {e}\")\n        import traceback\n        traceback.print_exc()\n        return jsonify({'error': str(e)}), 500\n\n@app.route('/api/ai/video-face-swap', methods=['POST'])\ndef video_face_swap():\n    \"\"\"Video Face Swap using PiAPI\"\"\"\n    try:\n        print(\"ðŸ“¥ [VIDEO_FACE_SWAP] Received request\")\n        data = request.get_json()\n        \n        video_url = data.get('video_url', '')\n        source_face = data.get('source_face', '')\n        \n        if not video_url or not source_face:\n            return jsonify({'error': 'Both video_url and source_face required'}), 400\n        \n        result = asyncio.run(face_swap_gateway.swap_face(\n            target=video_url,\n            source=source_face,\n            media_type=FaceSwapMediaType.VIDEO\n        ))\n        \n        if result.get('success'):\n            return jsonify(result)\n        else:\n            return jsonify(result), 500\n            \n    except Exception as e:\n        print(f\"âŒ [VIDEO_FACE_SWAP] Error: {e}\")\n        return jsonify({'error': str(e)}), 500\n\nif __name__ == '__main__':\n    # For local testing\n    app.run(host='0.0.0.0', port=5000, debug=True)\n","size_bytes":10988},"VERCEL_SETUP_GUIDE.md":{"content":"# ðŸš€ HÆ°á»›ng Dáº«n Deploy Backend LÃªn Vercel\n\n## âœ… ÄÃ£ Chuáº©n Bá»‹ Sáºµn\n\nMÃ¬nh Ä‘Ã£ táº¡o sáºµn cÃ¡c file cáº§n thiáº¿t:\n- âœ… `api/index.py` - Flask backend API\n- âœ… `vercel.json` - Config Vercel\n- âœ… `requirements.txt` - Python dependencies\n- âœ… `services/` - CÃ¡c service AI hiá»‡n cÃ³\n\n## ðŸ“‹ ThÃ´ng Tin Báº¡n Cáº§n Gá»­i\n\n### 1. API Keys/Secrets (Báº¡n Ä‘Ã£ cÃ³ sáºµn)\n\nBáº¡n cáº§n cung cáº¥p cÃ¡c API keys sau (Ä‘Ã£ cÃ³ trong Replit secrets):\n\n```bash\n# Báº¯t buá»™c\nHUGGINGFACE_TOKEN=hf_xxxxxxxxxxxxxxxxxxxxxxxx\nREPLICATE_API_TOKEN=r8_xxxxxxxxxxxxxxxxxxxxx\n\n# TÃ¹y chá»n (náº¿u cÃ³)\nPIAPI_API_KEY=xxxxxxxxxxxxxxxx\nSUPABASE_URL=https://xxxxxxxx.supabase.co\nSUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.xxxxx\n```\n\n### 2. GitHub Repository\n\n**Option A: Táº¡o repo má»›i**\n1. VÃ o GitHub â†’ New Repository\n2. TÃªn repo: `visoai-backend` (hoáº·c tÃªn báº¡n thÃ­ch)\n3. Public hoáº·c Private Ä‘á»u Ä‘Æ°á»£c\n4. KhÃ´ng cáº§n README, gitignore\n\n**Option B: DÃ¹ng repo hiá»‡n cÃ³**\n- Náº¿u Ä‘Ã£ cÃ³ repo, chá»‰ cáº§n push code lÃªn\n\n## ðŸ”§ CÃ¡c BÆ°á»›c Deploy\n\n### BÆ°á»›c 1: Push Code LÃªn GitHub\n\n```bash\n# Khá»Ÿi táº¡o git (náº¿u chÆ°a cÃ³)\ngit init\n\n# Add táº¥t cáº£ files\ngit add .\n\n# Commit\ngit commit -m \"Prepare backend for Vercel deployment\"\n\n# Link vá»›i GitHub repo\ngit remote add origin https://github.com/YOUR_USERNAME/visoai-backend.git\n\n# Push\ngit push -u origin main\n```\n\n### BÆ°á»›c 2: Deploy LÃªn Vercel\n\n1. **Truy cáº­p Vercel**\n   - VÃ o [vercel.com](https://vercel.com)\n   - Click \"Sign Up\" vá»›i GitHub account\n   - Authorize Vercel\n\n2. **Import Project**\n   - Click \"Add New\" â†’ \"Project\"\n   - Chá»n repository `visoai-backend`\n   - Vercel tá»± Ä‘á»™ng detect Flask/Python\n   - Click \"Deploy\"\n\n3. **ThÃªm Environment Variables**\n   - Sau khi deploy, vÃ o Project Settings\n   - Tab \"Environment Variables\"\n   - ThÃªm tá»«ng biáº¿n:\n     ```\n     Name: HUGGINGFACE_TOKEN\n     Value: [API key cá»§a báº¡n]\n     ```\n   - LÃ m tÆ°Æ¡ng tá»± cho:\n     - `REPLICATE_API_TOKEN`\n     - `PIAPI_API_KEY` (optional)\n     - `SUPABASE_URL` (optional)\n     - `SUPABASE_ANON_KEY` (optional)\n\n4. **Redeploy**\n   - VÃ o tab \"Deployments\"\n   - Click \"Redeploy\" Ä‘á»ƒ apply env vars\n   - Äá»£i ~30 giÃ¢y\n\n### BÆ°á»›c 3: Láº¥y URL Production\n\nSau khi deploy xong, Vercel sáº½ cho báº¡n URL kiá»ƒu:\n```\nhttps://visoai-backend.vercel.app\n```\n\n**URL nÃ y cá»‘ Ä‘á»‹nh, khÃ´ng Ä‘á»•i!** âœ¨\n\n## ðŸ“± Cáº­p Nháº­t Flutter App\n\n### Option 1: Rebuild vá»›i URL má»›i\n\nMá»Ÿ terminal vÃ  build láº¡i:\n\n```bash\n# Thay YOUR_DOMAIN báº±ng domain Vercel cá»§a báº¡n\nflutter build apk --release \\\n  --dart-define=API_DOMAIN=visoai-backend.vercel.app \\\n  --split-per-abi \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --tree-shake-icons\n```\n\n### Option 2: Cáº­p nháº­t default domain\n\nMá»Ÿ `lib/services/huggingface_service.dart` vÃ  Ä‘á»•i:\n\n```dart\n// Thay báº±ng Vercel domain cá»§a báº¡n\nstatic const String _defaultApiDomain = 'visoai-backend.vercel.app';\n```\n\nSau Ä‘Ã³ build:\n```bash\nflutter build apk --release --split-per-abi\n```\n\n## âœ… Kiá»ƒm Tra\n\n### Test API\n\n```bash\n# Health check\ncurl https://visoai-backend.vercel.app/\n\n# Test face swap\ncurl -X POST https://visoai-backend.vercel.app/api/ai/face-swap-v2 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"target_image\": \"data:image/png;base64,...\",\n    \"source_face\": \"data:image/png;base64,...\"\n  }'\n```\n\n### Xem Logs\n\n1. VÃ o Vercel Dashboard\n2. Project â†’ Deployments\n3. Click deployment má»›i nháº¥t\n4. Xem \"Function Logs\" Ä‘á»ƒ debug\n\n## ðŸŽ¯ Lá»£i Ãch\n\nâœ… **URL cá»‘ Ä‘á»‹nh** - KhÃ´ng Ä‘á»•i khi restart\nâœ… **Auto-deploy** - Push code lÃ  tá»± Ä‘á»™ng deploy\nâœ… **Free tier** - 100GB bandwidth/month miá»…n phÃ­\nâœ… **Global CDN** - Nhanh trÃªn toÃ n tháº¿ giá»›i\nâœ… **SSL miá»…n phÃ­** - HTTPS tá»± Ä‘á»™ng\n\n## ðŸ”„ Update Sau NÃ y\n\nMá»—i láº§n sá»­a code:\n```bash\ngit add .\ngit commit -m \"Update API logic\"\ngit push\n```\n\nâ†’ Vercel tá»± Ä‘á»™ng deploy láº¡i trong ~1 phÃºt!\n\n## ðŸ“Š Monitoring\n\n### Xem Usage\n- Vercel Dashboard â†’ Project â†’ Analytics\n- Theo dÃµi requests, errors, latency\n\n### Set Alerts (Optional)\n- Settings â†’ Notifications\n- Nháº­n email khi cÃ³ lá»—i hoáº·c downtime\n\n## ðŸ†˜ Troubleshooting\n\n### Lá»—i: \"502 Bad Gateway\"\n- Kiá»ƒm tra `requirements.txt` Ä‘áº§y Ä‘á»§\n- Check Function Logs Ä‘á»ƒ xem lá»—i gÃ¬\n\n### Lá»—i: \"Build Failed\"\n- Äáº£m báº£o `api/index.py` khÃ´ng cÃ³ syntax error\n- Xem Build Logs Ä‘á»ƒ biáº¿t nguyÃªn nhÃ¢n\n\n### API cháº­m láº§n Ä‘áº§u\n- Cold start cá»§a serverless (~1-2s)\n- Láº§n sau sáº½ nhanh hÆ¡n\n\n## ðŸ’° Chi PhÃ­\n\n| Plan | GiÃ¡ | Bandwidth | Functions |\n|------|-----|-----------|-----------|\n| Hobby (Free) | $0 | 100GB/month | 1000 invocations/day |\n| Pro | $20/month | 1TB | Unlimited |\n\n**Free tier Ä‘á»§ cho testing vÃ  production nhá»!**\n\n---\n\n## ðŸ“ TÃ³m Táº¯t - Báº¡n Cáº§n LÃ m\n\n1. âœ… Push code lÃªn GitHub\n2. âœ… Import project vÃ o Vercel\n3. âœ… ThÃªm env vars (API keys)\n4. âœ… Redeploy\n5. âœ… Rebuild Flutter app vá»›i Vercel domain\n6. âœ… Test vÃ  enjoy!\n\n**Thá»i gian: ~15 phÃºt** âš¡\n\n---\n\nNáº¿u cáº§n giÃºp Ä‘á»¡, ping mÃ¬nh báº¥t cá»© lÃºc nÃ o! ðŸš€\n","size_bytes":5143},"APK_SIZE_OPTIMIZATION.md":{"content":"# ðŸ“¦ HÆ°á»›ng Dáº«n Giáº£m KÃ­ch ThÆ°á»›c APK Flutter\n\n## âš ï¸ Váº¥n Äá» Hiá»‡n Táº¡i\n\nAPK cá»§a báº¡n náº·ng hÆ¡n 200MB vÃ¬:\n1. **Flutter engine binaries** (~40-60MB)\n2. **Assets/images lá»›n** (108 images, má»™t sá»‘ file 1.5MB)\n3. **Multiple ABIs** (ARM, ARM64, x86 trong 1 APK)\n4. **Dependencies** (AdMob, AppLovin, RevenueCat, Supabase)\n\n## ðŸŽ¯ Má»¥c TiÃªu\n\nGiáº£m tá»« **200MB â†’ 40-60MB** cho má»—i APK\n\n---\n\n## ðŸš€ Giáº£i PhÃ¡p Ngay Láº­p Tá»©c\n\n### 1. Build APK theo tá»«ng ABI (Quan trá»ng nháº¥t!)\n\nThay vÃ¬ 1 APK chá»©a táº¥t cáº£ (200MB), táº¡o 3 APK riÃªng:\n\n```bash\nflutter build apk --release --split-per-abi --obfuscate --split-debug-info=build/debug-info --tree-shake-icons\n```\n\n**Káº¿t quáº£:**\n- `app-armeabi-v7a-release.apk` (~40-50MB) - MÃ¡y Android cÅ©\n- `app-arm64-v8a-release.apk` (~50-60MB) - MÃ¡y Android má»›i  \n- `app-x86_64-release.apk` (~5-10MB) - Emulator\n\n**Giáº£m ngay 60-70% so vá»›i fat APK!**\n\n### 2. DÃ¹ng App Bundle thay vÃ¬ APK\n\nGoogle Play tá»± Ä‘á»™ng chá»n APK phÃ¹ há»£p cho tá»«ng mÃ¡y:\n\n```bash\nflutter build appbundle --release --obfuscate --split-debug-info=build/debug-info --tree-shake-icons\n```\n\nUpload file `.aab` lÃªn Google Play â†’ User download chá»‰ 40-60MB!\n\n---\n\n## ðŸ–¼ï¸ Tá»‘i Æ¯u Assets (Giáº£m thÃªm 10-20MB)\n\n### BÆ°á»›c 1: NÃ©n láº¡i images\n\n```bash\n# CÃ i cÃ´ng cá»¥ nÃ©n áº£nh\nnpm install -g @squoosh/cli\n\n# NÃ©n táº¥t cáº£ PNG/JPG\nsquoosh-cli --webp auto assets/images/*.{png,jpg,jpeg}\n```\n\n### BÆ°á»›c 2: XÃ³a áº£nh khÃ´ng dÃ¹ng\n\nKiá»ƒm tra `pubspec.yaml` vÃ  xÃ³a assets khÃ´ng cáº§n thiáº¿t:\n\n```yaml\nflutter:\n  assets:\n    - assets/images/  # â† Chá»‰ giá»¯ thÆ° má»¥c Ä‘ang dÃ¹ng\n```\n\n### BÆ°á»›c 3: Resize icons quÃ¡ lá»›n\n\nIcons hiá»‡n táº¡i: **1.5MB** (quÃ¡ lá»›n!)\n```bash\n# Giáº£m kÃ­ch thÆ°á»›c icons\nconvert assets/images/viso-ai.png -resize 512x512 -quality 85 assets/images/viso-ai-optimized.png\n```\n\n**Má»¥c tiÃªu:** Icons nÃªn < 200KB\n\n---\n\n## âš™ï¸ Cáº¥u HÃ¬nh Build.gradle (ÄÃ£ enable)\n\nFile `android/app/build.gradle` Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t:\n\n```gradle\nbuildTypes {\n    release {\n        minifyEnabled true          // XÃ³a code Java/Kotlin khÃ´ng dÃ¹ng\n        shrinkResources true        // XÃ³a resources khÃ´ng dÃ¹ng\n        proguardFiles ...          // Optimization\n    }\n}\n```\n\n**LÆ°u Ã½:** CÃ¡i nÃ y chá»‰ giáº£m vÃ i MB cho Java/Kotlin, khÃ´ng áº£nh hÆ°á»Ÿng nhiá»u Ä‘áº¿n Flutter.\n\n---\n\n## ðŸ“Š PhÃ¢n TÃ­ch Chi Tiáº¿t APK Size\n\n### Kiá»ƒm tra APK hiá»‡n táº¡i\n\n```bash\nflutter build apk --analyze-size\n```\n\nHoáº·c dÃ¹ng Android Studio:\n1. Build â†’ Analyze APK\n2. Xem breakdown theo thÃ nh pháº§n\n\n### Typical breakdown cho Flutter app:\n\n| Component | Size | Giáº£i phÃ¡p |\n|-----------|------|-----------|\n| Flutter engine | 40-60MB | Split ABI |\n| Assets/Images | 10-30MB | NÃ©n/WebP |\n| Native libs | 5-15MB | Split ABI |\n| Code (Dart) | 5-10MB | Obfuscate |\n\n---\n\n## ðŸ”¥ Build Script Tá»‘i Æ¯u\n\nTáº¡o file `build_optimized.sh`:\n\n```bash\n#!/bin/bash\n\necho \"ðŸš€ Building optimized APKs...\"\n\n# Clean old builds\nflutter clean\nflutter pub get\n\n# Build with all optimizations\nflutter build apk \\\n  --release \\\n  --split-per-abi \\\n  --obfuscate \\\n  --split-debug-info=build/debug-info \\\n  --tree-shake-icons\n\necho \"âœ… Done! Check build/app/outputs/flutter-apk/\"\necho \"\"\necho \"ðŸ“¦ APK files:\"\nls -lh build/app/outputs/flutter-apk/*.apk\n```\n\nCháº¡y:\n```bash\nchmod +x build_optimized.sh\n./build_optimized.sh\n```\n\n---\n\n## ðŸ“± Upload LÃªn Google Play\n\n### Option 1: Upload APKs riÃªng láº»\n\n1. VÃ o Google Play Console\n2. Release â†’ Production â†’ Create Release\n3. Upload cáº£ 3 APKs:\n   - `app-armeabi-v7a-release.apk`\n   - `app-arm64-v8a-release.apk`\n   - `app-x86_64-release.apk`\n\nGoogle Play tá»± chá»n APK Ä‘Ãºng cho tá»«ng mÃ¡y.\n\n### Option 2: Upload App Bundle (Khuyáº¿n nghá»‹)\n\n```bash\nflutter build appbundle --release\n```\n\nUpload file `.aab` â†’ Google tá»± Ä‘á»™ng optimize!\n\n---\n\n## ðŸŽ¯ Checklist Tá»‘i Æ¯u\n\n- [x] Enable ProGuard + shrinkResources\n- [ ] Build vá»›i `--split-per-abi`\n- [ ] NÃ©n láº¡i táº¥t cáº£ images (WebP/optimized PNG)\n- [ ] Resize icons > 500KB xuá»‘ng < 200KB\n- [ ] XÃ³a assets khÃ´ng dÃ¹ng trong `pubspec.yaml`\n- [ ] Build vá»›i `--obfuscate --split-debug-info`\n- [ ] Tree-shake icons vá»›i `--tree-shake-icons`\n- [ ] DÃ¹ng App Bundle thay vÃ¬ APK\n\n---\n\n## ðŸ“ˆ Káº¿t Quáº£ Ká»³ Vá»ng\n\n| TrÆ°á»›c | Sau |\n|-------|-----|\n| 1 APK Ã— 200MB | 3 APKs Ã— 40-60MB má»—i cÃ¡i |\n| Assets: 22MB | Assets: 5-10MB (sau nÃ©n) |\n| **Total: 200MB** | **Download: 40-60MB** |\n\n**Giáº£m 60-70% kÃ­ch thÆ°á»›c!** ðŸŽ‰\n\n---\n\n## ðŸ†˜ Troubleshooting\n\n### APK váº«n lá»›n sau khi split ABI?\n\n1. Kiá»ƒm tra assets folder:\n   ```bash\n   du -sh assets/\n   ```\n\n2. TÃ¬m files lá»›n nháº¥t:\n   ```bash\n   find assets -type f -exec du -h {} \\; | sort -rh | head -20\n   ```\n\n3. NÃ©n hoáº·c xÃ³a files khÃ´ng cáº§n\n\n### Build bá»‹ lá»—i vá»›i ProGuard?\n\nThÃªm vÃ o `android/app/proguard-rules.pro`:\n```\n-keep class io.flutter.** { *; }\n-keep class com.google.firebase.** { *; }\n```\n\n---\n\n## ðŸ’¡ Tips ThÃªm\n\n1. **Lazy load images** - Download images khi cáº§n thay vÃ¬ bundle\n2. **CDN for templates** - LÆ°u face swap templates trÃªn Supabase Storage\n3. **Dynamic Feature Modules** - TÃ¡ch features thÃ nh modules riÃªng\n4. **Remove unused fonts** - Chá»‰ include font weights Ä‘ang dÃ¹ng\n\n---\n\n**TÃ³m láº¡i:** Split ABI lÃ  cÃ¡ch nhanh nháº¥t giáº£m size. Káº¿t há»£p vá»›i nÃ©n assets cÃ³ thá»ƒ Ä‘áº¡t 40-60MB/APK! ðŸš€\n","size_bytes":5450},"railway_app.py":{"content":"#!/usr/bin/env python3\n\"\"\"\nRailway deployment entry point\nImports Flask app from api/index.py\nVersion: 1.0.1 - With API keys configured\n\"\"\"\nimport os\nimport sys\n\n# Add current directory to path\nsys.path.insert(0, os.path.dirname(os.path.abspath(__file__)))\n\n# Import Flask app from api/index.py\nfrom api.index import app\n\nif __name__ == '__main__':\n    port = int(os.getenv('PORT', 5000))\n    app.run(host='0.0.0.0', port=port, debug=False)\n","size_bytes":441},"railway.toml":{"content":"[deploy]\nhealthcheckPath = \"/\"\nhealthcheckTimeout = 300\n","size_bytes":56},"VERCEL_DEPLOYMENT.md":{"content":"# HÆ°á»›ng Dáº«n Deploy Backend Flask lÃªn Vercel\n\n## Táº¡i sao nÃªn dÃ¹ng Vercel thay vÃ¬ Replit?\n\nâœ… **URL cá»‘ Ä‘á»‹nh** - KhÃ´ng thay Ä‘á»•i khi restart\nâœ… **Miá»…n phÃ­** - Free tier Ä‘á»§ cho production\nâœ… **Tá»± Ä‘á»™ng scale** - Xá»­ lÃ½ tÄƒng traffic\nâœ… **Zero-config** - Deploy Flask chá»‰ vá»›i vÃ i click\n\n---\n\n## Chuáº©n bá»‹\n\n### 1. Cáº¥u trÃºc thÆ° má»¥c cáº§n thiáº¿t\n\nTáº¡o cáº¥u trÃºc sau cho Vercel:\n\n```\nyour-project/\nâ”œâ”€â”€ api/\nâ”‚   â””â”€â”€ index.py          # Flask app chÃ­nh\nâ”œâ”€â”€ services/             # CÃ¡c service hiá»‡n táº¡i\nâ”‚   â”œâ”€â”€ face_swap_gateway.py\nâ”‚   â””â”€â”€ ...\nâ”œâ”€â”€ requirements.txt      # Python dependencies\nâ””â”€â”€ vercel.json          # Config Vercel\n```\n\n### 2. Táº¡o file `api/index.py`\n\nDi chuyá»ƒn code tá»« `api_server.py` sang `api/index.py`:\n\n```python\nfrom flask import Flask, request, jsonify, send_from_directory\nfrom flask_cors import CORS\nimport os\nimport sys\n\n# Add parent directory to path\nsys.path.insert(0, os.path.dirname(os.path.dirname(os.path.abspath(__file__))))\n\nfrom services.face_swap_gateway import FaceSwapGateway\n\napp = Flask(__name__)\nCORS(app)\n\n# Initialize services\nface_swap_gateway = FaceSwapGateway()\n\n@app.route('/api/face-swap-v2', methods=['POST'])\ndef face_swap_v2():\n    # Your face swap logic here\n    pass\n\n@app.route('/api/ai/hd-image', methods=['POST'])\ndef hd_image():\n    # Your HD image logic here\n    pass\n\n# Add all other endpoints...\n\n@app.route('/')\ndef home():\n    return jsonify({\n        \"status\": \"online\",\n        \"service\": \"Viso AI Backend\",\n        \"version\": \"1.0.0\"\n    })\n```\n\n### 3. Táº¡o file `vercel.json`\n\n```json\n{\n  \"rewrites\": [\n    { \"source\": \"/(.*)\", \"destination\": \"/api/index\" }\n  ],\n  \"env\": {\n    \"REPLICATE_API_TOKEN\": \"@replicate_token\",\n    \"HUGGINGFACE_TOKEN\": \"@huggingface_token\",\n    \"SUPABASE_URL\": \"@supabase_url\",\n    \"SUPABASE_ANON_KEY\": \"@supabase_key\"\n  }\n}\n```\n\n### 4. Cáº­p nháº­t `requirements.txt`\n\n```txt\nFlask==3.0.3\nflask-cors==4.0.0\ngradio-client\npillow\nreplicate\nrequests\n```\n\n---\n\n## Deploy lÃªn Vercel\n\n### BÆ°á»›c 1: Táº¡o tÃ i khoáº£n Vercel\n\n1. Truy cáº­p [vercel.com](https://vercel.com)\n2. Sign up vá»›i GitHub account\n3. Authorize Vercel\n\n### BÆ°á»›c 2: Push code lÃªn GitHub\n\n```bash\ngit add .\ngit commit -m \"Prepare for Vercel deployment\"\ngit push origin main\n```\n\n### BÆ°á»›c 3: Import Project vÃ o Vercel\n\n1. VÃ o Vercel Dashboard â†’ **Add New** â†’ **Project**\n2. Chá»n repository cá»§a báº¡n\n3. Vercel tá»± Ä‘á»™ng detect Flask\n4. Click **Deploy**\n\n### BÆ°á»›c 4: ThÃªm Environment Variables\n\n1. VÃ o Project Settings â†’ **Environment Variables**\n2. ThÃªm cÃ¡c biáº¿n:\n   - `REPLICATE_API_TOKEN` = your-replicate-token\n   - `HUGGINGFACE_TOKEN` = your-hf-token\n   - `SUPABASE_URL` = your-supabase-url\n   - `SUPABASE_ANON_KEY` = your-supabase-key\n\n3. Click **Save**\n\n### BÆ°á»›c 5: Redeploy\n\n1. VÃ o **Deployments** tab\n2. Click **Redeploy** Ä‘á»ƒ Ã¡p dá»¥ng env vars\n\n---\n\n## Cáº­p nháº­t Flutter App\n\n### Thay Ä‘á»•i API URL trong Flutter\n\nMá»Ÿ `lib/services/huggingface_service.dart`:\n\n```dart\nclass HuggingfaceService {\n  // Thay Ä‘á»•i domain máº·c Ä‘á»‹nh sang Vercel\n  static const String _defaultApiDomain = 'your-project.vercel.app';\n  static const String _apiDomain = String.fromEnvironment('API_DOMAIN', defaultValue: _defaultApiDomain);\n  \n  static String get baseUrl {\n    if (kIsWeb) {\n      final origin = Uri.base.origin;\n      return '$origin/api/huggingface';\n    } else {\n      return 'https://$_apiDomain/api/huggingface';\n    }\n  }\n  \n  static String get aiBaseUrl {\n    if (kIsWeb) {\n      final origin = Uri.base.origin;\n      return '$origin/api/ai';\n    } else {\n      return 'https://$_apiDomain/api/ai';\n    }\n  }\n}\n```\n\n### Build láº¡i APK\n\n```bash\nflutter build apk --release --split-per-abi\n```\n\n---\n\n## Testing\n\n### Test API trÃªn Vercel\n\n```bash\n# Check status\ncurl https://your-project.vercel.app/\n\n# Test face swap\ncurl -X POST https://your-project.vercel.app/api/face-swap-v2 \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"source_image\": \"...\", \"target_image\": \"...\"}'\n```\n\n---\n\n## Lá»£i Ã­ch\n\nâœ… **URL cá»‘ Ä‘á»‹nh** - `https://your-project.vercel.app` khÃ´ng Ä‘á»•i\nâœ… **Tá»± Ä‘á»™ng deploy** - Push code lÃ  tá»± Ä‘á»™ng deploy\nâœ… **Free SSL** - HTTPS tá»± Ä‘á»™ng\nâœ… **Global CDN** - Nhanh á»Ÿ má»i khu vá»±c\nâœ… **Logs & Analytics** - Theo dÃµi lá»—i dá»… dÃ ng\n\n---\n\n## Alternative: Supabase Edge Functions\n\nâš ï¸ **LÆ°u Ã½**: Supabase Edge Functions **KHÃ”NG há»— trá»£ Python/Flask**\n\nNáº¿u muá»‘n dÃ¹ng Supabase:\n1. Viáº¿t láº¡i backend báº±ng **TypeScript/Deno**\n2. HOáº¶C deploy Flask á»Ÿ nÆ¡i khÃ¡c (Vercel/Fly.io) vÃ  gá»i tá»« Supabase\n\n**Recommendation**: DÃ¹ng Vercel cho Ä‘Æ¡n giáº£n nháº¥t!\n\n---\n\n## Troubleshooting\n\n### Lá»—i: \"502 Bad Gateway\"\n- Kiá»ƒm tra `requirements.txt` cÃ³ Ä‘áº§y Ä‘á»§ dependencies\n- Check Vercel logs: Project â†’ Deployments â†’ View Function Logs\n\n### Lá»—i: \"Unable to find Python version\"\n- VÃ o Settings â†’ General â†’ Node.js Version\n- Äá»•i sang **18.x**\n\n### API cháº¡y cháº­m\n- Vercel serverless cÃ³ cold start (~1-2s láº§n Ä‘áº§u)\n- Giáº£i phÃ¡p: Upgrade Vercel Pro hoáº·c dÃ¹ng Keep-Alive ping\n\n---\n\n## Chi phÃ­\n\n| Plan | GiÃ¡ | Limits |\n|------|-----|--------|\n| Hobby (Free) | $0 | 100GB bandwidth/month, 1000 invocations/day |\n| Pro | $20/month | 1TB bandwidth, unlimited invocations |\n\n**Káº¿t luáº­n**: Free tier Ä‘á»§ cho testing vÃ  MVP!\n","size_bytes":5436},"BUILD_INSTRUCTIONS.md":{"content":"# Mobile Build Instructions for Viso AI\n\n## Current Issue: Mobile App Using Outdated API Domain\n\nIf your mobile app is showing errors like `FormatException: Unexpected character`, it's likely because:\n1. The mobile app was built with an old Replit domain URL\n2. That old domain no longer exists (Replit domains change when the server restarts)\n3. The app receives HTML error pages instead of JSON responses\n\n## Quick Workaround: Use Flutter Web\n**Test the app on Flutter web instead of mobile** - it works immediately because it uses relative URLs that automatically adapt to the current domain.\n\nAccess your app at: `https://[your-current-replit-domain].replit.dev`\n\n## Temporary Workaround: Rebuild Mobile App\n\nâš ï¸ **IMPORTANT:** Rebuilding is only a **temporary fix**. The app will break again when Replit restarts with a new domain. For production, see \"Production Solution\" below.\n\n### Option 1: Build with Current Domain (Quick Fix)\nThe current Replit domain is already set as the default. Simply rebuild:\n\n```bash\n# Android\nflutter build apk --release\n\n# iOS\nflutter build ios --release\n```\n\n**Limitation:** This will break again when Replit restarts with a new domain.\n\n### Option 2: Build with Custom Domain (If Available)\nIf you have a stable custom domain, specify it at build time:\n\n```bash\n# Get current domain\nenv | grep DOMAIN\n\n# Build with custom domain\nflutter build apk --release --dart-define=API_DOMAIN=your-stable-domain.com\n\n# Build with current Replit domain (will break on restart)\nflutter build apk --release --dart-define=API_DOMAIN=8bf1f206-1bbf-468e-94c3-c805a85c0cc0-00-3pryuqwgngpev.sisko.replit.dev\n```\n\n**Limitation:** dart-define is compile-time only. Already-installed apps cannot be updated without rebuilding and redistributing.\n\n## Production Solution: Runtime Configuration (Required for Stability)\nFor production apps, implement runtime configuration using Firebase Remote Config (already included in the project):\n\n1. Store API domain in Firebase Remote Config\n2. Fetch domain at app startup\n3. No need to rebuild when domain changes\n\n## Why This Happens\n- **Flutter Web**: Uses `Uri.base.origin` which automatically gets the current domain âœ…\n- **Mobile Apps**: Need absolute URLs specified at compile time âŒ\n- **Replit**: Generates new domain IDs on each restart, breaking hardcoded URLs\n\n## Verification\nAfter rebuilding, check the logs when making API calls:\n```\nðŸŒ Making request to: https://[domain]/api/face-swap\n```\n\nIf you see the correct domain, the app will work properly.\n\n## Production Deployment Checklist\n- [ ] Use a stable custom domain (not Replit auto-generated domain)\n- [ ] OR implement Firebase Remote Config for dynamic API URL\n- [ ] Test both web and mobile versions before release\n- [ ] Document the API domain configuration for your team\n","size_bytes":2811}},"version":2}